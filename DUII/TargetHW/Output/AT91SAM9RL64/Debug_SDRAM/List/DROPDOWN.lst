###############################################################################
#                                                                             #
# IAR ANSI C/C++ Compiler V6.10.2.52244/W32 for ARM     14/Jul/2015  18:59:43 #
# Copyright 1999-2010 IAR Systems AB.                                         #
#                                                                             #
#    Cpu mode     =  arm                                                      #
#    Endian       =  little                                                   #
#    Source file  =  C:\DUII\TargetHW\GUI\DROPDOWN.c                          #
#    Command line =  C:\DUII\TargetHW\GUI\DROPDOWN.c -D DEBUG=1 -D            #
#                    SDRAM_TARGET=1 -D USB_IS_HIGH_SPEED -D                   #
#                    XIGNORE_TEMPERATURE -D BUILD_DEBUG_PORT -D PROFILER      #
#                    -lCN C:\DUII\TargetHW\Output\AT91SAM9RL64\Debug_SDRAM\Li #
#                    st\ -o C:\DUII\TargetHW\Output\AT91SAM9RL64\Debug_SDRAM\ #
#                    Obj\ --debug --endian=little --cpu=ARM926EJ-S -e         #
#                    --fpu=None --dlib_config "C:\Program Files (x86)\IAR     #
#                    Systems\Embedded Workbench 6.0\arm\INC\c\DLib_Config_Ful #
#                    l.h" -I C:\DUII\TargetHW\Application\SEGGERDEMO\ -I      #
#                    C:\DUII\TargetHW\Application\SEGGERDEMO\Src\ -I          #
#                    C:\DUII\TargetHW\Config\ -I C:\DUII\TargetHW\FS\ -I      #
#                    C:\DUII\TargetHW\GUI\ -I C:\DUII\TargetHW\Inc\ -I        #
#                    C:\DUII\TargetHW\OS\ -I C:\DUII\TargetHW\Setup\ -I       #
#                    \DUII\DUII\ -I \DUII\DUII\Graphics\ -I PROFILER\         #
#                    --cpu_mode arm -Ohs --use_c++_inline                     #
#                    --require_prototypes                                     #
#    List file    =  C:\DUII\TargetHW\Output\AT91SAM9RL64\Debug_SDRAM\List\DR #
#                    OPDOWN.lst                                               #
#    Object file  =  C:\DUII\TargetHW\Output\AT91SAM9RL64\Debug_SDRAM\Obj\DRO #
#                    PDOWN.o                                                  #
#                                                                             #
#                                                                             #
###############################################################################

C:\DUII\TargetHW\GUI\DROPDOWN.c
      1          /*********************************************************************
      2          *                SEGGER Microcontroller GmbH & Co. KG                *
      3          *        Solutions for real time microcontroller applications        *
      4          **********************************************************************
      5          *                                                                    *
      6          *        (c) 1996 - 2010  SEGGER Microcontroller GmbH & Co. KG       *
      7          *                                                                    *
      8          *        Internet: www.segger.com    Support:  support@segger.com    *
      9          *                                                                    *
     10          **********************************************************************
     11          
     12          ** emWin V5.06 - Graphical user interface for embedded applications **
     13          emWin is protected by international copyright laws.   Knowledge of the
     14          source code may not be used to write a similar product.  This file may
     15          only be used in accordance with a license and should not be re-
     16          distributed in any way. We appreciate your understanding and fairness.
     17          ----------------------------------------------------------------------
     18          File        : DROPDOWN.c
     19          Purpose     : Implementation of dropdown widget
     20          ---------------------------END-OF-HEADER------------------------------
     21          */
     22          
     23          #include <stdlib.h>
     24          #include <string.h>
     25          
     26          #include "GUI_ARRAY.h"
     27          #include "DROPDOWN.h"
     28          #include "DROPDOWN_Private.h"
     29          #include "SCROLLBAR.h"
     30          #include "WIDGET.h"
     31          #include "GUI_Debug.h"
     32          #include "GUI_Private.h"
     33          #include "WM_Intern.h"
     34          #include "LISTBOX.h"
     35          
     36          #if GUI_WINSUPPORT
     37          
     38          /*********************************************************************
     39          *
     40          *       Private config defaults
     41          *
     42          **********************************************************************
     43          */
     44          
     45          /* Define default fonts */
     46          #ifndef   DROPDOWN_FONT_DEFAULT
     47            #if   WIDGET_USE_SCHEME_SMALL
     48              #define DROPDOWN_FONT_DEFAULT &GUI_Font13_1
     49            #elif WIDGET_USE_SCHEME_MEDIUM
     50              #define DROPDOWN_FONT_DEFAULT &GUI_Font16_1
     51            #elif WIDGET_USE_SCHEME_LARGE
     52              #define DROPDOWN_FONT_DEFAULT &GUI_Font24_1
     53            #endif
     54          #endif
     55          
     56          /* Define colors */
     57          #ifndef   DROPDOWN_BKCOLOR0_DEFAULT
     58            #define DROPDOWN_BKCOLOR0_DEFAULT GUI_WHITE     /* Not selected */
     59          #endif
     60          
     61          #ifndef   DROPDOWN_BKCOLOR1_DEFAULT
     62            #define DROPDOWN_BKCOLOR1_DEFAULT GUI_GRAY      /* Selected, no focus */
     63          #endif
     64          
     65          #ifndef   DROPDOWN_BKCOLOR2_DEFAULT
     66            #define DROPDOWN_BKCOLOR2_DEFAULT GUI_BLUE      /* Selected, focus */
     67          #endif
     68          
     69          #ifndef   DROPDOWN_TEXTCOLOR0_DEFAULT
     70            #define DROPDOWN_TEXTCOLOR0_DEFAULT GUI_BLACK   /* Not selected */
     71          #endif
     72          
     73          #ifndef   DROPDOWN_TEXTCOLOR1_DEFAULT
     74            #define DROPDOWN_TEXTCOLOR1_DEFAULT GUI_WHITE   /* Selected, no focus */
     75          #endif
     76          
     77          #ifndef   DROPDOWN_TEXTCOLOR2_DEFAULT
     78            #define DROPDOWN_TEXTCOLOR2_DEFAULT GUI_WHITE   /* Selected, focus */
     79          #endif
     80          
     81          #ifndef   SCROLLBAR_COLOR_ARROW_DEFAULT
     82            #define SCROLLBAR_COLOR_ARROW_DEFAULT GUI_BLACK /* Arrow color */
     83          #endif
     84          
     85          #ifndef   SCROLLBAR_COLOR_BUTTON_DEFAULT
     86            #define SCROLLBAR_COLOR_BUTTON_DEFAULT 0xc0c0c0 /* Button color */
     87          #endif
     88          
     89          #ifndef   DROPDOWN_BORDER_DEFAULT
     90            #define DROPDOWN_BORDER_DEFAULT 2
     91          #endif
     92          
     93          #ifndef   DROPDOWN_ALIGN_DEFAULT
     94            #define DROPDOWN_ALIGN_DEFAULT GUI_TA_LEFT      /* Default text alignment */
     95          #endif
     96          
     97          #ifndef   DROPDOWN_KEY_EXPAND
     98            #define DROPDOWN_KEY_EXPAND GUI_KEY_SPACE
     99          #endif
    100          
    101          #ifndef   DROPDOWN_KEY_SELECT
    102            #define DROPDOWN_KEY_SELECT GUI_KEY_ENTER
    103          #endif
    104          
    105          #ifndef   DROPDOWN_DRAW_SKIN_DEFAULT
    106            #define DROPDOWN_DRAW_SKIN_DEFAULT NULL
    107          #endif
    108          
    109          /*********************************************************************
    110          *
    111          *       Static data
    112          *
    113          **********************************************************************
    114          */
    115          

   \                                 In section .data, align 4
    116          DROPDOWN_PROPS DROPDOWN__DefaultProps = {
   \                     DROPDOWN__DefaultProps:
   \   00000000   ........FFFF       DC32 GUI_Font13_1, 16777215, 8421504, 16711680, 0, 16777215, 16777215
   \              FF0080808000
   \              0000FF000000
   \              0000FFFFFF00
   \              FFFFFF00    
   \   0000001C   00000000C0C0       DC32 0, 12632256, 268435455, 268435455, 268435455, 0H
   \              C000FFFFFF0F
   \              FFFFFF0FFFFF
   \              FF0F00000000
   \   00000034   02000000           DC16 2, 0
    117            DROPDOWN_FONT_DEFAULT,
    118            {
    119              DROPDOWN_BKCOLOR0_DEFAULT,
    120              DROPDOWN_BKCOLOR1_DEFAULT,
    121              DROPDOWN_BKCOLOR2_DEFAULT,
    122            },
    123            {
    124              DROPDOWN_TEXTCOLOR0_DEFAULT,
    125              DROPDOWN_TEXTCOLOR1_DEFAULT,
    126              DROPDOWN_TEXTCOLOR2_DEFAULT,
    127            },
    128            {
    129              SCROLLBAR_COLOR_ARROW_DEFAULT,
    130              SCROLLBAR_COLOR_BUTTON_DEFAULT,
    131            },
    132            {
    133              GUI_INVALID_COLOR,
    134              GUI_INVALID_COLOR,
    135              GUI_INVALID_COLOR,
    136            },
    137            {
    138              DROPDOWN_DRAW_SKIN_DEFAULT
    139            },
    140            DROPDOWN_BORDER_DEFAULT,
    141            DROPDOWN_ALIGN_DEFAULT
    142          };
    143          
    144          WIDGET_SKIN const * DROPDOWN__pSkinDefault = &DROPDOWN__SkinClassic;
   \                     DROPDOWN__pSkinDefault:
   \   00000038   ........           DC32 DROPDOWN__SkinClassic
    145          
    146          /*********************************************************************
    147          *
    148          *       Static routines
    149          *
    150          **********************************************************************
    151          */
    152          /*********************************************************************
    153          *
    154          *       DROPDOWN__GetNumItems
    155          
    156            Returns:
    157              Number of fully or partially visible items
    158          */

   \                                 In section .text, align 4, keep-with-next
    159          int DROPDOWN__GetNumItems(DROPDOWN_Obj * pObj) {
    160            int NumItems;
    161            NumItems = GUI_ARRAY_GetNumItems(pObj->Handles);
    162            return NumItems;
   \                     DROPDOWN__GetNumItems:
   \   00000000   3C0090E5           LDR      R0,[R0, #+60]
   \   00000004   ........           B        GUI_ARRAY_GetNumItems  ;; tailcall
    163          }
    164          
    165          /*********************************************************************
    166          *
    167          *       _Tolower
    168          */
    169          static int _Tolower(int Key) {
    170            if ((Key >= 0x41) && (Key <= 0x5a)) {
    171              Key += 0x20;
    172            }
    173            return Key;
    174          }
    175          
    176          /*********************************************************************
    177          *
    178          *       _SelectByKey
    179          */

   \                                 In section .text, align 4, keep-with-next
    180          static void _SelectByKey(DROPDOWN_Handle hObj, int Key) {
   \                     _SelectByKey:
   \   00000000   B0472DE9           PUSH     {R4,R5,R7-R10,LR}
   \   00000004   04D04DE2           SUB      SP,SP,#+4
   \   00000008   0040A0E1           MOV      R4,R0
   \   0000000C   0170A0E1           MOV      R7,R1
    181            int i;
    182            DROPDOWN_Obj * pObj;
    183            int NumItems;
    184          
    185            pObj = DROPDOWN_LOCK_H(hObj);
   \   00000010   ........           BL       GUI_ALLOC_LockH
    186            NumItems = DROPDOWN__GetNumItems(pObj);
   \   00000014   3C0090E5           LDR      R0,[R0, #+60]
   \   00000018   ........           BL       GUI_ARRAY_GetNumItems
   \   0000001C   0080A0E1           MOV      R8,R0
    187            GUI_UNLOCK_H(pObj);
   \   00000020   ........           BL       GUI_ALLOC_UnlockH
    188            Key = _Tolower(Key);
   \   00000024   410047E2           SUB      R0,R7,#+65
   \   00000028   1A0050E3           CMP      R0,#+26
   \   0000002C   20708732           ADDCC    R7,R7,#+32
    189            for (i = 0; i < NumItems; i++) {
   \   00000030   0050A0E3           MOV      R5,#+0
   \   00000034   010058E3           CMP      R8,#+1
   \   00000038   320000BA           BLT      ??_SelectByKey_0
    190              const char * s;
    191              char c;
    192              s = DROPDOWN__GetpItemLocked(hObj, i);
   \                     ??_SelectByKey_1:
   \   0000003C   0090A0E3           MOV      R9,#+0
   \   00000040   0400A0E1           MOV      R0,R4
   \   00000044   ........           BL       GUI_ALLOC_LockH
   \   00000048   0510A0E1           MOV      R1,R5
   \   0000004C   3C0090E5           LDR      R0,[R0, #+60]
   \   00000050   ........           BL       GUI_ARRAY_GethItem
   \   00000054   00A0A0E1           MOV      R10,R0
   \   00000058   ........           BL       GUI_ALLOC_UnlockH
   \   0000005C   00005AE3           CMP      R10,#+0
   \   00000060   0200000A           BEQ      ??_SelectByKey_2
   \   00000064   0A00A0E1           MOV      R0,R10
   \   00000068   ........           BL       GUI_ALLOC_LockH
   \   0000006C   0090A0E1           MOV      R9,R0
    193              c = _Tolower(*s);
   \                     ??_SelectByKey_2:
   \   00000070   0090D9E5           LDRB     R9,[R9, #+0]
   \   00000074   410049E2           SUB      R0,R9,#+65
   \   00000078   1A0050E3           CMP      R0,#+26
   \   0000007C   20908932           ADDCC    R9,R9,#+32
    194              GUI_UNLOCK_H(s);
   \   00000080   ........           BL       GUI_ALLOC_UnlockH
    195              if (c == Key) {
   \   00000084   099CA0E1           MOV      R9,R9, LSL #+24
   \   00000088   290C57E1           CMP      R7,R9, LSR #+24
   \   0000008C   1A00001A           BNE      ??_SelectByKey_3
    196                DROPDOWN_SetSel(hObj, i);
   \   00000090   000054E3           CMP      R4,#+0
   \   00000094   1B00000A           BEQ      ??_SelectByKey_0
   \   00000098   ........           BL       GUI_Lock
   \   0000009C   0400A0E1           MOV      R0,R4
   \   000000A0   ........           BL       GUI_ALLOC_LockH
   \   000000A4   0070A0E1           MOV      R7,R0
   \   000000A8   3C0097E5           LDR      R0,[R7, #+60]
   \   000000AC   ........           BL       GUI_ARRAY_GetNumItems
   \   000000B0   000050E3           CMP      R0,#+0
   \   000000B4   01004012           SUBNE    R0,R0,#+1
   \   000000B8   050050E1           CMP      R0,R5
   \   000000BC   0050A0D1           MOVLE    R5,R0
   \   000000C0   F403D7E1           LDRSH    R0,[R7, #+52]
   \   000000C4   000055E1           CMP      R5,R0
   \   000000C8   0100001A           BNE      ??_SelectByKey_4
   \   000000CC   ........           BL       GUI_ALLOC_UnlockH
   \   000000D0   060000EA           B        ??_SelectByKey_5
   \                     ??_SelectByKey_4:
   \   000000D4   B453C7E1           STRH     R5,[R7, #+52]
   \   000000D8   ........           BL       GUI_ALLOC_UnlockH
   \   000000DC   0400A0E1           MOV      R0,R4
   \   000000E0   ........           BL       WM_InvalidateWindow
   \   000000E4   0410A0E3           MOV      R1,#+4
   \   000000E8   0400A0E1           MOV      R0,R4
   \   000000EC   ........           BL       WM_NotifyParent
   \                     ??_SelectByKey_5:
   \   000000F0   04D08DE2           ADD      SP,SP,#+4
   \   000000F4   B047BDE8           POP      {R4,R5,R7-R10,LR}
   \   000000F8   ........           B        GUI_Unlock       ;; tailcall
    197                break;
    198              }
    199            }
   \                     ??_SelectByKey_3:
   \   000000FC   015085E2           ADD      R5,R5,#+1
   \   00000100   080055E1           CMP      R5,R8
   \   00000104   CCFFFFBA           BLT      ??_SelectByKey_1
    200          }
   \                     ??_SelectByKey_0:
   \   00000108   04D08DE2           ADD      SP,SP,#+4        ;; stack cleaning
   \   0000010C   B087BDE8           POP      {R4,R5,R7-R10,PC}  ;; return
    201          
    202          /*********************************************************************
    203          *
    204          *       _FreeAttached
    205          */
    206          static void _FreeAttached(DROPDOWN_Handle hObj) {
    207            DROPDOWN_Obj * pObj;
    208            pObj = DROPDOWN_LOCK_H(hObj);
    209            GUI_ARRAY_Delete(pObj->Handles);
    210            WM_DeleteWindow(pObj->hListWin);
    211            GUI_ALLOC_Free(pObj->hDisabled);
    212            GUI_UNLOCK_H(pObj);
    213          }
    214          
    215          /*********************************************************************
    216          *
    217          *       _Paint
    218          */
    219          static void _Paint(DROPDOWN_Handle hObj) {
    220            DROPDOWN_Obj * pObj;
    221            WIDGET_PAINT * pfPaint;
    222          
    223            pObj = DROPDOWN_LOCK_H(hObj);
    224            pfPaint = pObj->pWidgetSkin->pfPaint;
    225            GUI_UNLOCK_H(pObj);
    226            if (pfPaint) {
    227              pfPaint(hObj);
    228            }
    229          }
    230          
    231          /*********************************************************************
    232          *
    233          *       _OnTouch
    234          */
    235          static int _OnTouch(DROPDOWN_Handle hObj, WM_MESSAGE * pMsg) {
    236            const GUI_PID_STATE * pState = (const GUI_PID_STATE *)pMsg->Data.p;
    237            if (pMsg->Data.p) {  /* Something happened in our area (pressed or released) */
    238              if (pState->Pressed) {
    239                WM_NotifyParent(hObj, WM_NOTIFICATION_CLICKED);
    240              } else {
    241                WM_NotifyParent(hObj, WM_NOTIFICATION_RELEASED);
    242              }
    243            } else {     /* Mouse moved out */
    244              WM_NotifyParent(hObj, WM_NOTIFICATION_MOVED_OUT);
    245            }
    246            return 0; /* Message handled */
    247          }
    248          
    249          /*********************************************************************
    250          *
    251          *       Private routines
    252          *
    253          **********************************************************************
    254          */
    255          /*********************************************************************
    256          *
    257          *       DROPDOWN__GetpItemLocked
    258          *
    259          * Returns:
    260          *   Pointer to the specified item in locked state. Note that caller
    261          *   need to unlock the pointer after use!
    262          */

   \                                 In section .text, align 4, keep-with-next
    263          const char * DROPDOWN__GetpItemLocked(DROPDOWN_Handle hObj, int Index) {
   \                     DROPDOWN__GetpItemLocked:
   \   00000000   30402DE9           PUSH     {R4,R5,LR}
   \   00000004   04D04DE2           SUB      SP,SP,#+4
   \   00000008   0140A0E1           MOV      R4,R1
    264            DROPDOWN_Obj * pObj;
    265            const char * s;
    266            WM_HMEM h;
    267          
    268            s = NULL;
   \   0000000C   0050A0E3           MOV      R5,#+0
    269            pObj = DROPDOWN_LOCK_H(hObj);
   \   00000010   ........           BL       GUI_ALLOC_LockH
    270            h = GUI_ARRAY_GethItem(pObj->Handles, Index);
   \   00000014   0410A0E1           MOV      R1,R4
   \   00000018   3C0090E5           LDR      R0,[R0, #+60]
   \   0000001C   ........           BL       GUI_ARRAY_GethItem
   \   00000020   0040A0E1           MOV      R4,R0
    271            GUI_UNLOCK_H(pObj);
   \   00000024   ........           BL       GUI_ALLOC_UnlockH
    272            if (h) {
   \   00000028   000054E3           CMP      R4,#+0
   \   0000002C   0200000A           BEQ      ??DROPDOWN__GetpItemLocked_0
    273              s = (const char *)GUI_LOCK_H(h);
   \   00000030   0400A0E1           MOV      R0,R4
   \   00000034   ........           BL       GUI_ALLOC_LockH
   \   00000038   0050A0E1           MOV      R5,R0
    274            }
    275            return s;
   \                     ??DROPDOWN__GetpItemLocked_0:
   \   0000003C   0500A0E1           MOV      R0,R5
   \   00000040   04D08DE2           ADD      SP,SP,#+4
   \   00000044   3080BDE8           POP      {R4,R5,PC}       ;; return
    276          }
    277          
    278          /*********************************************************************
    279          *
    280          *       DROPDOWN_LockH
    281          */
    282          #if GUI_DEBUG_LEVEL >= GUI_DEBUG_LEVEL_CHECK_ALL
    283          DROPDOWN_Obj * DROPDOWN_LockH(DROPDOWN_Handle h) {
    284            DROPDOWN_Obj * p = (DROPDOWN_Obj *)GUI_LOCK_H(h);
    285            if (p) {
    286              if (p->DebugId != DROPDOWN_ID) {
    287                GUI_DEBUG_ERROROUT("DROPDOWN.c: Wrong handle type or Object not init'ed");
    288                return 0;
    289              }
    290            }
    291            return p;
    292          }
    293          #endif
    294          
    295          /*********************************************************************
    296          *
    297          *       DROPDOWN__AdjustHeight
    298          */

   \                                 In section .text, align 4, keep-with-next
    299          void DROPDOWN__AdjustHeight(DROPDOWN_Handle hObj) {
   \                     DROPDOWN__AdjustHeight:
   \   00000000   70402DE9           PUSH     {R4-R6,LR}
   \   00000004   0040A0E1           MOV      R4,R0
    300            int Height, xSize;
    301            DROPDOWN_Obj * pObj;
    302            
    303            pObj = DROPDOWN_LOCK_H(hObj);
   \   00000008   ........           BL       GUI_ALLOC_LockH
   \   0000000C   0050A0E1           MOV      R5,R0
    304            Height = pObj->TextHeight;
   \   00000010   F803D5E1           LDRSH    R0,[R5, #+56]
    305            if (!Height) {
   \   00000014   000050E3           CMP      R0,#+0
   \   00000018   0100001A           BNE      ??DROPDOWN__AdjustHeight_0
    306              Height = GUI_GetYDistOfFont(pObj->Props.pFont);
   \   0000001C   4C0095E5           LDR      R0,[R5, #+76]
   \   00000020   ........           BL       GUI_GetYDistOfFont
    307            }
    308            Height += pObj->Widget.pEffect->EffectSize + 2 * pObj->Props.TextBorderSize;
   \                     ??DROPDOWN__AdjustHeight_0:
   \   00000024   2C1095E5           LDR      R1,[R5, #+44]
   \   00000028   F028D5E1           LDRSH    R2,[R5, #+128]
   \   0000002C   001091E5           LDR      R1,[R1, #+0]
   \   00000030   821081E0           ADD      R1,R1,R2, LSL #+1
   \   00000034   006081E0           ADD      R6,R1,R0
    309            xSize = WM__GetWindowSizeX(&pObj->Widget.Win);
   \   00000038   0500A0E1           MOV      R0,R5
   \   0000003C   ........           BL       WM__GetWindowSizeX
   \   00000040   0050A0E1           MOV      R5,R0
    310            GUI_UNLOCK_H(pObj);
   \   00000044   ........           BL       GUI_ALLOC_UnlockH
    311            WM_SetSize(hObj, xSize, Height);
   \   00000048   0620A0E1           MOV      R2,R6
   \   0000004C   0510A0E1           MOV      R1,R5
   \   00000050   0400A0E1           MOV      R0,R4
   \   00000054   7040BDE8           POP      {R4-R6,LR}
   \   00000058   ........           B        WM_SetSize       ;; tailcall
    312          }
    313          
    314          /*********************************************************************
    315          *
    316          *       Exported routines:  Callback
    317          *
    318          **********************************************************************
    319          */
    320          /*********************************************************************
    321          *
    322          *       DROPDOWN_Callback
    323          */

   \                                 In section .text, align 4, keep-with-next
    324          void DROPDOWN_Callback (WM_MESSAGE * pMsg) {
   \                     DROPDOWN_Callback:
   \   00000000   F0402DE9           PUSH     {R4-R7,LR}
   \   00000004   0040A0E1           MOV      R4,R0
    325            DROPDOWN_Handle hObj;
    326            DROPDOWN_Obj * pObj;
    327            char IsExpandedBeforeMsg;
    328            WM_HWIN hListWin;
    329          
    330            hObj = pMsg->hWin;
   \   00000008   045094E5           LDR      R5,[R4, #+4]
   \   0000000C   04D04DE2           SUB      SP,SP,#+4
    331            pObj = (DROPDOWN_Obj *)GUI_LOCK_H(hObj); /* Don't use use WIDGET_H2P because WIDGET_INIT_ID() has not be called at this point */
    332            hListWin = pObj->hListWin;
   \   00000010   0500A0E1           MOV      R0,R5
   \   00000014   ........           BL       GUI_ALLOC_LockH
   \   00000018   886090E5           LDR      R6,[R0, #+136]
    333            GUI_UNLOCK_H(pObj);
   \   0000001C   ........           BL       GUI_ALLOC_UnlockH
    334            IsExpandedBeforeMsg = hListWin ? 1 : 0;
   \   00000020   000056E3           CMP      R6,#+0
   \   00000024   0170A013           MOVNE    R7,#+1
   \   00000028   0070A003           MOVEQ    R7,#+0
    335            /* Let widget handle the standard messages */
    336            if (WIDGET_HandleActive(hObj, pMsg) == 0) {
   \   0000002C   0410A0E1           MOV      R1,R4
   \   00000030   0500A0E1           MOV      R0,R5
   \   00000034   ........           BL       WIDGET_HandleActive
   \   00000038   000050E3           CMP      R0,#+0
   \   0000003C   5C00000A           BEQ      ??DROPDOWN_Callback_1
    337              return;
    338            }
    339            switch (pMsg->MsgId) {
   \   00000040   000094E5           LDR      R0,[R4, #+0]
   \   00000044   0B0040E2           SUB      R0,R0,#+11
   \   00000048   1B0050E3           CMP      R0,#+27
   \   0000004C   00F18F90           ADDLS    PC,PC,R0, LSL #+2
   \                     ??DROPDOWN_Callback_0:
   \   00000050   5500008A           BHI      ??DROPDOWN_Callback_2
   \   00000054   B50000EA           B        ??DROPDOWN_Callback_3
   \   00000058   9D0000EA           B        ??DROPDOWN_Callback_4
   \   0000005C   520000EA           B        ??DROPDOWN_Callback_2
   \   00000060   BD0000EA           B        ??DROPDOWN_Callback_5
   \   00000064   A70000EA           B        ??DROPDOWN_Callback_6
   \   00000068   4F0000EA           B        ??DROPDOWN_Callback_2
   \   0000006C   8F0000EA           B        ??DROPDOWN_Callback_7
   \   00000070   4D0000EA           B        ??DROPDOWN_Callback_2
   \   00000074   4C0000EA           B        ??DROPDOWN_Callback_2
   \   00000078   4B0000EA           B        ??DROPDOWN_Callback_2
   \   0000007C   4A0000EA           B        ??DROPDOWN_Callback_2
   \   00000080   490000EA           B        ??DROPDOWN_Callback_2
   \   00000084   480000EA           B        ??DROPDOWN_Callback_2
   \   00000088   470000EA           B        ??DROPDOWN_Callback_2
   \   0000008C   460000EA           B        ??DROPDOWN_Callback_2
   \   00000090   450000EA           B        ??DROPDOWN_Callback_2
   \   00000094   440000EA           B        ??DROPDOWN_Callback_2
   \   00000098   430000EA           B        ??DROPDOWN_Callback_2
   \   0000009C   420000EA           B        ??DROPDOWN_Callback_2
   \   000000A0   410000EA           B        ??DROPDOWN_Callback_2
   \   000000A4   400000EA           B        ??DROPDOWN_Callback_2
   \   000000A8   3F0000EA           B        ??DROPDOWN_Callback_2
   \   000000AC   040000EA           B        ??DROPDOWN_Callback_8
   \   000000B0   3D0000EA           B        ??DROPDOWN_Callback_2
   \   000000B4   3C0000EA           B        ??DROPDOWN_Callback_2
   \   000000B8   3B0000EA           B        ??DROPDOWN_Callback_2
   \   000000BC   3A0000EA           B        ??DROPDOWN_Callback_2
   \   000000C0   3D0000EA           B        ??DROPDOWN_Callback_9
    340            case WM_NOTIFY_OWNER_KEY:
    341              /* Close the listbox if DROPDOWN_KEY_SELECT has been pressed */
    342              if (((const WM_KEY_INFO *)(pMsg->Data.p))->PressedCnt > 0) {
   \                     ??DROPDOWN_Callback_8:
   \   000000C4   0C0094E5           LDR      R0,[R4, #+12]
   \   000000C8   041090E5           LDR      R1,[R0, #+4]
   \   000000CC   010051E3           CMP      R1,#+1
   \   000000D0   350000BA           BLT      ??DROPDOWN_Callback_2
    343                int Key;
    344                Key = ((const WM_KEY_INFO *)(pMsg->Data.p))->Key;
    345                if (Key == DROPDOWN_KEY_SELECT) {
   \   000000D4   000090E5           LDR      R0,[R0, #+0]
   \   000000D8   0D0050E3           CMP      R0,#+13
   \   000000DC   3200001A           BNE      ??DROPDOWN_Callback_2
    346                  int Sel;
    347                  Sel = LISTBOX_GetSel(hListWin);
    348                  if (Sel > 0) {
   \   000000E0   0600A0E1           MOV      R0,R6
   \   000000E4   ........           BL       LISTBOX_GetSel
   \   000000E8   010050E3           CMP      R0,#+1
   \   000000EC   1C0000BA           BLT      ??DROPDOWN_Callback_10
    349                    DROPDOWN_SetSel(hObj, LISTBOX_GetSel(hListWin));
   \   000000F0   0600A0E1           MOV      R0,R6
   \   000000F4   ........           BL       LISTBOX_GetSel
   \   000000F8   0060A0E1           MOV      R6,R0
   \   000000FC   000055E3           CMP      R5,#+0
   \   00000100   2700000A           BEQ      ??DROPDOWN_Callback_11
   \   00000104   ........           BL       GUI_Lock
   \   00000108   0500A0E1           MOV      R0,R5
   \   0000010C   ........           BL       GUI_ALLOC_LockH
   \   00000110   0070A0E1           MOV      R7,R0
   \   00000114   3C0097E5           LDR      R0,[R7, #+60]
   \   00000118   ........           BL       GUI_ARRAY_GetNumItems
   \   0000011C   000050E3           CMP      R0,#+0
   \   00000120   01004012           SUBNE    R0,R0,#+1
   \   00000124   060050E1           CMP      R0,R6
   \   00000128   0060A0D1           MOVLE    R6,R0
   \   0000012C   F403D7E1           LDRSH    R0,[R7, #+52]
   \   00000130   000056E1           CMP      R6,R0
   \   00000134   0100001A           BNE      ??DROPDOWN_Callback_12
   \   00000138   ........           BL       GUI_ALLOC_UnlockH
   \   0000013C   060000EA           B        ??DROPDOWN_Callback_13
   \                     ??DROPDOWN_Callback_12:
   \   00000140   B463C7E1           STRH     R6,[R7, #+52]
   \   00000144   ........           BL       GUI_ALLOC_UnlockH
   \   00000148   0500A0E1           MOV      R0,R5
   \   0000014C   ........           BL       WM_InvalidateWindow
   \   00000150   0410A0E3           MOV      R1,#+4
   \   00000154   0500A0E1           MOV      R0,R5
   \   00000158   ........           BL       WM_NotifyParent
   \                     ??DROPDOWN_Callback_13:
   \   0000015C   ........           BL       GUI_Unlock
   \   00000160   010000EA           B        ??DROPDOWN_Callback_14
    350                  }
    351                  DROPDOWN_Collapse(hObj);
   \                     ??DROPDOWN_Callback_10:
   \   00000164   000055E3           CMP      R5,#+0
   \   00000168   0D00000A           BEQ      ??DROPDOWN_Callback_11
   \                     ??DROPDOWN_Callback_14:
   \   0000016C   ........           BL       GUI_Lock
   \   00000170   0500A0E1           MOV      R0,R5
   \   00000174   ........           BL       GUI_ALLOC_LockH
   \   00000178   0060A0E1           MOV      R6,R0
   \   0000017C   880096E5           LDR      R0,[R6, #+136]
   \   00000180   000050E3           CMP      R0,#+0
   \   00000184   0400000A           BEQ      ??DROPDOWN_Callback_15
   \   00000188   ........           BL       WM_DeleteWindow
   \   0000018C   0000A0E3           MOV      R0,#+0
   \   00000190   880086E5           STR      R0,[R6, #+136]
   \   00000194   0500A0E1           MOV      R0,R5
   \   00000198   ........           BL       WM_InvalidateWindow
   \                     ??DROPDOWN_Callback_15:
   \   0000019C   ........           BL       GUI_ALLOC_UnlockH
   \                     ??DROPDOWN_Callback_16:
   \   000001A0   ........           BL       GUI_Unlock
    352                  WM_SetFocus(hObj);
   \                     ??DROPDOWN_Callback_11:
   \   000001A4   0500A0E1           MOV      R0,R5
   \   000001A8   ........           BL       WM_SetFocus
    353                }
    354              }
    355              break;
    356            case WM_NOTIFY_PARENT:
    357              switch (pMsg->Data.v) {
    358              case WM_NOTIFICATION_SCROLL_CHANGED:
    359                WM_NotifyParent(hObj, WM_NOTIFICATION_SCROLL_CHANGED);
    360                break;
    361              case WM_NOTIFICATION_CLICKED:
    362                {
    363                  int Sel;
    364                  Sel = LISTBOX_GetSel(hListWin);
    365                  if (Sel >= 0)  {
    366                    DROPDOWN_SetSel(hObj, LISTBOX_GetSel(hListWin));
    367                    WM_SetFocus(hObj);
    368                  }
    369                }
    370                break;
    371              case LISTBOX_NOTIFICATION_LOST_FOCUS:
    372                DROPDOWN_Collapse(hObj);
    373                break;
    374              }
    375              break;
    376            case WM_PID_STATE_CHANGED:
    377              if (IsExpandedBeforeMsg == 0) {    /* Make sure we do not react a second time */
    378                const WM_PID_STATE_CHANGED_INFO * pInfo = (const WM_PID_STATE_CHANGED_INFO *)pMsg->Data.p;
    379                if (pInfo->State) {
    380                  DROPDOWN_Expand(hObj);
    381                }
    382              }
    383              break;
    384            case WM_TOUCH:
    385              if (_OnTouch(hObj, pMsg) == 0) {
    386                return;
    387              }
    388              break;
    389            case WM_PAINT:
    390              _Paint(hObj);
    391              break;
    392            case WM_DELETE:
    393              _FreeAttached(hObj);
    394              break;       /* No return here ... WM_DefaultProc needs to be called */
    395            case WM_KEY:
    396              if (((const WM_KEY_INFO *)(pMsg->Data.p))->PressedCnt >0) {
    397                int Key = ((const WM_KEY_INFO *)(pMsg->Data.p))->Key;
    398                switch (Key) {
    399                case DROPDOWN_KEY_EXPAND:
    400                  DROPDOWN_Expand(hObj);
    401                  break;
    402                case GUI_KEY_BACKTAB:
    403                  break;
    404                case GUI_KEY_TAB:
    405                  if (WM_GetFocussedWindow() == hListWin) {
    406                    WM_SetFocus(hObj);      /* Make sure, WM_SetFocusOnNextChild() works right when calling WM_DefaultProc() */
    407                  }
    408                  break;                    /* Send to parent by not doing anything */
    409                default:
    410                  DROPDOWN_AddKey(hObj, Key);
    411                  return;
    412                }
    413              }
    414              break;
    415            }
    416            WM_DefaultProc(pMsg);
   \                     ??DROPDOWN_Callback_2:
   \   000001AC   0400A0E1           MOV      R0,R4
   \   000001B0   ........           BL       WM_DefaultProc
    417          }
   \                     ??DROPDOWN_Callback_1:
   \   000001B4   04D08DE2           ADD      SP,SP,#+4        ;; stack cleaning
   \   000001B8   F080BDE8           POP      {R4-R7,PC}       ;; return
   \                     ??DROPDOWN_Callback_9:
   \   000001BC   0C0094E5           LDR      R0,[R4, #+12]
   \   000001C0   010050E2           SUBS     R0,R0,#+1
   \   000001C4   0800000A           BEQ      ??DROPDOWN_Callback_17
   \   000001C8   090050E2           SUBS     R0,R0,#+9
   \   000001CC   0200000A           BEQ      ??DROPDOWN_Callback_18
   \   000001D0   010050E2           SUBS     R0,R0,#+1
   \   000001D4   2400000A           BEQ      ??DROPDOWN_Callback_19
   \   000001D8   F3FFFFEA           B        ??DROPDOWN_Callback_2
   \                     ??DROPDOWN_Callback_18:
   \   000001DC   0A10A0E3           MOV      R1,#+10
   \   000001E0   0500A0E1           MOV      R0,R5
   \   000001E4   ........           BL       WM_NotifyParent
   \   000001E8   EFFFFFEA           B        ??DROPDOWN_Callback_2
   \                     ??DROPDOWN_Callback_17:
   \   000001EC   0600A0E1           MOV      R0,R6
   \   000001F0   ........           BL       LISTBOX_GetSel
   \   000001F4   000050E3           CMP      R0,#+0
   \   000001F8   EBFFFF4A           BMI      ??DROPDOWN_Callback_2
   \   000001FC   0600A0E1           MOV      R0,R6
   \   00000200   ........           BL       LISTBOX_GetSel
   \   00000204   0060A0E1           MOV      R6,R0
   \   00000208   000055E3           CMP      R5,#+0
   \   0000020C   E4FFFF0A           BEQ      ??DROPDOWN_Callback_11
   \   00000210   ........           BL       GUI_Lock
   \   00000214   0500A0E1           MOV      R0,R5
   \   00000218   ........           BL       GUI_ALLOC_LockH
   \   0000021C   0070A0E1           MOV      R7,R0
   \   00000220   3C0097E5           LDR      R0,[R7, #+60]
   \   00000224   ........           BL       GUI_ARRAY_GetNumItems
   \   00000228   000050E3           CMP      R0,#+0
   \   0000022C   01004012           SUBNE    R0,R0,#+1
   \   00000230   060050E1           CMP      R0,R6
   \   00000234   0060A0D1           MOVLE    R6,R0
   \   00000238   F403D7E1           LDRSH    R0,[R7, #+52]
   \   0000023C   000056E1           CMP      R6,R0
   \   00000240   0100001A           BNE      ??DROPDOWN_Callback_20
   \   00000244   ........           BL       GUI_ALLOC_UnlockH
   \   00000248   D4FFFFEA           B        ??DROPDOWN_Callback_16
   \                     ??DROPDOWN_Callback_20:
   \   0000024C   B463C7E1           STRH     R6,[R7, #+52]
   \   00000250   ........           BL       GUI_ALLOC_UnlockH
   \   00000254   0500A0E1           MOV      R0,R5
   \   00000258   ........           BL       WM_InvalidateWindow
   \   0000025C   0410A0E3           MOV      R1,#+4
   \   00000260   0500A0E1           MOV      R0,R5
   \   00000264   ........           BL       WM_NotifyParent
   \   00000268   CCFFFFEA           B        ??DROPDOWN_Callback_16
   \                     ??DROPDOWN_Callback_19:
   \   0000026C   000055E3           CMP      R5,#+0
   \   00000270   CDFFFF0A           BEQ      ??DROPDOWN_Callback_2
   \   00000274   ........           BL       GUI_Lock
   \   00000278   0500A0E1           MOV      R0,R5
   \   0000027C   ........           BL       GUI_ALLOC_LockH
   \   00000280   0060A0E1           MOV      R6,R0
   \   00000284   880096E5           LDR      R0,[R6, #+136]
   \   00000288   000050E3           CMP      R0,#+0
   \   0000028C   0400000A           BEQ      ??DROPDOWN_Callback_21
   \   00000290   ........           BL       WM_DeleteWindow
   \   00000294   0000A0E3           MOV      R0,#+0
   \   00000298   880086E5           STR      R0,[R6, #+136]
   \   0000029C   0500A0E1           MOV      R0,R5
   \   000002A0   ........           BL       WM_InvalidateWindow
   \                     ??DROPDOWN_Callback_21:
   \   000002A4   ........           BL       GUI_ALLOC_UnlockH
   \   000002A8   ........           BL       GUI_Unlock
   \   000002AC   BEFFFFEA           B        ??DROPDOWN_Callback_2
   \                     ??DROPDOWN_Callback_7:
   \   000002B0   000057E3           CMP      R7,#+0
   \   000002B4   BCFFFF1A           BNE      ??DROPDOWN_Callback_2
   \   000002B8   0C0094E5           LDR      R0,[R4, #+12]
   \   000002BC   0800D0E5           LDRB     R0,[R0, #+8]
   \   000002C0   000050E3           CMP      R0,#+0
   \   000002C4   B8FFFF0A           BEQ      ??DROPDOWN_Callback_2
   \                     ??DROPDOWN_Callback_22:
   \   000002C8   0500A0E1           MOV      R0,R5
   \   000002CC   ........           BL       DROPDOWN_Expand
   \   000002D0   B5FFFFEA           B        ??DROPDOWN_Callback_2
   \                     ??DROPDOWN_Callback_4:
   \   000002D4   0C0094E5           LDR      R0,[R4, #+12]
   \   000002D8   000050E3           CMP      R0,#+0
   \   000002DC   0300001A           BNE      ??DROPDOWN_Callback_23
   \   000002E0   0310A0E3           MOV      R1,#+3
   \                     ??DROPDOWN_Callback_24:
   \   000002E4   0500A0E1           MOV      R0,R5
   \   000002E8   ........           BL       WM_NotifyParent
   \   000002EC   B0FFFFEA           B        ??DROPDOWN_Callback_1
   \                     ??DROPDOWN_Callback_23:
   \   000002F0   0800D0E5           LDRB     R0,[R0, #+8]
   \   000002F4   000050E3           CMP      R0,#+0
   \   000002F8   0110A013           MOVNE    R1,#+1
   \   000002FC   F8FFFF1A           BNE      ??DROPDOWN_Callback_24
   \   00000300   0210A0E3           MOV      R1,#+2
   \   00000304   F6FFFFEA           B        ??DROPDOWN_Callback_24
   \                     ??DROPDOWN_Callback_6:
   \   00000308   0500A0E1           MOV      R0,R5
   \   0000030C   ........           BL       GUI_ALLOC_LockH
   \   00000310   840090E5           LDR      R0,[R0, #+132]
   \   00000314   006090E5           LDR      R6,[R0, #+0]
   \   00000318   ........           BL       GUI_ALLOC_UnlockH
   \   0000031C   000056E3           CMP      R6,#+0
   \   00000320   A1FFFF0A           BEQ      ??DROPDOWN_Callback_2
   \   00000324   0500A0E1           MOV      R0,R5
   \   00000328   36FF2FE1           BLX      R6
   \   0000032C   9EFFFFEA           B        ??DROPDOWN_Callback_2
   \                     ??DROPDOWN_Callback_3:
   \   00000330   0500A0E1           MOV      R0,R5
   \   00000334   ........           BL       GUI_ALLOC_LockH
   \   00000338   0050A0E1           MOV      R5,R0
   \   0000033C   3C0095E5           LDR      R0,[R5, #+60]
   \   00000340   ........           BL       GUI_ARRAY_Delete
   \   00000344   880095E5           LDR      R0,[R5, #+136]
   \   00000348   ........           BL       WM_DeleteWindow
   \   0000034C   940095E5           LDR      R0,[R5, #+148]
   \   00000350   ........           BL       GUI_ALLOC_Free
   \   00000354   ........           BL       GUI_ALLOC_UnlockH
   \   00000358   93FFFFEA           B        ??DROPDOWN_Callback_2
   \                     ??DROPDOWN_Callback_5:
   \   0000035C   0C0094E5           LDR      R0,[R4, #+12]
   \   00000360   041090E5           LDR      R1,[R0, #+4]
   \   00000364   010051E3           CMP      R1,#+1
   \   00000368   8FFFFFBA           BLT      ??DROPDOWN_Callback_2
   \   0000036C   007090E5           LDR      R7,[R0, #+0]
   \   00000370   090057E2           SUBS     R0,R7,#+9
   \   00000374   0400000A           BEQ      ??DROPDOWN_Callback_25
   \   00000378   010050E2           SUBS     R0,R0,#+1
   \   0000037C   8AFFFF0A           BEQ      ??DROPDOWN_Callback_2
   \   00000380   160050E2           SUBS     R0,R0,#+22
   \   00000384   0400001A           BNE      ??DROPDOWN_Callback_26
   \   00000388   CEFFFFEA           B        ??DROPDOWN_Callback_22
   \                     ??DROPDOWN_Callback_25:
   \   0000038C   ........           BL       WM_GetFocussedWindow
   \   00000390   060050E1           CMP      R0,R6
   \   00000394   84FFFF1A           BNE      ??DROPDOWN_Callback_2
   \   00000398   81FFFFEA           B        ??DROPDOWN_Callback_11
   \                     ??DROPDOWN_Callback_26:
   \   0000039C   000055E3           CMP      R5,#+0
   \   000003A0   83FFFF0A           BEQ      ??DROPDOWN_Callback_1
   \   000003A4   ........           BL       GUI_Lock
   \   000003A8   110057E2           SUBS     R0,R7,#+17
   \   000003AC   0200000A           BEQ      ??DROPDOWN_Callback_27
   \   000003B0   020050E2           SUBS     R0,R0,#+2
   \   000003B4   0300000A           BEQ      ??DROPDOWN_Callback_28
   \   000003B8   050000EA           B        ??DROPDOWN_Callback_29
   \                     ??DROPDOWN_Callback_27:
   \   000003BC   0500A0E1           MOV      R0,R5
   \   000003C0   ........           BL       DROPDOWN_DecSel
   \   000003C4   050000EA           B        ??DROPDOWN_Callback_30
   \                     ??DROPDOWN_Callback_28:
   \   000003C8   0500A0E1           MOV      R0,R5
   \   000003CC   ........           BL       DROPDOWN_IncSel
   \   000003D0   020000EA           B        ??DROPDOWN_Callback_30
   \                     ??DROPDOWN_Callback_29:
   \   000003D4   0710A0E1           MOV      R1,R7
   \   000003D8   0500A0E1           MOV      R0,R5
   \   000003DC   ........           BL       _SelectByKey
   \                     ??DROPDOWN_Callback_30:
   \   000003E0   ........           BL       GUI_Unlock
   \   000003E4   72FFFFEA           B        ??DROPDOWN_Callback_1
    418          
    419          /*********************************************************************
    420          *
    421          *       Exported routines:  Create
    422          *
    423          **********************************************************************
    424          */
    425          /*********************************************************************
    426          *
    427          *       DROPDOWN_CreateEx
    428          */

   \                                 In section .text, align 4, keep-with-next
    429          DROPDOWN_Handle DROPDOWN_CreateEx(int x0, int y0, int xsize, int ysize, WM_HWIN hParent,
    430                                            int WinFlags, int ExFlags, int Id)
    431          {
   \                     DROPDOWN_CreateEx:
   \   00000000   F04F2DE9           PUSH     {R4-R11,LR}
   \   00000004   14D04DE2           SUB      SP,SP,#+20
   \   00000008   0070A0E1           MOV      R7,R0
   \   0000000C   0180A0E1           MOV      R8,R1
   \   00000010   0290A0E1           MOV      R9,R2
   \   00000014   0340A0E1           MOV      R4,R3
   \   00000018   38A09DE5           LDR      R10,[SP, #+56]
   \   0000001C   3CB09DE5           LDR      R11,[SP, #+60]
   \   00000020   40509DE5           LDR      R5,[SP, #+64]
   \   00000024   44609DE5           LDR      R6,[SP, #+68]
    432            DROPDOWN_Handle hObj;
    433            GUI_ARRAY Handles;
    434            WM_LOCK();
   \   00000028   ........           BL       GUI_Lock
    435            hObj = WM_CreateWindowAsChild(x0, y0, xsize, -1, hParent, WinFlags, DROPDOWN_Callback,
    436                                          sizeof(DROPDOWN_Obj) - sizeof(WM_Obj));
   \   0000002C   6C00A0E3           MOV      R0,#+108
   \   00000030   0C008DE5           STR      R0,[SP, #+12]
   \   00000034   ........           LDR      R0,??DataTable0
   \   00000038   04B08DE5           STR      R11,[SP, #+4]
   \   0000003C   08008DE5           STR      R0,[SP, #+8]
   \   00000040   00A08DE5           STR      R10,[SP, #+0]
   \   00000044   0030E0E3           MVN      R3,#+0
   \   00000048   0920A0E1           MOV      R2,R9
   \   0000004C   0810A0E1           MOV      R1,R8
   \   00000050   0700A0E1           MOV      R0,R7
   \   00000054   ........           BL       WM_CreateWindowAsChild
   \   00000058   0070B0E1           MOVS     R7,R0
    437            if (hObj) {
   \   0000005C   3100000A           BEQ      ??DROPDOWN_CreateEx_0
    438              DROPDOWN_Obj * pObj;
    439              pObj = (DROPDOWN_Obj *)GUI_LOCK_H(hObj); /* Don't use use WIDGET_H2P because WIDGET_INIT_ID() has not be called at this point */
   \   00000060   ........           BL       GUI_ALLOC_LockH
   \   00000064   0080A0E1           MOV      R8,R0
    440              /* init widget specific variables */
    441              WIDGET__Init(&pObj->Widget, Id, WIDGET_STATE_FOCUSSABLE);
   \   00000068   1020A0E3           MOV      R2,#+16
   \   0000006C   0610A0E1           MOV      R1,R6
   \   00000070   ........           BL       WIDGET__Init
    442              pObj->Flags          = ExFlags;
   \   00000074   8C50C8E5           STRB     R5,[R8, #+140]
    443              pObj->Props          = DROPDOWN__DefaultProps;
   \   00000078   ........           LDR      R5,??DataTable0_1
   \   0000007C   4C0088E2           ADD      R0,R8,#+76
   \   00000080   4E52B5E8           LDM      R5!,{R1-R3,R6,R9,R12,LR}
   \   00000084   4E52A0E8           STM      R0!,{R1-R3,R6,R9,R12,LR}
   \   00000088   4E52B5E8           LDM      R5!,{R1-R3,R6,R9,R12,LR}
   \   0000008C   385045E2           SUB      R5,R5,#+56
   \   00000090   4E52A0E8           STM      R0!,{R1-R3,R6,R9,R12,LR}
    444              pObj->pWidgetSkin = DROPDOWN__pSkinDefault;
   \   00000094   380095E5           LDR      R0,[R5, #+56]
   \   00000098   840088E5           STR      R0,[R8, #+132]
    445              pObj->ScrollbarWidth = 0;
   \   0000009C   0000A0E3           MOV      R0,#+0
   \   000000A0   9000C8E5           STRB     R0,[R8, #+144]
    446              DROPDOWN_INIT_ID(pObj);
    447              pObj->ySizeEx = ysize;
   \   000000A4   B643C8E1           STRH     R4,[R8, #+54]
    448              DROPDOWN__AdjustHeight(hObj);
   \   000000A8   0700A0E1           MOV      R0,R7
   \   000000AC   ........           BL       GUI_ALLOC_LockH
   \   000000B0   0040A0E1           MOV      R4,R0
   \   000000B4   F803D4E1           LDRSH    R0,[R4, #+56]
   \   000000B8   000050E3           CMP      R0,#+0
   \   000000BC   0100001A           BNE      ??DROPDOWN_CreateEx_1
   \   000000C0   4C0094E5           LDR      R0,[R4, #+76]
   \   000000C4   ........           BL       GUI_GetYDistOfFont
   \                     ??DROPDOWN_CreateEx_1:
   \   000000C8   2C1094E5           LDR      R1,[R4, #+44]
   \   000000CC   F028D4E1           LDRSH    R2,[R4, #+128]
   \   000000D0   001091E5           LDR      R1,[R1, #+0]
   \   000000D4   821081E0           ADD      R1,R1,R2, LSL #+1
   \   000000D8   006081E0           ADD      R6,R1,R0
   \   000000DC   0400A0E1           MOV      R0,R4
   \   000000E0   ........           BL       WM__GetWindowSizeX
   \   000000E4   0040A0E1           MOV      R4,R0
   \   000000E8   ........           BL       GUI_ALLOC_UnlockH
   \   000000EC   0620A0E1           MOV      R2,R6
   \   000000F0   0410A0E1           MOV      R1,R4
   \   000000F4   0700A0E1           MOV      R0,R7
   \   000000F8   ........           BL       WM_SetSize
    449              /* Init sub-classes */
    450              GUI_UNLOCK_H(pObj);
   \   000000FC   ........           BL       GUI_ALLOC_UnlockH
    451              Handles = GUI_ARRAY_Create();
   \   00000100   ........           BL       GUI_ARRAY_Create
   \   00000104   0040A0E1           MOV      R4,R0
    452              pObj = DROPDOWN_LOCK_H(hObj);
    453              pObj->Handles = Handles;
   \   00000108   0700A0E1           MOV      R0,R7
   \   0000010C   ........           BL       GUI_ALLOC_LockH
   \   00000110   3C4080E5           STR      R4,[R0, #+60]
    454              GUI_UNLOCK_H(pObj);
   \   00000114   ........           BL       GUI_ALLOC_UnlockH
    455              DROPDOWN__pSkinDefault->pfCreate(hObj);
   \   00000118   381095E5           LDR      R1,[R5, #+56]
   \   0000011C   0700A0E1           MOV      R0,R7
   \   00000120   041091E5           LDR      R1,[R1, #+4]
   \   00000124   31FF2FE1           BLX      R1
    456            }
    457            WM_UNLOCK();
   \                     ??DROPDOWN_CreateEx_0:
   \   00000128   ........           BL       GUI_Unlock
    458            return hObj;
   \   0000012C   0700A0E1           MOV      R0,R7
   \   00000130   14D08DE2           ADD      SP,SP,#+20
   \   00000134   F08FBDE8           POP      {R4-R11,PC}      ;; return
    459          }
    460          
    461          /*********************************************************************
    462          *
    463          *       Exported routines:  Various methods
    464          *
    465          **********************************************************************
    466          */
    467          /*********************************************************************
    468          *
    469          *       DROPDOWN_Collapse
    470          */

   \                                 In section .text, align 4, keep-with-next
    471          void DROPDOWN_Collapse(DROPDOWN_Handle hObj) {
   \                     DROPDOWN_Collapse:
   \   00000000   70402DE9           PUSH     {R4-R6,LR}
   \   00000004   0040B0E1           MOVS     R4,R0
    472            DROPDOWN_Obj * pObj;
    473            if (hObj) {
   \   00000008   0D00000A           BEQ      ??DROPDOWN_Collapse_0
    474              WM_LOCK();
   \   0000000C   ........           BL       GUI_Lock
    475              pObj = DROPDOWN_LOCK_H(hObj);
   \   00000010   0400A0E1           MOV      R0,R4
   \   00000014   ........           BL       GUI_ALLOC_LockH
   \   00000018   0050A0E1           MOV      R5,R0
    476              if (pObj->hListWin) {
   \   0000001C   880095E5           LDR      R0,[R5, #+136]
   \   00000020   0060A0E3           MOV      R6,#+0
   \   00000024   000050E3           CMP      R0,#+0
   \   00000028   0300000A           BEQ      ??DROPDOWN_Collapse_1
    477                WM_DeleteWindow(pObj->hListWin);
   \   0000002C   ........           BL       WM_DeleteWindow
    478                pObj->hListWin = 0;
   \   00000030   886085E5           STR      R6,[R5, #+136]
    479                WM_InvalidateWindow(hObj);
   \   00000034   0400A0E1           MOV      R0,R4
   \   00000038   ........           BL       WM_InvalidateWindow
    480              }
    481              GUI_UNLOCK_H(pObj);
   \                     ??DROPDOWN_Collapse_1:
   \   0000003C   ........           BL       GUI_ALLOC_UnlockH
    482              WM_UNLOCK();
   \   00000040   ........           BL       GUI_Unlock
    483            }
    484          }
   \                     ??DROPDOWN_Collapse_0:
   \   00000044   7080BDE8           POP      {R4-R6,PC}       ;; return
    485          
    486          /*********************************************************************
    487          *
    488          *       DROPDOWN_Expand
    489          */

   \                                 In section .text, align 4, keep-with-next
    490          void DROPDOWN_Expand(DROPDOWN_Handle hObj) {
   \                     DROPDOWN_Expand:
   \   00000000   F04F2DE9           PUSH     {R4-R11,LR}
   \   00000004   4CD04DE2           SUB      SP,SP,#+76
   \   00000008   0050B0E1           MOVS     R5,R0
    491            #if WIDGET_USE_PARENT_EFFECT
    492              const WIDGET_EFFECT * pEffect;
    493            #endif
    494            int xSize, ySize, i, NumItems;
    495            WM_HWIN hListWin;
    496            GUI_RECT r;
    497            GUI_RECT RectParent;
    498            WM_Obj * pParent;
    499            DROPDOWN_Obj * pObj;
    500            U8 ScrollbarWidth;
    501            U8 Flags;
    502            I16 Sel;
    503            GUI_ARRAY Handles;
    504            U8 * pDisabled;
    505            U16  nDisabled;
    506            U16  ItemSpacing;
    507            I16  Align;
    508            const GUI_FONT GUI_UNI_PTR * pFont;
    509            WM_HMEM hString;
    510            GUI_COLOR aBackColor[3];
    511            GUI_COLOR aTextColor[3];
    512            GUI_COLOR aScrollbarColor[3];
    513            WM_HMEM hDisabled;
    514          
    515            if (hObj == 0) {
   \   0000000C   D200000A           BEQ      ??DROPDOWN_Expand_0
    516              return;
    517            }
    518            WM_LOCK();
   \   00000010   ........           BL       GUI_Lock
    519            //
    520            // Get object properties
    521            //
    522            pObj = DROPDOWN_LOCK_H(hObj);
   \   00000014   0500A0E1           MOV      R0,R5
   \   00000018   ........           BL       GUI_ALLOC_LockH
   \   0000001C   00A0A0E1           MOV      R10,R0
    523            xSize          = WM_GetWindowSizeX(hObj);
   \   00000020   0500A0E1           MOV      R0,R5
   \   00000024   ........           BL       WM_GetWindowSizeX
    524            ySize          = pObj->ySizeEx;
   \   00000028   F613DAE1           LDRSH    R1,[R10, #+54]
   \   0000002C   0060A0E1           MOV      R6,R0
   \   00000030   20108DE5           STR      R1,[SP, #+32]
    525            ScrollbarWidth = pObj->ScrollbarWidth;
   \   00000034   9010DAE5           LDRB     R1,[R10, #+144]
   \   00000038   0C10CDE5           STRB     R1,[SP, #+12]
    526            Handles        = pObj->Handles;
    527            Flags          = pObj->Flags;
   \   0000003C   8C20DAE5           LDRB     R2,[R10, #+140]
   \   00000040   3C009AE5           LDR      R0,[R10, #+60]
   \   00000044   1C208DE5           STR      R2,[SP, #+28]
    528            Sel            = pObj->Sel;
   \   00000048   F423DAE1           LDRSH    R2,[R10, #+52]
   \   0000004C   0040A0E1           MOV      R4,R0
   \   00000050   B821CDE1           STRH     R2,[SP, #+24]
    529            NumItems       = DROPDOWN__GetNumItems(pObj);
   \   00000054   ........           BL       GUI_ARRAY_GetNumItems
    530            ItemSpacing    = pObj->ItemSpacing;
   \   00000058   BE18DAE1           LDRH     R1,[R10, #+142]
   \   0000005C   0070A0E1           MOV      R7,R0
    531            Align          = pObj->Props.Align;
    532            pFont          = pObj->Props.pFont;
    533            r              = pObj->Widget.Win.Rect;
   \   00000060   10008DE2           ADD      R0,SP,#+16
   \   00000064   BE10CDE1           STRH     R1,[SP, #+14]
   \   00000068   4C109AE5           LDR      R1,[R10, #+76]
   \   0000006C   F288DAE1           LDRSH    R8,[R10, #+130]
   \   00000070   24108DE5           STR      R1,[SP, #+36]
   \   00000074   0A10A0E1           MOV      R1,R10
   \   00000078   0820A0E3           MOV      R2,#+8
   \   0000007C   ........           BL       __aeabi_memcpy
    534            hDisabled      = pObj->hDisabled;
   \   00000080   94909AE5           LDR      R9,[R10, #+148]
    535            #if WIDGET_USE_PARENT_EFFECT
    536              pEffect      = pObj->Widget.pEffect;
    537            #endif
    538            for (i = 0; i < GUI_COUNTOF(pObj->Props.aBackColor); i++) {
   \   00000084   40008DE2           ADD      R0,SP,#+64
   \   00000088   0A10A0E1           MOV      R1,R10
   \   0000008C   0320A0E3           MOV      R2,#+3
    539              aBackColor[i] = pObj->Props.aBackColor[i];
   \                     ??DROPDOWN_Expand_1:
   \   00000090   503091E5           LDR      R3,[R1, #+80]
    540            }
   \   00000094   041081E2           ADD      R1,R1,#+4
   \   00000098   043080E4           STR      R3,[R0], #+4
   \   0000009C   012052E2           SUBS     R2,R2,#+1
   \   000000A0   FAFFFF1A           BNE      ??DROPDOWN_Expand_1
    541            for (i = 0; i < GUI_COUNTOF(pObj->Props.aTextColor); i++) {
   \   000000A4   34008DE2           ADD      R0,SP,#+52
   \   000000A8   0A10A0E1           MOV      R1,R10
   \   000000AC   0320A0E3           MOV      R2,#+3
    542              aTextColor[i] = pObj->Props.aTextColor[i];
   \                     ??DROPDOWN_Expand_2:
   \   000000B0   5C3091E5           LDR      R3,[R1, #+92]
    543            }
   \   000000B4   041081E2           ADD      R1,R1,#+4
   \   000000B8   043080E4           STR      R3,[R0], #+4
   \   000000BC   012052E2           SUBS     R2,R2,#+1
   \   000000C0   FAFFFF1A           BNE      ??DROPDOWN_Expand_2
    544            for (i = 0; i < GUI_COUNTOF(pObj->Props.aScrollbarColor); i++) {
   \   000000C4   28008DE2           ADD      R0,SP,#+40
   \   000000C8   0310A0E3           MOV      R1,#+3
    545              aScrollbarColor[i] = pObj->Props.aScrollbarColor[i];
   \                     ??DROPDOWN_Expand_3:
   \   000000CC   70209AE5           LDR      R2,[R10, #+112]
    546            }
   \   000000D0   04A08AE2           ADD      R10,R10,#+4
   \   000000D4   042080E4           STR      R2,[R0], #+4
   \   000000D8   011051E2           SUBS     R1,R1,#+1
   \   000000DC   FAFFFF1A           BNE      ??DROPDOWN_Expand_3
    547            GUI_UNLOCK_H(pObj);
   \   000000E0   ........           BL       GUI_ALLOC_UnlockH
    548            //
    549            // Get parent properties
    550            //
    551            pParent = (WM_Obj *)GUI_LOCK_H(WM_GetParent(hObj));
   \   000000E4   0500A0E1           MOV      R0,R5
   \   000000E8   ........           BL       WM_GetParent
   \   000000EC   ........           BL       GUI_ALLOC_LockH
    552            RectParent = pParent->Rect;
   \   000000F0   F0A0D0E1           LDRSH    R10,[R0, #+0]
   \   000000F4   F2B0D0E1           LDRSH    R11,[R0, #+2]
    553            GUI_UNLOCK_H(pParent);
   \   000000F8   ........           BL       GUI_ALLOC_UnlockH
    554            //
    555            // Calculate position and size of listview
    556            //
    557            GUI_MoveRect(&r, -RectParent.x0, -RectParent.y0);
   \   000000FC   00206BE2           RSB      R2,R11,#+0
   \   00000100   00106AE2           RSB      R1,R10,#+0
   \   00000104   10008DE2           ADD      R0,SP,#+16
   \   00000108   ........           BL       GUI_MoveRect
    558            if (Flags & DROPDOWN_CF_UP) {
   \   0000010C   1C009DE5           LDR      R0,[SP, #+28]
   \   00000110   020010E3           TST      R0,#0x2
   \   00000114   0400000A           BEQ      ??DROPDOWN_Expand_4
    559              r.y0 -= ySize;
   \   00000118   F201DDE1           LDRSH    R0,[SP, #+18]
   \   0000011C   20109DE5           LDR      R1,[SP, #+32]
   \   00000120   010040E0           SUB      R0,R0,R1
   \   00000124   B201CDE1           STRH     R0,[SP, #+18]
   \   00000128   010000EA           B        ??DROPDOWN_Expand_5
    560            } else {
    561              r.y0 = r.y1;
   \                     ??DROPDOWN_Expand_4:
   \   0000012C   F611DDE1           LDRSH    R1,[SP, #+22]
   \   00000130   B211CDE1           STRH     R1,[SP, #+18]
    562            }
    563            //
    564            // Create listview
    565            //
    566            hListWin = LISTBOX_CreateAsChild(NULL, WM_GetParent(hObj), r.x0, r.y0, xSize, ySize, WM_CF_SHOW);
   \                     ??DROPDOWN_Expand_5:
   \   00000134   0500A0E1           MOV      R0,R5
   \   00000138   ........           BL       WM_GetParent
   \   0000013C   0210A0E3           MOV      R1,#+2
   \   00000140   08108DE5           STR      R1,[SP, #+8]
   \   00000144   20109DE5           LDR      R1,[SP, #+32]
   \   00000148   00608DE5           STR      R6,[SP, #+0]
   \   0000014C   04108DE5           STR      R1,[SP, #+4]
   \   00000150   0010A0E1           MOV      R1,R0
   \   00000154   F231DDE1           LDRSH    R3,[SP, #+18]
   \   00000158   F021DDE1           LDRSH    R2,[SP, #+16]
   \   0000015C   0000A0E3           MOV      R0,#+0
   \   00000160   ........           BL       LISTBOX_CreateAsChild
   \   00000164   0060A0E1           MOV      R6,R0
    567            #if WIDGET_USE_PARENT_EFFECT
    568              WIDGET_SetEffect(hListWin, pEffect);
    569            #endif
    570            //
    571            // Set scrollbar behavior of listbox
    572            //
    573            if (Flags & DROPDOWN_SF_AUTOSCROLLBAR) {
   \   00000168   1C009DE5           LDR      R0,[SP, #+28]
   \   0000016C   010010E3           TST      R0,#0x1
   \   00000170   0500000A           BEQ      ??DROPDOWN_Expand_6
    574              LISTBOX_SetScrollbarWidth(hListWin, ScrollbarWidth);
   \   00000174   0C10DDE5           LDRB     R1,[SP, #+12]
   \   00000178   0600A0E1           MOV      R0,R6
   \   0000017C   ........           BL       LISTBOX_SetScrollbarWidth
    575              LISTBOX_SetAutoScrollV(hListWin, 1);
   \   00000180   0110A0E3           MOV      R1,#+1
   \   00000184   0600A0E1           MOV      R0,R6
   \   00000188   ........           BL       LISTBOX_SetAutoScrollV
    576            }
    577            //
    578            // Copy data to listbox
    579            //
    580            for (i = 0; i< NumItems; i++) {
   \                     ??DROPDOWN_Expand_6:
   \   0000018C   00B0A0E3           MOV      R11,#+0
   \   00000190   010057E3           CMP      R7,#+1
   \   00000194   1A0000BA           BLT      ??DROPDOWN_Expand_7
   \   00000198   010017E3           TST      R7,#0x1
   \   0000019C   0600000A           BEQ      ??DROPDOWN_Expand_8
    581              hString = GUI_ARRAY_GethItem(Handles, i);
   \   000001A0   0010A0E3           MOV      R1,#+0
   \   000001A4   0400A0E1           MOV      R0,R4
   \   000001A8   ........           BL       GUI_ARRAY_GethItem
    582              LISTBOX_AddStringH(hListWin, hString);
   \   000001AC   0010A0E1           MOV      R1,R0
   \   000001B0   0600A0E1           MOV      R0,R6
   \   000001B4   ........           BL       LISTBOX_AddStringH
   \   000001B8   01B0A0E3           MOV      R11,#+1
   \                     ??DROPDOWN_Expand_8:
   \   000001BC   A770B0E1           LSRS     R7,R7,#+1
   \   000001C0   0F00000A           BEQ      ??DROPDOWN_Expand_7
   \                     ??DROPDOWN_Expand_9:
   \   000001C4   0B10A0E1           MOV      R1,R11
   \   000001C8   0400A0E1           MOV      R0,R4
   \   000001CC   ........           BL       GUI_ARRAY_GethItem
   \   000001D0   0010A0E1           MOV      R1,R0
   \   000001D4   0600A0E1           MOV      R0,R6
   \   000001D8   ........           BL       LISTBOX_AddStringH
   \   000001DC   01B08BE2           ADD      R11,R11,#+1
   \   000001E0   0B10A0E1           MOV      R1,R11
   \   000001E4   0400A0E1           MOV      R0,R4
   \   000001E8   ........           BL       GUI_ARRAY_GethItem
   \   000001EC   0010A0E1           MOV      R1,R0
   \   000001F0   0600A0E1           MOV      R0,R6
   \   000001F4   ........           BL       LISTBOX_AddStringH
    583            }
   \   000001F8   01B08BE2           ADD      R11,R11,#+1
   \   000001FC   017057E2           SUBS     R7,R7,#+1
   \   00000200   EFFFFF1A           BNE      ??DROPDOWN_Expand_9
    584            //
    585            // Set colors of listbox
    586            //
    587            for (i = 0; i < GUI_COUNTOF(pObj->Props.aBackColor); i++) {
   \                     ??DROPDOWN_Expand_7:
   \   00000204   40408DE2           ADD      R4,SP,#+64
    588              LISTBOX_SetBkColor(hListWin, i, aBackColor[i]);
   \   00000208   40209DE5           LDR      R2,[SP, #+64]
   \   0000020C   0010A0E3           MOV      R1,#+0
   \   00000210   0600A0E1           MOV      R0,R6
   \   00000214   ........           BL       LISTBOX_SetBkColor
   \   00000218   042094E5           LDR      R2,[R4, #+4]
   \   0000021C   0110A0E3           MOV      R1,#+1
   \   00000220   0600A0E1           MOV      R0,R6
   \   00000224   ........           BL       LISTBOX_SetBkColor
   \   00000228   082094E5           LDR      R2,[R4, #+8]
   \   0000022C   0210A0E3           MOV      R1,#+2
   \   00000230   0600A0E1           MOV      R0,R6
   \   00000234   ........           BL       LISTBOX_SetBkColor
    589            }
    590            for (i = 0; i < GUI_COUNTOF(pObj->Props.aTextColor); i++) {
   \   00000238   34408DE2           ADD      R4,SP,#+52
    591              LISTBOX_SetTextColor(hListWin, i, aTextColor[i]);
   \   0000023C   34209DE5           LDR      R2,[SP, #+52]
   \   00000240   0010A0E3           MOV      R1,#+0
   \   00000244   0600A0E1           MOV      R0,R6
   \   00000248   ........           BL       LISTBOX_SetTextColor
   \   0000024C   042094E5           LDR      R2,[R4, #+4]
   \   00000250   0110A0E3           MOV      R1,#+1
   \   00000254   0600A0E1           MOV      R0,R6
   \   00000258   ........           BL       LISTBOX_SetTextColor
   \   0000025C   082094E5           LDR      R2,[R4, #+8]
   \   00000260   0210A0E3           MOV      R1,#+2
   \   00000264   0600A0E1           MOV      R0,R6
   \   00000268   ........           BL       LISTBOX_SetTextColor
    592            }
    593            for (i = 0; i < GUI_COUNTOF(pObj->Props.aScrollbarColor); i++) {
   \   0000026C   28408DE2           ADD      R4,SP,#+40
    594              LISTBOX_SetScrollbarColor(hListWin, i, aScrollbarColor[i]);
   \   00000270   28209DE5           LDR      R2,[SP, #+40]
   \   00000274   0010A0E3           MOV      R1,#+0
   \   00000278   0600A0E1           MOV      R0,R6
   \   0000027C   ........           BL       LISTBOX_SetScrollbarColor
   \   00000280   042094E5           LDR      R2,[R4, #+4]
   \   00000284   0110A0E3           MOV      R1,#+1
   \   00000288   0600A0E1           MOV      R0,R6
   \   0000028C   ........           BL       LISTBOX_SetScrollbarColor
   \   00000290   082094E5           LDR      R2,[R4, #+8]
   \   00000294   0210A0E3           MOV      R1,#+2
   \   00000298   0600A0E1           MOV      R0,R6
   \   0000029C   ........           BL       LISTBOX_SetScrollbarColor
    595            }
    596            //
    597            // Set disabled state(s)
    598            //
    599            if (hDisabled) {
   \   000002A0   000059E3           CMP      R9,#+0
   \   000002A4   1300000A           BEQ      ??DROPDOWN_Expand_10
    600              pDisabled = (U8 *)GUI_LOCK_H(hDisabled);
   \   000002A8   0900A0E1           MOV      R0,R9
   \   000002AC   ........           BL       GUI_ALLOC_LockH
   \   000002B0   0040A0E1           MOV      R4,R0
    601              nDisabled = *(U16 *)pDisabled;
   \   000002B4   B270D4E0           LDRH     R7,[R4], #+2
    602              pDisabled += sizeof(U16);
    603              for (i = 0; i < nDisabled; i++) {
   \   000002B8   00B0A0E3           MOV      R11,#+0
   \   000002BC   010057E3           CMP      R7,#+1
   \   000002C0   0B0000BA           BLT      ??DROPDOWN_Expand_11
    604                LISTBOX_SetItemDisabled(hListWin, i, *(pDisabled + (i >> 3)) & (1 << (i & 7)) ? 1 : 0);
   \                     ??DROPDOWN_Expand_12:
   \   000002C4   CB01D4E7           LDRB     R0,[R4, +R11, ASR #+3]
   \   000002C8   0110A0E3           MOV      R1,#+1
   \   000002CC   07200BE2           AND      R2,R11,#0x7
   \   000002D0   110210E1           TST      R0,R1, LSL R2
   \   000002D4   0120A013           MOVNE    R2,#+1
   \   000002D8   0020A003           MOVEQ    R2,#+0
   \   000002DC   0B10A0E1           MOV      R1,R11
   \   000002E0   0600A0E1           MOV      R0,R6
   \   000002E4   ........           BL       LISTBOX_SetItemDisabled
    605              }
   \   000002E8   01B08BE2           ADD      R11,R11,#+1
   \   000002EC   07005BE1           CMP      R11,R7
   \   000002F0   F3FFFFBA           BLT      ??DROPDOWN_Expand_12
    606              GUI_UNLOCK_H(pDisabled);
   \                     ??DROPDOWN_Expand_11:
   \   000002F4   ........           BL       GUI_ALLOC_UnlockH
    607            }
    608            //
    609            // Set remaining properties of listview
    610            //
    611            LISTBOX_SetItemSpacing(hListWin, ItemSpacing);
   \                     ??DROPDOWN_Expand_10:
   \   000002F8   BE10DDE1           LDRH     R1,[SP, #+14]
   \   000002FC   0600A0E1           MOV      R0,R6
   \   00000300   ........           BL       LISTBOX_SetItemSpacing
    612            LISTBOX_SetFont(hListWin, pFont);
   \   00000304   24109DE5           LDR      R1,[SP, #+36]
   \   00000308   0600A0E1           MOV      R0,R6
   \   0000030C   ........           BL       LISTBOX_SetFont
    613            LISTBOX_SetTextAlign(hListWin, Align);
   \   00000310   0810A0E1           MOV      R1,R8
   \   00000314   0600A0E1           MOV      R0,R6
   \   00000318   ........           BL       LISTBOX_SetTextAlign
    614            WM_SetFocus(hListWin);
   \   0000031C   0600A0E1           MOV      R0,R6
   \   00000320   ........           BL       WM_SetFocus
    615            LISTBOX_SetOwner(hListWin, hObj);
   \   00000324   0510A0E1           MOV      R1,R5
   \   00000328   0600A0E1           MOV      R0,R6
   \   0000032C   ........           BL       LISTBOX_SetOwner
    616            LISTBOX_SetSel(hListWin, Sel);
   \   00000330   F811DDE1           LDRSH    R1,[SP, #+24]
   \   00000334   0600A0E1           MOV      R0,R6
   \   00000338   ........           BL       LISTBOX_SetSel
    617            WM_NotifyParent(hObj, WM_NOTIFICATION_CLICKED);
   \   0000033C   0110A0E3           MOV      R1,#+1
   \   00000340   0500A0E1           MOV      R0,R5
   \   00000344   ........           BL       WM_NotifyParent
    618            //
    619            // Remember listbox handle
    620            //
    621            pObj = DROPDOWN_LOCK_H(hObj);
    622            pObj->hListWin = hListWin;
   \   00000348   0500A0E1           MOV      R0,R5
   \   0000034C   ........           BL       GUI_ALLOC_LockH
   \   00000350   886080E5           STR      R6,[R0, #+136]
    623            GUI_UNLOCK_H(pObj);
   \   00000354   ........           BL       GUI_ALLOC_UnlockH
    624            //
    625            // Ready...
    626            //
    627            WM_UNLOCK();
   \   00000358   ........           BL       GUI_Unlock
    628          }
   \                     ??DROPDOWN_Expand_0:
   \   0000035C   4CD08DE2           ADD      SP,SP,#+76       ;; stack cleaning
   \   00000360   F08FBDE8           POP      {R4-R11,PC}      ;; return
    629          
    630          /*********************************************************************
    631          *
    632          *       DROPDOWN_AddKey
    633          */

   \                                 In section .text, align 4, keep-with-next
    634          void DROPDOWN_AddKey(DROPDOWN_Handle hObj, int Key) {
   \                     DROPDOWN_AddKey:
   \   00000000   30402DE9           PUSH     {R4,R5,LR}
   \   00000004   0040A0E1           MOV      R4,R0
   \   00000008   04D04DE2           SUB      SP,SP,#+4
   \   0000000C   0150A0E1           MOV      R5,R1
    635            if (hObj) {
   \   00000010   000054E3           CMP      R4,#+0
   \   00000014   0E00000A           BEQ      ??DROPDOWN_AddKey_0
    636              WM_LOCK();
   \   00000018   ........           BL       GUI_Lock
    637              switch (Key) {
   \   0000001C   110055E2           SUBS     R0,R5,#+17
   \   00000020   0400000A           BEQ      ??DROPDOWN_AddKey_1
   \   00000024   020050E2           SUBS     R0,R0,#+2
   \   00000028   0500001A           BNE      ??DROPDOWN_AddKey_2
    638                case GUI_KEY_DOWN:
    639                  DROPDOWN_IncSel(hObj);
   \   0000002C   0400A0E1           MOV      R0,R4
   \   00000030   ........           BL       DROPDOWN_IncSel
    640                  break;
   \   00000034   050000EA           B        ??DROPDOWN_AddKey_3
    641                case GUI_KEY_UP:
    642                  DROPDOWN_DecSel(hObj);
   \                     ??DROPDOWN_AddKey_1:
   \   00000038   0400A0E1           MOV      R0,R4
   \   0000003C   ........           BL       DROPDOWN_DecSel
    643                  break;
   \   00000040   020000EA           B        ??DROPDOWN_AddKey_3
    644                default:
    645                  _SelectByKey(hObj, Key);
   \                     ??DROPDOWN_AddKey_2:
   \   00000044   0510A0E1           MOV      R1,R5
   \   00000048   0400A0E1           MOV      R0,R4
   \   0000004C   ........           BL       _SelectByKey
    646                  break;
    647              }
    648              WM_UNLOCK();
   \                     ??DROPDOWN_AddKey_3:
   \   00000050   ........           BL       GUI_Unlock
    649            }
    650          }
   \                     ??DROPDOWN_AddKey_0:
   \   00000054   04D08DE2           ADD      SP,SP,#+4        ;; stack cleaning
   \   00000058   3080BDE8           POP      {R4,R5,PC}       ;; return
    651          
    652          /*********************************************************************
    653          *
    654          *       DROPDOWN_SetSel
    655          */

   \                                 In section .text, align 4, keep-with-next
    656          void DROPDOWN_SetSel(DROPDOWN_Handle hObj, int Sel) {
   \                     DROPDOWN_SetSel:
   \   00000000   70402DE9           PUSH     {R4-R6,LR}
   \   00000004   0040A0E1           MOV      R4,R0
   \   00000008   0150A0E1           MOV      R5,R1
    657            int NumItems, MaxSel;
    658            DROPDOWN_Obj * pObj;
    659            if (hObj) {
   \   0000000C   000054E3           CMP      R4,#+0
   \   00000010   1600000A           BEQ      ??DROPDOWN_SetSel_0
    660              WM_LOCK();
   \   00000014   ........           BL       GUI_Lock
    661              pObj = DROPDOWN_LOCK_H(hObj);
   \   00000018   0400A0E1           MOV      R0,R4
   \   0000001C   ........           BL       GUI_ALLOC_LockH
   \   00000020   0060A0E1           MOV      R6,R0
    662              NumItems = DROPDOWN__GetNumItems(pObj);
   \   00000024   3C0096E5           LDR      R0,[R6, #+60]
   \   00000028   ........           BL       GUI_ARRAY_GetNumItems
    663              MaxSel = NumItems ? NumItems-1 : 0;
   \   0000002C   000050E3           CMP      R0,#+0
   \   00000030   01004012           SUBNE    R0,R0,#+1
    664              if (Sel > MaxSel) {
   \   00000034   050050E1           CMP      R0,R5
   \   00000038   0050A0D1           MOVLE    R5,R0
    665                Sel = MaxSel;
    666              }
    667              if (Sel != pObj->Sel) {
   \   0000003C   F403D6E1           LDRSH    R0,[R6, #+52]
   \   00000040   000055E1           CMP      R5,R0
   \   00000044   0700000A           BEQ      ??DROPDOWN_SetSel_1
    668                pObj->Sel = Sel;
   \   00000048   B453C6E1           STRH     R5,[R6, #+52]
    669                GUI_UNLOCK_H(pObj);
   \   0000004C   ........           BL       GUI_ALLOC_UnlockH
    670                DROPDOWN_Invalidate(hObj);
   \   00000050   0400A0E1           MOV      R0,R4
   \   00000054   ........           BL       WM_InvalidateWindow
    671                WM_NotifyParent(hObj, WM_NOTIFICATION_SEL_CHANGED);
   \   00000058   0410A0E3           MOV      R1,#+4
   \   0000005C   0400A0E1           MOV      R0,R4
   \   00000060   ........           BL       WM_NotifyParent
   \   00000064   000000EA           B        ??DROPDOWN_SetSel_2
    672              } else {
    673                GUI_UNLOCK_H(pObj);
   \                     ??DROPDOWN_SetSel_1:
   \   00000068   ........           BL       GUI_ALLOC_UnlockH
    674              }
    675              WM_UNLOCK();
   \                     ??DROPDOWN_SetSel_2:
   \   0000006C   ........           BL       GUI_Unlock
    676            }
    677          }
   \                     ??DROPDOWN_SetSel_0:
   \   00000070   7080BDE8           POP      {R4-R6,PC}       ;; return
    678          
    679          /*********************************************************************
    680          *
    681          *       DROPDOWN_IncSel
    682          */

   \                                 In section .text, align 4, keep-with-next
    683          void DROPDOWN_IncSel(DROPDOWN_Handle hObj) {
   \                     DROPDOWN_IncSel:
   \   00000000   70402DE9           PUSH     {R4-R6,LR}
   \   00000004   0040B0E1           MOVS     R4,R0
    684            int Sel;
    685            Sel = DROPDOWN_GetSel(hObj);
   \   00000008   1D00000A           BEQ      ??DROPDOWN_IncSel_0
   \   0000000C   ........           BL       GUI_Lock
   \   00000010   0400A0E1           MOV      R0,R4
   \   00000014   ........           BL       GUI_ALLOC_LockH
   \   00000018   F453D0E1           LDRSH    R5,[R0, #+52]
   \   0000001C   ........           BL       GUI_ALLOC_UnlockH
   \   00000020   ........           BL       GUI_Unlock
   \   00000024   015085E2           ADD      R5,R5,#+1
   \   00000028   ........           BL       GUI_Lock
   \   0000002C   0400A0E1           MOV      R0,R4
   \   00000030   ........           BL       GUI_ALLOC_LockH
   \   00000034   0060A0E1           MOV      R6,R0
   \   00000038   3C0096E5           LDR      R0,[R6, #+60]
   \   0000003C   ........           BL       GUI_ARRAY_GetNumItems
   \   00000040   000050E3           CMP      R0,#+0
   \   00000044   01004012           SUBNE    R0,R0,#+1
   \   00000048   F413D6E1           LDRSH    R1,[R6, #+52]
   \   0000004C   050050E1           CMP      R0,R5
   \   00000050   0500A0C1           MOVGT    R0,R5
   \   00000054   010050E1           CMP      R0,R1
   \   00000058   0100001A           BNE      ??DROPDOWN_IncSel_1
   \   0000005C   ........           BL       GUI_ALLOC_UnlockH
   \   00000060   060000EA           B        ??DROPDOWN_IncSel_2
   \                     ??DROPDOWN_IncSel_1:
   \   00000064   B403C6E1           STRH     R0,[R6, #+52]
   \   00000068   ........           BL       GUI_ALLOC_UnlockH
   \   0000006C   0400A0E1           MOV      R0,R4
   \   00000070   ........           BL       WM_InvalidateWindow
   \   00000074   0410A0E3           MOV      R1,#+4
   \   00000078   0400A0E1           MOV      R0,R4
   \   0000007C   ........           BL       WM_NotifyParent
   \                     ??DROPDOWN_IncSel_2:
   \   00000080   ........           BL       GUI_Unlock
    686            DROPDOWN_SetSel(hObj, Sel + 1);
    687          }
   \                     ??DROPDOWN_IncSel_0:
   \   00000084   7080BDE8           POP      {R4-R6,PC}       ;; return
    688          
    689          /*********************************************************************
    690          *
    691          *       DROPDOWN_DecSel
    692          */

   \                                 In section .text, align 4, keep-with-next
    693          void DROPDOWN_DecSel(DROPDOWN_Handle hObj) {
   \                     DROPDOWN_DecSel:
   \   00000000   70402DE9           PUSH     {R4-R6,LR}
   \   00000004   0040B0E1           MOVS     R4,R0
    694            int Sel;
    695            Sel = DROPDOWN_GetSel(hObj);
   \   00000008   0050A0E3           MOV      R5,#+0
   \   0000000C   0500000A           BEQ      ??DROPDOWN_DecSel_0
   \   00000010   ........           BL       GUI_Lock
   \   00000014   0400A0E1           MOV      R0,R4
   \   00000018   ........           BL       GUI_ALLOC_LockH
   \   0000001C   F453D0E1           LDRSH    R5,[R0, #+52]
   \   00000020   ........           BL       GUI_ALLOC_UnlockH
   \   00000024   ........           BL       GUI_Unlock
    696            if (Sel) {
   \                     ??DROPDOWN_DecSel_0:
   \   00000028   000055E3           CMP      R5,#+0
    697          	  Sel--;
   \   0000002C   01504512           SUBNE    R5,R5,#+1
    698            }
    699            DROPDOWN_SetSel(hObj, Sel);
   \   00000030   000054E3           CMP      R4,#+0
   \   00000034   1600000A           BEQ      ??DROPDOWN_DecSel_1
   \   00000038   ........           BL       GUI_Lock
   \   0000003C   0400A0E1           MOV      R0,R4
   \   00000040   ........           BL       GUI_ALLOC_LockH
   \   00000044   0060A0E1           MOV      R6,R0
   \   00000048   3C0096E5           LDR      R0,[R6, #+60]
   \   0000004C   ........           BL       GUI_ARRAY_GetNumItems
   \   00000050   000050E3           CMP      R0,#+0
   \   00000054   01004012           SUBNE    R0,R0,#+1
   \   00000058   050050E1           CMP      R0,R5
   \   0000005C   0050A0D1           MOVLE    R5,R0
   \   00000060   F403D6E1           LDRSH    R0,[R6, #+52]
   \   00000064   000055E1           CMP      R5,R0
   \   00000068   0100001A           BNE      ??DROPDOWN_DecSel_2
   \   0000006C   ........           BL       GUI_ALLOC_UnlockH
   \   00000070   060000EA           B        ??DROPDOWN_DecSel_3
   \                     ??DROPDOWN_DecSel_2:
   \   00000074   B453C6E1           STRH     R5,[R6, #+52]
   \   00000078   ........           BL       GUI_ALLOC_UnlockH
   \   0000007C   0400A0E1           MOV      R0,R4
   \   00000080   ........           BL       WM_InvalidateWindow
   \   00000084   0410A0E3           MOV      R1,#+4
   \   00000088   0400A0E1           MOV      R0,R4
   \   0000008C   ........           BL       WM_NotifyParent
   \                     ??DROPDOWN_DecSel_3:
   \   00000090   ........           BL       GUI_Unlock
    700          }
   \                     ??DROPDOWN_DecSel_1:
   \   00000094   7080BDE8           POP      {R4-R6,PC}       ;; return
    701          
    702          /*********************************************************************
    703          *
    704          *       DROPDOWN_GetSel
    705          */

   \                                 In section .text, align 4, keep-with-next
    706          int  DROPDOWN_GetSel (DROPDOWN_Handle hObj) {
   \                     DROPDOWN_GetSel:
   \   00000000   30402DE9           PUSH     {R4,R5,LR}
   \   00000004   04D04DE2           SUB      SP,SP,#+4
   \   00000008   0040B0E1           MOVS     R4,R0
    707            int r = 0;
   \   0000000C   0050A0E3           MOV      R5,#+0
    708            DROPDOWN_Obj * pObj;
    709            if (hObj) {
   \   00000010   0500000A           BEQ      ??DROPDOWN_GetSel_0
    710              WM_LOCK();
   \   00000014   ........           BL       GUI_Lock
    711              pObj = DROPDOWN_LOCK_H(hObj);
    712              r = pObj->Sel;
   \   00000018   0400A0E1           MOV      R0,R4
   \   0000001C   ........           BL       GUI_ALLOC_LockH
   \   00000020   F453D0E1           LDRSH    R5,[R0, #+52]
    713              GUI_UNLOCK_H(pObj);
   \   00000024   ........           BL       GUI_ALLOC_UnlockH
    714              WM_UNLOCK();
   \   00000028   ........           BL       GUI_Unlock
    715            }
    716            return r;
   \                     ??DROPDOWN_GetSel_0:
   \   0000002C   0500A0E1           MOV      R0,R5
   \   00000030   04D08DE2           ADD      SP,SP,#+4
   \   00000034   3080BDE8           POP      {R4,R5,PC}       ;; return
    717          }

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable0:
   \   00000000   ........           DC32     DROPDOWN_Callback

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable0_1:
   \   00000000   ........           DC32     DROPDOWN__DefaultProps
    718          
    719          #else                            /* Avoid problems with empty object modules */
    720            void DROPDOWN_C(void) {}
    721          #endif

   Maximum stack usage in bytes:

     Function                 .cstack
     --------                 -------
     DROPDOWN_AddKey              16
     DROPDOWN_Callback            24
     DROPDOWN_Collapse            16
     DROPDOWN_CreateEx            56
     DROPDOWN_DecSel              24
     DROPDOWN_Expand             112
     DROPDOWN_GetSel              16
     DROPDOWN_IncSel              16
     DROPDOWN_SetSel              24
     DROPDOWN__AdjustHeight       16
     DROPDOWN__GetNumItems         8
     DROPDOWN__GetpItemLocked     16
     _SelectByKey                 32


   Section sizes:

     Function/Label           Bytes
     --------------           -----
     DROPDOWN__DefaultProps     60
     DROPDOWN__pSkinDefault
     DROPDOWN__GetNumItems       8
     _SelectByKey              272
     DROPDOWN__GetpItemLocked   72
     DROPDOWN__AdjustHeight     92
     DROPDOWN_Callback        1000
     DROPDOWN_CreateEx         312
     DROPDOWN_Collapse          72
     DROPDOWN_Expand           868
     DROPDOWN_AddKey            92
     DROPDOWN_SetSel           116
     DROPDOWN_IncSel           136
     DROPDOWN_DecSel           152
     DROPDOWN_GetSel            56
     ??DataTable0                4
     ??DataTable0_1              4

 
    60 bytes in section .data
 3 256 bytes in section .text
 
 3 256 bytes of CODE memory
    60 bytes of DATA memory

Errors: none
Warnings: none
