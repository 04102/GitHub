###############################################################################
#                                                                             #
# IAR ANSI C/C++ Compiler V6.10.2.52244/W32 for ARM     19/Nov/2015  13:12:09 #
# Copyright 1999-2010 IAR Systems AB.                                         #
#                                                                             #
#    Cpu mode     =  arm                                                      #
#    Endian       =  little                                                   #
#    Source file  =  C:\DUII\TargetHW\GUI\MENU.c                              #
#    Command line =  C:\DUII\TargetHW\GUI\MENU.c -D DEBUG=1 -D                #
#                    SDRAM_TARGET=1 -D USB_IS_HIGH_SPEED -D NOPROFILER -D     #
#                    OS_TRACE=0 -D OS_VIEW_ENABLE=0 -lCN                      #
#                    C:\DUII\TargetHW\Release\List\ -o                        #
#                    C:\DUII\TargetHW\Release\Obj\ --endian=little            #
#                    --cpu=ARM926EJ-S -e --fpu=None --dlib_config             #
#                    "C:\Program Files (x86)\IAR Systems\Embedded Workbench   #
#                    6.0\arm\INC\c\DLib_Config_Normal.h" -I                   #
#                    C:\DUII\TargetHW\Application\SEGGERDEMO\ -I              #
#                    C:\DUII\TargetHW\Application\SEGGERDEMO\Src\ -I          #
#                    C:\DUII\TargetHW\Config\ -I C:\DUII\TargetHW\FS\ -I      #
#                    C:\DUII\TargetHW\GUI\ -I C:\DUII\TargetHW\Inc\ -I        #
#                    C:\DUII\TargetHW\OS\ -I C:\DUII\TargetHW\Setup\ -I       #
#                    \DUII\DUII\ -I \DUII\DUII\Graphics\ --cpu_mode arm -Ohs  #
#                    --use_c++_inline --require_prototypes                    #
#    List file    =  C:\DUII\TargetHW\Release\List\MENU.lst                   #
#    Object file  =  C:\DUII\TargetHW\Release\Obj\MENU.o                      #
#                                                                             #
#                                                                             #
###############################################################################

C:\DUII\TargetHW\GUI\MENU.c
      1          /*********************************************************************
      2          *                SEGGER Microcontroller GmbH & Co. KG                *
      3          *        Solutions for real time microcontroller applications        *
      4          **********************************************************************
      5          *                                                                    *
      6          *        (c) 1996 - 2010  SEGGER Microcontroller GmbH & Co. KG       *
      7          *                                                                    *
      8          *        Internet: www.segger.com    Support:  support@segger.com    *
      9          *                                                                    *
     10          **********************************************************************
     11          
     12          ** emWin V5.06 - Graphical user interface for embedded applications **
     13          emWin is protected by international copyright laws.   Knowledge of the
     14          source code may not be used to write a similar product.  This file may
     15          only be used in accordance with a license and should not be re-
     16          distributed in any way. We appreciate your understanding and fairness.
     17          ----------------------------------------------------------------------
     18          File        : MENU.c
     19          Purpose     : Implementation of menu widget
     20          ---------------------------END-OF-HEADER------------------------------
     21          */
     22          
     23          #include <stdlib.h>
     24          #include <string.h>
     25          
     26          #define MENU_C       /* Required to generate intermodule data */
     27          
     28          #include "MENU.h"
     29          #include "MENU_Private.h"
     30          #include "GUI_Debug.h"
     31          #include "GUI_Private.h"
     32          
     33          #if GUI_WINSUPPORT
     34          
     35          /*********************************************************************
     36          *
     37          *       Private config defaults
     38          *
     39          **********************************************************************
     40          */
     41          
     42          /* Define default font */
     43          #ifndef MENU_FONT_DEFAULT
     44            #if   WIDGET_USE_SCHEME_SMALL
     45              #define MENU_FONT_DEFAULT &GUI_Font13_1
     46            #elif WIDGET_USE_SCHEME_MEDIUM
     47              #define MENU_FONT_DEFAULT &GUI_Font16_1
     48            #elif WIDGET_USE_SCHEME_LARGE
     49              #define MENU_FONT_DEFAULT &GUI_Font24_1
     50            #endif
     51          #endif
     52          
     53          /* Define default effect */
     54          #ifndef MENU_EFFECT_DEFAULT
     55            #define MENU_EFFECT_DEFAULT       &WIDGET_Effect_3D1L
     56          #endif
     57          
     58          /* Define colors, index 0, enabled, not selected */
     59          #ifndef MENU_TEXTCOLOR0_DEFAULT
     60            #define MENU_TEXTCOLOR0_DEFAULT   GUI_BLACK
     61          #endif
     62          
     63          #ifndef MENU_BKCOLOR0_DEFAULT
     64            #define MENU_BKCOLOR0_DEFAULT     GUI_LIGHTGRAY
     65          #endif
     66          
     67          /* Define colors, index 1, enabled, selected */
     68          #ifndef MENU_TEXTCOLOR1_DEFAULT
     69            #define MENU_TEXTCOLOR1_DEFAULT   GUI_WHITE
     70          #endif
     71          
     72          #ifndef MENU_BKCOLOR1_DEFAULT
     73            #define MENU_BKCOLOR1_DEFAULT     0x980000
     74          #endif
     75          
     76          /* Define colors, index 2, disabled, not selected */
     77          #ifndef MENU_TEXTCOLOR2_DEFAULT
     78            #define MENU_TEXTCOLOR2_DEFAULT   0x7C7C7C
     79          #endif
     80          
     81          #ifndef MENU_BKCOLOR2_DEFAULT
     82            #define MENU_BKCOLOR2_DEFAULT     GUI_LIGHTGRAY
     83          #endif
     84          
     85          /* Define colors, index 3, disabled, selected */
     86          #ifndef MENU_TEXTCOLOR3_DEFAULT
     87            #define MENU_TEXTCOLOR3_DEFAULT   GUI_LIGHTGRAY
     88          #endif
     89          
     90          #ifndef MENU_BKCOLOR3_DEFAULT
     91            #define MENU_BKCOLOR3_DEFAULT     0x980000
     92          #endif
     93          
     94          /* Define colors, index 4, active submenu */
     95          #ifndef MENU_TEXTCOLOR4_DEFAULT
     96            #define MENU_TEXTCOLOR4_DEFAULT   GUI_WHITE
     97          #endif
     98          
     99          #ifndef MENU_BKCOLOR4_DEFAULT
    100            #define MENU_BKCOLOR4_DEFAULT     0x7C7C7C
    101          #endif
    102          
    103          /* Define borders */
    104          #ifndef MENU_BORDER_LEFT_DEFAULT
    105            #define MENU_BORDER_LEFT_DEFAULT    4
    106          #endif
    107          
    108          #ifndef MENU_BORDER_RIGHT_DEFAULT
    109            #define MENU_BORDER_RIGHT_DEFAULT   4
    110          #endif
    111          
    112          #ifndef MENU_BORDER_TOP_DEFAULT
    113            #define MENU_BORDER_TOP_DEFAULT     2
    114          #endif
    115          
    116          #ifndef MENU_BORDER_BOTTOM_DEFAULT
    117            #define MENU_BORDER_BOTTOM_DEFAULT  2
    118          #endif
    119          
    120          /*********************************************************************
    121          *
    122          *       Static data
    123          *
    124          **********************************************************************
    125          */
    126          

   \                                 In section .data, align 4
    127          MENU_PROPS MENU__DefaultProps = {
   \                     MENU__DefaultProps:
   \   00000000   00000000FFFF       DC32 0, 16777215, 8158332, 13882323, 16777215, 13882323, 9961472
   \              FF007C7C7C00
   \              D3D3D300FFFF
   \              FF00D3D3D300
   \              00009800    
   \   0000001C   D3D3D3000000       DC32 13882323, 9961472, 8158332
   \              98007C7C7C00
   \   00000028   04040202           DC8 4, 4, 2, 2
   \   0000002C   ........           DC32 GUI_Font13_1
    128            {
    129              MENU_TEXTCOLOR0_DEFAULT,
    130              MENU_TEXTCOLOR1_DEFAULT,
    131              MENU_TEXTCOLOR2_DEFAULT,
    132              MENU_TEXTCOLOR3_DEFAULT,
    133              MENU_TEXTCOLOR4_DEFAULT,
    134            },
    135            {
    136              MENU_BKCOLOR0_DEFAULT,
    137              MENU_BKCOLOR1_DEFAULT,
    138              MENU_BKCOLOR2_DEFAULT,
    139              MENU_BKCOLOR3_DEFAULT,
    140              MENU_BKCOLOR4_DEFAULT,
    141            },
    142            {
    143              MENU_BORDER_LEFT_DEFAULT,
    144              MENU_BORDER_RIGHT_DEFAULT,
    145              MENU_BORDER_TOP_DEFAULT,
    146              MENU_BORDER_BOTTOM_DEFAULT,
    147            },
    148            MENU_FONT_DEFAULT
    149          };
    150          
    151          const WIDGET_EFFECT* MENU__pDefaultEffect = MENU_EFFECT_DEFAULT;
   \                     MENU__pDefaultEffect:
   \   00000030   ........           DC32 WIDGET_Effect_3D1L
    152          
    153          /*********************************************************************
    154          *
    155          *       Static routines
    156          *
    157          **********************************************************************
    158          */
    159          /*********************************************************************
    160          *
    161          *       _IsTopLevelMenu
    162          */
    163          static char _IsTopLevelMenu(MENU_Handle hObj) {
    164            MENU_Obj * pObj;
    165            WM_HWIN     hOwner;
    166            pObj = MENU_LOCK_H(hObj);
    167            hOwner = pObj->hOwner;
    168            GUI_UNLOCK_H(pObj);
    169            if (MENU__SendMenuMessage(hObj, hOwner, MENU_IS_MENU, 0) == 0) {
    170              return 1;
    171            }
    172            return 0;
    173          }
    174          
    175          /*********************************************************************
    176          *
    177          *       _GetTopLevelMenu
    178          *
    179          * Purpose:
    180          *   The function returns the top level menu of the given menu.
    181          *
    182          * Parameter:
    183          *   hObj, pObj                  : Obvious
    184          *   phObjTopLevel, ppObjTopLevel: Pointer to handle and object pointer for the result
    185          *   pSubSel                     : Pointer to an integer variable for returning the current 
    186          *                                 selection of the last open sub menu.
    187          */

   \                                 In section .text, align 4, keep-with-next
    188          static void _GetTopLevelMenu(MENU_Handle hObj, MENU_Handle * phObjTopLevel, int * pSubSel) {
   \                     _GetTopLevelMenu:
   \   00000000   F0472DE9           PUSH     {R4-R10,LR}
   \   00000004   18D04DE2           SUB      SP,SP,#+24
   \   00000008   0040A0E1           MOV      R4,R0
   \   0000000C   0150A0E1           MOV      R5,R1
   \   00000010   0260A0E1           MOV      R6,R2
    189            MENU_Handle hObjTopLevel;
    190            MENU_Obj * pObjTopLevel;
    191            if (_IsTopLevelMenu(hObj)) {
   \   00000014   ........           BL       GUI_ALLOC_LockH
   \   00000018   688090E5           LDR      R8,[R0, #+104]
   \   0000001C   ........           BL       GUI_ALLOC_UnlockH
   \   00000020   ............       ADRL     R7,`?<Constant {0}>`
   \              ....        
   \   00000028   04008DE2           ADD      R0,SP,#+4
   \   0000002C   0E10B7E8           LDM      R7!,{R1-R3,R12}
   \   00000030   0090A0E3           MOV      R9,#+0
   \   00000034   0E10A0E8           STM      R0!,{R1-R3,R12}
   \   00000038   0510A0E3           MOV      R1,#+5
   \   0000003C   B010CDE1           STRH     R1,[SP, #+0]
   \   00000040   2C10A0E3           MOV      R1,#+44
   \   00000044   107047E2           SUB      R7,R7,#+16
   \   00000048   B290CDE1           STRH     R9,[SP, #+2]
   \   0000004C   04108DE5           STR      R1,[SP, #+4]
   \   00000050   10D08DE5           STR      SP,[SP, #+16]
   \   00000054   0C408DE5           STR      R4,[SP, #+12]
   \   00000058   000058E3           CMP      R8,#+0
   \   0000005C   0200001A           BNE      ??_GetTopLevelMenu_0
   \   00000060   0400A0E1           MOV      R0,R4
   \   00000064   ........           BL       WM_GetParent
   \   00000068   0080A0E1           MOV      R8,R0
   \                     ??_GetTopLevelMenu_0:
   \   0000006C   000058E3           CMP      R8,#+0
   \   00000070   2E00000A           BEQ      ??_GetTopLevelMenu_1
   \   00000074   04108DE2           ADD      R1,SP,#+4
   \   00000078   0800A0E1           MOV      R0,R8
   \   0000007C   ........           BL       WM__SendMessage
   \   00000080   10009DE5           LDR      R0,[SP, #+16]
   \   00000084   000050E3           CMP      R0,#+0
   \   00000088   2800000A           BEQ      ??_GetTopLevelMenu_1
    192              hObjTopLevel = hObj;
    193            } else {
    194              pObjTopLevel = MENU_LOCK_H(hObj);
   \   0000008C   0400A0E1           MOV      R0,R4
   \   00000090   ........           BL       GUI_ALLOC_LockH
   \   00000094   0080A0E1           MOV      R8,R0
   \   00000098   080000EA           B        ??_GetTopLevelMenu_2
    195              do {
    196                hObjTopLevel = pObjTopLevel->hOwner;
    197                GUI_UNLOCK_H(pObjTopLevel);
    198                pObjTopLevel = (MENU_Obj *)GUI_LOCK_H(hObjTopLevel);
    199                if (_IsTopLevelMenu(hObjTopLevel)) {
   \                     ??_GetTopLevelMenu_3:
   \   0000009C   04108DE2           ADD      R1,SP,#+4
   \   000000A0   0A00A0E1           MOV      R0,R10
   \   000000A4   ........           BL       WM__SendMessage
   \   000000A8   10009DE5           LDR      R0,[SP, #+16]
   \   000000AC   000050E3           CMP      R0,#+0
   \   000000B0   1D00000A           BEQ      ??_GetTopLevelMenu_4
    200                  break;
    201                } else {
    202                  if (pSubSel) {
   \   000000B4   000056E3           CMP      R6,#+0
    203                    *pSubSel = pObjTopLevel->Sel;
   \   000000B8   78009815           LDRNE    R0,[R8, #+120]
   \   000000BC   00008615           STRNE    R0,[R6, #+0]
    204                  }
    205                }
   \                     ??_GetTopLevelMenu_2:
   \   000000C0   684098E5           LDR      R4,[R8, #+104]
   \   000000C4   ........           BL       GUI_ALLOC_UnlockH
   \   000000C8   0400A0E1           MOV      R0,R4
   \   000000CC   ........           BL       GUI_ALLOC_LockH
   \   000000D0   0080A0E1           MOV      R8,R0
   \   000000D4   0400A0E1           MOV      R0,R4
   \   000000D8   ........           BL       GUI_ALLOC_LockH
   \   000000DC   68A090E5           LDR      R10,[R0, #+104]
   \   000000E0   ........           BL       GUI_ALLOC_UnlockH
   \   000000E4   0E10B7E8           LDM      R7!,{R1-R3,R12}
   \   000000E8   04008DE2           ADD      R0,SP,#+4
   \   000000EC   0E10A0E8           STM      R0!,{R1-R3,R12}
   \   000000F0   0510A0E3           MOV      R1,#+5
   \   000000F4   B010CDE1           STRH     R1,[SP, #+0]
   \   000000F8   2C10A0E3           MOV      R1,#+44
   \   000000FC   107047E2           SUB      R7,R7,#+16
   \   00000100   B290CDE1           STRH     R9,[SP, #+2]
   \   00000104   04108DE5           STR      R1,[SP, #+4]
   \   00000108   10D08DE5           STR      SP,[SP, #+16]
   \   0000010C   0C408DE5           STR      R4,[SP, #+12]
   \   00000110   00005AE3           CMP      R10,#+0
   \   00000114   0200001A           BNE      ??_GetTopLevelMenu_5
   \   00000118   0400A0E1           MOV      R0,R4
   \   0000011C   ........           BL       WM_GetParent
   \   00000120   00A0A0E1           MOV      R10,R0
   \                     ??_GetTopLevelMenu_5:
   \   00000124   00005AE3           CMP      R10,#+0
   \   00000128   DBFFFF1A           BNE      ??_GetTopLevelMenu_3
    206              } while (1);
    207              GUI_UNLOCK_H(pObjTopLevel);
   \                     ??_GetTopLevelMenu_4:
   \   0000012C   ........           BL       GUI_ALLOC_UnlockH
    208            }
    209            *phObjTopLevel = hObjTopLevel;
   \                     ??_GetTopLevelMenu_1:
   \   00000130   004085E5           STR      R4,[R5, #+0]
    210          }
   \   00000134   18D08DE2           ADD      SP,SP,#+24
   \   00000138   F087BDE8           POP      {R4-R10,PC}      ;; return
    211          
    212          /*********************************************************************
    213          *
    214          *       _HasEffect
    215          */
    216          static int _HasEffect(MENU_Handle hObj, MENU_Obj * pObj) {
    217            if (!(pObj->Flags & MENU_SF_POPUP)) {
    218              if (_IsTopLevelMenu(hObj)) {
    219                return 0;
    220              }
    221            }
    222            return 1;
    223          }
    224          
    225          /*********************************************************************
    226          *
    227          *       _GetEffectSize
    228          */
    229          static int _GetEffectSize(MENU_Handle hObj) {
    230            MENU_Obj * pObj;
    231            int r;
    232            pObj = MENU_LOCK_H(hObj);
    233            r = 0;
    234            if (_HasEffect(hObj, pObj)) {
    235              r = pObj->Widget.pEffect->EffectSize;
    236            }
    237            GUI_UNLOCK_H(pObj);
    238            return r;
    239          }
    240          
    241          /*********************************************************************
    242          *
    243          *       _CalcTextWidth
    244          */
    245          static int _CalcTextWidth(MENU_Obj * pObj, const char GUI_UNI_PTR * sText) {
    246            int TextWidth = 0;
    247            if (sText) {
    248              const GUI_FONT GUI_UNI_PTR * pOldFont;
    249              pOldFont  = GUI_SetFont(pObj->Props.pFont);
    250              TextWidth = GUI_GetStringDistX(sText);
    251              GUI_SetFont(pOldFont);
    252            }
    253            return TextWidth;
    254          }
    255          
    256          /*********************************************************************
    257          *
    258          *       _GetItemWidth
    259          */

   \                                 In section .text, align 4, keep-with-next
    260          static int _GetItemWidth(MENU_Handle hObj, MENU_Obj * pObj, unsigned Index) {
   \                     _GetItemWidth:
   \   00000000   F0412DE9           PUSH     {R4-R8,LR}
   \   00000004   0050A0E1           MOV      R5,R0
   \   00000008   0140A0E1           MOV      R4,R1
    261            int ItemWidth;
    262            if (pObj->Width && (pObj->Flags & MENU_SF_VERTICAL)) {
   \   0000000C   700094E5           LDR      R0,[R4, #+112]
   \   00000010   18D04DE2           SUB      SP,SP,#+24
   \   00000014   000050E3           CMP      R0,#+0
   \   00000018   6C00D415           LDRBNE   R0,[R4, #+108]
   \   0000001C   0210A0E1           MOV      R1,R2
   \   00000020   01001013           TSTNE    R0,#0x1
   \   00000024   2A00000A           BEQ      ??_GetItemWidth_0
    263              ItemWidth = pObj->Width - (_GetEffectSize(hObj) << 1);
   \   00000028   0500A0E1           MOV      R0,R5
   \   0000002C   ........           BL       GUI_ALLOC_LockH
   \   00000030   0060A0E1           MOV      R6,R0
   \   00000034   6C00D6E5           LDRB     R0,[R6, #+108]
   \   00000038   0070A0E3           MOV      R7,#+0
   \   0000003C   800010E3           TST      R0,#0x80
   \   00000040   1D00001A           BNE      ??_GetItemWidth_1
   \   00000044   0500A0E1           MOV      R0,R5
   \   00000048   ........           BL       GUI_ALLOC_LockH
   \   0000004C   688090E5           LDR      R8,[R0, #+104]
   \   00000050   ........           BL       GUI_ALLOC_UnlockH
   \   00000054   04008DE2           ADD      R0,SP,#+4
   \   00000058   0010A0E3           MOV      R1,#+0
   \   0000005C   0020A0E3           MOV      R2,#+0
   \   00000060   0030A0E3           MOV      R3,#+0
   \   00000064   00C0A0E3           MOV      R12,#+0
   \   00000068   0E10A0E8           STM      R0!,{R1-R3,R12}
   \   0000006C   0510A0E3           MOV      R1,#+5
   \   00000070   B010CDE1           STRH     R1,[SP, #+0]
   \   00000074   2C10A0E3           MOV      R1,#+44
   \   00000078   B220CDE1           STRH     R2,[SP, #+2]
   \   0000007C   04108DE5           STR      R1,[SP, #+4]
   \   00000080   10D08DE5           STR      SP,[SP, #+16]
   \   00000084   0C508DE5           STR      R5,[SP, #+12]
   \   00000088   000058E3           CMP      R8,#+0
   \   0000008C   0200001A           BNE      ??_GetItemWidth_2
   \   00000090   0500A0E1           MOV      R0,R5
   \   00000094   ........           BL       WM_GetParent
   \   00000098   0080A0E1           MOV      R8,R0
   \                     ??_GetItemWidth_2:
   \   0000009C   000058E3           CMP      R8,#+0
   \   000000A0   0700000A           BEQ      ??_GetItemWidth_3
   \   000000A4   04108DE2           ADD      R1,SP,#+4
   \   000000A8   0800A0E1           MOV      R0,R8
   \   000000AC   ........           BL       WM__SendMessage
   \   000000B0   10009DE5           LDR      R0,[SP, #+16]
   \   000000B4   000050E3           CMP      R0,#+0
   \   000000B8   0100000A           BEQ      ??_GetItemWidth_3
   \                     ??_GetItemWidth_1:
   \   000000BC   2C0096E5           LDR      R0,[R6, #+44]
   \   000000C0   007090E5           LDR      R7,[R0, #+0]
   \                     ??_GetItemWidth_3:
   \   000000C4   ........           BL       GUI_ALLOC_UnlockH
    264            } else {
   \   000000C8   700094E5           LDR      R0,[R4, #+112]
   \   000000CC   870040E0           SUB      R0,R0,R7, LSL #+1
   \   000000D0   0F0000EA           B        ??_GetItemWidth_4
    265              MENU_ITEM * pItem;
    266              pItem = (MENU_ITEM *)GUI_ARRAY_GetpItemLocked(pObj->ItemArray, Index);
   \                     ??_GetItemWidth_0:
   \   000000D4   640094E5           LDR      R0,[R4, #+100]
   \   000000D8   ........           BL       GUI_ARRAY_GetpItemLocked
    267              if ((pObj->Flags & MENU_SF_VERTICAL) || !(pItem->Flags & MENU_IF_SEPARATOR)) {
   \   000000DC   6C10D4E5           LDRB     R1,[R4, #+108]
   \   000000E0   010011E3           TST      R1,#0x1
   \   000000E4   0200001A           BNE      ??_GetItemWidth_5
   \   000000E8   0610D0E5           LDRB     R1,[R0, #+6]
   \   000000EC   020011E3           TST      R1,#0x2
   \   000000F0   0100001A           BNE      ??_GetItemWidth_6
    268                ItemWidth = pItem->TextWidth;
   \                     ??_GetItemWidth_5:
   \   000000F4   085090E5           LDR      R5,[R0, #+8]
   \   000000F8   000000EA           B        ??_GetItemWidth_7
    269              } else {
    270                ItemWidth = 3;
   \                     ??_GetItemWidth_6:
   \   000000FC   0350A0E3           MOV      R5,#+3
    271              }
    272              GUI_UNLOCK_H(pItem);
   \                     ??_GetItemWidth_7:
   \   00000100   ........           BL       GUI_ALLOC_UnlockH
    273              ItemWidth += pObj->Props.aBorder[MENU_BI_LEFT] + pObj->Props.aBorder[MENU_BI_RIGHT];
   \   00000104   5C00D4E5           LDRB     R0,[R4, #+92]
   \   00000108   5D10D4E5           LDRB     R1,[R4, #+93]
   \   0000010C   000081E0           ADD      R0,R1,R0
   \   00000110   050080E0           ADD      R0,R0,R5
    274            }
    275            return ItemWidth;
   \                     ??_GetItemWidth_4:
   \   00000114   18D08DE2           ADD      SP,SP,#+24       ;; stack cleaning
   \   00000118   F081BDE8           POP      {R4-R8,PC}       ;; return
    276          }
    277          
    278          /*********************************************************************
    279          *
    280          *       _GetItemHeight
    281          */

   \                                 In section .text, align 4, keep-with-next
    282          static int _GetItemHeight(MENU_Handle hObj, MENU_Obj * pObj, unsigned Index) {
   \                     _GetItemHeight:
   \   00000000   F0412DE9           PUSH     {R4-R8,LR}
   \   00000004   0050A0E1           MOV      R5,R0
   \   00000008   0140A0E1           MOV      R4,R1
    283            int ItemHeight;
    284            if (pObj->Height && !(pObj->Flags & MENU_SF_VERTICAL)) {
   \   0000000C   740094E5           LDR      R0,[R4, #+116]
   \   00000010   18D04DE2           SUB      SP,SP,#+24
   \   00000014   0260A0E1           MOV      R6,R2
   \   00000018   000050E3           CMP      R0,#+0
   \   0000001C   2D00000A           BEQ      ??_GetItemHeight_0
   \   00000020   6C00D4E5           LDRB     R0,[R4, #+108]
   \   00000024   010010E3           TST      R0,#0x1
   \   00000028   2A00001A           BNE      ??_GetItemHeight_0
    285              ItemHeight = pObj->Height - (_GetEffectSize(hObj) << 1);
   \   0000002C   0500A0E1           MOV      R0,R5
   \   00000030   ........           BL       GUI_ALLOC_LockH
   \   00000034   0060A0E1           MOV      R6,R0
   \   00000038   6C00D6E5           LDRB     R0,[R6, #+108]
   \   0000003C   0070A0E3           MOV      R7,#+0
   \   00000040   800010E3           TST      R0,#0x80
   \   00000044   1D00001A           BNE      ??_GetItemHeight_1
   \   00000048   0500A0E1           MOV      R0,R5
   \   0000004C   ........           BL       GUI_ALLOC_LockH
   \   00000050   688090E5           LDR      R8,[R0, #+104]
   \   00000054   ........           BL       GUI_ALLOC_UnlockH
   \   00000058   04008DE2           ADD      R0,SP,#+4
   \   0000005C   0010A0E3           MOV      R1,#+0
   \   00000060   0020A0E3           MOV      R2,#+0
   \   00000064   0030A0E3           MOV      R3,#+0
   \   00000068   00C0A0E3           MOV      R12,#+0
   \   0000006C   0E10A0E8           STM      R0!,{R1-R3,R12}
   \   00000070   0510A0E3           MOV      R1,#+5
   \   00000074   B010CDE1           STRH     R1,[SP, #+0]
   \   00000078   2C10A0E3           MOV      R1,#+44
   \   0000007C   B220CDE1           STRH     R2,[SP, #+2]
   \   00000080   04108DE5           STR      R1,[SP, #+4]
   \   00000084   10D08DE5           STR      SP,[SP, #+16]
   \   00000088   0C508DE5           STR      R5,[SP, #+12]
   \   0000008C   000058E3           CMP      R8,#+0
   \   00000090   0200001A           BNE      ??_GetItemHeight_2
   \   00000094   0500A0E1           MOV      R0,R5
   \   00000098   ........           BL       WM_GetParent
   \   0000009C   0080A0E1           MOV      R8,R0
   \                     ??_GetItemHeight_2:
   \   000000A0   000058E3           CMP      R8,#+0
   \   000000A4   0700000A           BEQ      ??_GetItemHeight_3
   \   000000A8   04108DE2           ADD      R1,SP,#+4
   \   000000AC   0800A0E1           MOV      R0,R8
   \   000000B0   ........           BL       WM__SendMessage
   \   000000B4   10009DE5           LDR      R0,[SP, #+16]
   \   000000B8   000050E3           CMP      R0,#+0
   \   000000BC   0100000A           BEQ      ??_GetItemHeight_3
   \                     ??_GetItemHeight_1:
   \   000000C0   2C0096E5           LDR      R0,[R6, #+44]
   \   000000C4   007090E5           LDR      R7,[R0, #+0]
   \                     ??_GetItemHeight_3:
   \   000000C8   ........           BL       GUI_ALLOC_UnlockH
    286            } else {
   \   000000CC   740094E5           LDR      R0,[R4, #+116]
   \   000000D0   870040E0           SUB      R0,R0,R7, LSL #+1
   \   000000D4   100000EA           B        ??_GetItemHeight_4
    287              ItemHeight = GUI_GetYDistOfFont(pObj->Props.pFont);
   \                     ??_GetItemHeight_0:
   \   000000D8   600094E5           LDR      R0,[R4, #+96]
   \   000000DC   ........           BL       GUI_GetYDistOfFont
   \   000000E0   0050A0E1           MOV      R5,R0
    288              if (pObj->Flags & MENU_SF_VERTICAL) {
   \   000000E4   6C00D4E5           LDRB     R0,[R4, #+108]
   \   000000E8   010010E3           TST      R0,#0x1
   \   000000EC   0600000A           BEQ      ??_GetItemHeight_5
    289                MENU_ITEM * pItem;
    290                pItem = (MENU_ITEM *)GUI_ARRAY_GetpItemLocked(pObj->ItemArray, Index);
    291                if (pItem->Flags & MENU_IF_SEPARATOR) {
   \   000000F0   0610A0E1           MOV      R1,R6
   \   000000F4   640094E5           LDR      R0,[R4, #+100]
   \   000000F8   ........           BL       GUI_ARRAY_GetpItemLocked
   \   000000FC   0600D0E5           LDRB     R0,[R0, #+6]
   \   00000100   020010E3           TST      R0,#0x2
    292                  ItemHeight = 3;
   \   00000104   0350A013           MOVNE    R5,#+3
    293                }
    294                GUI_UNLOCK_H(pItem);
   \   00000108   ........           BL       GUI_ALLOC_UnlockH
    295              }
    296              ItemHeight += pObj->Props.aBorder[MENU_BI_TOP] + pObj->Props.aBorder[MENU_BI_BOTTOM];
   \                     ??_GetItemHeight_5:
   \   0000010C   5E00D4E5           LDRB     R0,[R4, #+94]
   \   00000110   5F10D4E5           LDRB     R1,[R4, #+95]
   \   00000114   000081E0           ADD      R0,R1,R0
   \   00000118   050080E0           ADD      R0,R0,R5
    297            }
    298            return ItemHeight;
   \                     ??_GetItemHeight_4:
   \   0000011C   18D08DE2           ADD      SP,SP,#+24       ;; stack cleaning
   \   00000120   F081BDE8           POP      {R4-R8,PC}       ;; return
    299          }
    300          
    301          /*********************************************************************
    302          *
    303          *       _CalcMenuSizeX
    304          */

   \                                 In section .text, align 4, keep-with-next
    305          static int _CalcMenuSizeX(MENU_Handle hObj) {
   \                     _CalcMenuSizeX:
   \   00000000   F0472DE9           PUSH     {R4-R10,LR}
   \   00000004   18D04DE2           SUB      SP,SP,#+24
   \   00000008   0050A0E1           MOV      R5,R0
    306            MENU_Obj * pObj;
    307            unsigned i, NumItems;
    308            int xSize;
    309            
    310            pObj = MENU_LOCK_H(hObj);
   \   0000000C   ........           BL       GUI_ALLOC_LockH
   \   00000010   0060A0E1           MOV      R6,R0
    311            NumItems = MENU__GetNumItems(pObj);
   \   00000014   640096E5           LDR      R0,[R6, #+100]
   \   00000018   ........           BL       GUI_ARRAY_GetNumItems
   \   0000001C   0090A0E1           MOV      R9,R0
    312            xSize = 0;
    313            if (pObj->Flags & MENU_SF_VERTICAL) {
   \   00000020   6C00D6E5           LDRB     R0,[R6, #+108]
   \   00000024   0040A0E3           MOV      R4,#+0
   \   00000028   0070A0E3           MOV      R7,#+0
   \   0000002C   010010E3           TST      R0,#0x1
   \   00000030   0480A0E1           MOV      R8,R4
   \   00000034   1D00000A           BEQ      ??_CalcMenuSizeX_0
    314              int ItemWidth;
    315              for (i = 0; i < NumItems; i++) {
   \   00000038   000059E3           CMP      R9,#+0
   \   0000003C   3600000A           BEQ      ??_CalcMenuSizeX_1
   \   00000040   010019E3           TST      R9,#0x1
   \   00000044   0600000A           BEQ      ??_CalcMenuSizeX_2
    316                ItemWidth = _GetItemWidth(hObj, pObj, i);
   \   00000048   0020A0E3           MOV      R2,#+0
   \   0000004C   0610A0E1           MOV      R1,R6
   \   00000050   0500A0E1           MOV      R0,R5
   \   00000054   ........           BL       _GetItemWidth
    317                if (ItemWidth > xSize) {
   \   00000058   010050E3           CMP      R0,#+1
    318                  xSize = ItemWidth;
   \   0000005C   0040A0A1           MOVGE    R4,R0
    319                }
   \   00000060   0180A0E3           MOV      R8,#+1
   \                     ??_CalcMenuSizeX_2:
   \   00000064   A990B0E1           LSRS     R9,R9,#+1
   \   00000068   2B00000A           BEQ      ??_CalcMenuSizeX_1
   \                     ??_CalcMenuSizeX_3:
   \   0000006C   0820A0E1           MOV      R2,R8
   \   00000070   0610A0E1           MOV      R1,R6
   \   00000074   0500A0E1           MOV      R0,R5
   \   00000078   ........           BL       _GetItemWidth
   \   0000007C   000054E1           CMP      R4,R0
   \   00000080   0040A0B1           MOVLT    R4,R0
   \   00000084   018088E2           ADD      R8,R8,#+1
   \   00000088   0820A0E1           MOV      R2,R8
   \   0000008C   0610A0E1           MOV      R1,R6
   \   00000090   0500A0E1           MOV      R0,R5
   \   00000094   ........           BL       _GetItemWidth
   \   00000098   000054E1           CMP      R4,R0
   \   0000009C   0040A0B1           MOVLT    R4,R0
    320              }
   \   000000A0   018088E2           ADD      R8,R8,#+1
   \   000000A4   019059E2           SUBS     R9,R9,#+1
   \   000000A8   EFFFFF1A           BNE      ??_CalcMenuSizeX_3
   \   000000AC   1A0000EA           B        ??_CalcMenuSizeX_1
    321            } else {
    322              for (i = 0; i < NumItems; i++) {
   \                     ??_CalcMenuSizeX_0:
   \   000000B0   000059E3           CMP      R9,#+0
   \   000000B4   1800000A           BEQ      ??_CalcMenuSizeX_1
   \   000000B8   010019E3           TST      R9,#0x1
   \   000000BC   0500000A           BEQ      ??_CalcMenuSizeX_4
    323                xSize += _GetItemWidth(hObj, pObj, i);
   \   000000C0   0020A0E3           MOV      R2,#+0
   \   000000C4   0610A0E1           MOV      R1,R6
   \   000000C8   0500A0E1           MOV      R0,R5
   \   000000CC   ........           BL       _GetItemWidth
   \   000000D0   0040A0E1           MOV      R4,R0
   \   000000D4   0180A0E3           MOV      R8,#+1
   \                     ??_CalcMenuSizeX_4:
   \   000000D8   A990B0E1           LSRS     R9,R9,#+1
   \   000000DC   0E00000A           BEQ      ??_CalcMenuSizeX_1
   \                     ??_CalcMenuSizeX_5:
   \   000000E0   0820A0E1           MOV      R2,R8
   \   000000E4   0610A0E1           MOV      R1,R6
   \   000000E8   0500A0E1           MOV      R0,R5
   \   000000EC   ........           BL       _GetItemWidth
   \   000000F0   00A0A0E1           MOV      R10,R0
   \   000000F4   018088E2           ADD      R8,R8,#+1
   \   000000F8   0820A0E1           MOV      R2,R8
   \   000000FC   0610A0E1           MOV      R1,R6
   \   00000100   0500A0E1           MOV      R0,R5
   \   00000104   ........           BL       _GetItemWidth
   \   00000108   0A0080E0           ADD      R0,R0,R10
   \   0000010C   044080E0           ADD      R4,R0,R4
    324              }
   \   00000110   018088E2           ADD      R8,R8,#+1
   \   00000114   019059E2           SUBS     R9,R9,#+1
   \   00000118   F0FFFF1A           BNE      ??_CalcMenuSizeX_5
    325            }
    326            xSize += (_GetEffectSize(hObj) << 1);
   \                     ??_CalcMenuSizeX_1:
   \   0000011C   0500A0E1           MOV      R0,R5
   \   00000120   ........           BL       GUI_ALLOC_LockH
   \   00000124   0060A0E1           MOV      R6,R0
   \   00000128   6C00D6E5           LDRB     R0,[R6, #+108]
   \   0000012C   0080A0E3           MOV      R8,#+0
   \   00000130   800010E3           TST      R0,#0x80
   \   00000134   1D00001A           BNE      ??_CalcMenuSizeX_6
   \   00000138   0500A0E1           MOV      R0,R5
   \   0000013C   ........           BL       GUI_ALLOC_LockH
   \   00000140   689090E5           LDR      R9,[R0, #+104]
   \   00000144   ........           BL       GUI_ALLOC_UnlockH
   \   00000148   04008DE2           ADD      R0,SP,#+4
   \   0000014C   0010A0E3           MOV      R1,#+0
   \   00000150   0020A0E3           MOV      R2,#+0
   \   00000154   0030A0E3           MOV      R3,#+0
   \   00000158   00C0A0E3           MOV      R12,#+0
   \   0000015C   0E10A0E8           STM      R0!,{R1-R3,R12}
   \   00000160   0510A0E3           MOV      R1,#+5
   \   00000164   B010CDE1           STRH     R1,[SP, #+0]
   \   00000168   2C10A0E3           MOV      R1,#+44
   \   0000016C   B270CDE1           STRH     R7,[SP, #+2]
   \   00000170   04108DE5           STR      R1,[SP, #+4]
   \   00000174   10D08DE5           STR      SP,[SP, #+16]
   \   00000178   0C508DE5           STR      R5,[SP, #+12]
   \   0000017C   000059E3           CMP      R9,#+0
   \   00000180   0200001A           BNE      ??_CalcMenuSizeX_7
   \   00000184   0500A0E1           MOV      R0,R5
   \   00000188   ........           BL       WM_GetParent
   \   0000018C   0090A0E1           MOV      R9,R0
   \                     ??_CalcMenuSizeX_7:
   \   00000190   000059E3           CMP      R9,#+0
   \   00000194   0700000A           BEQ      ??_CalcMenuSizeX_8
   \   00000198   04108DE2           ADD      R1,SP,#+4
   \   0000019C   0900A0E1           MOV      R0,R9
   \   000001A0   ........           BL       WM__SendMessage
   \   000001A4   10009DE5           LDR      R0,[SP, #+16]
   \   000001A8   000050E3           CMP      R0,#+0
   \   000001AC   0100000A           BEQ      ??_CalcMenuSizeX_8
   \                     ??_CalcMenuSizeX_6:
   \   000001B0   2C0096E5           LDR      R0,[R6, #+44]
   \   000001B4   008090E5           LDR      R8,[R0, #+0]
   \                     ??_CalcMenuSizeX_8:
   \   000001B8   ........           BL       GUI_ALLOC_UnlockH
    327            GUI_UNLOCK_H(pObj);
   \   000001BC   ........           BL       GUI_ALLOC_UnlockH
    328            return xSize;
   \   000001C0   880084E0           ADD      R0,R4,R8, LSL #+1
   \   000001C4   18D08DE2           ADD      SP,SP,#+24
   \   000001C8   F087BDE8           POP      {R4-R10,PC}      ;; return
    329          }
    330          
    331          /*********************************************************************
    332          *
    333          *       _CalcMenuSizeY
    334          */

   \                                 In section .text, align 4, keep-with-next
    335          static int _CalcMenuSizeY(MENU_Handle hObj) {
   \                     _CalcMenuSizeY:
   \   00000000   F0472DE9           PUSH     {R4-R10,LR}
   \   00000004   18D04DE2           SUB      SP,SP,#+24
   \   00000008   0050A0E1           MOV      R5,R0
    336            MENU_Obj * pObj;
    337            unsigned i, NumItems;
    338            int ySize;
    339            
    340            pObj = MENU_LOCK_H(hObj);
   \   0000000C   ........           BL       GUI_ALLOC_LockH
   \   00000010   0060A0E1           MOV      R6,R0
    341            NumItems = MENU__GetNumItems(pObj);
   \   00000014   640096E5           LDR      R0,[R6, #+100]
   \   00000018   ........           BL       GUI_ARRAY_GetNumItems
   \   0000001C   0090A0E1           MOV      R9,R0
    342            ySize = 0;
    343            if (pObj->Flags & MENU_SF_VERTICAL) {
   \   00000020   6C00D6E5           LDRB     R0,[R6, #+108]
   \   00000024   0040A0E3           MOV      R4,#+0
   \   00000028   0070A0E3           MOV      R7,#+0
   \   0000002C   010010E3           TST      R0,#0x1
   \   00000030   0480A0E1           MOV      R8,R4
   \   00000034   1B00000A           BEQ      ??_CalcMenuSizeY_0
    344              for (i = 0; i < NumItems; i++) {
   \   00000038   000059E3           CMP      R9,#+0
   \   0000003C   3600000A           BEQ      ??_CalcMenuSizeY_1
   \   00000040   010019E3           TST      R9,#0x1
   \   00000044   0500000A           BEQ      ??_CalcMenuSizeY_2
    345                ySize += _GetItemHeight(hObj, pObj, i);
   \   00000048   0020A0E3           MOV      R2,#+0
   \   0000004C   0610A0E1           MOV      R1,R6
   \   00000050   0500A0E1           MOV      R0,R5
   \   00000054   ........           BL       _GetItemHeight
   \   00000058   0040A0E1           MOV      R4,R0
   \   0000005C   0180A0E3           MOV      R8,#+1
   \                     ??_CalcMenuSizeY_2:
   \   00000060   A990B0E1           LSRS     R9,R9,#+1
   \   00000064   2C00000A           BEQ      ??_CalcMenuSizeY_1
   \                     ??_CalcMenuSizeY_3:
   \   00000068   0820A0E1           MOV      R2,R8
   \   0000006C   0610A0E1           MOV      R1,R6
   \   00000070   0500A0E1           MOV      R0,R5
   \   00000074   ........           BL       _GetItemHeight
   \   00000078   00A0A0E1           MOV      R10,R0
   \   0000007C   018088E2           ADD      R8,R8,#+1
   \   00000080   0820A0E1           MOV      R2,R8
   \   00000084   0610A0E1           MOV      R1,R6
   \   00000088   0500A0E1           MOV      R0,R5
   \   0000008C   ........           BL       _GetItemHeight
   \   00000090   0A0080E0           ADD      R0,R0,R10
   \   00000094   044080E0           ADD      R4,R0,R4
    346              }
   \   00000098   018088E2           ADD      R8,R8,#+1
   \   0000009C   019059E2           SUBS     R9,R9,#+1
   \   000000A0   F0FFFF1A           BNE      ??_CalcMenuSizeY_3
   \   000000A4   1C0000EA           B        ??_CalcMenuSizeY_1
    347            } else {
    348              int ItemHeight;
    349              for (i = 0; i < NumItems; i++) {
   \                     ??_CalcMenuSizeY_0:
   \   000000A8   000059E3           CMP      R9,#+0
   \   000000AC   1A00000A           BEQ      ??_CalcMenuSizeY_1
   \   000000B0   010019E3           TST      R9,#0x1
   \   000000B4   0600000A           BEQ      ??_CalcMenuSizeY_4
    350                ItemHeight = _GetItemHeight(hObj, pObj, i);
   \   000000B8   0020A0E3           MOV      R2,#+0
   \   000000BC   0610A0E1           MOV      R1,R6
   \   000000C0   0500A0E1           MOV      R0,R5
   \   000000C4   ........           BL       _GetItemHeight
    351                if (ItemHeight > ySize) {
   \   000000C8   010050E3           CMP      R0,#+1
    352                  ySize = ItemHeight;
   \   000000CC   0040A0A1           MOVGE    R4,R0
    353                }
   \   000000D0   0180A0E3           MOV      R8,#+1
   \                     ??_CalcMenuSizeY_4:
   \   000000D4   A990B0E1           LSRS     R9,R9,#+1
   \   000000D8   0F00000A           BEQ      ??_CalcMenuSizeY_1
   \                     ??_CalcMenuSizeY_5:
   \   000000DC   0820A0E1           MOV      R2,R8
   \   000000E0   0610A0E1           MOV      R1,R6
   \   000000E4   0500A0E1           MOV      R0,R5
   \   000000E8   ........           BL       _GetItemHeight
   \   000000EC   000054E1           CMP      R4,R0
   \   000000F0   0040A0B1           MOVLT    R4,R0
   \   000000F4   018088E2           ADD      R8,R8,#+1
   \   000000F8   0820A0E1           MOV      R2,R8
   \   000000FC   0610A0E1           MOV      R1,R6
   \   00000100   0500A0E1           MOV      R0,R5
   \   00000104   ........           BL       _GetItemHeight
   \   00000108   000054E1           CMP      R4,R0
   \   0000010C   0040A0B1           MOVLT    R4,R0
    354              }
   \   00000110   018088E2           ADD      R8,R8,#+1
   \   00000114   019059E2           SUBS     R9,R9,#+1
   \   00000118   EFFFFF1A           BNE      ??_CalcMenuSizeY_5
    355            }
    356            ySize += (_GetEffectSize(hObj) << 1);
   \                     ??_CalcMenuSizeY_1:
   \   0000011C   0500A0E1           MOV      R0,R5
   \   00000120   ........           BL       GUI_ALLOC_LockH
   \   00000124   0060A0E1           MOV      R6,R0
   \   00000128   6C00D6E5           LDRB     R0,[R6, #+108]
   \   0000012C   0080A0E3           MOV      R8,#+0
   \   00000130   800010E3           TST      R0,#0x80
   \   00000134   1D00001A           BNE      ??_CalcMenuSizeY_6
   \   00000138   0500A0E1           MOV      R0,R5
   \   0000013C   ........           BL       GUI_ALLOC_LockH
   \   00000140   689090E5           LDR      R9,[R0, #+104]
   \   00000144   ........           BL       GUI_ALLOC_UnlockH
   \   00000148   04008DE2           ADD      R0,SP,#+4
   \   0000014C   0010A0E3           MOV      R1,#+0
   \   00000150   0020A0E3           MOV      R2,#+0
   \   00000154   0030A0E3           MOV      R3,#+0
   \   00000158   00C0A0E3           MOV      R12,#+0
   \   0000015C   0E10A0E8           STM      R0!,{R1-R3,R12}
   \   00000160   0510A0E3           MOV      R1,#+5
   \   00000164   B010CDE1           STRH     R1,[SP, #+0]
   \   00000168   2C10A0E3           MOV      R1,#+44
   \   0000016C   B270CDE1           STRH     R7,[SP, #+2]
   \   00000170   04108DE5           STR      R1,[SP, #+4]
   \   00000174   10D08DE5           STR      SP,[SP, #+16]
   \   00000178   0C508DE5           STR      R5,[SP, #+12]
   \   0000017C   000059E3           CMP      R9,#+0
   \   00000180   0200001A           BNE      ??_CalcMenuSizeY_7
   \   00000184   0500A0E1           MOV      R0,R5
   \   00000188   ........           BL       WM_GetParent
   \   0000018C   0090A0E1           MOV      R9,R0
   \                     ??_CalcMenuSizeY_7:
   \   00000190   000059E3           CMP      R9,#+0
   \   00000194   0700000A           BEQ      ??_CalcMenuSizeY_8
   \   00000198   04108DE2           ADD      R1,SP,#+4
   \   0000019C   0900A0E1           MOV      R0,R9
   \   000001A0   ........           BL       WM__SendMessage
   \   000001A4   10009DE5           LDR      R0,[SP, #+16]
   \   000001A8   000050E3           CMP      R0,#+0
   \   000001AC   0100000A           BEQ      ??_CalcMenuSizeY_8
   \                     ??_CalcMenuSizeY_6:
   \   000001B0   2C0096E5           LDR      R0,[R6, #+44]
   \   000001B4   008090E5           LDR      R8,[R0, #+0]
   \                     ??_CalcMenuSizeY_8:
   \   000001B8   ........           BL       GUI_ALLOC_UnlockH
    357            GUI_UNLOCK_H(pObj);
   \   000001BC   ........           BL       GUI_ALLOC_UnlockH
    358            return ySize;
   \   000001C0   880084E0           ADD      R0,R4,R8, LSL #+1
   \   000001C4   18D08DE2           ADD      SP,SP,#+24
   \   000001C8   F087BDE8           POP      {R4-R10,PC}      ;; return
    359          }
    360          
    361          /*********************************************************************
    362          *
    363          *       _CalcWindowSizeX
    364          */
    365          static int _CalcWindowSizeX(MENU_Handle hObj, MENU_Obj * pObj) {
    366            int xSize = pObj->Width;
    367            if (xSize == 0) {
    368              xSize = _CalcMenuSizeX(hObj);
    369            }
    370            return xSize;
    371          }
    372          
    373          /*********************************************************************
    374          *
    375          *       _CalcWindowSizeY
    376          */
    377          static int _CalcWindowSizeY(MENU_Handle hObj, MENU_Obj * pObj) {
    378            int ySize = pObj->Height;
    379            if (ySize == 0) {
    380              ySize = _CalcMenuSizeY(hObj);
    381            }
    382            return ySize;
    383          }
    384          
    385          /*********************************************************************
    386          *
    387          *       _GetItemFromPos
    388          *
    389          * Return value:
    390          *   Zero based index of item at given position or -1.
    391          *
    392          * NOTE:
    393          *   This function has to ensure that index is always less than the
    394          *   maximum number of items.
    395          */

   \                                 In section .text, align 4, keep-with-next
    396          static int _GetItemFromPos(MENU_Handle hObj, int x, int y) {
   \                     _GetItemFromPos:
   \   00000000   F64F2DE9           PUSH     {R1,R2,R4-R11,LR}
   \   00000004   14D04DE2           SUB      SP,SP,#+20
   \   00000008   0050A0E1           MOV      R5,R0
    397            MENU_Obj * pObj;
    398            int xSize, ySize, EffectSize, r = -1;
   \   0000000C   0060E0E3           MVN      R6,#+0
    399            ySize = _CalcMenuSizeY(hObj);
   \   00000010   ........           BL       _CalcMenuSizeY
   \   00000014   0040A0E1           MOV      R4,R0
    400            pObj = MENU_LOCK_H(hObj);
   \   00000018   0500A0E1           MOV      R0,R5
   \   0000001C   ........           BL       GUI_ALLOC_LockH
   \   00000020   0070A0E1           MOV      R7,R0
    401            if ((pObj->Height) && (pObj->Height < ySize)) {
   \   00000024   740097E5           LDR      R0,[R7, #+116]
   \   00000028   000050E3           CMP      R0,#+0
   \   0000002C   0100000A           BEQ      ??_GetItemFromPos_0
   \   00000030   040050E1           CMP      R0,R4
   \   00000034   0040A0D1           MOVLE    R4,R0
    402              ySize = pObj->Height;
    403            }
    404            xSize = _CalcMenuSizeX(hObj);
   \                     ??_GetItemFromPos_0:
   \   00000038   0500A0E1           MOV      R0,R5
   \   0000003C   ........           BL       _CalcMenuSizeX
   \   00000040   00A0A0E1           MOV      R10,R0
    405            if ((pObj->Width) && (pObj->Width < xSize)) {
   \   00000044   700097E5           LDR      R0,[R7, #+112]
   \   00000048   000050E3           CMP      R0,#+0
   \   0000004C   0100000A           BEQ      ??_GetItemFromPos_1
   \   00000050   0A0050E1           CMP      R0,R10
   \   00000054   00A0A0D1           MOVLE    R10,R0
    406              xSize = pObj->Width;
    407            }
    408            EffectSize = _GetEffectSize(hObj);
   \                     ??_GetItemFromPos_1:
   \   00000058   0500A0E1           MOV      R0,R5
   \   0000005C   ........           BL       GUI_ALLOC_LockH
   \   00000060   0080A0E1           MOV      R8,R0
   \   00000064   6C00D8E5           LDRB     R0,[R8, #+108]
   \   00000068   00B0A0E3           MOV      R11,#+0
   \   0000006C   800010E3           TST      R0,#0x80
   \   00000070   1D00001A           BNE      ??_GetItemFromPos_2
   \   00000074   0500A0E1           MOV      R0,R5
   \   00000078   ........           BL       GUI_ALLOC_LockH
   \   0000007C   689090E5           LDR      R9,[R0, #+104]
   \   00000080   ........           BL       GUI_ALLOC_UnlockH
   \   00000084   04008DE2           ADD      R0,SP,#+4
   \   00000088   0010A0E3           MOV      R1,#+0
   \   0000008C   0020A0E3           MOV      R2,#+0
   \   00000090   0030A0E3           MOV      R3,#+0
   \   00000094   00C0A0E3           MOV      R12,#+0
   \   00000098   0E10A0E8           STM      R0!,{R1-R3,R12}
   \   0000009C   0510A0E3           MOV      R1,#+5
   \   000000A0   B010CDE1           STRH     R1,[SP, #+0]
   \   000000A4   2C10A0E3           MOV      R1,#+44
   \   000000A8   B220CDE1           STRH     R2,[SP, #+2]
   \   000000AC   04108DE5           STR      R1,[SP, #+4]
   \   000000B0   10D08DE5           STR      SP,[SP, #+16]
   \   000000B4   0C508DE5           STR      R5,[SP, #+12]
   \   000000B8   000059E3           CMP      R9,#+0
   \   000000BC   0200001A           BNE      ??_GetItemFromPos_3
   \   000000C0   0500A0E1           MOV      R0,R5
   \   000000C4   ........           BL       WM_GetParent
   \   000000C8   0090A0E1           MOV      R9,R0
   \                     ??_GetItemFromPos_3:
   \   000000CC   000059E3           CMP      R9,#+0
   \   000000D0   0700000A           BEQ      ??_GetItemFromPos_4
   \   000000D4   04108DE2           ADD      R1,SP,#+4
   \   000000D8   0900A0E1           MOV      R0,R9
   \   000000DC   ........           BL       WM__SendMessage
   \   000000E0   10009DE5           LDR      R0,[SP, #+16]
   \   000000E4   000050E3           CMP      R0,#+0
   \   000000E8   0100000A           BEQ      ??_GetItemFromPos_4
   \                     ??_GetItemFromPos_2:
   \   000000EC   2C0098E5           LDR      R0,[R8, #+44]
   \   000000F0   00B090E5           LDR      R11,[R0, #+0]
   \                     ??_GetItemFromPos_4:
   \   000000F4   ........           BL       GUI_ALLOC_UnlockH
    409            x     -= EffectSize;
   \   000000F8   14009DE5           LDR      R0,[SP, #+20]
    410            y     -= EffectSize;
    411            xSize -= (EffectSize << 1);
   \   000000FC   8B104AE0           SUB      R1,R10,R11, LSL #+1
   \   00000100   0B8040E0           SUB      R8,R0,R11
   \   00000104   18009DE5           LDR      R0,[SP, #+24]
    412            ySize -= (EffectSize << 1);
    413            if ((x >= 0) && (y >= 0) && (x < xSize) && (y < ySize)) {
   \   00000108   000058E3           CMP      R8,#+0
   \   0000010C   0B9040E0           SUB      R9,R0,R11
   \   00000110   8B0044E0           SUB      R0,R4,R11, LSL #+1
   \   00000114   00005953           CMPPL    R9,#+0
   \   00000118   4E00004A           BMI      ??_GetItemFromPos_5
   \   0000011C   010058E1           CMP      R8,R1
   \   00000120   000059B1           CMPLT    R9,R0
   \   00000124   4B0000AA           BGE      ??_GetItemFromPos_5
    414              unsigned i, NumItems = MENU__GetNumItems(pObj);
   \   00000128   640097E5           LDR      R0,[R7, #+100]
   \   0000012C   ........           BL       GUI_ARRAY_GetNumItems
   \   00000130   00A0A0E1           MOV      R10,R0
    415              if (pObj->Flags & MENU_SF_VERTICAL) {
   \   00000134   6C00D7E5           LDRB     R0,[R7, #+108]
   \   00000138   0040A0E3           MOV      R4,#+0
   \   0000013C   010010E3           TST      R0,#0x1
   \   00000140   2300000A           BEQ      ??_GetItemFromPos_6
    416                int yPos = 0;
   \   00000144   0080A0E3           MOV      R8,#+0
    417                for (i = 0; i < NumItems; i++) {
   \   00000148   00005AE3           CMP      R10,#+0
   \   0000014C   4100000A           BEQ      ??_GetItemFromPos_5
   \   00000150   01001AE3           TST      R10,#0x1
   \   00000154   0700000A           BEQ      ??_GetItemFromPos_7
    418                  yPos += _GetItemHeight(hObj, pObj, i);
   \   00000158   0020A0E3           MOV      R2,#+0
   \   0000015C   0710A0E1           MOV      R1,R7
   \   00000160   0500A0E1           MOV      R0,R5
   \   00000164   ........           BL       _GetItemHeight
   \   00000168   0080A0E1           MOV      R8,R0
    419                  if (y < yPos) {
   \   0000016C   080059E1           CMP      R9,R8
   \   00000170   090000BA           BLT      ??_GetItemFromPos_8
   \   00000174   0140A0E3           MOV      R4,#+1
   \                     ??_GetItemFromPos_7:
   \   00000178   AAA0B0E1           LSRS     R10,R10,#+1
   \   0000017C   3500000A           BEQ      ??_GetItemFromPos_5
   \                     ??_GetItemFromPos_9:
   \   00000180   0420A0E1           MOV      R2,R4
   \   00000184   0710A0E1           MOV      R1,R7
   \   00000188   0500A0E1           MOV      R0,R5
   \   0000018C   ........           BL       _GetItemHeight
   \   00000190   088080E0           ADD      R8,R0,R8
   \   00000194   080059E1           CMP      R9,R8
   \   00000198   010000AA           BGE      ??_GetItemFromPos_10
    420                    r = i;
   \                     ??_GetItemFromPos_8:
   \   0000019C   0460A0E1           MOV      R6,R4
    421                    break;
   \   000001A0   2C0000EA           B        ??_GetItemFromPos_5
    422                  }
   \                     ??_GetItemFromPos_10:
   \   000001A4   014084E2           ADD      R4,R4,#+1
   \   000001A8   0420A0E1           MOV      R2,R4
   \   000001AC   0710A0E1           MOV      R1,R7
   \   000001B0   0500A0E1           MOV      R0,R5
   \   000001B4   ........           BL       _GetItemHeight
   \   000001B8   088080E0           ADD      R8,R0,R8
   \   000001BC   080059E1           CMP      R9,R8
   \   000001C0   F5FFFFBA           BLT      ??_GetItemFromPos_8
    423                }
   \   000001C4   014084E2           ADD      R4,R4,#+1
   \   000001C8   01A05AE2           SUBS     R10,R10,#+1
   \   000001CC   EBFFFF1A           BNE      ??_GetItemFromPos_9
   \   000001D0   200000EA           B        ??_GetItemFromPos_5
    424              } else {
    425                int xPos = 0;
   \                     ??_GetItemFromPos_6:
   \   000001D4   0090A0E3           MOV      R9,#+0
    426                for (i = 0; i < NumItems; i++) {
   \   000001D8   00005AE3           CMP      R10,#+0
   \   000001DC   1D00000A           BEQ      ??_GetItemFromPos_5
   \   000001E0   01001AE3           TST      R10,#0x1
   \   000001E4   0700000A           BEQ      ??_GetItemFromPos_11
    427                  xPos += _GetItemWidth(hObj, pObj, i);
   \   000001E8   0020A0E3           MOV      R2,#+0
   \   000001EC   0710A0E1           MOV      R1,R7
   \   000001F0   0500A0E1           MOV      R0,R5
   \   000001F4   ........           BL       _GetItemWidth
   \   000001F8   0090A0E1           MOV      R9,R0
    428                  if (x < xPos) {
   \   000001FC   090058E1           CMP      R8,R9
   \   00000200   E5FFFFBA           BLT      ??_GetItemFromPos_8
   \   00000204   0140A0E3           MOV      R4,#+1
   \                     ??_GetItemFromPos_11:
   \   00000208   AAA0B0E1           LSRS     R10,R10,#+1
   \   0000020C   1100000A           BEQ      ??_GetItemFromPos_5
   \                     ??_GetItemFromPos_12:
   \   00000210   0420A0E1           MOV      R2,R4
   \   00000214   0710A0E1           MOV      R1,R7
   \   00000218   0500A0E1           MOV      R0,R5
   \   0000021C   ........           BL       _GetItemWidth
   \   00000220   099080E0           ADD      R9,R0,R9
   \   00000224   090058E1           CMP      R8,R9
   \   00000228   DBFFFFBA           BLT      ??_GetItemFromPos_8
   \   0000022C   014084E2           ADD      R4,R4,#+1
   \   00000230   0420A0E1           MOV      R2,R4
   \   00000234   0710A0E1           MOV      R1,R7
   \   00000238   0500A0E1           MOV      R0,R5
   \   0000023C   ........           BL       _GetItemWidth
   \   00000240   099080E0           ADD      R9,R0,R9
   \   00000244   090058E1           CMP      R8,R9
   \   00000248   D3FFFFBA           BLT      ??_GetItemFromPos_8
    429                    r = i;
    430                    break;
    431                  }
    432                }
   \   0000024C   014084E2           ADD      R4,R4,#+1
   \   00000250   01A05AE2           SUBS     R10,R10,#+1
   \   00000254   EDFFFF1A           BNE      ??_GetItemFromPos_12
    433              }
    434            }
    435            GUI_UNLOCK_H(pObj);
   \                     ??_GetItemFromPos_5:
   \   00000258   ........           BL       GUI_ALLOC_UnlockH
    436            return r;
   \   0000025C   0600A0E1           MOV      R0,R6
   \   00000260   1CD08DE2           ADD      SP,SP,#+28
   \   00000264   F08FBDE8           POP      {R4-R11,PC}      ;; return
    437          }
    438          
    439          /*********************************************************************
    440          *
    441          *       _GetItemPos
    442          */

   \                                 In section .text, align 4, keep-with-next
    443          static void _GetItemPos(MENU_Handle hObj, unsigned Index, int* px, int* py) {
   \                     _GetItemPos:
   \   00000000   F44F2DE9           PUSH     {R2,R4-R11,LR}
   \   00000004   18D04DE2           SUB      SP,SP,#+24
   \   00000008   0070A0E1           MOV      R7,R0
   \   0000000C   0140A0E1           MOV      R4,R1
   \   00000010   0360A0E1           MOV      R6,R3
    444            MENU_Obj * pObj;
    445            int i, EffectSize;
    446            EffectSize = _GetEffectSize(hObj);
   \   00000014   ........           BL       GUI_ALLOC_LockH
   \   00000018   0080A0E1           MOV      R8,R0
   \   0000001C   6C00D8E5           LDRB     R0,[R8, #+108]
   \   00000020   0050A0E3           MOV      R5,#+0
   \   00000024   800010E3           TST      R0,#0x80
   \   00000028   1D00001A           BNE      ??_GetItemPos_0
   \   0000002C   0700A0E1           MOV      R0,R7
   \   00000030   ........           BL       GUI_ALLOC_LockH
   \   00000034   689090E5           LDR      R9,[R0, #+104]
   \   00000038   ........           BL       GUI_ALLOC_UnlockH
   \   0000003C   04008DE2           ADD      R0,SP,#+4
   \   00000040   0010A0E3           MOV      R1,#+0
   \   00000044   0020A0E3           MOV      R2,#+0
   \   00000048   0030A0E3           MOV      R3,#+0
   \   0000004C   00C0A0E3           MOV      R12,#+0
   \   00000050   0E10A0E8           STM      R0!,{R1-R3,R12}
   \   00000054   0510A0E3           MOV      R1,#+5
   \   00000058   B010CDE1           STRH     R1,[SP, #+0]
   \   0000005C   2C10A0E3           MOV      R1,#+44
   \   00000060   B220CDE1           STRH     R2,[SP, #+2]
   \   00000064   04108DE5           STR      R1,[SP, #+4]
   \   00000068   10D08DE5           STR      SP,[SP, #+16]
   \   0000006C   0C708DE5           STR      R7,[SP, #+12]
   \   00000070   000059E3           CMP      R9,#+0
   \   00000074   0200001A           BNE      ??_GetItemPos_1
   \   00000078   0700A0E1           MOV      R0,R7
   \   0000007C   ........           BL       WM_GetParent
   \   00000080   0090A0E1           MOV      R9,R0
   \                     ??_GetItemPos_1:
   \   00000084   000059E3           CMP      R9,#+0
   \   00000088   0700000A           BEQ      ??_GetItemPos_2
   \   0000008C   04108DE2           ADD      R1,SP,#+4
   \   00000090   0900A0E1           MOV      R0,R9
   \   00000094   ........           BL       WM__SendMessage
   \   00000098   10009DE5           LDR      R0,[SP, #+16]
   \   0000009C   000050E3           CMP      R0,#+0
   \   000000A0   0100000A           BEQ      ??_GetItemPos_2
   \                     ??_GetItemPos_0:
   \   000000A4   2C0098E5           LDR      R0,[R8, #+44]
   \   000000A8   005090E5           LDR      R5,[R0, #+0]
   \                     ??_GetItemPos_2:
   \   000000AC   ........           BL       GUI_ALLOC_UnlockH
    447            pObj = MENU_LOCK_H(hObj);
   \   000000B0   0700A0E1           MOV      R0,R7
   \   000000B4   ........           BL       GUI_ALLOC_LockH
   \   000000B8   0080A0E1           MOV      R8,R0
    448            if (pObj->Flags & MENU_SF_VERTICAL) {
   \   000000BC   6C00D8E5           LDRB     R0,[R8, #+108]
   \   000000C0   00A0A0E3           MOV      R10,#+0
   \   000000C4   0A90A0E1           MOV      R9,R10
   \   000000C8   010010E3           TST      R0,#0x1
   \   000000CC   1D00000A           BEQ      ??_GetItemPos_3
    449              int yPos = 0;
   \   000000D0   010054E3           CMP      R4,#+1
   \   000000D4   180000BA           BLT      ??_GetItemPos_4
   \   000000D8   010014E3           TST      R4,#0x1
   \   000000DC   0500000A           BEQ      ??_GetItemPos_5
    450              for (i = 0; i < (int)Index; i++) {
    451                yPos += _GetItemHeight(hObj, pObj, i);
   \   000000E0   0020A0E3           MOV      R2,#+0
   \   000000E4   0810A0E1           MOV      R1,R8
   \   000000E8   0700A0E1           MOV      R0,R7
   \   000000EC   ........           BL       _GetItemHeight
   \   000000F0   00A0A0E1           MOV      R10,R0
   \   000000F4   0190A0E3           MOV      R9,#+1
   \                     ??_GetItemPos_5:
   \   000000F8   A440B0E1           LSRS     R4,R4,#+1
   \   000000FC   0E00000A           BEQ      ??_GetItemPos_4
   \                     ??_GetItemPos_6:
   \   00000100   0920A0E1           MOV      R2,R9
   \   00000104   0810A0E1           MOV      R1,R8
   \   00000108   0700A0E1           MOV      R0,R7
   \   0000010C   ........           BL       _GetItemHeight
   \   00000110   00B0A0E1           MOV      R11,R0
   \   00000114   019089E2           ADD      R9,R9,#+1
   \   00000118   0920A0E1           MOV      R2,R9
   \   0000011C   0810A0E1           MOV      R1,R8
   \   00000120   0700A0E1           MOV      R0,R7
   \   00000124   ........           BL       _GetItemHeight
   \   00000128   0B0080E0           ADD      R0,R0,R11
   \   0000012C   0AA080E0           ADD      R10,R0,R10
    452              }
   \   00000130   019089E2           ADD      R9,R9,#+1
   \   00000134   014054E2           SUBS     R4,R4,#+1
   \   00000138   F0FFFF1A           BNE      ??_GetItemPos_6
    453              *px = EffectSize;
   \                     ??_GetItemPos_4:
   \   0000013C   0500A0E1           MOV      R0,R5
    454              *py = EffectSize + yPos;
   \   00000140   05508AE0           ADD      R5,R10,R5
   \   00000144   1B0000EA           B        ??_GetItemPos_7
    455            } else {
    456              int xPos = 0;
   \                     ??_GetItemPos_3:
   \   00000148   010054E3           CMP      R4,#+1
   \   0000014C   180000BA           BLT      ??_GetItemPos_8
   \   00000150   010014E3           TST      R4,#0x1
   \   00000154   0500000A           BEQ      ??_GetItemPos_9
    457              for (i = 0; i < (int)Index; i++) {
    458                xPos += _GetItemWidth(hObj, pObj, i);
   \   00000158   0020A0E3           MOV      R2,#+0
   \   0000015C   0810A0E1           MOV      R1,R8
   \   00000160   0700A0E1           MOV      R0,R7
   \   00000164   ........           BL       _GetItemWidth
   \   00000168   00A0A0E1           MOV      R10,R0
   \   0000016C   0190A0E3           MOV      R9,#+1
   \                     ??_GetItemPos_9:
   \   00000170   A440B0E1           LSRS     R4,R4,#+1
   \   00000174   0E00000A           BEQ      ??_GetItemPos_8
   \                     ??_GetItemPos_10:
   \   00000178   0920A0E1           MOV      R2,R9
   \   0000017C   0810A0E1           MOV      R1,R8
   \   00000180   0700A0E1           MOV      R0,R7
   \   00000184   ........           BL       _GetItemWidth
   \   00000188   00B0A0E1           MOV      R11,R0
   \   0000018C   019089E2           ADD      R9,R9,#+1
   \   00000190   0920A0E1           MOV      R2,R9
   \   00000194   0810A0E1           MOV      R1,R8
   \   00000198   0700A0E1           MOV      R0,R7
   \   0000019C   ........           BL       _GetItemWidth
   \   000001A0   0B0080E0           ADD      R0,R0,R11
   \   000001A4   0AA080E0           ADD      R10,R0,R10
    459              }
   \   000001A8   019089E2           ADD      R9,R9,#+1
   \   000001AC   014054E2           SUBS     R4,R4,#+1
   \   000001B0   F0FFFF1A           BNE      ??_GetItemPos_10
    460              *px = EffectSize + xPos;
   \                     ??_GetItemPos_8:
   \   000001B4   05008AE0           ADD      R0,R10,R5
    461              *py = EffectSize;
   \                     ??_GetItemPos_7:
   \   000001B8   18109DE5           LDR      R1,[SP, #+24]
   \   000001BC   000081E5           STR      R0,[R1, #+0]
   \   000001C0   005086E5           STR      R5,[R6, #+0]
    462            }
    463            GUI_UNLOCK_H(pObj);
   \   000001C4   ........           BL       GUI_ALLOC_UnlockH
    464          }
   \   000001C8   1CD08DE2           ADD      SP,SP,#+28       ;; stack cleaning
   \   000001CC   F08FBDE8           POP      {R4-R11,PC}      ;; return
    465          
    466          /*********************************************************************
    467          *
    468          *       _SetCapture
    469          */
    470          static void _SetCapture(MENU_Handle hObj) {
    471            MENU_Obj * pObj;
    472            char        IsSubmenuActive;
    473            pObj = MENU_LOCK_H(hObj);
    474            IsSubmenuActive = pObj->IsSubmenuActive;
    475            GUI_UNLOCK_H(pObj);
    476            if (IsSubmenuActive == 0) {
    477              if (WM_HasCaptured(hObj) == 0) {
    478                WM_SetCapture(hObj, 0);
    479              }
    480            }
    481          }
    482          
    483          /*********************************************************************
    484          *
    485          *       _ReleaseCapture
    486          */
    487          static void _ReleaseCapture(MENU_Handle hObj) {
    488            MENU_Obj * pObj;
    489            U16         Flags;
    490            if (WM_HasCaptured(hObj)) {
    491              pObj = MENU_LOCK_H(hObj);
    492              Flags = pObj->Flags;
    493              GUI_UNLOCK_H(pObj);
    494              if (_IsTopLevelMenu(hObj) && !(Flags & MENU_SF_POPUP)) {
    495                WM_ReleaseCapture();
    496              }
    497            }
    498          }
    499          
    500          /*********************************************************************
    501          *
    502          *       _CloseSubmenu
    503          */

   \                                 In section .text, align 4, keep-with-next
    504          static void _CloseSubmenu(MENU_Handle hObj) {
   \                     _CloseSubmenu:
   \   00000000   F0412DE9           PUSH     {R4-R8,LR}
   \   00000004   18D04DE2           SUB      SP,SP,#+24
   \   00000008   0040A0E1           MOV      R4,R0
    505            MENU_Obj * pObj;
    506            U16         Flags;
    507            GUI_ARRAY   ItemArray;
    508            int         Sel;
    509            char        IsSubmenuActive;
    510            pObj = MENU_LOCK_H(hObj);
   \   0000000C   ........           BL       GUI_ALLOC_LockH
    511            Flags           = pObj->Flags;
   \   00000010   BC56D0E1           LDRH     R5,[R0, #+108]
    512            ItemArray       = pObj->ItemArray;
   \   00000014   646090E5           LDR      R6,[R0, #+100]
    513            Sel             = pObj->Sel;
   \   00000018   787090E5           LDR      R7,[R0, #+120]
    514            IsSubmenuActive = pObj->IsSubmenuActive;
   \   0000001C   6E80D0E5           LDRB     R8,[R0, #+110]
    515            GUI_UNLOCK_H(pObj);
   \   00000020   ........           BL       GUI_ALLOC_UnlockH
    516            if (Flags & MENU_SF_ACTIVE) {
   \   00000024   400015E3           TST      R5,#0x40
    517              if (IsSubmenuActive) {
   \   00000028   00005813           CMPNE    R8,#+0
   \   0000002C   3300000A           BEQ      ??_CloseSubmenu_0
    518                MENU_ITEM * pItem;
    519                pItem = (MENU_ITEM *)GUI_ARRAY_GetpItemLocked(ItemArray, Sel);
   \   00000030   0710A0E1           MOV      R1,R7
   \   00000034   0600A0E1           MOV      R0,R6
   \   00000038   ........           BL       GUI_ARRAY_GetpItemLocked
    520                /* Inform submenu about its deactivation and detach it */
    521                if (pItem) {
   \   0000003C   0050A0E3           MOV      R5,#+0
   \   00000040   000050E3           CMP      R0,#+0
   \   00000044   1900000A           BEQ      ??_CloseSubmenu_1
    522                  MENU_Handle hSubmenu;
    523                  hSubmenu = pItem->hSubmenu;
   \   00000048   006090E5           LDR      R6,[R0, #+0]
    524                  GUI_UNLOCK_H(pItem);
   \   0000004C   ........           BL       GUI_ALLOC_UnlockH
    525                  MENU__SendMenuMessage(hObj, hSubmenu, MENU_ON_CLOSE, 0);
   \   00000050   0520A0E1           MOV      R2,R5
   \   00000054   04108DE2           ADD      R1,SP,#+4
   \   00000058   0230A0E1           MOV      R3,R2
   \   0000005C   02C0A0E1           MOV      R12,R2
   \   00000060   02E0A0E1           MOV      LR,R2
   \   00000064   0C50A1E8           STM      R1!,{R2,R3,R12,LR}
   \   00000068   0420A0E3           MOV      R2,#+4
   \   0000006C   B020CDE1           STRH     R2,[SP, #+0]
   \   00000070   2C20A0E3           MOV      R2,#+44
   \   00000074   0600B0E1           MOVS     R0,R6
   \   00000078   B250CDE1           STRH     R5,[SP, #+2]
   \   0000007C   04208DE5           STR      R2,[SP, #+4]
   \   00000080   10D08DE5           STR      SP,[SP, #+16]
   \   00000084   0C408DE5           STR      R4,[SP, #+12]
   \   00000088   0100001A           BNE      ??_CloseSubmenu_2
   \   0000008C   0400A0E1           MOV      R0,R4
   \   00000090   ........           BL       WM_GetParent
   \                     ??_CloseSubmenu_2:
   \   00000094   000050E3           CMP      R0,#+0
   \   00000098   0100000A           BEQ      ??_CloseSubmenu_3
   \   0000009C   04108DE2           ADD      R1,SP,#+4
   \   000000A0   ........           BL       WM__SendMessage
    526                  WM_DetachWindow(hSubmenu);
   \                     ??_CloseSubmenu_3:
   \   000000A4   0600A0E1           MOV      R0,R6
   \   000000A8   ........           BL       WM_DetachWindow
   \   000000AC   000000EA           B        ??_CloseSubmenu_4
    527                } else {
    528                  GUI_UNLOCK_H(pItem);
   \                     ??_CloseSubmenu_1:
   \   000000B0   ........           BL       GUI_ALLOC_UnlockH
    529                }
    530                pObj = MENU_LOCK_H(hObj);
    531                pObj->IsSubmenuActive = 0;
   \                     ??_CloseSubmenu_4:
   \   000000B4   0400A0E1           MOV      R0,R4
   \   000000B8   ........           BL       GUI_ALLOC_LockH
   \   000000BC   6E50C0E5           STRB     R5,[R0, #+110]
    532                GUI_UNLOCK_H(pObj);
   \   000000C0   ........           BL       GUI_ALLOC_UnlockH
    533                /*
    534                 * Keep capture in menu widget. The capture may only released
    535                 * by clicking outside the menu or when mouse moved out.
    536                 * And it may only released from a top level menu.
    537                 */
    538                _SetCapture(hObj);
   \   000000C4   0400A0E1           MOV      R0,R4
   \   000000C8   ........           BL       GUI_ALLOC_LockH
   \   000000CC   6E50D0E5           LDRB     R5,[R0, #+110]
   \   000000D0   ........           BL       GUI_ALLOC_UnlockH
   \   000000D4   000055E3           CMP      R5,#+0
   \   000000D8   0600001A           BNE      ??_CloseSubmenu_5
   \   000000DC   0400A0E1           MOV      R0,R4
   \   000000E0   ........           BL       WM_HasCaptured
   \   000000E4   000050E3           CMP      R0,#+0
   \   000000E8   0200001A           BNE      ??_CloseSubmenu_5
   \   000000EC   0010A0E3           MOV      R1,#+0
   \   000000F0   0400A0E1           MOV      R0,R4
   \   000000F4   ........           BL       WM_SetCapture
    539                /* Invalidate menu item. This is needed because the appearance may have changed */
    540                MENU__InvalidateItem(hObj, Sel);
   \                     ??_CloseSubmenu_5:
   \   000000F8   0400A0E1           MOV      R0,R4
   \   000000FC   ........           BL       WM_InvalidateWindow
    541              }
    542            }
    543          }
   \                     ??_CloseSubmenu_0:
   \   00000100   18D08DE2           ADD      SP,SP,#+24       ;; stack cleaning
   \   00000104   F081BDE8           POP      {R4-R8,PC}       ;; return
    544          
    545          /*********************************************************************
    546          *
    547          *       _OpenSubmenu
    548          */

   \                                 In section .text, align 4, keep-with-next
    549          static void _OpenSubmenu(MENU_Handle hObj, unsigned Index) {
   \                     _OpenSubmenu:
   \   00000000   F04F2DE9           PUSH     {R4-R11,LR}
   \   00000004   2CD04DE2           SUB      SP,SP,#+44
   \   00000008   0040A0E1           MOV      R4,R0
   \   0000000C   0170A0E1           MOV      R7,R1
    550            MENU_Obj * pObj;
    551            GUI_ARRAY   ItemArray;
    552            WM_HWIN     hOwner;
    553            U16         Flags;
    554            char PrevActiveSubmenu;
    555            pObj = MENU_LOCK_H(hObj);
   \   00000010   ........           BL       GUI_ALLOC_LockH
    556            ItemArray = pObj->ItemArray;
    557            hOwner    = pObj->hOwner;
   \   00000014   682090E5           LDR      R2,[R0, #+104]
   \   00000018   645090E5           LDR      R5,[R0, #+100]
   \   0000001C   24208DE5           STR      R2,[SP, #+36]
    558            Flags     = pObj->Flags;
   \   00000020   BC86D0E1           LDRH     R8,[R0, #+108]
    559            PrevActiveSubmenu = pObj->IsSubmenuActive;
   \   00000024   6E00D0E5           LDRB     R0,[R0, #+110]
   \   00000028   2200CDE5           STRB     R0,[SP, #+34]
    560            GUI_UNLOCK_H(pObj);
   \   0000002C   ........           BL       GUI_ALLOC_UnlockH
    561            if (Flags & MENU_SF_ACTIVE) {
   \   00000030   400018E3           TST      R8,#0x40
   \   00000034   2501000A           BEQ      ??_OpenSubmenu_0
    562              MENU_ITEM * pItem;
    563              MENU_Handle Item_hSubmenu;
    564              U16         Item_Id;
    565              U16         Item_Flags;
    566              /* Close previous submenu (if needed) */
    567              _CloseSubmenu(hObj);
   \   00000038   0400A0E1           MOV      R0,R4
   \   0000003C   ........           BL       _CloseSubmenu
    568              pItem = (MENU_ITEM *)GUI_ARRAY_GetpItemLocked(ItemArray, Index);
   \   00000040   0710A0E1           MOV      R1,R7
   \   00000044   0500A0E1           MOV      R0,R5
   \   00000048   ........           BL       GUI_ARRAY_GetpItemLocked
    569              Item_hSubmenu = pItem->hSubmenu;
    570              Item_Id       = pItem->Id;
   \   0000004C   B420D0E1           LDRH     R2,[R0, #+4]
   \   00000050   005090E5           LDR      R5,[R0, #+0]
   \   00000054   B022CDE1           STRH     R2,[SP, #+32]
    571              Item_Flags    = pItem->Flags;
   \   00000058   B660D0E1           LDRH     R6,[R0, #+6]
    572              GUI_UNLOCK_H(pItem);
   \   0000005C   ........           BL       GUI_ALLOC_UnlockH
    573              if (Item_hSubmenu) {
   \   00000060   000055E3           CMP      R5,#+0
   \   00000064   1901000A           BEQ      ??_OpenSubmenu_0
    574                if ((Item_Flags & MENU_IF_DISABLED) == 0) {
   \   00000068   010016E3           TST      R6,#0x1
   \   0000006C   1701001A           BNE      ??_OpenSubmenu_0
    575                  MENU_Handle hObjTopLevel; 
    576                  int x, y, EffectSize;
    577                  WM_HWIN hParent;
    578          
    579                  _GetTopLevelMenu(hObj, &hObjTopLevel, 0);
   \   00000070   0020A0E3           MOV      R2,#+0
   \   00000074   1C108DE2           ADD      R1,SP,#+28
   \   00000078   0400A0E1           MOV      R0,R4
   \   0000007C   ........           BL       _GetTopLevelMenu
    580                  hParent = WM_GetParent(hObjTopLevel);
   \   00000080   1C009DE5           LDR      R0,[SP, #+28]
   \   00000084   ........           BL       WM_GetParent
   \   00000088   0060A0E1           MOV      R6,R0
    581          
    582                  /* Calculate position of submenu */
    583                  EffectSize = _GetEffectSize(hObj);
   \   0000008C   0400A0E1           MOV      R0,R4
   \   00000090   ........           BL       GUI_ALLOC_LockH
   \   00000094   00A0A0E1           MOV      R10,R0
   \   00000098   6C00DAE5           LDRB     R0,[R10, #+108]
   \   0000009C   0090A0E3           MOV      R9,#+0
   \   000000A0   800010E3           TST      R0,#0x80
   \   000000A4   1D00001A           BNE      ??_OpenSubmenu_1
   \   000000A8   0400A0E1           MOV      R0,R4
   \   000000AC   ........           BL       GUI_ALLOC_LockH
   \   000000B0   68B090E5           LDR      R11,[R0, #+104]
   \   000000B4   ........           BL       GUI_ALLOC_UnlockH
   \   000000B8   04008DE2           ADD      R0,SP,#+4
   \   000000BC   0010A0E3           MOV      R1,#+0
   \   000000C0   0020A0E3           MOV      R2,#+0
   \   000000C4   0030A0E3           MOV      R3,#+0
   \   000000C8   00C0A0E3           MOV      R12,#+0
   \   000000CC   0E10A0E8           STM      R0!,{R1-R3,R12}
   \   000000D0   0510A0E3           MOV      R1,#+5
   \   000000D4   B010CDE1           STRH     R1,[SP, #+0]
   \   000000D8   2C10A0E3           MOV      R1,#+44
   \   000000DC   B220CDE1           STRH     R2,[SP, #+2]
   \   000000E0   04108DE5           STR      R1,[SP, #+4]
   \   000000E4   10D08DE5           STR      SP,[SP, #+16]
   \   000000E8   0C408DE5           STR      R4,[SP, #+12]
   \   000000EC   00005BE3           CMP      R11,#+0
   \   000000F0   0200001A           BNE      ??_OpenSubmenu_2
   \   000000F4   0400A0E1           MOV      R0,R4
   \   000000F8   ........           BL       WM_GetParent
   \   000000FC   00B0A0E1           MOV      R11,R0
   \                     ??_OpenSubmenu_2:
   \   00000100   00005BE3           CMP      R11,#+0
   \   00000104   0700000A           BEQ      ??_OpenSubmenu_3
   \   00000108   04108DE2           ADD      R1,SP,#+4
   \   0000010C   0B00A0E1           MOV      R0,R11
   \   00000110   ........           BL       WM__SendMessage
   \   00000114   10009DE5           LDR      R0,[SP, #+16]
   \   00000118   000050E3           CMP      R0,#+0
   \   0000011C   0100000A           BEQ      ??_OpenSubmenu_3
   \                     ??_OpenSubmenu_1:
   \   00000120   2C009AE5           LDR      R0,[R10, #+44]
   \   00000124   009090E5           LDR      R9,[R0, #+0]
   \                     ??_OpenSubmenu_3:
   \   00000128   ........           BL       GUI_ALLOC_UnlockH
    584                  _GetItemPos(hObj, Index, &x, &y);
   \   0000012C   14308DE2           ADD      R3,SP,#+20
   \   00000130   18208DE2           ADD      R2,SP,#+24
   \   00000134   0710A0E1           MOV      R1,R7
   \   00000138   0400A0E1           MOV      R0,R4
   \   0000013C   ........           BL       _GetItemPos
    585                  if (Flags & MENU_SF_VERTICAL) {
   \   00000140   010018E3           TST      R8,#0x1
   \   00000144   0400A0E1           MOV      R0,R4
   \   00000148   3100000A           BEQ      ??_OpenSubmenu_4
    586                    x += _CalcMenuSizeX(hObj) - (_GetEffectSize(hObj) << 1);
   \   0000014C   ........           BL       _CalcMenuSizeX
   \   00000150   0070A0E1           MOV      R7,R0
   \   00000154   0400A0E1           MOV      R0,R4
   \   00000158   ........           BL       GUI_ALLOC_LockH
   \   0000015C   0080A0E1           MOV      R8,R0
   \   00000160   6C00D8E5           LDRB     R0,[R8, #+108]
   \   00000164   00A0A0E3           MOV      R10,#+0
   \   00000168   800010E3           TST      R0,#0x80
   \   0000016C   1D00001A           BNE      ??_OpenSubmenu_5
   \   00000170   0400A0E1           MOV      R0,R4
   \   00000174   ........           BL       GUI_ALLOC_LockH
   \   00000178   68B090E5           LDR      R11,[R0, #+104]
   \   0000017C   ........           BL       GUI_ALLOC_UnlockH
   \   00000180   04008DE2           ADD      R0,SP,#+4
   \   00000184   0010A0E3           MOV      R1,#+0
   \   00000188   0020A0E3           MOV      R2,#+0
   \   0000018C   0030A0E3           MOV      R3,#+0
   \   00000190   00C0A0E3           MOV      R12,#+0
   \   00000194   0E10A0E8           STM      R0!,{R1-R3,R12}
   \   00000198   0510A0E3           MOV      R1,#+5
   \   0000019C   B010CDE1           STRH     R1,[SP, #+0]
   \   000001A0   2C10A0E3           MOV      R1,#+44
   \   000001A4   B220CDE1           STRH     R2,[SP, #+2]
   \   000001A8   04108DE5           STR      R1,[SP, #+4]
   \   000001AC   10D08DE5           STR      SP,[SP, #+16]
   \   000001B0   0C408DE5           STR      R4,[SP, #+12]
   \   000001B4   00005BE3           CMP      R11,#+0
   \   000001B8   0200001A           BNE      ??_OpenSubmenu_6
   \   000001BC   0400A0E1           MOV      R0,R4
   \   000001C0   ........           BL       WM_GetParent
   \   000001C4   00B0A0E1           MOV      R11,R0
   \                     ??_OpenSubmenu_6:
   \   000001C8   00005BE3           CMP      R11,#+0
   \   000001CC   0700000A           BEQ      ??_OpenSubmenu_7
   \   000001D0   04108DE2           ADD      R1,SP,#+4
   \   000001D4   0B00A0E1           MOV      R0,R11
   \   000001D8   ........           BL       WM__SendMessage
   \   000001DC   10009DE5           LDR      R0,[SP, #+16]
   \   000001E0   000050E3           CMP      R0,#+0
   \   000001E4   0100000A           BEQ      ??_OpenSubmenu_7
   \                     ??_OpenSubmenu_5:
   \   000001E8   2C0098E5           LDR      R0,[R8, #+44]
   \   000001EC   00A090E5           LDR      R10,[R0, #+0]
   \                     ??_OpenSubmenu_7:
   \   000001F0   ........           BL       GUI_ALLOC_UnlockH
   \   000001F4   18009DE5           LDR      R0,[SP, #+24]
   \   000001F8   000087E0           ADD      R0,R7,R0
   \   000001FC   8A0040E0           SUB      R0,R0,R10, LSL #+1
   \   00000200   18008DE5           STR      R0,[SP, #+24]
    587                    y -= EffectSize;
   \   00000204   14009DE5           LDR      R0,[SP, #+20]
   \   00000208   090040E0           SUB      R0,R0,R9
   \   0000020C   14008DE5           STR      R0,[SP, #+20]
   \   00000210   300000EA           B        ??_OpenSubmenu_8
    588                  } else {
    589                    y += _CalcMenuSizeY(hObj) - (_GetEffectSize(hObj) << 1);
   \                     ??_OpenSubmenu_4:
   \   00000214   ........           BL       _CalcMenuSizeY
   \   00000218   0070A0E1           MOV      R7,R0
   \   0000021C   0400A0E1           MOV      R0,R4
   \   00000220   ........           BL       GUI_ALLOC_LockH
   \   00000224   0080A0E1           MOV      R8,R0
   \   00000228   6C00D8E5           LDRB     R0,[R8, #+108]
   \   0000022C   00A0A0E3           MOV      R10,#+0
   \   00000230   800010E3           TST      R0,#0x80
   \   00000234   1D00001A           BNE      ??_OpenSubmenu_9
   \   00000238   0400A0E1           MOV      R0,R4
   \   0000023C   ........           BL       GUI_ALLOC_LockH
   \   00000240   68B090E5           LDR      R11,[R0, #+104]
   \   00000244   ........           BL       GUI_ALLOC_UnlockH
   \   00000248   04008DE2           ADD      R0,SP,#+4
   \   0000024C   0010A0E3           MOV      R1,#+0
   \   00000250   0020A0E3           MOV      R2,#+0
   \   00000254   0030A0E3           MOV      R3,#+0
   \   00000258   00C0A0E3           MOV      R12,#+0
   \   0000025C   0E10A0E8           STM      R0!,{R1-R3,R12}
   \   00000260   0510A0E3           MOV      R1,#+5
   \   00000264   B010CDE1           STRH     R1,[SP, #+0]
   \   00000268   2C10A0E3           MOV      R1,#+44
   \   0000026C   B220CDE1           STRH     R2,[SP, #+2]
   \   00000270   04108DE5           STR      R1,[SP, #+4]
   \   00000274   10D08DE5           STR      SP,[SP, #+16]
   \   00000278   0C408DE5           STR      R4,[SP, #+12]
   \   0000027C   00005BE3           CMP      R11,#+0
   \   00000280   0200001A           BNE      ??_OpenSubmenu_10
   \   00000284   0400A0E1           MOV      R0,R4
   \   00000288   ........           BL       WM_GetParent
   \   0000028C   00B0A0E1           MOV      R11,R0
   \                     ??_OpenSubmenu_10:
   \   00000290   00005BE3           CMP      R11,#+0
   \   00000294   0700000A           BEQ      ??_OpenSubmenu_11
   \   00000298   04108DE2           ADD      R1,SP,#+4
   \   0000029C   0B00A0E1           MOV      R0,R11
   \   000002A0   ........           BL       WM__SendMessage
   \   000002A4   10009DE5           LDR      R0,[SP, #+16]
   \   000002A8   000050E3           CMP      R0,#+0
   \   000002AC   0100000A           BEQ      ??_OpenSubmenu_11
   \                     ??_OpenSubmenu_9:
   \   000002B0   2C0098E5           LDR      R0,[R8, #+44]
   \   000002B4   00A090E5           LDR      R10,[R0, #+0]
   \                     ??_OpenSubmenu_11:
   \   000002B8   ........           BL       GUI_ALLOC_UnlockH
   \   000002BC   14009DE5           LDR      R0,[SP, #+20]
   \   000002C0   000087E0           ADD      R0,R7,R0
   \   000002C4   8A0040E0           SUB      R0,R0,R10, LSL #+1
   \   000002C8   14008DE5           STR      R0,[SP, #+20]
    590                    x -= EffectSize;
   \   000002CC   18009DE5           LDR      R0,[SP, #+24]
   \   000002D0   090040E0           SUB      R0,R0,R9
   \   000002D4   18008DE5           STR      R0,[SP, #+24]
    591                  }
    592                  x += WM_GetWindowOrgX(hObjTopLevel) - WM_GetWindowOrgX(hParent);
   \                     ??_OpenSubmenu_8:
   \   000002D8   1C009DE5           LDR      R0,[SP, #+28]
   \   000002DC   ........           BL       WM_GetWindowOrgX
   \   000002E0   0070A0E1           MOV      R7,R0
   \   000002E4   0600A0E1           MOV      R0,R6
   \   000002E8   ........           BL       WM_GetWindowOrgX
   \   000002EC   18109DE5           LDR      R1,[SP, #+24]
   \   000002F0   011087E0           ADD      R1,R7,R1
   \   000002F4   000041E0           SUB      R0,R1,R0
   \   000002F8   18008DE5           STR      R0,[SP, #+24]
    593                  y += WM_GetWindowOrgY(hObjTopLevel) - WM_GetWindowOrgY(hParent);
   \   000002FC   1C009DE5           LDR      R0,[SP, #+28]
   \   00000300   ........           BL       WM_GetWindowOrgY
   \   00000304   0070A0E1           MOV      R7,R0
   \   00000308   0600A0E1           MOV      R0,R6
   \   0000030C   ........           BL       WM_GetWindowOrgY
   \   00000310   14109DE5           LDR      R1,[SP, #+20]
   \   00000314   011087E0           ADD      R1,R7,R1
   \   00000318   000041E0           SUB      R0,R1,R0
   \   0000031C   14008DE5           STR      R0,[SP, #+20]
    594                  /*
    595                   * Notify owner window when for the first time open a menu (when no
    596                   * other submenu was open), so it can initialize the menu items.
    597                   */
    598                  if (PrevActiveSubmenu == 0) {
   \   00000320   2200DDE5           LDRB     R0,[SP, #+34]
   \   00000324   ............       ADRL     R7,`?<Constant {0}>`
   \              ....        
   \   0000032C   000050E3           CMP      R0,#+0
   \   00000330   3000001A           BNE      ??_OpenSubmenu_12
    599                    if (_IsTopLevelMenu(hObj)) {
   \   00000334   0400A0E1           MOV      R0,R4
   \   00000338   ........           BL       GUI_ALLOC_LockH
   \   0000033C   688090E5           LDR      R8,[R0, #+104]
   \   00000340   ........           BL       GUI_ALLOC_UnlockH
   \   00000344   0E10B7E8           LDM      R7!,{R1-R3,R12}
   \   00000348   04008DE2           ADD      R0,SP,#+4
   \   0000034C   0E10A0E8           STM      R0!,{R1-R3,R12}
   \   00000350   0510A0E3           MOV      R1,#+5
   \   00000354   B010CDE1           STRH     R1,[SP, #+0]
   \   00000358   0090A0E3           MOV      R9,#+0
   \   0000035C   2C10A0E3           MOV      R1,#+44
   \   00000360   107047E2           SUB      R7,R7,#+16
   \   00000364   B290CDE1           STRH     R9,[SP, #+2]
   \   00000368   04108DE5           STR      R1,[SP, #+4]
   \   0000036C   10D08DE5           STR      SP,[SP, #+16]
   \   00000370   0C408DE5           STR      R4,[SP, #+12]
   \   00000374   000058E3           CMP      R8,#+0
   \   00000378   0200001A           BNE      ??_OpenSubmenu_13
   \   0000037C   0400A0E1           MOV      R0,R4
   \   00000380   ........           BL       WM_GetParent
   \   00000384   0080A0E1           MOV      R8,R0
   \                     ??_OpenSubmenu_13:
   \   00000388   000058E3           CMP      R8,#+0
   \   0000038C   0500000A           BEQ      ??_OpenSubmenu_14
   \   00000390   04108DE2           ADD      R1,SP,#+4
   \   00000394   0800A0E1           MOV      R0,R8
   \   00000398   ........           BL       WM__SendMessage
   \   0000039C   10009DE5           LDR      R0,[SP, #+16]
   \   000003A0   000050E3           CMP      R0,#+0
   \   000003A4   1300001A           BNE      ??_OpenSubmenu_12
    600                      MENU__SendMenuMessage(hObj, hOwner, MENU_ON_INITMENU, 0);
   \                     ??_OpenSubmenu_14:
   \   000003A8   0C50B7E8           LDM      R7!,{R2,R3,R12,LR}
   \   000003AC   24009DE5           LDR      R0,[SP, #+36]
   \   000003B0   04108DE2           ADD      R1,SP,#+4
   \   000003B4   0C50A1E8           STM      R1!,{R2,R3,R12,LR}
   \   000003B8   0120A0E3           MOV      R2,#+1
   \   000003BC   B020CDE1           STRH     R2,[SP, #+0]
   \   000003C0   2C20A0E3           MOV      R2,#+44
   \   000003C4   107047E2           SUB      R7,R7,#+16
   \   000003C8   B290CDE1           STRH     R9,[SP, #+2]
   \   000003CC   04208DE5           STR      R2,[SP, #+4]
   \   000003D0   10D08DE5           STR      SP,[SP, #+16]
   \   000003D4   0C408DE5           STR      R4,[SP, #+12]
   \   000003D8   000050E3           CMP      R0,#+0
   \   000003DC   0100001A           BNE      ??_OpenSubmenu_15
   \   000003E0   0400A0E1           MOV      R0,R4
   \   000003E4   ........           BL       WM_GetParent
   \                     ??_OpenSubmenu_15:
   \   000003E8   000050E3           CMP      R0,#+0
   \   000003EC   0100000A           BEQ      ??_OpenSubmenu_12
   \   000003F0   04108DE2           ADD      R1,SP,#+4
   \   000003F4   ........           BL       WM__SendMessage
    601                    }
    602                  }
    603                  /* Notify owner window when a submenu opens, so it can initialize the menu items. */
    604                  MENU__SendMenuMessage(hObj, hOwner, MENU_ON_INITSUBMENU, Item_Id);
   \                     ??_OpenSubmenu_12:
   \   000003F8   0C50B7E8           LDM      R7!,{R2,R3,R12,LR}
   \   000003FC   24009DE5           LDR      R0,[SP, #+36]
   \   00000400   04108DE2           ADD      R1,SP,#+4
   \   00000404   0C50A1E8           STM      R1!,{R2,R3,R12,LR}
   \   00000408   0220A0E3           MOV      R2,#+2
   \   0000040C   B020CDE1           STRH     R2,[SP, #+0]
   \   00000410   B022DDE1           LDRH     R2,[SP, #+32]
   \   00000414   107047E2           SUB      R7,R7,#+16
   \   00000418   10D08DE5           STR      SP,[SP, #+16]
   \   0000041C   B220CDE1           STRH     R2,[SP, #+2]
   \   00000420   2C20A0E3           MOV      R2,#+44
   \   00000424   04208DE5           STR      R2,[SP, #+4]
   \   00000428   0C408DE5           STR      R4,[SP, #+12]
   \   0000042C   000050E3           CMP      R0,#+0
   \   00000430   0100001A           BNE      ??_OpenSubmenu_16
   \   00000434   0400A0E1           MOV      R0,R4
   \   00000438   ........           BL       WM_GetParent
   \                     ??_OpenSubmenu_16:
   \   0000043C   000050E3           CMP      R0,#+0
   \   00000440   0100000A           BEQ      ??_OpenSubmenu_17
   \   00000444   04108DE2           ADD      R1,SP,#+4
   \   00000448   ........           BL       WM__SendMessage
   \                     ??_OpenSubmenu_17:
   \   0000044C   ........           BL       GUI_Lock
   \   00000450   0500A0E1           MOV      R0,R5
   \   00000454   ........           BL       GUI_ALLOC_LockH
   \   00000458   000050E3           CMP      R0,#+0
   \   0000045C   68408015           STRNE    R4,[R0, #+104]
   \   00000460   ........           BL       GUI_ALLOC_UnlockH
   \   00000464   ........           BL       GUI_Unlock
    605                  /* Set active menu as owner of submenu. */
    606                  MENU_SetOwner(Item_hSubmenu, hObj);
    607                  /* Attach submenu and inform it about its activation. */
    608                  WM_AttachWindowAt(Item_hSubmenu, /*WM_HBKWIN*/hParent, x, y);
   \   00000468   14309DE5           LDR      R3,[SP, #+20]
   \   0000046C   18209DE5           LDR      R2,[SP, #+24]
   \   00000470   0610A0E1           MOV      R1,R6
   \   00000474   0500A0E1           MOV      R0,R5
   \   00000478   ........           BL       WM_AttachWindowAt
    609                  MENU__SendMenuMessage(hObj, Item_hSubmenu, MENU_ON_OPEN, 0);
   \   0000047C   0E10B7E8           LDM      R7!,{R1-R3,R12}
   \   00000480   04008DE2           ADD      R0,SP,#+4
   \   00000484   0E10A0E8           STM      R0!,{R1-R3,R12}
   \   00000488   0310A0E3           MOV      R1,#+3
   \   0000048C   B010CDE1           STRH     R1,[SP, #+0]
   \   00000490   0010A0E3           MOV      R1,#+0
   \   00000494   B210CDE1           STRH     R1,[SP, #+2]
   \   00000498   2C10A0E3           MOV      R1,#+44
   \   0000049C   04108DE5           STR      R1,[SP, #+4]
   \   000004A0   10D08DE5           STR      SP,[SP, #+16]
   \   000004A4   0C408DE5           STR      R4,[SP, #+12]
   \   000004A8   04108DE2           ADD      R1,SP,#+4
   \   000004AC   0500A0E1           MOV      R0,R5
   \   000004B0   ........           BL       WM__SendMessage
    610                  pObj = MENU_LOCK_H(hObj);
    611                  pObj->IsSubmenuActive = 1;
   \   000004B4   0400A0E1           MOV      R0,R4
   \   000004B8   ........           BL       GUI_ALLOC_LockH
   \   000004BC   0110A0E3           MOV      R1,#+1
   \   000004C0   6E10C0E5           STRB     R1,[R0, #+110]
    612                  GUI_UNLOCK_H(pObj);
   \   000004C4   ........           BL       GUI_ALLOC_UnlockH
    613                  /* Invalidate menu item. This is needed because the appearance may have changed. */
    614                  MENU__InvalidateItem(hObj, Index);
   \   000004C8   0400A0E1           MOV      R0,R4
   \   000004CC   ........           BL       WM_InvalidateWindow
    615                }
    616              }
    617            }
    618          }
   \                     ??_OpenSubmenu_0:
   \   000004D0   2CD08DE2           ADD      SP,SP,#+44       ;; stack cleaning
   \   000004D4   F08FBDE8           POP      {R4-R11,PC}      ;; return
    619          
    620          /*********************************************************************
    621          *
    622          *       _ClosePopup
    623          */
    624          static void _ClosePopup(MENU_Handle hObj) {
    625            MENU_Obj * pObj;
    626            pObj = MENU_LOCK_H(hObj);
    627            if (pObj->Flags & MENU_SF_POPUP) {
    628              pObj->Flags &= ~(MENU_SF_POPUP);
    629              GUI_UNLOCK_H(pObj);
    630              WM_DetachWindow(hObj);
    631              WM_ReleaseCapture();
    632            } else {
    633              GUI_UNLOCK_H(pObj);
    634            }
    635          }
    636          
    637          /*********************************************************************
    638          *
    639          *       _SetSelectionEx
    640          */

   \                                 In section .text, align 4, keep-with-next
    641          static void _SetSelectionEx(MENU_Handle hObj, int Index, int SuppressNotification) {
   \                     _SetSelectionEx:
   \   00000000   F04D2DE9           PUSH     {R4-R8,R10,R11,LR}
   \   00000004   18D04DE2           SUB      SP,SP,#+24
   \   00000008   0040A0E1           MOV      R4,R0
   \   0000000C   0160A0E1           MOV      R6,R1
   \   00000010   0270A0E1           MOV      R7,R2
    642            MENU_Obj * pObj;
    643            char        IsSubmenuActive;
    644            GUI_ARRAY   ItemArray;
    645            WM_HWIN     hOwner;
    646            pObj = MENU_LOCK_H(hObj);
   \   00000014   ........           BL       GUI_ALLOC_LockH
   \   00000018   0080A0E1           MOV      R8,R0
    647            if (Index != pObj->Sel) {
   \   0000001C   780098E5           LDR      R0,[R8, #+120]
   \   00000020   000056E1           CMP      R6,R0
   \   00000024   2E00000A           BEQ      ??_SetSelectionEx_0
    648              IsSubmenuActive = pObj->IsSubmenuActive;
   \   00000028   6EA0D8E5           LDRB     R10,[R8, #+110]
    649              ItemArray       = pObj->ItemArray;
   \   0000002C   64B098E5           LDR      R11,[R8, #+100]
    650              hOwner          = pObj->hOwner;
   \   00000030   685098E5           LDR      R5,[R8, #+104]
    651              MENU__InvalidateItem(hObj, pObj->Sel); /* Invalidate previous selection */
   \   00000034   0400A0E1           MOV      R0,R4
   \   00000038   ........           BL       WM_InvalidateWindow
    652              pObj->Sel = Index;
   \   0000003C   786088E5           STR      R6,[R8, #+120]
    653              MENU__InvalidateItem(hObj, Index);     /* Invalidate new selection */
   \   00000040   0400A0E1           MOV      R0,R4
   \   00000044   ........           BL       WM_InvalidateWindow
    654              GUI_UNLOCK_H(pObj);
   \   00000048   ........           BL       GUI_ALLOC_UnlockH
    655              if ((IsSubmenuActive == 0) && (Index >= 0) && (SuppressNotification == 0)) {
   \   0000004C   00005AE3           CMP      R10,#+0
   \   00000050   2400001A           BNE      ??_SetSelectionEx_1
   \   00000054   000056E3           CMP      R6,#+0
   \   00000058   2200004A           BMI      ??_SetSelectionEx_1
   \   0000005C   000057E3           CMP      R7,#+0
   \   00000060   2000001A           BNE      ??_SetSelectionEx_1
    656                MENU_ITEM * pItem;
    657                U16         Id;
    658                U16         Flags;
    659                pItem = (MENU_ITEM *)GUI_ARRAY_GetpItemLocked(ItemArray, Index);
   \   00000064   0610A0E1           MOV      R1,R6
   \   00000068   0B00A0E1           MOV      R0,R11
   \   0000006C   ........           BL       GUI_ARRAY_GetpItemLocked
    660                Id    = pItem->Id;
   \   00000070   B460D0E1           LDRH     R6,[R0, #+4]
    661                Flags = pItem->Flags;
   \   00000074   B670D0E1           LDRH     R7,[R0, #+6]
    662                GUI_UNLOCK_H(pItem);
   \   00000078   ........           BL       GUI_ALLOC_UnlockH
    663                if ((Flags & MENU_IF_SEPARATOR) == 0) {
   \   0000007C   020017E3           TST      R7,#0x2
   \   00000080   1800001A           BNE      ??_SetSelectionEx_1
    664                  MENU__SendMenuMessage(hObj, hOwner, MENU_ON_ITEMACTIVATE, Id);
   \   00000084   04008DE2           ADD      R0,SP,#+4
   \   00000088   0010A0E3           MOV      R1,#+0
   \   0000008C   0020A0E3           MOV      R2,#+0
   \   00000090   0030A0E3           MOV      R3,#+0
   \   00000094   00C0A0E3           MOV      R12,#+0
   \   00000098   0E10A0E8           STM      R0!,{R1-R3,R12}
   \   0000009C   0610A0E3           MOV      R1,#+6
   \   000000A0   B010CDE1           STRH     R1,[SP, #+0]
   \   000000A4   2C10A0E3           MOV      R1,#+44
   \   000000A8   B260CDE1           STRH     R6,[SP, #+2]
   \   000000AC   04108DE5           STR      R1,[SP, #+4]
   \   000000B0   10D08DE5           STR      SP,[SP, #+16]
   \   000000B4   0C408DE5           STR      R4,[SP, #+12]
   \   000000B8   000055E3           CMP      R5,#+0
   \   000000BC   0200001A           BNE      ??_SetSelectionEx_2
   \   000000C0   0400A0E1           MOV      R0,R4
   \   000000C4   ........           BL       WM_GetParent
   \   000000C8   0050A0E1           MOV      R5,R0
   \                     ??_SetSelectionEx_2:
   \   000000CC   000055E3           CMP      R5,#+0
   \   000000D0   0400000A           BEQ      ??_SetSelectionEx_1
   \   000000D4   04108DE2           ADD      R1,SP,#+4
   \   000000D8   0500A0E1           MOV      R0,R5
   \   000000DC   ........           BL       WM__SendMessage
   \   000000E0   000000EA           B        ??_SetSelectionEx_1
    665                }
    666              }
    667            } else {
    668              GUI_UNLOCK_H(pObj);
   \                     ??_SetSelectionEx_0:
   \   000000E4   ........           BL       GUI_ALLOC_UnlockH
    669            }
    670          }
   \                     ??_SetSelectionEx_1:
   \   000000E8   18D08DE2           ADD      SP,SP,#+24       ;; stack cleaning
   \   000000EC   F08DBDE8           POP      {R4-R8,R10,R11,PC}  ;; return
    671          
    672          /*********************************************************************
    673          *
    674          *       _SetSelection
    675          */
    676          static void _SetSelection(MENU_Handle hObj, int Index) {
    677            _SetSelectionEx(hObj, Index, 0);
    678          }
    679          
    680          /*********************************************************************
    681          *
    682          *       _SelectItem
    683          */
    684          static void _SelectItem(MENU_Handle hObj, unsigned Index) {
    685            MENU_Obj * pObj;
    686            unsigned Sel;
    687            pObj = MENU_LOCK_H(hObj);
    688            Sel = pObj->Sel;
    689            GUI_UNLOCK_H(pObj);
    690            if (Sel != Index) {
    691              _SetCapture(hObj);
    692              _OpenSubmenu(hObj, Index);
    693              _SetSelection(hObj, Index);
    694            }
    695          }
    696          
    697          /*********************************************************************
    698          *
    699          *       _DeselectItem
    700          */

   \                                 In section .text, align 4, keep-with-next
    701          static void _DeselectItem(MENU_Handle hObj) {
   \                     _DeselectItem:
   \   00000000   70402DE9           PUSH     {R4-R6,LR}
   \   00000004   18D04DE2           SUB      SP,SP,#+24
   \   00000008   0040A0E1           MOV      R4,R0
    702            MENU_Obj * pObj;
    703            char        IsSubmenuActive;
    704            pObj = MENU_LOCK_H(hObj);
    705            IsSubmenuActive = pObj->IsSubmenuActive;
   \   0000000C   ........           BL       GUI_ALLOC_LockH
   \   00000010   6E50D0E5           LDRB     R5,[R0, #+110]
    706            GUI_UNLOCK_H(pObj);
   \   00000014   ........           BL       GUI_ALLOC_UnlockH
    707            if (IsSubmenuActive == 0) {
   \   00000018   000055E3           CMP      R5,#+0
   \   0000001C   2C00001A           BNE      ??_DeselectItem_0
    708              _SetSelection(hObj, -1);
   \   00000020   0020A0E3           MOV      R2,#+0
   \   00000024   0210E0E1           MVN      R1,R2
   \   00000028   0400A0E1           MOV      R0,R4
   \   0000002C   ........           BL       _SetSelectionEx
    709              _ReleaseCapture(hObj);
   \   00000030   0400A0E1           MOV      R0,R4
   \   00000034   ........           BL       WM_HasCaptured
   \   00000038   000050E3           CMP      R0,#+0
   \   0000003C   2400000A           BEQ      ??_DeselectItem_0
   \   00000040   0400A0E1           MOV      R0,R4
   \   00000044   ........           BL       GUI_ALLOC_LockH
   \   00000048   BC56D0E1           LDRH     R5,[R0, #+108]
   \   0000004C   ........           BL       GUI_ALLOC_UnlockH
   \   00000050   0400A0E1           MOV      R0,R4
   \   00000054   ........           BL       GUI_ALLOC_LockH
   \   00000058   686090E5           LDR      R6,[R0, #+104]
   \   0000005C   ........           BL       GUI_ALLOC_UnlockH
   \   00000060   04008DE2           ADD      R0,SP,#+4
   \   00000064   0010A0E3           MOV      R1,#+0
   \   00000068   0020A0E3           MOV      R2,#+0
   \   0000006C   0030A0E3           MOV      R3,#+0
   \   00000070   00C0A0E3           MOV      R12,#+0
   \   00000074   0E10A0E8           STM      R0!,{R1-R3,R12}
   \   00000078   0510A0E3           MOV      R1,#+5
   \   0000007C   B010CDE1           STRH     R1,[SP, #+0]
   \   00000080   2C10A0E3           MOV      R1,#+44
   \   00000084   B220CDE1           STRH     R2,[SP, #+2]
   \   00000088   04108DE5           STR      R1,[SP, #+4]
   \   0000008C   10D08DE5           STR      SP,[SP, #+16]
   \   00000090   0C408DE5           STR      R4,[SP, #+12]
   \   00000094   000056E3           CMP      R6,#+0
   \   00000098   0200001A           BNE      ??_DeselectItem_1
   \   0000009C   0400A0E1           MOV      R0,R4
   \   000000A0   ........           BL       WM_GetParent
   \   000000A4   0060A0E1           MOV      R6,R0
   \                     ??_DeselectItem_1:
   \   000000A8   000056E3           CMP      R6,#+0
   \   000000AC   0500000A           BEQ      ??_DeselectItem_2
   \   000000B0   04108DE2           ADD      R1,SP,#+4
   \   000000B4   0600A0E1           MOV      R0,R6
   \   000000B8   ........           BL       WM__SendMessage
   \   000000BC   10009DE5           LDR      R0,[SP, #+16]
   \   000000C0   000050E3           CMP      R0,#+0
   \   000000C4   0200001A           BNE      ??_DeselectItem_0
   \                     ??_DeselectItem_2:
   \   000000C8   800015E3           TST      R5,#0x80
   \   000000CC   0000001A           BNE      ??_DeselectItem_0
   \   000000D0   ........           BL       WM_ReleaseCapture
    710            }
    711          }
   \                     ??_DeselectItem_0:
   \   000000D4   18D08DE2           ADD      SP,SP,#+24       ;; stack cleaning
   \   000000D8   7080BDE8           POP      {R4-R6,PC}       ;; return
    712          
    713          /*********************************************************************
    714          *
    715          *       _ActivateItem
    716          */

   \                                 In section .text, align 4, keep-with-next
    717          static void _ActivateItem(MENU_Handle hObj, unsigned Index) {
   \                     _ActivateItem:
   \   00000000   F0412DE9           PUSH     {R4-R8,LR}
   \   00000004   18D04DE2           SUB      SP,SP,#+24
   \   00000008   0040A0E1           MOV      R4,R0
   \   0000000C   0160A0E1           MOV      R6,R1
    718            MENU_Obj * pObj;
    719            MENU_ITEM * pItem;
    720            MENU_Handle Item_hSubmenu;
    721            U16         Item_Flags;
    722            U16         Item_Id;
    723            GUI_ARRAY ItemArray;
    724            WM_HWIN     hOwner;
    725            pObj = MENU_LOCK_H(hObj);
   \   00000010   ........           BL       GUI_ALLOC_LockH
    726            ItemArray = pObj->ItemArray;
   \   00000014   647090E5           LDR      R7,[R0, #+100]
    727            hOwner = pObj->hOwner;
   \   00000018   685090E5           LDR      R5,[R0, #+104]
    728            GUI_UNLOCK_H(pObj);
   \   0000001C   ........           BL       GUI_ALLOC_UnlockH
    729            pItem = (MENU_ITEM *)GUI_ARRAY_GetpItemLocked(ItemArray, Index);
   \   00000020   0610A0E1           MOV      R1,R6
   \   00000024   0700A0E1           MOV      R0,R7
   \   00000028   ........           BL       GUI_ARRAY_GetpItemLocked
    730            Item_hSubmenu = pItem->hSubmenu;
   \   0000002C   007090E5           LDR      R7,[R0, #+0]
    731            Item_Flags    = pItem->Flags;
   \   00000030   B680D0E1           LDRH     R8,[R0, #+6]
    732            Item_Id       = pItem->Id;
   \   00000034   B460D0E1           LDRH     R6,[R0, #+4]
    733            GUI_UNLOCK_H(pItem);
   \   00000038   ........           BL       GUI_ALLOC_UnlockH
    734            if (Item_hSubmenu == 0) {
   \   0000003C   000057E3           CMP      R7,#+0
    735              if ((Item_Flags & (MENU_IF_DISABLED | MENU_IF_SEPARATOR)) == 0) {
   \   00000040   03001803           TSTEQ    R8,#0x3
   \   00000044   2300001A           BNE      ??_ActivateItem_0
    736                _ClosePopup(hObj);
   \   00000048   0400A0E1           MOV      R0,R4
   \   0000004C   ........           BL       GUI_ALLOC_LockH
   \   00000050   6C10D0E5           LDRB     R1,[R0, #+108]
   \   00000054   800011E3           TST      R1,#0x80
   \   00000058   0700000A           BEQ      ??_ActivateItem_1
   \   0000005C   BC16D0E1           LDRH     R1,[R0, #+108]
   \   00000060   8010C1E3           BIC      R1,R1,#0x80
   \   00000064   BC16C0E1           STRH     R1,[R0, #+108]
   \   00000068   ........           BL       GUI_ALLOC_UnlockH
   \   0000006C   0400A0E1           MOV      R0,R4
   \   00000070   ........           BL       WM_DetachWindow
   \   00000074   ........           BL       WM_ReleaseCapture
   \   00000078   000000EA           B        ??_ActivateItem_2
   \                     ??_ActivateItem_1:
   \   0000007C   ........           BL       GUI_ALLOC_UnlockH
    737                /* Send item select message to owner. */
    738                MENU__SendMenuMessage(hObj, hOwner, MENU_ON_ITEMSELECT, Item_Id);
   \                     ??_ActivateItem_2:
   \   00000080   04008DE2           ADD      R0,SP,#+4
   \   00000084   0010A0E3           MOV      R1,#+0
   \   00000088   0020A0E3           MOV      R2,#+0
   \   0000008C   0030A0E3           MOV      R3,#+0
   \   00000090   00C0A0E3           MOV      R12,#+0
   \   00000094   0E10A0E8           STM      R0!,{R1-R3,R12}
   \   00000098   2C10A0E3           MOV      R1,#+44
   \   0000009C   B070CDE1           STRH     R7,[SP, #+0]
   \   000000A0   B260CDE1           STRH     R6,[SP, #+2]
   \   000000A4   04108DE5           STR      R1,[SP, #+4]
   \   000000A8   10D08DE5           STR      SP,[SP, #+16]
   \   000000AC   0C408DE5           STR      R4,[SP, #+12]
   \   000000B0   000055E3           CMP      R5,#+0
   \   000000B4   0200001A           BNE      ??_ActivateItem_3
   \   000000B8   0400A0E1           MOV      R0,R4
   \   000000BC   ........           BL       WM_GetParent
   \   000000C0   0050A0E1           MOV      R5,R0
   \                     ??_ActivateItem_3:
   \   000000C4   000055E3           CMP      R5,#+0
   \   000000C8   0200000A           BEQ      ??_ActivateItem_0
   \   000000CC   04108DE2           ADD      R1,SP,#+4
   \   000000D0   0500A0E1           MOV      R0,R5
   \   000000D4   ........           BL       WM__SendMessage
    739              }
    740            }
    741          }
   \                     ??_ActivateItem_0:
   \   000000D8   18D08DE2           ADD      SP,SP,#+24       ;; stack cleaning
   \   000000DC   F081BDE8           POP      {R4-R8,PC}       ;; return
    742          
    743          /*********************************************************************
    744          *
    745          *       _ActivateMenu
    746          */

   \                                 In section .text, align 4, keep-with-next
    747          static void _ActivateMenu(MENU_Handle hObj, unsigned Index) {
   \                     _ActivateMenu:
   \   00000000   F0472DE9           PUSH     {R4-R10,LR}
   \   00000004   0040A0E1           MOV      R4,R0
   \   00000008   0150A0E1           MOV      R5,R1
    748            MENU_Obj * pObj;
    749            int         Sel;
    750            U16         Flags;
    751            MENU_ITEM * pItem;
    752            MENU_Handle Item_hSubmenu;
    753            U16         Item_Flags;
    754            pObj = MENU_LOCK_H(hObj);
   \   0000000C   ........           BL       GUI_ALLOC_LockH
   \   00000010   0070A0E1           MOV      R7,R0
    755            pItem = (MENU_ITEM *)GUI_ARRAY_GetpItemLocked(pObj->ItemArray, Index);
   \   00000014   0510A0E1           MOV      R1,R5
   \   00000018   640097E5           LDR      R0,[R7, #+100]
   \   0000001C   ........           BL       GUI_ARRAY_GetpItemLocked
   \   00000020   0080A0E1           MOV      R8,R0
    756            Sel   = pObj->Sel;
   \   00000024   786097E5           LDR      R6,[R7, #+120]
    757            Flags = pObj->Flags;
   \   00000028   BC96D7E1           LDRH     R9,[R7, #+108]
    758            GUI_UNLOCK_H(pObj);
   \   0000002C   ........           BL       GUI_ALLOC_UnlockH
    759            Item_hSubmenu = pItem->hSubmenu;
   \   00000030   00A098E5           LDR      R10,[R8, #+0]
    760            Item_Flags    = pItem->Flags;
   \   00000034   B680D8E1           LDRH     R8,[R8, #+6]
    761            GUI_UNLOCK_H(pItem);
   \   00000038   ........           BL       GUI_ALLOC_UnlockH
    762            if (Item_hSubmenu) {
   \   0000003C   00005AE3           CMP      R10,#+0
   \   00000040   1D00000A           BEQ      ??_ActivateMenu_0
    763              if ((Item_Flags & MENU_IF_DISABLED) == 0) {
   \   00000044   010018E3           TST      R8,#0x1
   \   00000048   1B00001A           BNE      ??_ActivateMenu_0
    764                if ((Flags & MENU_SF_ACTIVE) == 0) {
   \   0000004C   400019E3           TST      R9,#0x40
   \   00000050   0D00001A           BNE      ??_ActivateMenu_1
    765                  pObj = MENU_LOCK_H(hObj);
   \   00000054   0400A0E1           MOV      R0,R4
   \   00000058   ........           BL       GUI_ALLOC_LockH
    766                  pObj->Flags |= MENU_SF_ACTIVE;
   \   0000005C   BC16D0E1           LDRH     R1,[R0, #+108]
   \   00000060   401081E3           ORR      R1,R1,#0x40
   \   00000064   BC16C0E1           STRH     R1,[R0, #+108]
    767                  GUI_UNLOCK_H(pObj);
   \   00000068   ........           BL       GUI_ALLOC_UnlockH
    768                  _OpenSubmenu(hObj, Index);
   \   0000006C   0510A0E1           MOV      R1,R5
   \   00000070   0400A0E1           MOV      R0,R4
   \   00000074   ........           BL       _OpenSubmenu
    769                  _SetSelection(hObj, Index);
   \   00000078   0510A0E1           MOV      R1,R5
   \   0000007C   0400A0E1           MOV      R0,R4
   \   00000080   F047BDE8           POP      {R4-R10,LR}
   \   00000084   0020A0E3           MOV      R2,#+0
   \   00000088   ........           B        _SetSelectionEx  ;; tailcall
    770                } else if (Flags & MENU_SF_CLOSE_ON_SECOND_CLICK) {
   \                     ??_ActivateMenu_1:
   \   0000008C   040019E3           TST      R9,#0x4
   \   00000090   0900000A           BEQ      ??_ActivateMenu_0
    771                  if ((int)Index == Sel) {
   \   00000094   060055E1           CMP      R5,R6
   \   00000098   0700001A           BNE      ??_ActivateMenu_0
    772                    _CloseSubmenu(hObj);
   \   0000009C   0400A0E1           MOV      R0,R4
   \   000000A0   ........           BL       _CloseSubmenu
    773                    pObj = MENU_LOCK_H(hObj);
   \   000000A4   0400A0E1           MOV      R0,R4
   \   000000A8   ........           BL       GUI_ALLOC_LockH
    774                    pObj->Flags &= ~MENU_SF_ACTIVE;
   \   000000AC   BC16D0E1           LDRH     R1,[R0, #+108]
   \   000000B0   4010C1E3           BIC      R1,R1,#0x40
   \   000000B4   BC16C0E1           STRH     R1,[R0, #+108]
    775                    GUI_UNLOCK_H(pObj);
   \   000000B8   ........           BL       GUI_ALLOC_UnlockH
    776                  }
    777                }
    778              }
    779            }
    780          }
   \                     ??_ActivateMenu_0:
   \   000000BC   F087BDE8           POP      {R4-R10,PC}      ;; return
    781          
    782          /*********************************************************************
    783          *
    784          *       _DeactivateMenu
    785          */
    786          static void _DeactivateMenu(MENU_Handle hObj) {
    787            MENU_Obj * pObj;
    788            _CloseSubmenu(hObj);
    789            pObj = MENU_LOCK_H(hObj);
    790            if ((pObj->Flags & MENU_SF_OPEN_ON_POINTEROVER) == 0) {
    791              pObj->Flags &= ~MENU_SF_ACTIVE;
    792            }
    793            GUI_UNLOCK_H(pObj);
    794          }
    795          
    796          /*******************************************************************
    797          *
    798          *       _ForwardMouseOverMsg
    799          */
    800          #if (GUI_SUPPORT_MOUSE)

   \                                 In section .text, align 4, keep-with-next
    801          static int _ForwardMouseOverMsg(MENU_Handle hObj, int x, int y) {
   \                     _ForwardMouseOverMsg:
   \   00000000   F0412DE9           PUSH     {R4-R8,LR}
   \   00000004   20D04DE2           SUB      SP,SP,#+32
   \   00000008   0060A0E1           MOV      R6,R0
   \   0000000C   0140A0E1           MOV      R4,R1
   \   00000010   0250A0E1           MOV      R5,R2
    802            MENU_Obj * pObj;
    803            char        IsSubmenuActive;
    804            U16         Flags;
    805            pObj = MENU_LOCK_H(hObj);
   \   00000014   ........           BL       GUI_ALLOC_LockH
    806            IsSubmenuActive = pObj->IsSubmenuActive;
   \   00000018   6E70D0E5           LDRB     R7,[R0, #+110]
    807            Flags           = pObj->Flags;
   \   0000001C   BC86D0E1           LDRH     R8,[R0, #+108]
    808            GUI_UNLOCK_H(pObj);
   \   00000020   ........           BL       GUI_ALLOC_UnlockH
    809            if ((IsSubmenuActive == 0) && !(Flags & MENU_SF_POPUP)) {
   \   00000024   000057E3           CMP      R7,#+0
   \   00000028   80001803           TSTEQ    R8,#0x80
   \   0000002C   4000001A           BNE      ??_ForwardMouseOverMsg_0
    810              if (_IsTopLevelMenu(hObj)) {
   \   00000030   0600A0E1           MOV      R0,R6
   \   00000034   ........           BL       GUI_ALLOC_LockH
   \   00000038   687090E5           LDR      R7,[R0, #+104]
   \   0000003C   ........           BL       GUI_ALLOC_UnlockH
   \   00000040   04008DE2           ADD      R0,SP,#+4
   \   00000044   0010A0E3           MOV      R1,#+0
   \   00000048   0020A0E3           MOV      R2,#+0
   \   0000004C   0030A0E3           MOV      R3,#+0
   \   00000050   00C0A0E3           MOV      R12,#+0
   \   00000054   0E10A0E8           STM      R0!,{R1-R3,R12}
   \   00000058   0510A0E3           MOV      R1,#+5
   \   0000005C   B010CDE1           STRH     R1,[SP, #+0]
   \   00000060   0080A0E3           MOV      R8,#+0
   \   00000064   2C10A0E3           MOV      R1,#+44
   \   00000068   B280CDE1           STRH     R8,[SP, #+2]
   \   0000006C   04108DE5           STR      R1,[SP, #+4]
   \   00000070   10D08DE5           STR      SP,[SP, #+16]
   \   00000074   0C608DE5           STR      R6,[SP, #+12]
   \   00000078   000057E3           CMP      R7,#+0
   \   0000007C   0200001A           BNE      ??_ForwardMouseOverMsg_1
   \   00000080   0600A0E1           MOV      R0,R6
   \   00000084   ........           BL       WM_GetParent
   \   00000088   0070A0E1           MOV      R7,R0
   \                     ??_ForwardMouseOverMsg_1:
   \   0000008C   000057E3           CMP      R7,#+0
   \   00000090   0500000A           BEQ      ??_ForwardMouseOverMsg_2
   \   00000094   04108DE2           ADD      R1,SP,#+4
   \   00000098   0700A0E1           MOV      R0,R7
   \   0000009C   ........           BL       WM__SendMessage
   \   000000A0   10009DE5           LDR      R0,[SP, #+16]
   \   000000A4   000050E3           CMP      R0,#+0
   \   000000A8   2100001A           BNE      ??_ForwardMouseOverMsg_0
    811                WM_HWIN hBelow;
    812                x += WM_GetWindowOrgX(hObj);
   \                     ??_ForwardMouseOverMsg_2:
   \   000000AC   0600A0E1           MOV      R0,R6
   \   000000B0   ........           BL       WM_GetWindowOrgX
   \   000000B4   044080E0           ADD      R4,R0,R4
    813                y += WM_GetWindowOrgY(hObj);
   \   000000B8   0600A0E1           MOV      R0,R6
   \   000000BC   ........           BL       WM_GetWindowOrgY
   \   000000C0   055080E0           ADD      R5,R0,R5
    814                hBelow = WM_Screen2hWin(x, y);
   \   000000C4   0510A0E1           MOV      R1,R5
   \   000000C8   0400A0E1           MOV      R0,R4
   \   000000CC   ........           BL       WM_Screen2hWin
   \   000000D0   0070B0E1           MOVS     R7,R0
    815                if (hBelow && (hBelow != hObj) && WM__IsInModalArea(hBelow)) {
   \   000000D4   06005711           CMPNE    R7,R6
   \   000000D8   1500000A           BEQ      ??_ForwardMouseOverMsg_0
   \   000000DC   ........           BL       WM__IsInModalArea
   \   000000E0   000050E3           CMP      R0,#+0
   \   000000E4   1300000A           BEQ      ??_ForwardMouseOverMsg_3
    816                  WM_MESSAGE Msg;
    817                  GUI_PID_STATE State;
    818                  x -= WM_GetWindowOrgX(hBelow);
   \   000000E8   0700A0E1           MOV      R0,R7
   \   000000EC   ........           BL       WM_GetWindowOrgX
   \   000000F0   0060A0E1           MOV      R6,R0
    819                  y -= WM_GetWindowOrgY(hBelow);
   \   000000F4   0700A0E1           MOV      R0,R7
   \   000000F8   ........           BL       WM_GetWindowOrgY
    820                  State.Pressed = 0;
    821                  State.x = x;
   \   000000FC   061044E0           SUB      R1,R4,R6
   \   00000100   14108DE5           STR      R1,[SP, #+20]
    822                  State.y = y;
    823                  Msg.Data.p = &State;
   \   00000104   14108DE2           ADD      R1,SP,#+20
   \   00000108   10108DE5           STR      R1,[SP, #+16]
   \   0000010C   000045E0           SUB      R0,R5,R0
    824                  Msg.MsgId = WM_MOUSEOVER;
   \   00000110   1010A0E3           MOV      R1,#+16
   \   00000114   18008DE5           STR      R0,[SP, #+24]
   \   00000118   04108DE5           STR      R1,[SP, #+4]
   \   0000011C   1C80CDE5           STRB     R8,[SP, #+28]
    825                  WM__SendMessage(hBelow, &Msg);
   \   00000120   04108DE2           ADD      R1,SP,#+4
   \   00000124   0700A0E1           MOV      R0,R7
   \   00000128   ........           BL       WM__SendMessage
    826                  return 1;
   \   0000012C   0100A0E3           MOV      R0,#+1
   \   00000130   000000EA           B        ??_ForwardMouseOverMsg_3
    827                }
    828              }
    829            }
    830            return 0;
   \                     ??_ForwardMouseOverMsg_0:
   \   00000134   0000A0E3           MOV      R0,#+0
   \                     ??_ForwardMouseOverMsg_3:
   \   00000138   20D08DE2           ADD      SP,SP,#+32       ;; stack cleaning
   \   0000013C   F081BDE8           POP      {R4-R8,PC}       ;; return
    831          }
    832          #endif
    833          
    834          /*********************************************************************
    835          *
    836          *       _XYInWidget
    837          *
    838          * Return values:
    839          *   1 = Given position is inside of widget
    840          *   0 = Given position is outside
    841          */
    842          static int _XYInWidget(MENU_Obj * pObj, int x, int y) {
    843            int XYInWidget;
    844            XYInWidget = 0;
    845            if ((x >= 0) && (y >= 0)) {
    846              GUI_RECT r;
    847              WM__GetClientRectWin(&pObj->Widget.Win, &r);
    848              if ((x <= r.x1) && (y <= r.y1)) {
    849                XYInWidget = 1;
    850              }
    851            }
    852            return XYInWidget;
    853          }
    854          
    855          /*********************************************************************
    856          *
    857          *       _HandlePID
    858          *
    859          * Return values:
    860          *   1 = We need to forward PID message to owner.
    861          *   0 = We do not need to inform owner.
    862          */

   \                                 In section .text, align 4, keep-with-next
    863          static char _HandlePID(MENU_Handle hObj, int x, int y, int Pressed) {
   \                     _HandlePID:
   \   00000000   F04F2DE9           PUSH     {R4-R11,LR}
   \   00000004   0050A0E1           MOV      R5,R0
    864            MENU_Obj * pObj;
    865            GUI_ARRAY   ItemArray;
    866            WM_HWIN     hOwner;
    867            U16 State;
    868            GUI_PID_STATE PrevState;
    869            int XYInWidget;
    870            WM_PID__GetPrevState(&PrevState, WM__TOUCHED_LAYER);
   \   00000008   ........           LDR      R0,??DataTable4
   \   0000000C   0160A0E1           MOV      R6,R1
   \   00000010   2CD04DE2           SUB      SP,SP,#+44
   \   00000014   001090E5           LDR      R1,[R0, #+0]
   \   00000018   0270A0E1           MOV      R7,R2
   \   0000001C   0390A0E1           MOV      R9,R3
   \   00000020   20008DE2           ADD      R0,SP,#+32
   \   00000024   ........           BL       WM_PID__GetPrevState
    871            /*
    872             * Check if coordinates are inside the widget.
    873             */
    874            pObj = MENU_LOCK_H(hObj);
   \   00000028   0500A0E1           MOV      R0,R5
   \   0000002C   ........           BL       GUI_ALLOC_LockH
    875            ItemArray  = pObj->ItemArray;
    876            hOwner     = pObj->hOwner;
    877            State      = pObj->Widget.State;
    878            XYInWidget = _XYInWidget(pObj, x, y);
   \   00000030   000056E3           CMP      R6,#+0
   \   00000034   64A090E5           LDR      R10,[R0, #+100]
   \   00000038   684090E5           LDR      R4,[R0, #+104]
   \   0000003C   B283D0E1           LDRH     R8,[R0, #+50]
   \   00000040   00B0A0E3           MOV      R11,#+0
   \   00000044   00005753           CMPPL    R7,#+0
   \   00000048   0600004A           BMI      ??_HandlePID_0
   \   0000004C   18108DE2           ADD      R1,SP,#+24
   \   00000050   ........           BL       WM__GetClientRectWin
   \   00000054   FC01DDE1           LDRSH    R0,[SP, #+28]
   \   00000058   060050E1           CMP      R0,R6
   \   0000005C   FE01DDA1           LDRSHGE  R0,[SP, #+30]
   \   00000060   070050A1           CMPGE    R0,R7
   \   00000064   01B0A0A3           MOVGE    R11,#+1
    879            GUI_UNLOCK_H(pObj);
   \                     ??_HandlePID_0:
   \   00000068   ........           BL       GUI_ALLOC_UnlockH
    880            if (XYInWidget) {
   \   0000006C   00005BE3           CMP      R11,#+0
   \   00000070   B400000A           BEQ      ??_HandlePID_1
    881              int ItemIndex;
    882              ItemIndex = _GetItemFromPos(hObj, x, y);
   \   00000074   0720A0E1           MOV      R2,R7
   \   00000078   0610A0E1           MOV      R1,R6
   \   0000007C   0500A0E1           MOV      R0,R5
   \   00000080   ........           BL       _GetItemFromPos
   \   00000084   00B0B0E1           MOVS     R11,R0
    883              /* 
    884               * Handle PID when coordinates are inside the widget.
    885               */
    886              if (ItemIndex >= 0) {
   \   00000088   9600004A           BMI      ??_HandlePID_2
    887                /* 
    888                 * Coordinates are inside the menu.
    889                 */
    890                if (Pressed > 0) {
   \   0000008C   010059E3           CMP      R9,#+1
   \   00000090   590000BA           BLT      ??_HandlePID_3
    891                  if ((PrevState.Pressed == 0) && (Pressed == 1)) {  /* Clicked */
   \   00000094   2800DDE5           LDRB     R0,[SP, #+40]
   \   00000098   000050E3           CMP      R0,#+0
   \   0000009C   01005903           CMPEQ    R9,#+1
   \   000000A0   3A00001A           BNE      ??_HandlePID_4
    892                    MENU_ITEM * pItem;
    893                    U16         Flags;
    894                    U16         Id;
    895                    _ActivateMenu(hObj, ItemIndex);
   \   000000A4   0B10A0E1           MOV      R1,R11
   \   000000A8   0500A0E1           MOV      R0,R5
   \   000000AC   ........           BL       _ActivateMenu
    896                    _SelectItem(hObj, ItemIndex);
   \   000000B0   0500A0E1           MOV      R0,R5
   \   000000B4   ........           BL       GUI_ALLOC_LockH
   \   000000B8   787090E5           LDR      R7,[R0, #+120]
   \   000000BC   ........           BL       GUI_ALLOC_UnlockH
   \   000000C0   0B0057E1           CMP      R7,R11
   \   000000C4   1300000A           BEQ      ??_HandlePID_5
   \   000000C8   0500A0E1           MOV      R0,R5
   \   000000CC   ........           BL       GUI_ALLOC_LockH
   \   000000D0   6E70D0E5           LDRB     R7,[R0, #+110]
   \   000000D4   ........           BL       GUI_ALLOC_UnlockH
   \   000000D8   000057E3           CMP      R7,#+0
   \   000000DC   0600001A           BNE      ??_HandlePID_6
   \   000000E0   0500A0E1           MOV      R0,R5
   \   000000E4   ........           BL       WM_HasCaptured
   \   000000E8   000050E3           CMP      R0,#+0
   \   000000EC   0200001A           BNE      ??_HandlePID_6
   \   000000F0   0010A0E3           MOV      R1,#+0
   \   000000F4   0500A0E1           MOV      R0,R5
   \   000000F8   ........           BL       WM_SetCapture
   \                     ??_HandlePID_6:
   \   000000FC   0B10A0E1           MOV      R1,R11
   \   00000100   0500A0E1           MOV      R0,R5
   \   00000104   ........           BL       _OpenSubmenu
   \   00000108   0020A0E3           MOV      R2,#+0
   \   0000010C   0B10A0E1           MOV      R1,R11
   \   00000110   0500A0E1           MOV      R0,R5
   \   00000114   ........           BL       _SetSelectionEx
    897                    pItem = (MENU_ITEM *)GUI_ARRAY_GetpItemLocked(ItemArray, ItemIndex);
   \                     ??_HandlePID_5:
   \   00000118   0B10A0E1           MOV      R1,R11
   \   0000011C   0A00A0E1           MOV      R0,R10
   \   00000120   ........           BL       GUI_ARRAY_GetpItemLocked
    898                    Flags = pItem->Flags;
   \   00000124   B670D0E1           LDRH     R7,[R0, #+6]
    899                    Id    = pItem->Id;
   \   00000128   B460D0E1           LDRH     R6,[R0, #+4]
    900                    GUI_UNLOCK_H(pItem);
   \   0000012C   ........           BL       GUI_ALLOC_UnlockH
    901                    if ((Flags & MENU_IF_SEPARATOR) == 0) {
   \   00000130   020017E3           TST      R7,#0x2
   \   00000134   8100001A           BNE      ??_HandlePID_7
    902                      MENU__SendMenuMessage(hObj, hOwner, MENU_ON_ITEMPRESSED, Id);
   \   00000138   0020A0E3           MOV      R2,#+0
   \   0000013C   08108DE2           ADD      R1,SP,#+8
   \   00000140   0230A0E1           MOV      R3,R2
   \   00000144   02C0A0E1           MOV      R12,R2
   \   00000148   02E0A0E1           MOV      LR,R2
   \   0000014C   0C50A1E8           STM      R1!,{R2,R3,R12,LR}
   \   00000150   0400B0E1           MOVS     R0,R4
   \   00000154   0720A0E3           MOV      R2,#+7
   \                     ??_HandlePID_8:
   \   00000158   B020CDE1           STRH     R2,[SP, #+0]
   \   0000015C   2C20A0E3           MOV      R2,#+44
   \   00000160   B260CDE1           STRH     R6,[SP, #+2]
   \   00000164   08208DE5           STR      R2,[SP, #+8]
   \   00000168   14D08DE5           STR      SP,[SP, #+20]
   \   0000016C   10508DE5           STR      R5,[SP, #+16]
   \   00000170   0100001A           BNE      ??_HandlePID_9
   \   00000174   0500A0E1           MOV      R0,R5
   \   00000178   ........           BL       WM_GetParent
   \                     ??_HandlePID_9:
   \   0000017C   000050E3           CMP      R0,#+0
   \   00000180   D300000A           BEQ      ??_HandlePID_10
   \   00000184   08108DE2           ADD      R1,SP,#+8
   \   00000188   ........           BL       WM__SendMessage
   \   0000018C   6B0000EA           B        ??_HandlePID_7
    903                    }
    904                  } else {
    905                    _SelectItem(hObj, ItemIndex);
   \                     ??_HandlePID_4:
   \   00000190   0500A0E1           MOV      R0,R5
   \   00000194   ........           BL       GUI_ALLOC_LockH
   \   00000198   784090E5           LDR      R4,[R0, #+120]
   \   0000019C   ........           BL       GUI_ALLOC_UnlockH
   \   000001A0   0B0054E1           CMP      R4,R11
   \   000001A4   6500000A           BEQ      ??_HandlePID_7
   \   000001A8   0500A0E1           MOV      R0,R5
   \   000001AC   ........           BL       GUI_ALLOC_LockH
   \   000001B0   6E40D0E5           LDRB     R4,[R0, #+110]
   \   000001B4   ........           BL       GUI_ALLOC_UnlockH
   \   000001B8   000054E3           CMP      R4,#+0
   \   000001BC   0600001A           BNE      ??_HandlePID_11
   \   000001C0   0500A0E1           MOV      R0,R5
   \   000001C4   ........           BL       WM_HasCaptured
   \   000001C8   000050E3           CMP      R0,#+0
   \   000001CC   0200001A           BNE      ??_HandlePID_11
   \   000001D0   0010A0E3           MOV      R1,#+0
   \   000001D4   0500A0E1           MOV      R0,R5
   \   000001D8   ........           BL       WM_SetCapture
   \                     ??_HandlePID_11:
   \   000001DC   0B10A0E1           MOV      R1,R11
   \   000001E0   0500A0E1           MOV      R0,R5
   \   000001E4   ........           BL       _OpenSubmenu
   \   000001E8   0020A0E3           MOV      R2,#+0
   \   000001EC   0B10A0E1           MOV      R1,R11
   \   000001F0   0500A0E1           MOV      R0,R5
   \   000001F4   ........           BL       _SetSelectionEx
   \   000001F8   500000EA           B        ??_HandlePID_7
    906                  }
    907                } else if ((Pressed == 0) && (PrevState.Pressed == 1)) {  /* Released */
   \                     ??_HandlePID_3:
   \   000001FC   000059E3           CMP      R9,#+0
   \   00000200   0600001A           BNE      ??_HandlePID_12
   \   00000204   2800DDE5           LDRB     R0,[SP, #+40]
   \   00000208   010050E3           CMP      R0,#+1
   \   0000020C   4B00001A           BNE      ??_HandlePID_7
    908                  _ActivateItem(hObj, ItemIndex);
   \   00000210   0B10A0E1           MOV      R1,R11
   \   00000214   0500A0E1           MOV      R0,R5
   \   00000218   ........           BL       _ActivateItem
   \   0000021C   470000EA           B        ??_HandlePID_7
    909                } else if (Pressed < 0) {  /* Mouse moved */
   \                     ??_HandlePID_12:
   \   00000220   4600005A           BPL      ??_HandlePID_7
    910                  #if (GUI_SUPPORT_MOUSE)
    911                    if (_ForwardMouseOverMsg(hObj, x, y) != 0) {
   \   00000224   0720A0E1           MOV      R2,R7
   \   00000228   0610A0E1           MOV      R1,R6
   \   0000022C   0500A0E1           MOV      R0,R5
   \   00000230   ........           BL       _ForwardMouseOverMsg
   \   00000234   000050E3           CMP      R0,#+0
   \   00000238   0500A0E1           MOV      R0,R5
   \   0000023C   3E00001A           BNE      ??_HandlePID_13
    912                      _DeselectItem(hObj);
    913                    } else
    914                  #endif
    915                  {
    916                    MENU_ITEM * pItem;
    917                    U16         Flags;
    918                    U16         Id;
    919                    _SelectItem(hObj, ItemIndex);
   \   00000240   ........           BL       GUI_ALLOC_LockH
   \   00000244   787090E5           LDR      R7,[R0, #+120]
   \   00000248   ........           BL       GUI_ALLOC_UnlockH
   \   0000024C   0B0057E1           CMP      R7,R11
   \   00000250   1300000A           BEQ      ??_HandlePID_14
   \   00000254   0500A0E1           MOV      R0,R5
   \   00000258   ........           BL       GUI_ALLOC_LockH
   \   0000025C   6E70D0E5           LDRB     R7,[R0, #+110]
   \   00000260   ........           BL       GUI_ALLOC_UnlockH
   \   00000264   000057E3           CMP      R7,#+0
   \   00000268   0600001A           BNE      ??_HandlePID_15
   \   0000026C   0500A0E1           MOV      R0,R5
   \   00000270   ........           BL       WM_HasCaptured
   \   00000274   000050E3           CMP      R0,#+0
   \   00000278   0200001A           BNE      ??_HandlePID_15
   \   0000027C   0010A0E3           MOV      R1,#+0
   \   00000280   0500A0E1           MOV      R0,R5
   \   00000284   ........           BL       WM_SetCapture
   \                     ??_HandlePID_15:
   \   00000288   0B10A0E1           MOV      R1,R11
   \   0000028C   0500A0E1           MOV      R0,R5
   \   00000290   ........           BL       _OpenSubmenu
   \   00000294   0020A0E3           MOV      R2,#+0
   \   00000298   0B10A0E1           MOV      R1,R11
   \   0000029C   0500A0E1           MOV      R0,R5
   \   000002A0   ........           BL       _SetSelectionEx
    920                    pItem = (MENU_ITEM *)GUI_ARRAY_GetpItemLocked(ItemArray, ItemIndex);
   \                     ??_HandlePID_14:
   \   000002A4   0B10A0E1           MOV      R1,R11
   \   000002A8   0A00A0E1           MOV      R0,R10
   \   000002AC   ........           BL       GUI_ARRAY_GetpItemLocked
    921                    Flags = pItem->Flags;
   \   000002B0   B670D0E1           LDRH     R7,[R0, #+6]
    922                    Id    = pItem->Id;
   \   000002B4   B460D0E1           LDRH     R6,[R0, #+4]
    923                    GUI_UNLOCK_H(pItem);
   \   000002B8   ........           BL       GUI_ALLOC_UnlockH
    924                    if ((Flags & MENU_IF_SEPARATOR) == 0) {
   \   000002BC   020017E3           TST      R7,#0x2
   \   000002C0   1E00001A           BNE      ??_HandlePID_7
    925                      MENU__SendMenuMessage(hObj, hOwner, MENU_ON_ITEMACTIVATE, Id);
   \   000002C4   0020A0E3           MOV      R2,#+0
   \   000002C8   08108DE2           ADD      R1,SP,#+8
   \   000002CC   0230A0E1           MOV      R3,R2
   \   000002D0   02C0A0E1           MOV      R12,R2
   \   000002D4   02E0A0E1           MOV      LR,R2
   \   000002D8   0C50A1E8           STM      R1!,{R2,R3,R12,LR}
   \   000002DC   0400B0E1           MOVS     R0,R4
   \   000002E0   0620A0E3           MOV      R2,#+6
   \   000002E4   9BFFFFEA           B        ??_HandlePID_8
    926                    }
    927                  }
    928                }
    929              } else {
    930                /* 
    931                 * Coordinates are outside the menu but inside the widget.
    932                 */
    933                if (Pressed > 0) {
   \                     ??_HandlePID_2:
   \   000002E8   010059E3           CMP      R9,#+1
   \   000002EC   0D0000BA           BLT      ??_HandlePID_16
    934                  if (PrevState.Pressed == 0) {  /* Clicked */
   \   000002F0   2800DDE5           LDRB     R0,[SP, #+40]
   \   000002F4   000050E3           CMP      R0,#+0
   \   000002F8   0E00001A           BNE      ??_HandlePID_17
    935                    /* 
    936                     * User has clicked outside the menu. Close the active submenu.
    937                     * The widget itself must be closed (if needed) by the owner.
    938                     */
    939                    _DeactivateMenu(hObj);
   \   000002FC   0500A0E1           MOV      R0,R5
   \   00000300   ........           BL       _CloseSubmenu
   \   00000304   0500A0E1           MOV      R0,R5
   \   00000308   ........           BL       GUI_ALLOC_LockH
   \   0000030C   6C10D0E5           LDRB     R1,[R0, #+108]
   \   00000310   020011E3           TST      R1,#0x2
   \   00000314   BC16D001           LDRHEQ   R1,[R0, #+108]
   \   00000318   4010C103           BICEQ    R1,R1,#0x40
   \   0000031C   BC16C001           STRHEQ   R1,[R0, #+108]
   \   00000320   ........           BL       GUI_ALLOC_UnlockH
    940                  }
    941                  _DeselectItem(hObj);
   \   00000324   030000EA           B        ??_HandlePID_17
    942                } else if (Pressed < 0) {  /* Moved out or mouse moved */
   \                     ??_HandlePID_16:
   \   00000328   000059E3           CMP      R9,#+0
   \   0000032C   0300005A           BPL      ??_HandlePID_7
    943                  if (!(State & WIDGET_STATE_FOCUS)) {
   \   00000330   010018E3           TST      R8,#0x1
   \   00000334   0100001A           BNE      ??_HandlePID_7
    944                    _DeselectItem(hObj);
   \                     ??_HandlePID_17:
   \   00000338   0500A0E1           MOV      R0,R5
   \                     ??_HandlePID_13:
   \   0000033C   ........           BL       _DeselectItem
    945                  }
    946                }
    947              }
    948              return 0;
   \                     ??_HandlePID_7:
   \   00000340   0000A0E3           MOV      R0,#+0
   \   00000344   620000EA           B        ??_HandlePID_10
    949            } else {
    950              /* 
    951               * Handle PID when coordinates are outside the widget.
    952               */
    953              if ((Pressed > 0) && (PrevState.Pressed == 0)) {
   \                     ??_HandlePID_1:
   \   00000348   010059E3           CMP      R9,#+1
   \   0000034C   570000BA           BLT      ??_HandlePID_18
   \   00000350   2800DDE5           LDRB     R0,[SP, #+40]
   \   00000354   000050E3           CMP      R0,#+0
   \   00000358   5400001A           BNE      ??_HandlePID_18
    954                /* 
    955                 * User has clicked outside the menu. Close the active submenu.
    956                 * The widget itself must be closed (if needed) by the owner.
    957                 */
    958                _DeselectItem(hObj);
   \   0000035C   0500A0E1           MOV      R0,R5
   \   00000360   ........           BL       _DeselectItem
    959                _DeactivateMenu(hObj);
   \   00000364   0500A0E1           MOV      R0,R5
   \   00000368   ........           BL       _CloseSubmenu
   \   0000036C   0500A0E1           MOV      R0,R5
   \   00000370   ........           BL       GUI_ALLOC_LockH
   \   00000374   6C10D0E5           LDRB     R1,[R0, #+108]
   \   00000378   020011E3           TST      R1,#0x2
   \   0000037C   BC16D001           LDRHEQ   R1,[R0, #+108]
   \   00000380   4010C103           BICEQ    R1,R1,#0x40
   \   00000384   BC16C001           STRHEQ   R1,[R0, #+108]
   \   00000388   ........           BL       GUI_ALLOC_UnlockH
    960                _ClosePopup(hObj);
   \   0000038C   0500A0E1           MOV      R0,R5
   \   00000390   ........           BL       GUI_ALLOC_LockH
   \   00000394   6C10D0E5           LDRB     R1,[R0, #+108]
   \   00000398   800011E3           TST      R1,#0x80
   \   0000039C   0700000A           BEQ      ??_HandlePID_19
   \   000003A0   BC16D0E1           LDRH     R1,[R0, #+108]
   \   000003A4   8010C1E3           BIC      R1,R1,#0x80
   \   000003A8   BC16C0E1           STRH     R1,[R0, #+108]
   \   000003AC   ........           BL       GUI_ALLOC_UnlockH
   \   000003B0   0500A0E1           MOV      R0,R5
   \   000003B4   ........           BL       WM_DetachWindow
   \   000003B8   ........           BL       WM_ReleaseCapture
   \   000003BC   000000EA           B        ??_HandlePID_20
   \                     ??_HandlePID_19:
   \   000003C0   ........           BL       GUI_ALLOC_UnlockH
    961                _SetSelection(hObj, -1);
   \                     ??_HandlePID_20:
   \   000003C4   0020A0E3           MOV      R2,#+0
   \   000003C8   0210E0E1           MVN      R1,R2
   \   000003CC   0500A0E1           MOV      R0,R5
   \   000003D0   ........           BL       _SetSelectionEx
    962                if (State & WIDGET_STATE_FOCUS) {
   \   000003D4   010018E3           TST      R8,#0x1
   \   000003D8   3600000A           BEQ      ??_HandlePID_21
    963                  MENU_Handle hObjTopLevel; 
    964                  _GetTopLevelMenu(hObj, &hObjTopLevel, 0);
   \   000003DC   0020A0E3           MOV      R2,#+0
   \   000003E0   04108DE2           ADD      R1,SP,#+4
   \   000003E4   0500A0E1           MOV      R0,R5
   \   000003E8   ........           BL       _GetTopLevelMenu
    965                  WM_SetFocus(hObjTopLevel);
   \   000003EC   04009DE5           LDR      R0,[SP, #+4]
   \   000003F0   ........           BL       WM_SetFocus
    966                  _SetSelection(hObjTopLevel, -1);
   \   000003F4   0020A0E3           MOV      R2,#+0
   \   000003F8   0210E0E1           MVN      R1,R2
   \   000003FC   04009DE5           LDR      R0,[SP, #+4]
   \   00000400   ........           BL       _SetSelectionEx
    967                  _ReleaseCapture(hObjTopLevel);
   \   00000404   04409DE5           LDR      R4,[SP, #+4]
   \   00000408   0400A0E1           MOV      R0,R4
   \   0000040C   ........           BL       WM_HasCaptured
   \   00000410   000050E3           CMP      R0,#+0
   \   00000414   2900000A           BEQ      ??_HandlePID_22
   \   00000418   0400A0E1           MOV      R0,R4
   \   0000041C   ........           BL       GUI_ALLOC_LockH
   \   00000420   BC86D0E1           LDRH     R8,[R0, #+108]
   \   00000424   ........           BL       GUI_ALLOC_UnlockH
   \   00000428   0400A0E1           MOV      R0,R4
   \   0000042C   ........           BL       GUI_ALLOC_LockH
   \   00000430   689090E5           LDR      R9,[R0, #+104]
   \   00000434   ........           BL       GUI_ALLOC_UnlockH
   \   00000438   08008DE2           ADD      R0,SP,#+8
   \   0000043C   0010A0E3           MOV      R1,#+0
   \   00000440   0020A0E3           MOV      R2,#+0
   \   00000444   0030A0E3           MOV      R3,#+0
   \   00000448   00C0A0E3           MOV      R12,#+0
   \   0000044C   0E10A0E8           STM      R0!,{R1-R3,R12}
   \   00000450   0510A0E3           MOV      R1,#+5
   \   00000454   B010CDE1           STRH     R1,[SP, #+0]
   \   00000458   2C10A0E3           MOV      R1,#+44
   \   0000045C   B220CDE1           STRH     R2,[SP, #+2]
   \   00000460   08108DE5           STR      R1,[SP, #+8]
   \   00000464   14D08DE5           STR      SP,[SP, #+20]
   \   00000468   10408DE5           STR      R4,[SP, #+16]
   \   0000046C   000059E3           CMP      R9,#+0
   \   00000470   0200001A           BNE      ??_HandlePID_23
   \   00000474   0400A0E1           MOV      R0,R4
   \   00000478   ........           BL       WM_GetParent
   \   0000047C   0090A0E1           MOV      R9,R0
   \                     ??_HandlePID_23:
   \   00000480   000059E3           CMP      R9,#+0
   \   00000484   0500000A           BEQ      ??_HandlePID_24
   \   00000488   08108DE2           ADD      R1,SP,#+8
   \   0000048C   0900A0E1           MOV      R0,R9
   \   00000490   ........           BL       WM__SendMessage
   \   00000494   14009DE5           LDR      R0,[SP, #+20]
   \   00000498   000050E3           CMP      R0,#+0
   \   0000049C   0700001A           BNE      ??_HandlePID_22
   \                     ??_HandlePID_24:
   \   000004A0   800018E3           TST      R8,#0x80
   \   000004A4   0500001A           BNE      ??_HandlePID_22
   \   000004A8   ........           BL       WM_ReleaseCapture
   \   000004AC   030000EA           B        ??_HandlePID_22
    968                }
    969              }
    970              if (!(State & WIDGET_STATE_FOCUS)) {
   \                     ??_HandlePID_18:
   \   000004B0   010018E3           TST      R8,#0x1
   \   000004B4   0100001A           BNE      ??_HandlePID_22
    971                _DeselectItem(hObj);
   \                     ??_HandlePID_21:
   \   000004B8   0500A0E1           MOV      R0,R5
   \   000004BC   ........           BL       _DeselectItem
    972              }
    973              #if (GUI_SUPPORT_MOUSE)
    974                _ForwardMouseOverMsg(hObj, x, y);
   \                     ??_HandlePID_22:
   \   000004C0   0720A0E1           MOV      R2,R7
   \   000004C4   0610A0E1           MOV      R1,R6
   \   000004C8   0500A0E1           MOV      R0,R5
   \   000004CC   ........           BL       _ForwardMouseOverMsg
    975              #endif
    976            }
    977            return 1;   /* Coordinates are not in widget, we need to forward PID message to owner */
   \   000004D0   0100A0E3           MOV      R0,#+1
   \                     ??_HandlePID_10:
   \   000004D4   2CD08DE2           ADD      SP,SP,#+44       ;; stack cleaning
   \   000004D8   F08FBDE8           POP      {R4-R11,PC}      ;; return
    978          }
    979          
    980          /*********************************************************************
    981          *
    982          *       _ForwardPIDMsgToOwner
    983          */

   \                                 In section .text, align 4, keep-with-next
    984          static int _ForwardPIDMsgToOwner(MENU_Handle hObj, WM_MESSAGE * pMsg) {
   \                     _ForwardPIDMsgToOwner:
   \   00000000   F0412DE9           PUSH     {R4-R8,LR}
   \   00000004   18D04DE2           SUB      SP,SP,#+24
   \   00000008   0060A0E1           MOV      R6,R0
   \   0000000C   0140A0E1           MOV      R4,R1
    985            MENU_Obj * pObj;
    986            if (_IsTopLevelMenu(hObj) == 0) {
   \   00000010   ........           BL       GUI_ALLOC_LockH
   \   00000014   685090E5           LDR      R5,[R0, #+104]
   \   00000018   ........           BL       GUI_ALLOC_UnlockH
   \   0000001C   04008DE2           ADD      R0,SP,#+4
   \   00000020   0010A0E3           MOV      R1,#+0
   \   00000024   0020A0E3           MOV      R2,#+0
   \   00000028   0030A0E3           MOV      R3,#+0
   \   0000002C   00C0A0E3           MOV      R12,#+0
   \   00000030   0E10A0E8           STM      R0!,{R1-R3,R12}
   \   00000034   0510A0E3           MOV      R1,#+5
   \   00000038   B010CDE1           STRH     R1,[SP, #+0]
   \   0000003C   2C10A0E3           MOV      R1,#+44
   \   00000040   B220CDE1           STRH     R2,[SP, #+2]
   \   00000044   04108DE5           STR      R1,[SP, #+4]
   \   00000048   10D08DE5           STR      SP,[SP, #+16]
   \   0000004C   0C608DE5           STR      R6,[SP, #+12]
   \   00000050   000055E3           CMP      R5,#+0
   \   00000054   0200001A           BNE      ??_ForwardPIDMsgToOwner_0
   \   00000058   0600A0E1           MOV      R0,R6
   \   0000005C   ........           BL       WM_GetParent
   \   00000060   0050A0E1           MOV      R5,R0
   \                     ??_ForwardPIDMsgToOwner_0:
   \   00000064   000055E3           CMP      R5,#+0
   \   00000068   2A00000A           BEQ      ??_ForwardPIDMsgToOwner_1
   \   0000006C   04108DE2           ADD      R1,SP,#+4
   \   00000070   0500A0E1           MOV      R0,R5
   \   00000074   ........           BL       WM__SendMessage
   \   00000078   10009DE5           LDR      R0,[SP, #+16]
   \   0000007C   000050E3           CMP      R0,#+0
   \   00000080   2400000A           BEQ      ??_ForwardPIDMsgToOwner_1
    987              WM_HWIN hOwner;
    988              pObj = MENU_LOCK_H(hObj);
   \   00000084   0600A0E1           MOV      R0,R6
   \   00000088   ........           BL       GUI_ALLOC_LockH
    989              hOwner = pObj->hOwner ? pObj->hOwner : WM_GetParent(hObj);
   \   0000008C   685090E5           LDR      R5,[R0, #+104]
   \   00000090   000055E3           CMP      R5,#+0
   \   00000094   0200001A           BNE      ??_ForwardPIDMsgToOwner_2
   \   00000098   0600A0E1           MOV      R0,R6
   \   0000009C   ........           BL       WM_GetParent
   \   000000A0   0050A0E1           MOV      R5,R0
    990              GUI_UNLOCK_H(pObj);
   \                     ??_ForwardPIDMsgToOwner_2:
   \   000000A4   ........           BL       GUI_ALLOC_UnlockH
    991              if (hOwner) {
   \   000000A8   000055E3           CMP      R5,#+0
   \   000000AC   1900000A           BEQ      ??_ForwardPIDMsgToOwner_1
    992                if (pMsg->Data.p) {
   \   000000B0   0C7094E5           LDR      R7,[R4, #+12]
   \   000000B4   000057E3           CMP      R7,#+0
   \   000000B8   1100000A           BEQ      ??_ForwardPIDMsgToOwner_3
    993                  GUI_PID_STATE * pState;
    994                  pState = (GUI_PID_STATE *)pMsg->Data.p;
    995                  pState->x += WM_GetWindowOrgX(hObj) - WM_GetWindowOrgX(hOwner);
   \   000000BC   0600A0E1           MOV      R0,R6
   \   000000C0   ........           BL       WM_GetWindowOrgX
   \   000000C4   0080A0E1           MOV      R8,R0
   \   000000C8   0500A0E1           MOV      R0,R5
   \   000000CC   ........           BL       WM_GetWindowOrgX
   \   000000D0   001097E5           LDR      R1,[R7, #+0]
   \   000000D4   011088E0           ADD      R1,R8,R1
   \   000000D8   000041E0           SUB      R0,R1,R0
   \   000000DC   000087E5           STR      R0,[R7, #+0]
    996                  pState->y += WM_GetWindowOrgY(hObj) - WM_GetWindowOrgY(hOwner);
   \   000000E0   0600A0E1           MOV      R0,R6
   \   000000E4   ........           BL       WM_GetWindowOrgY
   \   000000E8   0060A0E1           MOV      R6,R0
   \   000000EC   0500A0E1           MOV      R0,R5
   \   000000F0   ........           BL       WM_GetWindowOrgY
   \   000000F4   041097E5           LDR      R1,[R7, #+4]
   \   000000F8   011086E0           ADD      R1,R6,R1
   \   000000FC   000041E0           SUB      R0,R1,R0
   \   00000100   040087E5           STR      R0,[R7, #+4]
    997                }
    998                WM__SendMessage(hOwner, pMsg);
   \                     ??_ForwardPIDMsgToOwner_3:
   \   00000104   0410A0E1           MOV      R1,R4
   \   00000108   0500A0E1           MOV      R0,R5
   \   0000010C   ........           BL       WM__SendMessage
    999                return 0; /* Message has been forwarded */
   \   00000110   0000A0E3           MOV      R0,#+0
   \   00000114   000000EA           B        ??_ForwardPIDMsgToOwner_4
   1000              }
   1001            }
   1002            return 1; /* Message has not been forwarded */
   \                     ??_ForwardPIDMsgToOwner_1:
   \   00000118   0100A0E3           MOV      R0,#+1
   \                     ??_ForwardPIDMsgToOwner_4:
   \   0000011C   18D08DE2           ADD      SP,SP,#+24       ;; stack cleaning
   \   00000120   F081BDE8           POP      {R4-R8,PC}       ;; return
   1003          }
   1004          
   1005          /*********************************************************************
   1006          *
   1007          *       _ForwardPIDStateChange
   1008          */

   \                                 In section .text, align 4, keep-with-next
   1009          static void _ForwardPIDStateChange(MENU_Handle hObj, WM_MESSAGE * pMsg) {
   \                     _ForwardPIDStateChange:
   \   00000000   F0472DE9           PUSH     {R4-R10,LR}
   \   00000004   20D04DE2           SUB      SP,SP,#+32
   \   00000008   0040A0E1           MOV      R4,R0
   \   0000000C   0150A0E1           MOV      R5,R1
   1010            MENU_Obj * pObj;
   1011            WM_HWIN     hOwner;
   1012            WM_HWIN hWin;
   1013            WM_PID_STATE_CHANGED_INFO * pState;
   1014            int XYInWidget, x, y;
   1015            pObj = MENU_LOCK_H(hObj);
   \   00000010   ........           BL       GUI_ALLOC_LockH
   1016            hOwner     = pObj->hOwner;
   1017            pState     = (WM_PID_STATE_CHANGED_INFO *)pMsg->Data.p;
   \   00000014   0C6095E5           LDR      R6,[R5, #+12]
   \   00000018   689090E5           LDR      R9,[R0, #+104]
   1018            x          = pState->x;
   \   0000001C   007096E5           LDR      R7,[R6, #+0]
   1019            y          = pState->y;
   \   00000020   048096E5           LDR      R8,[R6, #+4]
   1020            XYInWidget = _XYInWidget(pObj, x, y);
   \   00000024   000057E3           CMP      R7,#+0
   \   00000028   00A0A0E3           MOV      R10,#+0
   \   0000002C   00005853           CMPPL    R8,#+0
   \   00000030   0600004A           BMI      ??_ForwardPIDStateChange_0
   \   00000034   04108DE2           ADD      R1,SP,#+4
   \   00000038   ........           BL       WM__GetClientRectWin
   \   0000003C   F800DDE1           LDRSH    R0,[SP, #+8]
   \   00000040   070050E1           CMP      R0,R7
   \   00000044   FA00DDA1           LDRSHGE  R0,[SP, #+10]
   \   00000048   080050A1           CMPGE    R0,R8
   \   0000004C   01A0A0A3           MOVGE    R10,#+1
   1021            GUI_UNLOCK_H(pObj);
   \                     ??_ForwardPIDStateChange_0:
   \   00000050   ........           BL       GUI_ALLOC_UnlockH
   1022            if ((XYInWidget) || (pState->State == 0)) {
   \   00000054   00005AE3           CMP      R10,#+0
   \   00000058   4100001A           BNE      ??_ForwardPIDStateChange_1
   \   0000005C   0800D6E5           LDRB     R0,[R6, #+8]
   \   00000060   000050E3           CMP      R0,#+0
   \   00000064   3E00000A           BEQ      ??_ForwardPIDStateChange_1
   1023              return;
   1024            }
   1025            x += WM_GetWindowOrgX(hObj);
   \   00000068   0400A0E1           MOV      R0,R4
   \   0000006C   ........           BL       WM_GetWindowOrgX
   \   00000070   077080E0           ADD      R7,R0,R7
   1026            y += WM_GetWindowOrgY(hObj);
   \   00000074   0400A0E1           MOV      R0,R4
   \   00000078   ........           BL       WM_GetWindowOrgY
   \   0000007C   088080E0           ADD      R8,R0,R8
   1027            if (_IsTopLevelMenu(hObj)) {
   \   00000080   0400A0E1           MOV      R0,R4
   \   00000084   ........           BL       GUI_ALLOC_LockH
   \   00000088   68A090E5           LDR      R10,[R0, #+104]
   \   0000008C   ........           BL       GUI_ALLOC_UnlockH
   \   00000090   0C008DE2           ADD      R0,SP,#+12
   \   00000094   0010A0E3           MOV      R1,#+0
   \   00000098   0020A0E3           MOV      R2,#+0
   \   0000009C   0030A0E3           MOV      R3,#+0
   \   000000A0   00C0A0E3           MOV      R12,#+0
   \   000000A4   0E10A0E8           STM      R0!,{R1-R3,R12}
   \   000000A8   0510A0E3           MOV      R1,#+5
   \   000000AC   B010CDE1           STRH     R1,[SP, #+0]
   \   000000B0   2C10A0E3           MOV      R1,#+44
   \   000000B4   B220CDE1           STRH     R2,[SP, #+2]
   \   000000B8   0C108DE5           STR      R1,[SP, #+12]
   \   000000BC   18D08DE5           STR      SP,[SP, #+24]
   \   000000C0   14408DE5           STR      R4,[SP, #+20]
   \   000000C4   00005AE3           CMP      R10,#+0
   \   000000C8   0200001A           BNE      ??_ForwardPIDStateChange_2
   \   000000CC   0400A0E1           MOV      R0,R4
   \   000000D0   ........           BL       WM_GetParent
   \   000000D4   00A0A0E1           MOV      R10,R0
   \                     ??_ForwardPIDStateChange_2:
   \   000000D8   00005AE3           CMP      R10,#+0
   \   000000DC   2200000A           BEQ      ??_ForwardPIDStateChange_3
   \   000000E0   0C108DE2           ADD      R1,SP,#+12
   \   000000E4   0A00A0E1           MOV      R0,R10
   \   000000E8   ........           BL       WM__SendMessage
   \   000000EC   18009DE5           LDR      R0,[SP, #+24]
   \   000000F0   000050E3           CMP      R0,#+0
   \   000000F4   1C00000A           BEQ      ??_ForwardPIDStateChange_3
   1028              hWin = WM_Screen2hWin(x, y);
   1029              WM_ReleaseCapture();
   1030            } else {
   1031              hWin = hOwner ? hOwner : WM_GetParent(hObj);
   \   000000F8   000059E3           CMP      R9,#+0
   \   000000FC   0200001A           BNE      ??_ForwardPIDStateChange_4
   \   00000100   0400A0E1           MOV      R0,R4
   \   00000104   ........           BL       WM_GetParent
   \   00000108   0090A0E1           MOV      R9,R0
   1032              x -= WM_GetWindowOrgX(hWin);
   \                     ??_ForwardPIDStateChange_4:
   \   0000010C   0900A0E1           MOV      R0,R9
   \   00000110   ........           BL       WM_GetWindowOrgX
   \   00000114   007047E0           SUB      R7,R7,R0
   1033              y -= WM_GetWindowOrgY(hWin);
   \   00000118   0900A0E1           MOV      R0,R9
   \   0000011C   ........           BL       WM_GetWindowOrgY
   \   00000120   008048E0           SUB      R8,R8,R0
   1034              if (WM_HasFocus(hObj)) {
   \   00000124   0400A0E1           MOV      R0,R4
   \   00000128   ........           BL       WM_HasFocus
   \   0000012C   000050E3           CMP      R0,#+0
   \   00000130   0100000A           BEQ      ??_ForwardPIDStateChange_5
   1035                WM_SetFocus(hWin);
   \   00000134   0900A0E1           MOV      R0,R9
   \   00000138   ........           BL       WM_SetFocus
   1036              }
   1037            }
   1038            if (hWin) {
   \                     ??_ForwardPIDStateChange_5:
   \   0000013C   000059E3           CMP      R9,#+0
   \   00000140   0700000A           BEQ      ??_ForwardPIDStateChange_1
   1039              pState->x = x;
   \   00000144   007086E5           STR      R7,[R6, #+0]
   1040              pState->y = y;
   \   00000148   048086E5           STR      R8,[R6, #+4]
   1041              pMsg->hWin = hWin;
   \   0000014C   049085E5           STR      R9,[R5, #+4]
   1042              WM__SendMessage(hWin, pMsg);
   \   00000150   0510A0E1           MOV      R1,R5
   \   00000154   0900A0E1           MOV      R0,R9
   \   00000158   ........           BL       WM__SendMessage
   1043              WM__SetLastTouched(hWin);
   \   0000015C   0900A0E1           MOV      R0,R9
   \   00000160   ........           BL       WM__SetLastTouched
   \                     ??_ForwardPIDStateChange_1:
   \   00000164   20D08DE2           ADD      SP,SP,#+32       ;; stack cleaning
   \   00000168   F087BDE8           POP      {R4-R10,PC}      ;; return
   1044            }
   \                     ??_ForwardPIDStateChange_3:
   \   0000016C   0810A0E1           MOV      R1,R8
   \   00000170   0700A0E1           MOV      R0,R7
   \   00000174   ........           BL       WM_Screen2hWin
   \   00000178   0090A0E1           MOV      R9,R0
   \   0000017C   ........           BL       WM_ReleaseCapture
   \   00000180   EDFFFFEA           B        ??_ForwardPIDStateChange_5
   1045          }
   1046          
   1047          /*********************************************************************
   1048          *
   1049          *       _ForwardPIDMsg
   1050          */

   \                                 In section .text, align 4, keep-with-next
   1051          static void _ForwardPIDMsg(MENU_Handle hObj, WM_MESSAGE * pMsg) {
   \                     _ForwardPIDMsg:
   \   00000000   F0432DE9           PUSH     {R4-R9,LR}
   \   00000004   0140A0E1           MOV      R4,R1
   1052            MENU_Obj * pObj;
   1053            WM_HWIN hWin;
   1054            GUI_PID_STATE * pState;
   1055            int XYInWidget, x, y;
   1056            pState = (GUI_PID_STATE *)pMsg->Data.p;
   \   00000008   0C5094E5           LDR      R5,[R4, #+12]
   \   0000000C   0CD04DE2           SUB      SP,SP,#+12
   \   00000010   0080A0E1           MOV      R8,R0
   1057            if (pState == NULL) {
   \   00000014   000055E3           CMP      R5,#+0
   \   00000018   2A00000A           BEQ      ??_ForwardPIDMsg_0
   1058              return;
   1059            }
   1060            x = pState->x;
   \   0000001C   006095E5           LDR      R6,[R5, #+0]
   1061            y = pState->y;
   \   00000020   047095E5           LDR      R7,[R5, #+4]
   1062            pObj = MENU_LOCK_H(hObj);
   1063            XYInWidget = _XYInWidget(pObj, x, y);
   \   00000024   ........           BL       GUI_ALLOC_LockH
   \   00000028   000056E3           CMP      R6,#+0
   \   0000002C   0090A0E3           MOV      R9,#+0
   \   00000030   00005753           CMPPL    R7,#+0
   \   00000034   0600004A           BMI      ??_ForwardPIDMsg_1
   \   00000038   0D10A0E1           MOV      R1,SP
   \   0000003C   ........           BL       WM__GetClientRectWin
   \   00000040   F400DDE1           LDRSH    R0,[SP, #+4]
   \   00000044   060050E1           CMP      R0,R6
   \   00000048   F600DDA1           LDRSHGE  R0,[SP, #+6]
   \   0000004C   070050A1           CMPGE    R0,R7
   \   00000050   0190A0A3           MOVGE    R9,#+1
   1064            GUI_UNLOCK_H(pObj);
   \                     ??_ForwardPIDMsg_1:
   \   00000054   ........           BL       GUI_ALLOC_UnlockH
   1065            if (XYInWidget) {
   \   00000058   000059E3           CMP      R9,#+0
   \   0000005C   1900001A           BNE      ??_ForwardPIDMsg_0
   1066              return;
   1067            }
   1068            x += WM_GetWindowOrgX(hObj);
   \   00000060   0800A0E1           MOV      R0,R8
   \   00000064   ........           BL       WM_GetWindowOrgX
   \   00000068   066080E0           ADD      R6,R0,R6
   1069            y += WM_GetWindowOrgY(hObj);
   \   0000006C   0800A0E1           MOV      R0,R8
   \   00000070   ........           BL       WM_GetWindowOrgY
   \   00000074   077080E0           ADD      R7,R0,R7
   1070            hWin = WM_Screen2hWin(x, y);
   \   00000078   0710A0E1           MOV      R1,R7
   \   0000007C   0600A0E1           MOV      R0,R6
   \   00000080   ........           BL       WM_Screen2hWin
   \   00000084   0080B0E1           MOVS     R8,R0
   1071            if (hWin) {
   \   00000088   0E00000A           BEQ      ??_ForwardPIDMsg_0
   1072              x -= WM_GetWindowOrgX(hWin);
   \   0000008C   ........           BL       WM_GetWindowOrgX
   \   00000090   0090A0E1           MOV      R9,R0
   1073              y -= WM_GetWindowOrgY(hWin);
   \   00000094   0800A0E1           MOV      R0,R8
   \   00000098   ........           BL       WM_GetWindowOrgY
   1074              pState->x = x;
   \   0000009C   091046E0           SUB      R1,R6,R9
   \   000000A0   001085E5           STR      R1,[R5, #+0]
   1075              pState->y = y;
   \   000000A4   000047E0           SUB      R0,R7,R0
   \   000000A8   040085E5           STR      R0,[R5, #+4]
   1076              pMsg->hWin = hWin;
   \   000000AC   048084E5           STR      R8,[R4, #+4]
   1077              WM_ReleaseCapture();
   \   000000B0   ........           BL       WM_ReleaseCapture
   1078              WM__SendMessage(hWin, pMsg);
   \   000000B4   0410A0E1           MOV      R1,R4
   \   000000B8   0800A0E1           MOV      R0,R8
   \   000000BC   ........           BL       WM__SendMessage
   1079              WM__SetLastTouched(hWin);
   \   000000C0   0800A0E1           MOV      R0,R8
   \   000000C4   ........           BL       WM__SetLastTouched
   \                     ??_ForwardPIDMsg_0:
   \   000000C8   0CD08DE2           ADD      SP,SP,#+12       ;; stack cleaning
   \   000000CC   F083BDE8           POP      {R4-R9,PC}       ;; return
   1080            }
   1081          }
   1082          
   1083          /*********************************************************************
   1084          *
   1085          *       Static routines
   1086          *
   1087          **********************************************************************
   1088          */
   1089          /*********************************************************************
   1090          *
   1091          *       _OnMenu
   1092          */

   \                                 In section .text, align 4, keep-with-next
   1093          static void _OnMenu(MENU_Handle hObj, WM_MESSAGE * pMsg) {
   \                     _OnMenu:
   \   00000000   F0412DE9           PUSH     {R4-R8,LR}
   \   00000004   0160A0E1           MOV      R6,R1
   \   00000008   0040A0E1           MOV      R4,R0
   1094            MENU_Obj * pObj;
   1095            WM_HWIN     hOwner;
   1096            const MENU_MSG_DATA * pData;
   1097            pData = (const MENU_MSG_DATA *)pMsg->Data.p;
   \   0000000C   0C8096E5           LDR      R8,[R6, #+12]
   1098            pObj = MENU_LOCK_H(hObj);
   1099            hOwner = pObj->hOwner;
   \   00000010   ........           BL       GUI_ALLOC_LockH
   \   00000014   687090E5           LDR      R7,[R0, #+104]
   1100            GUI_UNLOCK_H(pObj);
   \   00000018   ........           BL       GUI_ALLOC_UnlockH
   \   0000001C   0050A0E3           MOV      R5,#+0
   1101            if (pData) {
   \   00000020   000058E3           CMP      R8,#+0
   \   00000024   6300000A           BEQ      ??_OnMenu_1
   1102              switch (pData->MsgType) {
   \   00000028   B000D8E1           LDRH     R0,[R8, #+0]
   \   0000002C   070050E3           CMP      R0,#+7
   \   00000030   00F18F90           ADDLS    PC,PC,R0, LSL #+2
   \                     ??_OnMenu_0:
   \   00000034   5F00008A           BHI      ??_OnMenu_1
   \   00000038   060000EA           B        ??_OnMenu_2
   \   0000003C   1F0000EA           B        ??_OnMenu_3
   \   00000040   1E0000EA           B        ??_OnMenu_3
   \   00000044   290000EA           B        ??_OnMenu_4
   \   00000048   550000EA           B        ??_OnMenu_5
   \   0000004C   570000EA           B        ??_OnMenu_6
   \   00000050   1A0000EA           B        ??_OnMenu_3
   \   00000054   190000EA           B        ??_OnMenu_3
   1103              case MENU_ON_ITEMSELECT:
   1104                _DeactivateMenu(hObj);
   \                     ??_OnMenu_2:
   \   00000058   0400A0E1           MOV      R0,R4
   \   0000005C   ........           BL       _CloseSubmenu
   \   00000060   0400A0E1           MOV      R0,R4
   \   00000064   ........           BL       GUI_ALLOC_LockH
   \   00000068   6C10D0E5           LDRB     R1,[R0, #+108]
   \   0000006C   020011E3           TST      R1,#0x2
   \   00000070   BC16D001           LDRHEQ   R1,[R0, #+108]
   \   00000074   4010C103           BICEQ    R1,R1,#0x40
   \   00000078   BC16C001           STRHEQ   R1,[R0, #+108]
   \   0000007C   ........           BL       GUI_ALLOC_UnlockH
   1105                _DeselectItem(hObj);
   \   00000080   0400A0E1           MOV      R0,R4
   \   00000084   ........           BL       _DeselectItem
   1106                _ClosePopup(hObj);
   \   00000088   0400A0E1           MOV      R0,R4
   \   0000008C   ........           BL       GUI_ALLOC_LockH
   \   00000090   6C10D0E5           LDRB     R1,[R0, #+108]
   \   00000094   800011E3           TST      R1,#0x80
   \   00000098   0700000A           BEQ      ??_OnMenu_7
   \   0000009C   BC16D0E1           LDRH     R1,[R0, #+108]
   \   000000A0   8010C1E3           BIC      R1,R1,#0x80
   \   000000A4   BC16C0E1           STRH     R1,[R0, #+108]
   \   000000A8   ........           BL       GUI_ALLOC_UnlockH
   \   000000AC   0400A0E1           MOV      R0,R4
   \   000000B0   ........           BL       WM_DetachWindow
   \   000000B4   ........           BL       WM_ReleaseCapture
   \   000000B8   000000EA           B        ??_OnMenu_3
   \                     ??_OnMenu_7:
   \   000000BC   ........           BL       GUI_ALLOC_UnlockH
   1107                /* No break here. We need to forward message to owner. */
   1108              case MENU_ON_INITMENU:
   1109              case MENU_ON_INITSUBMENU:
   1110              case MENU_ON_ITEMACTIVATE:
   1111              case MENU_ON_ITEMPRESSED:
   1112                /* Forward message to owner. */
   1113                if (hOwner == 0) {
   \                     ??_OnMenu_3:
   \   000000C0   000057E3           CMP      R7,#+0
   \   000000C4   0200001A           BNE      ??_OnMenu_8
   1114                  hOwner = WM_GetParent(hObj);
   \   000000C8   0400A0E1           MOV      R0,R4
   \   000000CC   ........           BL       WM_GetParent
   \   000000D0   0070A0E1           MOV      R7,R0
   1115                }
   1116                if (hOwner) {
   \                     ??_OnMenu_8:
   \   000000D4   000057E3           CMP      R7,#+0
   \   000000D8   3600000A           BEQ      ??_OnMenu_1
   1117                  pMsg->hWinSrc = hObj;
   \   000000DC   084086E5           STR      R4,[R6, #+8]
   1118                  WM__SendMessage(hOwner, pMsg);
   \   000000E0   0610A0E1           MOV      R1,R6
   \   000000E4   0700A0E1           MOV      R0,R7
   \   000000E8   F041BDE8           POP      {R4-R8,LR}
   \   000000EC   ........           B        WM__SendMessage  ;; tailcall
   1119                }
   1120                break;
   1121              case MENU_ON_OPEN:
   1122                pObj = MENU_LOCK_H(hObj);
   \                     ??_OnMenu_4:
   \   000000F0   0400A0E1           MOV      R0,R4
   \   000000F4   ........           BL       GUI_ALLOC_LockH
   1123                pObj->Sel = -1;
   \   000000F8   0510E0E1           MVN      R1,R5
   \   000000FC   781080E5           STR      R1,[R0, #+120]
   1124                pObj->IsSubmenuActive = 0;
   \   00000100   6E50C0E5           STRB     R5,[R0, #+110]
   1125                pObj->Flags |= MENU_SF_ACTIVE | MENU_SF_OPEN_ON_POINTEROVER;
   \   00000104   BC16D0E1           LDRH     R1,[R0, #+108]
   \   00000108   421081E3           ORR      R1,R1,#0x42
   \   0000010C   BC16C0E1           STRH     R1,[R0, #+108]
   1126                GUI_UNLOCK_H(pObj);
   \   00000110   ........           BL       GUI_ALLOC_UnlockH
   1127                _SetCapture(hObj);
   \   00000114   0400A0E1           MOV      R0,R4
   \   00000118   ........           BL       GUI_ALLOC_LockH
   \   0000011C   6E60D0E5           LDRB     R6,[R0, #+110]
   \   00000120   ........           BL       GUI_ALLOC_UnlockH
   \   00000124   000056E3           CMP      R6,#+0
   \   00000128   0600001A           BNE      ??_OnMenu_9
   \   0000012C   0400A0E1           MOV      R0,R4
   \   00000130   ........           BL       WM_HasCaptured
   \   00000134   000050E3           CMP      R0,#+0
   \   00000138   0200001A           BNE      ??_OnMenu_9
   \   0000013C   0010A0E3           MOV      R1,#+0
   \   00000140   0400A0E1           MOV      R0,R4
   \   00000144   ........           BL       WM_SetCapture
   1128                MENU__ResizeMenu(hObj);
   \                     ??_OnMenu_9:
   \   00000148   0400A0E1           MOV      R0,R4
   \   0000014C   ........           BL       GUI_ALLOC_LockH
   \   00000150   0050A0E1           MOV      R5,R0
   \   00000154   706095E5           LDR      R6,[R5, #+112]
   \   00000158   000056E3           CMP      R6,#+0
   \   0000015C   0200001A           BNE      ??_OnMenu_10
   \   00000160   0400A0E1           MOV      R0,R4
   \   00000164   ........           BL       _CalcMenuSizeX
   \   00000168   0060A0E1           MOV      R6,R0
   \                     ??_OnMenu_10:
   \   0000016C   745095E5           LDR      R5,[R5, #+116]
   \   00000170   000055E3           CMP      R5,#+0
   \   00000174   0200001A           BNE      ??_OnMenu_11
   \   00000178   0400A0E1           MOV      R0,R4
   \   0000017C   ........           BL       _CalcMenuSizeY
   \   00000180   0050A0E1           MOV      R5,R0
   \                     ??_OnMenu_11:
   \   00000184   ........           BL       GUI_ALLOC_UnlockH
   \   00000188   0520A0E1           MOV      R2,R5
   \   0000018C   0610A0E1           MOV      R1,R6
   \   00000190   0400A0E1           MOV      R0,R4
   \   00000194   ........           BL       WM_SetSize
   \   00000198   0400A0E1           MOV      R0,R4
   \   0000019C   F041BDE8           POP      {R4-R8,LR}
   \   000001A0   ........           B        WM_InvalidateWindow  ;; tailcall
   1129                break;
   1130              case MENU_ON_CLOSE:
   1131                _CloseSubmenu(hObj);
   \                     ??_OnMenu_5:
   \   000001A4   0400A0E1           MOV      R0,R4
   \   000001A8   F041BDE8           POP      {R4-R8,LR}
   \   000001AC   ........           B        _CloseSubmenu    ;; tailcall
   1132                break;
   1133              case MENU_IS_MENU:
   1134                pMsg->Data.v = 1;
   \                     ??_OnMenu_6:
   \   000001B0   0100A0E3           MOV      R0,#+1
   \   000001B4   0C0086E5           STR      R0,[R6, #+12]
   1135                break;
   1136              }
   1137            }
   1138          }
   \                     ??_OnMenu_1:
   \   000001B8   F081BDE8           POP      {R4-R8,PC}       ;; return
   1139          
   1140          /*********************************************************************
   1141          *
   1142          *       _OnTouch
   1143          */
   1144          static char _OnTouch(MENU_Handle hObj, WM_MESSAGE * pMsg) {
   1145            const GUI_PID_STATE * pState = (const GUI_PID_STATE *)pMsg->Data.p;
   1146            if (pState) {  /* Something happened in our area (pressed or released) */
   1147              return _HandlePID(hObj, pState->x, pState->y, pState->Pressed);
   1148            }
   1149            return _HandlePID(hObj, -1, -1, -1); /* Moved out */
   1150          }
   1151          
   1152          /*********************************************************************
   1153          *
   1154          *       _OnMouseOver
   1155          */
   1156          #if (GUI_SUPPORT_MOUSE)
   1157          static char _OnMouseOver(MENU_Handle hObj, WM_MESSAGE * pMsg) {
   1158            const GUI_PID_STATE * pState = (const GUI_PID_STATE *)pMsg->Data.p;
   1159            if (pState) {
   1160              return _HandlePID(hObj, pState->x, pState->y, -1);
   1161            }
   1162            return 0;
   1163          }
   1164          #endif
   1165          
   1166          /*********************************************************************
   1167          *
   1168          *       _SetPaintColors
   1169          */
   1170          static void _SetPaintColors(const MENU_Obj * pObj, const MENU_ITEM * pItem, int ItemIndex) {
   1171            char Selected;
   1172            unsigned ColorIndex;
   1173            Selected = (ItemIndex == pObj->Sel) ? 1 : 0;
   1174            if (pObj->IsSubmenuActive && Selected) {
   1175              ColorIndex = MENU_CI_ACTIVE_SUBMENU;
   1176            } else if (pItem->Flags & MENU_IF_SEPARATOR) {
   1177              ColorIndex = MENU_CI_ENABLED;
   1178            } else {
   1179              ColorIndex = (Selected) ? MENU_CI_SELECTED : MENU_CI_ENABLED;
   1180              if (pItem->Flags & MENU_IF_DISABLED) {
   1181                if (pObj->Flags & MENU_CF_HIDE_DISABLED_SEL) {
   1182                  ColorIndex = MENU_CI_DISABLED;
   1183                } else {
   1184                  ColorIndex += MENU_CI_DISABLED;
   1185                }
   1186              }
   1187            }
   1188            GUI_SetBkColor(pObj->Props.aBkColor[ColorIndex]);
   1189            GUI_SetColor(pObj->Props.aTextColor[ColorIndex]);
   1190          }
   1191          
   1192          /*********************************************************************
   1193          *
   1194          *       _OnPaint
   1195          */

   \                                 In section .text, align 4, keep-with-next
   1196          static void _OnPaint(MENU_Handle hObj) {
   \                     _OnPaint:
   \   00000000   F04F2DE9           PUSH     {R4-R11,LR}
   \   00000004   3CD04DE2           SUB      SP,SP,#+60
   \   00000008   0040A0E1           MOV      R4,R0
   1197            MENU_Obj * pObj;
   1198            GUI_RECT FillRect, TextRect;
   1199            MENU_ITEM * pItem;
   1200            unsigned TextWidth, NumItems, i;
   1201            U8 BorderLeft;
   1202            U8 BorderTop;
   1203            int FontHeight;
   1204            int EffectSize;
   1205          
   1206            pObj = MENU_LOCK_H(hObj);
   \   0000000C   ........           BL       GUI_ALLOC_LockH
   \   00000010   0050A0E1           MOV      R5,R0
   1207            BorderLeft   = pObj->Props.aBorder[MENU_BI_LEFT];
   \   00000014   5C10D5E5           LDRB     R1,[R5, #+92]
   \   00000018   1C108DE5           STR      R1,[SP, #+28]
   1208            BorderTop    = pObj->Props.aBorder[MENU_BI_TOP];
   \   0000001C   5E10D5E5           LDRB     R1,[R5, #+94]
   \   00000020   18108DE5           STR      R1,[SP, #+24]
   1209            FontHeight  = GUI_GetYDistOfFont(pObj->Props.pFont);
   \   00000024   600095E5           LDR      R0,[R5, #+96]
   \   00000028   ........           BL       GUI_GetYDistOfFont
   \   0000002C   38008DE5           STR      R0,[SP, #+56]
   1210            EffectSize  = _GetEffectSize(hObj);
   \   00000030   0400A0E1           MOV      R0,R4
   \   00000034   ........           BL       GUI_ALLOC_LockH
   \   00000038   0070A0E1           MOV      R7,R0
   \   0000003C   6C00D7E5           LDRB     R0,[R7, #+108]
   \   00000040   0060A0E3           MOV      R6,#+0
   \   00000044   800010E3           TST      R0,#0x80
   \   00000048   1E00001A           BNE      ??_OnPaint_0
   \   0000004C   0400A0E1           MOV      R0,R4
   \   00000050   ........           BL       GUI_ALLOC_LockH
   \   00000054   688090E5           LDR      R8,[R0, #+104]
   \   00000058   ........           BL       GUI_ALLOC_UnlockH
   \   0000005C   20008DE2           ADD      R0,SP,#+32
   \   00000060   0010A0E3           MOV      R1,#+0
   \   00000064   0020A0E3           MOV      R2,#+0
   \   00000068   0030A0E3           MOV      R3,#+0
   \   0000006C   00C0A0E3           MOV      R12,#+0
   \   00000070   0E10A0E8           STM      R0!,{R1-R3,R12}
   \   00000074   0510A0E3           MOV      R1,#+5
   \   00000078   B810CDE1           STRH     R1,[SP, #+8]
   \   0000007C   2C10A0E3           MOV      R1,#+44
   \   00000080   20108DE5           STR      R1,[SP, #+32]
   \   00000084   08108DE2           ADD      R1,SP,#+8
   \   00000088   BA20CDE1           STRH     R2,[SP, #+10]
   \   0000008C   2C108DE5           STR      R1,[SP, #+44]
   \   00000090   28408DE5           STR      R4,[SP, #+40]
   \   00000094   000058E3           CMP      R8,#+0
   \   00000098   0200001A           BNE      ??_OnPaint_1
   \   0000009C   0400A0E1           MOV      R0,R4
   \   000000A0   ........           BL       WM_GetParent
   \   000000A4   0080A0E1           MOV      R8,R0
   \                     ??_OnPaint_1:
   \   000000A8   000058E3           CMP      R8,#+0
   \   000000AC   0700000A           BEQ      ??_OnPaint_2
   \   000000B0   20108DE2           ADD      R1,SP,#+32
   \   000000B4   0800A0E1           MOV      R0,R8
   \   000000B8   ........           BL       WM__SendMessage
   \   000000BC   2C009DE5           LDR      R0,[SP, #+44]
   \   000000C0   000050E3           CMP      R0,#+0
   \   000000C4   0100000A           BEQ      ??_OnPaint_2
   \                     ??_OnPaint_0:
   \   000000C8   2C0097E5           LDR      R0,[R7, #+44]
   \   000000CC   006090E5           LDR      R6,[R0, #+0]
   \                     ??_OnPaint_2:
   \   000000D0   ........           BL       GUI_ALLOC_UnlockH
   1211            NumItems = MENU__GetNumItems(pObj);
   \   000000D4   640095E5           LDR      R0,[R5, #+100]
   \   000000D8   ........           BL       GUI_ARRAY_GetNumItems
   \   000000DC   14008DE5           STR      R0,[SP, #+20]
   1212            WM__GetClientRectWin(&pObj->Widget.Win, &FillRect);
   \   000000E0   0D10A0E1           MOV      R1,SP
   \   000000E4   0500A0E1           MOV      R0,R5
   \   000000E8   ........           BL       WM__GetClientRectWin
   1213            GUI__ReduceRect(&FillRect, &FillRect, EffectSize);
   \   000000EC   0620A0E1           MOV      R2,R6
   \   000000F0   0D10A0E1           MOV      R1,SP
   \   000000F4   0D00A0E1           MOV      R0,SP
   \   000000F8   ........           BL       GUI__ReduceRect
   1214            GUI_SetFont(pObj->Props.pFont);
   \   000000FC   600095E5           LDR      R0,[R5, #+96]
   \   00000100   ........           BL       GUI_SetFont
   1215            if (pObj->Flags & MENU_SF_VERTICAL) {
   \   00000104   6C00D5E5           LDRB     R0,[R5, #+108]
   \   00000108   0070A0E3           MOV      R7,#+0
   \   0000010C   010010E3           TST      R0,#0x1
   \   00000110   0400A0E1           MOV      R0,R4
   \   00000114   5F00000A           BEQ      ??_OnPaint_3
   1216              int ItemHeight, xSize;
   1217              xSize = _CalcMenuSizeX(hObj);
   1218              FillRect.x1 = xSize - EffectSize - 1;
   \   00000118   ........           BL       _CalcMenuSizeX
   \   0000011C   060040E0           SUB      R0,R0,R6
   \   00000120   010040E2           SUB      R0,R0,#+1
   \   00000124   B400CDE1           STRH     R0,[SP, #+4]
   1219              TextRect.x0 = FillRect.x0 + BorderLeft;
   \   00000128   F000DDE1           LDRSH    R0,[SP, #+0]
   \   0000012C   1C109DE5           LDR      R1,[SP, #+28]
   1220              for (i = 0; i < NumItems; i++) {
   \   00000130   0080A0E3           MOV      R8,#+0
   \   00000134   000081E0           ADD      R0,R1,R0
   \   00000138   BC00CDE1           STRH     R0,[SP, #+12]
   \   0000013C   14009DE5           LDR      R0,[SP, #+20]
   \   00000140   000050E3           CMP      R0,#+0
   \   00000144   B200000A           BEQ      ??_OnPaint_4
   \   00000148   ........           LDR      R9,??DataTable5  ;; 0x7c7c7c
   1221                pItem = (MENU_ITEM *)GUI_ARRAY_GetpItemLocked(pObj->ItemArray, i);
   \                     ??_OnPaint_5:
   \   0000014C   0810A0E1           MOV      R1,R8
   \   00000150   640095E5           LDR      R0,[R5, #+100]
   \   00000154   ........           BL       GUI_ARRAY_GetpItemLocked
   \   00000158   00B0A0E1           MOV      R11,R0
   1222                ItemHeight = _GetItemHeight(hObj, pObj, i);
   \   0000015C   0820A0E1           MOV      R2,R8
   \   00000160   0510A0E1           MOV      R1,R5
   \   00000164   0400A0E1           MOV      R0,R4
   \   00000168   ........           BL       _GetItemHeight
   \   0000016C   00A0A0E1           MOV      R10,R0
   1223                _SetPaintColors(pObj, pItem, i);
   \   00000170   780095E5           LDR      R0,[R5, #+120]
   \   00000174   6E10D5E5           LDRB     R1,[R5, #+110]
   \   00000178   000058E1           CMP      R8,R0
   \   0000017C   0000A013           MOVNE    R0,#+0
   \   00000180   0100A003           MOVEQ    R0,#+1
   \   00000184   000051E3           CMP      R1,#+0
   \   00000188   00005013           CMPNE    R0,#+0
   \   0000018C   0400A013           MOVNE    R0,#+4
   \   00000190   0900001A           BNE      ??_OnPaint_6
   \   00000194   B610DBE1           LDRH     R1,[R11, #+6]
   \   00000198   020011E3           TST      R1,#0x2
   \   0000019C   0000A013           MOVNE    R0,#+0
   \   000001A0   0500001A           BNE      ??_OnPaint_6
   \   000001A4   010011E3           TST      R1,#0x1
   \   000001A8   0300000A           BEQ      ??_OnPaint_6
   \   000001AC   6C10D5E5           LDRB     R1,[R5, #+108]
   \   000001B0   080011E3           TST      R1,#0x8
   \   000001B4   0200A013           MOVNE    R0,#+2
   \   000001B8   02008002           ADDEQ    R0,R0,#+2
   \                     ??_OnPaint_6:
   \   000001BC   000185E0           ADD      R0,R5,R0, LSL #+2
   \   000001C0   08008DE5           STR      R0,[SP, #+8]
   \   000001C4   480090E5           LDR      R0,[R0, #+72]
   \   000001C8   ........           BL       GUI_SetBkColor
   \   000001CC   08009DE5           LDR      R0,[SP, #+8]
   \   000001D0   340090E5           LDR      R0,[R0, #+52]
   \   000001D4   ........           BL       GUI_SetColor
   1224                FillRect.y1 = FillRect.y0 + ItemHeight - 1;
   \   000001D8   F210DDE1           LDRSH    R1,[SP, #+2]
   \   000001DC   0A0081E0           ADD      R0,R1,R10
   \   000001E0   010040E2           SUB      R0,R0,#+1
   \   000001E4   B600CDE1           STRH     R0,[SP, #+6]
   1225                if (pItem->Flags & MENU_IF_SEPARATOR) {
   \   000001E8   0600DBE5           LDRB     R0,[R11, #+6]
   \   000001EC   020010E3           TST      R0,#0x2
   \   000001F0   0D00000A           BEQ      ??_OnPaint_7
   1226                  GUI_ClearRectEx(&FillRect);
   \   000001F4   0D00A0E1           MOV      R0,SP
   \   000001F8   ........           BL       GUI_ClearRectEx
   1227                  GUI_SetColor(0x7C7C7C);
   \   000001FC   0900A0E1           MOV      R0,R9
   \   00000200   ........           BL       GUI_SetColor
   1228                  GUI_DrawHLine(FillRect.y0 + BorderTop + 1, FillRect.x0 + 2, FillRect.x1 - 2);
   \   00000204   F400DDE1           LDRSH    R0,[SP, #+4]
   \   00000208   F230DDE1           LDRSH    R3,[SP, #+2]
   \   0000020C   022040E2           SUB      R2,R0,#+2
   \   00000210   F000DDE1           LDRSH    R0,[SP, #+0]
   \   00000214   021080E2           ADD      R1,R0,#+2
   \   00000218   18009DE5           LDR      R0,[SP, #+24]
   \   0000021C   000083E0           ADD      R0,R3,R0
   \   00000220   010080E2           ADD      R0,R0,#+1
   \   00000224   ........           BL       GUI_DrawHLine
   \   00000228   110000EA           B        ??_OnPaint_8
   1229                } else {
   1230                  TextWidth = pItem->TextWidth;
   1231                  TextRect.x1 = TextRect.x0 + TextWidth - 1;
   \                     ??_OnPaint_7:
   \   0000022C   FC10DDE1           LDRSH    R1,[SP, #+12]
   \   00000230   08009BE5           LDR      R0,[R11, #+8]
   1232                  TextRect.y0 = FillRect.y0 + BorderTop;
   1233                  TextRect.y1 = TextRect.y0 + FontHeight - 1;
   1234                  WIDGET__FillStringInRect(pItem->acText, &FillRect, &TextRect, &TextRect);
   \   00000234   0C308DE2           ADD      R3,SP,#+12
   \   00000238   000081E0           ADD      R0,R1,R0
   \   0000023C   010040E2           SUB      R0,R0,#+1
   \   00000240   B001CDE1           STRH     R0,[SP, #+16]
   \   00000244   F200DDE1           LDRSH    R0,[SP, #+2]
   \   00000248   18109DE5           LDR      R1,[SP, #+24]
   \   0000024C   0C208DE2           ADD      R2,SP,#+12
   \   00000250   000081E0           ADD      R0,R1,R0
   \   00000254   38109DE5           LDR      R1,[SP, #+56]
   \   00000258   BE00CDE1           STRH     R0,[SP, #+14]
   \   0000025C   010080E0           ADD      R0,R0,R1
   \   00000260   010040E2           SUB      R0,R0,#+1
   \   00000264   B201CDE1           STRH     R0,[SP, #+18]
   \   00000268   0D10A0E1           MOV      R1,SP
   \   0000026C   0C008BE2           ADD      R0,R11,#+12
   \   00000270   ........           BL       WIDGET__FillStringInRect
   1235                }
   1236                FillRect.y0 += ItemHeight;
   \                     ??_OnPaint_8:
   \   00000274   F200DDE1           LDRSH    R0,[SP, #+2]
   \   00000278   00008AE0           ADD      R0,R10,R0
   \   0000027C   B200CDE1           STRH     R0,[SP, #+2]
   1237                GUI_UNLOCK_H(pItem);
   \   00000280   ........           BL       GUI_ALLOC_UnlockH
   1238              }
   \   00000284   14009DE5           LDR      R0,[SP, #+20]
   \   00000288   018088E2           ADD      R8,R8,#+1
   \   0000028C   000058E1           CMP      R8,R0
   \   00000290   ADFFFF3A           BCC      ??_OnPaint_5
   \   00000294   5E0000EA           B        ??_OnPaint_4
   1239            } else {
   1240              int ItemWidth, ySize;
   1241              ySize = _CalcMenuSizeY(hObj);
   1242              FillRect.y1 = ySize - EffectSize - 1;
   \                     ??_OnPaint_3:
   \   00000298   ........           BL       _CalcMenuSizeY
   \   0000029C   060040E0           SUB      R0,R0,R6
   \   000002A0   010040E2           SUB      R0,R0,#+1
   \   000002A4   B600CDE1           STRH     R0,[SP, #+6]
   1243              TextRect.y0 = FillRect.y0 + BorderTop;
   \   000002A8   F200DDE1           LDRSH    R0,[SP, #+2]
   \   000002AC   18109DE5           LDR      R1,[SP, #+24]
   1244              TextRect.y1 = TextRect.y0 + FontHeight - 1;
   1245              for (i = 0; i < NumItems; i++) {
   \   000002B0   0080A0E3           MOV      R8,#+0
   \   000002B4   000081E0           ADD      R0,R1,R0
   \   000002B8   38109DE5           LDR      R1,[SP, #+56]
   \   000002BC   BE00CDE1           STRH     R0,[SP, #+14]
   \   000002C0   000081E0           ADD      R0,R1,R0
   \   000002C4   010040E2           SUB      R0,R0,#+1
   \   000002C8   B201CDE1           STRH     R0,[SP, #+18]
   \   000002CC   14009DE5           LDR      R0,[SP, #+20]
   \   000002D0   000050E3           CMP      R0,#+0
   \   000002D4   4E00000A           BEQ      ??_OnPaint_4
   \   000002D8   ........           LDR      R9,??DataTable5  ;; 0x7c7c7c
   1246                pItem = (MENU_ITEM *)GUI_ARRAY_GetpItemLocked(pObj->ItemArray, i);
   \                     ??_OnPaint_9:
   \   000002DC   0810A0E1           MOV      R1,R8
   \   000002E0   640095E5           LDR      R0,[R5, #+100]
   \   000002E4   ........           BL       GUI_ARRAY_GetpItemLocked
   \   000002E8   00B0A0E1           MOV      R11,R0
   1247                ItemWidth = _GetItemWidth(hObj, pObj, i);
   \   000002EC   0820A0E1           MOV      R2,R8
   \   000002F0   0510A0E1           MOV      R1,R5
   \   000002F4   0400A0E1           MOV      R0,R4
   \   000002F8   ........           BL       _GetItemWidth
   \   000002FC   00A0A0E1           MOV      R10,R0
   1248                _SetPaintColors(pObj, pItem, i);
   \   00000300   780095E5           LDR      R0,[R5, #+120]
   \   00000304   6E10D5E5           LDRB     R1,[R5, #+110]
   \   00000308   000058E1           CMP      R8,R0
   \   0000030C   0000A013           MOVNE    R0,#+0
   \   00000310   0100A003           MOVEQ    R0,#+1
   \   00000314   000051E3           CMP      R1,#+0
   \   00000318   00005013           CMPNE    R0,#+0
   \   0000031C   0400A013           MOVNE    R0,#+4
   \   00000320   0900001A           BNE      ??_OnPaint_10
   \   00000324   B610DBE1           LDRH     R1,[R11, #+6]
   \   00000328   020011E3           TST      R1,#0x2
   \   0000032C   0000A013           MOVNE    R0,#+0
   \   00000330   0500001A           BNE      ??_OnPaint_10
   \   00000334   010011E3           TST      R1,#0x1
   \   00000338   0300000A           BEQ      ??_OnPaint_10
   \   0000033C   6C10D5E5           LDRB     R1,[R5, #+108]
   \   00000340   080011E3           TST      R1,#0x8
   \   00000344   0200A013           MOVNE    R0,#+2
   \   00000348   02008002           ADDEQ    R0,R0,#+2
   \                     ??_OnPaint_10:
   \   0000034C   000185E0           ADD      R0,R5,R0, LSL #+2
   \   00000350   08008DE5           STR      R0,[SP, #+8]
   \   00000354   480090E5           LDR      R0,[R0, #+72]
   \   00000358   ........           BL       GUI_SetBkColor
   \   0000035C   08009DE5           LDR      R0,[SP, #+8]
   \   00000360   340090E5           LDR      R0,[R0, #+52]
   \   00000364   ........           BL       GUI_SetColor
   1249                FillRect.x1 = FillRect.x0 + ItemWidth - 1;
   \   00000368   F010DDE1           LDRSH    R1,[SP, #+0]
   \   0000036C   0A0081E0           ADD      R0,R1,R10
   \   00000370   010040E2           SUB      R0,R0,#+1
   \   00000374   B400CDE1           STRH     R0,[SP, #+4]
   1250                if (pItem->Flags & MENU_IF_SEPARATOR) {
   \   00000378   0600DBE5           LDRB     R0,[R11, #+6]
   \   0000037C   020010E3           TST      R0,#0x2
   \   00000380   0D00000A           BEQ      ??_OnPaint_11
   1251                  GUI_ClearRectEx(&FillRect);
   \   00000384   0D00A0E1           MOV      R0,SP
   \   00000388   ........           BL       GUI_ClearRectEx
   1252                  GUI_SetColor(0x7C7C7C);
   \   0000038C   0900A0E1           MOV      R0,R9
   \   00000390   ........           BL       GUI_SetColor
   1253                  GUI_DrawVLine(FillRect.x0 + BorderLeft + 1, FillRect.y0 + 2, FillRect.y1 - 2);
   \   00000394   F600DDE1           LDRSH    R0,[SP, #+6]
   \   00000398   F030DDE1           LDRSH    R3,[SP, #+0]
   \   0000039C   022040E2           SUB      R2,R0,#+2
   \   000003A0   F200DDE1           LDRSH    R0,[SP, #+2]
   \   000003A4   021080E2           ADD      R1,R0,#+2
   \   000003A8   1C009DE5           LDR      R0,[SP, #+28]
   \   000003AC   000083E0           ADD      R0,R3,R0
   \   000003B0   010080E2           ADD      R0,R0,#+1
   \   000003B4   ........           BL       GUI_DrawVLine
   \   000003B8   0D0000EA           B        ??_OnPaint_12
   1254                } else {
   1255                  TextWidth = pItem->TextWidth;
   1256                  TextRect.x0 = FillRect.x0 + BorderLeft;
   \                     ??_OnPaint_11:
   \   000003BC   F010DDE1           LDRSH    R1,[SP, #+0]
   \   000003C0   1C209DE5           LDR      R2,[SP, #+28]
   \   000003C4   08009BE5           LDR      R0,[R11, #+8]
   \   000003C8   011082E0           ADD      R1,R2,R1
   \   000003CC   BC10CDE1           STRH     R1,[SP, #+12]
   1257                  TextRect.x1 = TextRect.x0 + TextWidth - 1;
   \   000003D0   FC10DDE1           LDRSH    R1,[SP, #+12]
   1258                  WIDGET__FillStringInRect(pItem->acText, &FillRect, &TextRect, &TextRect);
   \   000003D4   0C308DE2           ADD      R3,SP,#+12
   \   000003D8   0C208DE2           ADD      R2,SP,#+12
   \   000003DC   000081E0           ADD      R0,R1,R0
   \   000003E0   010040E2           SUB      R0,R0,#+1
   \   000003E4   B001CDE1           STRH     R0,[SP, #+16]
   \   000003E8   0D10A0E1           MOV      R1,SP
   \   000003EC   0C008BE2           ADD      R0,R11,#+12
   \   000003F0   ........           BL       WIDGET__FillStringInRect
   1259                }
   1260                FillRect.x0 += ItemWidth;
   \                     ??_OnPaint_12:
   \   000003F4   F000DDE1           LDRSH    R0,[SP, #+0]
   \   000003F8   00008AE0           ADD      R0,R10,R0
   \   000003FC   B000CDE1           STRH     R0,[SP, #+0]
   1261                GUI_UNLOCK_H(pItem);
   \   00000400   ........           BL       GUI_ALLOC_UnlockH
   1262              }
   \   00000404   14009DE5           LDR      R0,[SP, #+20]
   \   00000408   018088E2           ADD      R8,R8,#+1
   \   0000040C   000058E1           CMP      R8,R0
   \   00000410   B1FFFF3A           BCC      ??_OnPaint_9
   1263            }
   1264            if (pObj->Width || pObj->Height) {
   \                     ??_OnPaint_4:
   \   00000414   700095E5           LDR      R0,[R5, #+112]
   \   00000418   000050E3           CMP      R0,#+0
   \   0000041C   74009505           LDREQ    R0,[R5, #+116]
   \   00000420   00005003           CMPEQ    R0,#+0
   \   00000424   1400000A           BEQ      ??_OnPaint_13
   1265              GUI_RECT r;
   1266              WM__GetClientRectWin(&pObj->Widget.Win, &r);
   \   00000428   30108DE2           ADD      R1,SP,#+48
   \   0000042C   0500A0E1           MOV      R0,R5
   \   00000430   ........           BL       WM__GetClientRectWin
   1267              GUI__ReduceRect(&r, &r, EffectSize);
   \   00000434   0620A0E1           MOV      R2,R6
   \   00000438   30108DE2           ADD      R1,SP,#+48
   \   0000043C   30008DE2           ADD      R0,SP,#+48
   \   00000440   ........           BL       GUI__ReduceRect
   1268              GUI_SetBkColor(pObj->Props.aBkColor[MENU_CI_ENABLED]);
   \   00000444   480095E5           LDR      R0,[R5, #+72]
   \   00000448   ........           BL       GUI_SetBkColor
   1269              GUI_ClearRect(FillRect.x1 + 1, EffectSize, r.x1, FillRect.y1);
   \   0000044C   F400DDE1           LDRSH    R0,[SP, #+4]
   \   00000450   F630DDE1           LDRSH    R3,[SP, #+6]
   \   00000454   F423DDE1           LDRSH    R2,[SP, #+52]
   \   00000458   0610A0E1           MOV      R1,R6
   \   0000045C   010080E2           ADD      R0,R0,#+1
   \   00000460   ........           BL       GUI_ClearRect
   1270              GUI_ClearRect(EffectSize, FillRect.y1 + 1, r.x1, r.y1);
   \   00000464   F600DDE1           LDRSH    R0,[SP, #+6]
   \   00000468   F633DDE1           LDRSH    R3,[SP, #+54]
   \   0000046C   F423DDE1           LDRSH    R2,[SP, #+52]
   \   00000470   011080E2           ADD      R1,R0,#+1
   \   00000474   0600A0E1           MOV      R0,R6
   \   00000478   ........           BL       GUI_ClearRect
   1271            }
   1272            /* Draw 3D effect (if configured) */
   1273            if (_HasEffect(hObj, pObj)) {
   \                     ??_OnPaint_13:
   \   0000047C   6C00D5E5           LDRB     R0,[R5, #+108]
   \   00000480   800010E3           TST      R0,#0x80
   \   00000484   1E00001A           BNE      ??_OnPaint_14
   \   00000488   0400A0E1           MOV      R0,R4
   \   0000048C   ........           BL       GUI_ALLOC_LockH
   \   00000490   686090E5           LDR      R6,[R0, #+104]
   \   00000494   ........           BL       GUI_ALLOC_UnlockH
   \   00000498   20008DE2           ADD      R0,SP,#+32
   \   0000049C   0010A0E3           MOV      R1,#+0
   \   000004A0   0020A0E3           MOV      R2,#+0
   \   000004A4   0030A0E3           MOV      R3,#+0
   \   000004A8   00C0A0E3           MOV      R12,#+0
   \   000004AC   0E10A0E8           STM      R0!,{R1-R3,R12}
   \   000004B0   0510A0E3           MOV      R1,#+5
   \   000004B4   B810CDE1           STRH     R1,[SP, #+8]
   \   000004B8   2C10A0E3           MOV      R1,#+44
   \   000004BC   20108DE5           STR      R1,[SP, #+32]
   \   000004C0   08108DE2           ADD      R1,SP,#+8
   \   000004C4   BA70CDE1           STRH     R7,[SP, #+10]
   \   000004C8   2C108DE5           STR      R1,[SP, #+44]
   \   000004CC   28408DE5           STR      R4,[SP, #+40]
   \   000004D0   000056E3           CMP      R6,#+0
   \   000004D4   0200001A           BNE      ??_OnPaint_15
   \   000004D8   0400A0E1           MOV      R0,R4
   \   000004DC   ........           BL       WM_GetParent
   \   000004E0   0060A0E1           MOV      R6,R0
   \                     ??_OnPaint_15:
   \   000004E4   000056E3           CMP      R6,#+0
   \   000004E8   0800000A           BEQ      ??_OnPaint_16
   \   000004EC   20108DE2           ADD      R1,SP,#+32
   \   000004F0   0600A0E1           MOV      R0,R6
   \   000004F4   ........           BL       WM__SendMessage
   \   000004F8   2C009DE5           LDR      R0,[SP, #+44]
   \   000004FC   000050E3           CMP      R0,#+0
   \   00000500   0200000A           BEQ      ??_OnPaint_16
   1274              pObj->Widget.pEffect->pfDrawUp();
   \                     ??_OnPaint_14:
   \   00000504   2C0095E5           LDR      R0,[R5, #+44]
   \   00000508   040090E5           LDR      R0,[R0, #+4]
   \   0000050C   30FF2FE1           BLX      R0
   1275            }
   1276            GUI_UNLOCK_H(pObj);
   \                     ??_OnPaint_16:
   \   00000510   ........           BL       GUI_ALLOC_UnlockH
   1277          }
   \   00000514   3CD08DE2           ADD      SP,SP,#+60       ;; stack cleaning
   \   00000518   F08FBDE8           POP      {R4-R11,PC}      ;; return
   1278          
   1279          /*********************************************************************
   1280          *
   1281          *       _MoveSel
   1282          *
   1283          * Purpose:
   1284          *   Moves the selection of the given menu to the desired direction.
   1285          *   If the last or the first item is selected, the selection moves to the begin or the end.
   1286          *   Separators will be skipped.
   1287          */
   1288          static void _MoveSel(MENU_Handle hObj, int Dir, int SuppressNotification) {
   1289            MENU_Obj * pObj;
   1290            GUI_ARRAY   ItemArray;
   1291            int NewIndex, Index, NumItems, Cnt = 0;
   1292            pObj = MENU_LOCK_H(hObj);
   1293            ItemArray = pObj->ItemArray;
   1294            Index     = pObj->Sel;
   1295            GUI_UNLOCK_H(pObj);
   1296            NewIndex = -1;
   1297            NumItems = GUI_ARRAY_GetNumItems(ItemArray);
   1298            do {
   1299              MENU_ITEM * pItem;
   1300              Index += Dir;
   1301              if (Index >= NumItems) {
   1302                Index = 0;
   1303                Cnt++;
   1304              } else if (Index < 0) {
   1305                Index = NumItems - 1;
   1306                Cnt++;
   1307              }
   1308              pItem = (MENU_ITEM *)GUI_ARRAY_GetpItemLocked(ItemArray, Index);
   1309              if (!(pItem->Flags & MENU_IF_SEPARATOR)) {
   1310                NewIndex = Index;
   1311              }
   1312              GUI_UNLOCK_H(pItem);
   1313            } while ((NewIndex < 0) && (Cnt < 2));
   1314            if (NewIndex >= 0) {
   1315              _SetSelectionEx(hObj, Index, SuppressNotification);
   1316            }
   1317          }
   1318          
   1319          /*********************************************************************
   1320          *
   1321          *       _OpenMenu
   1322          */
   1323          static void _OpenMenu(MENU_Handle hObj, int Index, int SubSel) {
   1324            MENU_Obj * pObj;
   1325            MENU_ITEM * pItem;
   1326            int NumItems;
   1327            GUI_ARRAY   ItemArray;
   1328            MENU_Handle Item_hSubmenu;
   1329            
   1330            pObj = MENU_LOCK_H(hObj);
   1331            ItemArray = pObj->ItemArray;
   1332            pObj->Flags |= MENU_SF_ACTIVE;
   1333            GUI_UNLOCK_H(pObj);
   1334            pItem = (MENU_ITEM *)GUI_ARRAY_GetpItemLocked(ItemArray, Index);
   1335            Item_hSubmenu = pItem->hSubmenu;
   1336            GUI_UNLOCK_H(pItem);
   1337            _OpenSubmenu(hObj, Index);
   1338            NumItems = GUI_ARRAY_GetNumItems(ItemArray);
   1339            if (SubSel >= NumItems) {
   1340              SubSel = NumItems - 1;
   1341            }
   1342            _SetSelection(Item_hSubmenu, SubSel);
   1343            WM_SetFocus(Item_hSubmenu);
   1344            _SetSelection(hObj, Index);
   1345          }
   1346          
   1347          /*********************************************************************
   1348          *
   1349          *       _OnKey
   1350          */

   \                                 In section .text, align 4, keep-with-next
   1351          static int _OnKey(MENU_Handle hObj, int Key) {
   \                     _OnKey:
   \   00000000   F04F2DE9           PUSH     {R4-R11,LR}
   \   00000004   0160A0E1           MOV      R6,R1
   \   00000008   2CD04DE2           SUB      SP,SP,#+44
   1352            MENU_Obj * pObj;
   1353            int KeyOpen, KeyBack, KeyNext, KeyPrev, Index, SubSel = 0;
   \   0000000C   0010A0E3           MOV      R1,#+0
   \   00000010   0050A0E1           MOV      R5,R0
   \   00000014   1C108DE5           STR      R1,[SP, #+28]
   1354            MENU_ITEM * pItem;
   1355            MENU_Handle hObjTopLevel;
   1356            MENU_Obj * pObjTopLevel;
   1357            GUI_ARRAY   ItemArray;
   1358            WM_HWIN     hOwner;
   1359            U16         Flags;
   1360            MENU_Handle Item_hSubmenu;
   1361            U16         Item_Id;
   1362            U16         Item_Flags;
   1363            U16         TopLevel_Flags;
   1364            int         TopLevel_Sel;
   1365            
   1366            pObj = MENU_LOCK_H(hObj);
   \   00000018   ........           BL       GUI_ALLOC_LockH
   1367            ItemArray = pObj->ItemArray;
   1368            hOwner    = pObj->hOwner;
   1369            Flags     = pObj->Flags;
   \   0000001C   BC16D0E1           LDRH     R1,[R0, #+108]
   \   00000020   64B090E5           LDR      R11,[R0, #+100]
   \   00000024   684090E5           LDR      R4,[R0, #+104]
   \   00000028   24108DE5           STR      R1,[SP, #+36]
   1370            Index     = pObj->Sel;
   \   0000002C   787090E5           LDR      R7,[R0, #+120]
   1371            GUI_UNLOCK_H(pObj);
   \   00000030   ........           BL       GUI_ALLOC_UnlockH
   1372          
   1373            _GetTopLevelMenu(hObj, &hObjTopLevel, &SubSel);
   \   00000034   1C208DE2           ADD      R2,SP,#+28
   \   00000038   04108DE2           ADD      R1,SP,#+4
   \   0000003C   0500A0E1           MOV      R0,R5
   \   00000040   ........           BL       _GetTopLevelMenu
   1374            pObjTopLevel = MENU_LOCK_H(hObjTopLevel);
   1375            TopLevel_Flags = pObjTopLevel->Flags;
   \   00000044   04009DE5           LDR      R0,[SP, #+4]
   \   00000048   ........           BL       GUI_ALLOC_LockH
   \   0000004C   BC86D0E1           LDRH     R8,[R0, #+108]
   1376            GUI_UNLOCK_H(pObjTopLevel);
   \   00000050   ........           BL       GUI_ALLOC_UnlockH
   1377            
   1378            if (Flags & MENU_CF_VERTICAL) {
   \   00000054   24009DE5           LDR      R0,[SP, #+36]
   \   00000058   010010E3           TST      R0,#0x1
   \   0000005C   0600000A           BEQ      ??_OnKey_0
   1379              KeyOpen = GUI_KEY_RIGHT;
   1380              KeyBack = GUI_KEY_LEFT;
   \   00000060   1010A0E3           MOV      R1,#+16
   \   00000064   08108DE5           STR      R1,[SP, #+8]
   1381              KeyNext = GUI_KEY_DOWN;
   \   00000068   1310A0E3           MOV      R1,#+19
   \   0000006C   1290A0E3           MOV      R9,#+18
   \   00000070   20108DE5           STR      R1,[SP, #+32]
   1382              KeyPrev = GUI_KEY_UP;
   \   00000074   11A0A0E3           MOV      R10,#+17
   \   00000078   050000EA           B        ??_OnKey_1
   1383            } else {
   1384              KeyOpen = GUI_KEY_DOWN;
   1385              KeyBack = 0;
   \                     ??_OnKey_0:
   \   0000007C   0010A0E3           MOV      R1,#+0
   \   00000080   08108DE5           STR      R1,[SP, #+8]
   1386              KeyNext = GUI_KEY_RIGHT;
   \   00000084   1210A0E3           MOV      R1,#+18
   \   00000088   1390A0E3           MOV      R9,#+19
   \   0000008C   20108DE5           STR      R1,[SP, #+32]
   1387              KeyPrev = GUI_KEY_LEFT;
   \   00000090   10A0A0E3           MOV      R10,#+16
   1388            }
   1389            if (Index < 0) {
   \                     ??_OnKey_1:
   \   00000094   000057E3           CMP      R7,#+0
   \   00000098   1F00005A           BPL      ??_OnKey_2
   1390              if        (Key == KeyPrev) {
   \   0000009C   0A0056E1           CMP      R6,R10
   \   000000A0   0800001A           BNE      ??_OnKey_3
   1391                int NumItems;
   1392                NumItems = GUI_ARRAY_GetNumItems(ItemArray);
   \   000000A4   0B00A0E1           MOV      R0,R11
   \   000000A8   ........           BL       GUI_ARRAY_GetNumItems
   1393                _SetSelection(hObj, NumItems - 1);
   \   000000AC   011040E2           SUB      R1,R0,#+1
   \   000000B0   0020A0E3           MOV      R2,#+0
   \   000000B4   0500A0E1           MOV      R0,R5
   \   000000B8   ........           BL       _SetSelectionEx
   1394              } else if (Key != GUI_KEY_ESCAPE) {
   1395                _SetSelection(hObj, 0);
   1396              }
   1397              if (Key != GUI_KEY_ESCAPE) {
   \   000000BC   1B0056E3           CMP      R6,#+27
   \   000000C0   0600001A           BNE      ??_OnKey_4
   \   000000C4   120000EA           B        ??_OnKey_5
   \                     ??_OnKey_3:
   \   000000C8   1B0056E3           CMP      R6,#+27
   \   000000CC   1000000A           BEQ      ??_OnKey_5
   \   000000D0   0020A0E3           MOV      R2,#+0
   \   000000D4   0010A0E3           MOV      R1,#+0
   \   000000D8   0500A0E1           MOV      R0,R5
   \   000000DC   ........           BL       _SetSelectionEx
   1398                _SetCapture(hObj);
   \                     ??_OnKey_4:
   \   000000E0   0500A0E1           MOV      R0,R5
   \   000000E4   ........           BL       GUI_ALLOC_LockH
   \   000000E8   6E40D0E5           LDRB     R4,[R0, #+110]
   \   000000EC   ........           BL       GUI_ALLOC_UnlockH
   \   000000F0   000054E3           CMP      R4,#+0
   \   000000F4   0600001A           BNE      ??_OnKey_5
   \   000000F8   0500A0E1           MOV      R0,R5
   \   000000FC   ........           BL       WM_HasCaptured
   \   00000100   000050E3           CMP      R0,#+0
   \   00000104   0200001A           BNE      ??_OnKey_5
   \   00000108   0010A0E3           MOV      R1,#+0
   \   0000010C   0500A0E1           MOV      R0,R5
   \   00000110   ........           BL       WM_SetCapture
   1399              }
   1400              return 0;
   \                     ??_OnKey_5:
   \   00000114   0000A0E3           MOV      R0,#+0
   \   00000118   8C0100EA           B        ??_OnKey_6
   1401            }
   1402            
   1403            pItem = (MENU_ITEM *)GUI_ARRAY_GetpItemLocked(ItemArray, Index);
   \                     ??_OnKey_2:
   \   0000011C   0710A0E1           MOV      R1,R7
   \   00000120   0B00A0E1           MOV      R0,R11
   \   00000124   ........           BL       GUI_ARRAY_GetpItemLocked
   1404            Item_hSubmenu = pItem->hSubmenu;
   1405            Item_Flags    = pItem->Flags;
   \   00000128   B610D0E1           LDRH     R1,[R0, #+6]
   \   0000012C   00B090E5           LDR      R11,[R0, #+0]
   \   00000130   00108DE5           STR      R1,[SP, #+0]
   1406            Item_Id       = pItem->Id;
   \   00000134   B400D0E1           LDRH     R0,[R0, #+4]
   \   00000138   B802CDE1           STRH     R0,[SP, #+40]
   1407            GUI_UNLOCK_H(pItem);
   \   0000013C   ........           BL       GUI_ALLOC_UnlockH
   1408          
   1409            if (Item_hSubmenu && ((Key == KeyOpen) || (Key == GUI_KEY_ENTER))) {
   \   00000140   00005BE3           CMP      R11,#+0
   \   00000144   2100000A           BEQ      ??_OnKey_7
   \   00000148   090056E1           CMP      R6,R9
   \   0000014C   0D005613           CMPNE    R6,#+13
   \   00000150   4200001A           BNE      ??_OnKey_8
   1410              /*
   1411               *  If the current menu item is a submenu and <ENTER> or KeyOpen has been pressed, open the submenu
   1412               */
   1413              _OpenMenu(hObj, Index, 0);
   \   00000154   0040A0E3           MOV      R4,#+0
   \   00000158   0500A0E1           MOV      R0,R5
   \   0000015C   ........           BL       GUI_ALLOC_LockH
   \   00000160   BC16D0E1           LDRH     R1,[R0, #+108]
   \   00000164   646090E5           LDR      R6,[R0, #+100]
   \   00000168   401081E3           ORR      R1,R1,#0x40
   \   0000016C   BC16C0E1           STRH     R1,[R0, #+108]
   \   00000170   ........           BL       GUI_ALLOC_UnlockH
   \   00000174   0710A0E1           MOV      R1,R7
   \   00000178   0600A0E1           MOV      R0,R6
   \   0000017C   ........           BL       GUI_ARRAY_GetpItemLocked
   \   00000180   008090E5           LDR      R8,[R0, #+0]
   \   00000184   ........           BL       GUI_ALLOC_UnlockH
   \   00000188   0710A0E1           MOV      R1,R7
   \   0000018C   0500A0E1           MOV      R0,R5
   \   00000190   ........           BL       _OpenSubmenu
   \   00000194   0600A0E1           MOV      R0,R6
   \   00000198   ........           BL       GUI_ARRAY_GetNumItems
   \   0000019C   010050E3           CMP      R0,#+1
   \   000001A0   014040B2           SUBLT    R4,R0,#+1
   \   000001A4   0020A0E3           MOV      R2,#+0
   \   000001A8   0410A0E1           MOV      R1,R4
   \   000001AC   0800A0E1           MOV      R0,R8
   \   000001B0   ........           BL       _SetSelectionEx
   \   000001B4   0800A0E1           MOV      R0,R8
   \   000001B8   ........           BL       WM_SetFocus
   \                     ??_OnKey_9:
   \   000001BC   0020A0E3           MOV      R2,#+0
   \   000001C0   0710A0E1           MOV      R1,R7
   \   000001C4   0500A0E1           MOV      R0,R5
   \                     ??_OnKey_10:
   \   000001C8   ........           BL       _SetSelectionEx
   1414            } else if (!Item_hSubmenu && (Key == GUI_KEY_ENTER)) {
   \   000001CC   D0FFFFEA           B        ??_OnKey_5
   \                     ??_OnKey_7:
   \   000001D0   0D0056E3           CMP      R6,#+13
   \   000001D4   2100001A           BNE      ??_OnKey_8
   1415              /*
   1416               *  If the current menu item is not a submenu and <ENTER> has been pressed,
   1417               *  set the focus to the top level menu, close the submenus and send an MENU_ON_ITEMSELECT message to the owner
   1418               */
   1419              if ((Item_Flags & MENU_IF_DISABLED) == 0) {
   \   000001D8   00009DE5           LDR      R0,[SP, #+0]
   \   000001DC   010010E3           TST      R0,#0x1
   \   000001E0   0400001A           BNE      ??_OnKey_11
   1420                WM_SetFocus(hObjTopLevel);
   \   000001E4   04009DE5           LDR      R0,[SP, #+4]
   \   000001E8   ........           BL       WM_SetFocus
   1421                _ActivateItem(hObj, Index);
   \   000001EC   0710A0E1           MOV      R1,R7
   \   000001F0   0500A0E1           MOV      R0,R5
   \   000001F4   ........           BL       _ActivateItem
   1422              }
   1423              if ((Item_Flags & MENU_IF_SEPARATOR) == 0) {
   \                     ??_OnKey_11:
   \   000001F8   00009DE5           LDR      R0,[SP, #+0]
   \   000001FC   020010E3           TST      R0,#0x2
   \   00000200   C3FFFF1A           BNE      ??_OnKey_5
   1424                MENU__SendMenuMessage(hObj, hOwner, MENU_ON_ITEMPRESSED, Item_Id);
   \   00000204   0020A0E3           MOV      R2,#+0
   \   00000208   0C108DE2           ADD      R1,SP,#+12
   \   0000020C   0230A0E1           MOV      R3,R2
   \   00000210   02C0A0E1           MOV      R12,R2
   \   00000214   02E0A0E1           MOV      LR,R2
   \   00000218   0C50A1E8           STM      R1!,{R2,R3,R12,LR}
   \   0000021C   0720A0E3           MOV      R2,#+7
   \   00000220   B020CDE1           STRH     R2,[SP, #+0]
   \   00000224   B822DDE1           LDRH     R2,[SP, #+40]
   \   00000228   0400B0E1           MOVS     R0,R4
   \   0000022C   18D08DE5           STR      SP,[SP, #+24]
   \   00000230   B220CDE1           STRH     R2,[SP, #+2]
   \   00000234   2C20A0E3           MOV      R2,#+44
   \   00000238   0C208DE5           STR      R2,[SP, #+12]
   \   0000023C   14508DE5           STR      R5,[SP, #+20]
   \   00000240   0100001A           BNE      ??_OnKey_12
   \   00000244   0500A0E1           MOV      R0,R5
   \   00000248   ........           BL       WM_GetParent
   \                     ??_OnKey_12:
   \   0000024C   000050E3           CMP      R0,#+0
   \   00000250   3E01000A           BEQ      ??_OnKey_6
   \   00000254   0C108DE2           ADD      R1,SP,#+12
   \                     ??_OnKey_13:
   \   00000258   ........           BL       WM__SendMessage
   \   0000025C   ACFFFFEA           B        ??_OnKey_5
   1425              }
   1426            } else if (((hObjTopLevel != hObj) && !(TopLevel_Flags & MENU_CF_VERTICAL) && (Key == KeyOpen) && (!Item_hSubmenu)) ||
   1427                       ((hObjTopLevel != hObj) && !(TopLevel_Flags & MENU_CF_VERTICAL) && (Key == KeyBack) && (hObjTopLevel == hOwner))) {
   \                     ??_OnKey_8:
   \   00000260   04009DE5           LDR      R0,[SP, #+4]
   \   00000264   050050E1           CMP      R0,R5
   \   00000268   8900000A           BEQ      ??_OnKey_14
   \   0000026C   010018E3           TST      R8,#0x1
   \   00000270   7C00001A           BNE      ??_OnKey_15
   \   00000274   090056E1           CMP      R6,R9
   \   00000278   00005B03           CMPEQ    R11,#+0
   \   0000027C   0400000A           BEQ      ??_OnKey_16
   \   00000280   08009DE5           LDR      R0,[SP, #+8]
   \   00000284   000056E1           CMP      R6,R0
   \   00000288   04009D05           LDREQ    R0,[SP, #+4]
   \   0000028C   04005001           CMPEQ    R0,R4
   \   00000290   7400001A           BNE      ??_OnKey_15
   1428              /*
   1429               *  If the current menu is not the top level menu and the top level menu is horizontal
   1430               *  and <GUI_KEY_RIGHT> or <GUI_KEY_LEFT> has been pressed close the current submenus,
   1431               *  move the selection of the top level menu to next/previous item and open it
   1432               */
   1433              pObj = MENU_LOCK_H(hObj);
   \                     ??_OnKey_16:
   \   00000294   0500A0E1           MOV      R0,R5
   \   00000298   ........           BL       GUI_ALLOC_LockH
   1434              pObj->Flags &= ~MENU_SF_ACTIVE;
   \   0000029C   BC16D0E1           LDRH     R1,[R0, #+108]
   \   000002A0   4010C1E3           BIC      R1,R1,#0x40
   \   000002A4   BC16C0E1           STRH     R1,[R0, #+108]
   1435              GUI_UNLOCK_H(pObj);
   \   000002A8   ........           BL       GUI_ALLOC_UnlockH
   1436              /* Set focus to top level menu */
   1437              WM_SetFocus(hObjTopLevel);
   \   000002AC   04009DE5           LDR      R0,[SP, #+4]
   \   000002B0   ........           BL       WM_SetFocus
   1438              /* Move selection of top level menu */
   1439              if (Key == KeyOpen) {
   \   000002B4   04409DE5           LDR      R4,[SP, #+4]
   \   000002B8   090056E1           CMP      R6,R9
   \   000002BC   0070A0E3           MOV      R7,#+0
   \   000002C0   0400A0E1           MOV      R0,R4
   \   000002C4   1C00001A           BNE      ??_OnKey_17
   1440                _MoveSel(hObjTopLevel, +1, 1);
   \   000002C8   ........           BL       GUI_ALLOC_LockH
   \   000002CC   648090E5           LDR      R8,[R0, #+100]
   \   000002D0   78B090E5           LDR      R11,[R0, #+120]
   \   000002D4   ........           BL       GUI_ALLOC_UnlockH
   \   000002D8   0790E0E1           MVN      R9,R7
   \   000002DC   0800A0E1           MOV      R0,R8
   \   000002E0   ........           BL       GUI_ARRAY_GetNumItems
   \   000002E4   00A0A0E1           MOV      R10,R0
   \                     ??_OnKey_18:
   \   000002E8   01B08BE2           ADD      R11,R11,#+1
   \   000002EC   0A005BE1           CMP      R11,R10
   \   000002F0   030000AA           BGE      ??_OnKey_19
   \   000002F4   00005BE3           CMP      R11,#+0
   \   000002F8   0300005A           BPL      ??_OnKey_20
   \   000002FC   01B04AE2           SUB      R11,R10,#+1
   \   00000300   000000EA           B        ??_OnKey_21
   \                     ??_OnKey_19:
   \   00000304   00B0A0E3           MOV      R11,#+0
   \                     ??_OnKey_21:
   \   00000308   017087E2           ADD      R7,R7,#+1
   \                     ??_OnKey_20:
   \   0000030C   0B10A0E1           MOV      R1,R11
   \   00000310   0800A0E1           MOV      R0,R8
   \   00000314   ........           BL       GUI_ARRAY_GetpItemLocked
   \   00000318   0600D0E5           LDRB     R0,[R0, #+6]
   \   0000031C   020010E3           TST      R0,#0x2
   \   00000320   0B90A001           MOVEQ    R9,R11
   \   00000324   ........           BL       GUI_ALLOC_UnlockH
   \   00000328   000059E3           CMP      R9,#+0
   \   0000032C   1F00005A           BPL      ??_OnKey_22
   \   00000330   020057E3           CMP      R7,#+2
   \   00000334   EBFFFFBA           BLT      ??_OnKey_18
   \   00000338   200000EA           B        ??_OnKey_23
   1441                _GetTopLevelMenu(hObj, &hObjTopLevel, &SubSel); /* Pointer recalculation required after sending a notification message */
   1442              } else {
   1443                _MoveSel(hObjTopLevel, -1, 1);
   \                     ??_OnKey_17:
   \   0000033C   ........           BL       GUI_ALLOC_LockH
   \   00000340   648090E5           LDR      R8,[R0, #+100]
   \   00000344   78B090E5           LDR      R11,[R0, #+120]
   \   00000348   ........           BL       GUI_ALLOC_UnlockH
   \   0000034C   0790E0E1           MVN      R9,R7
   \   00000350   0800A0E1           MOV      R0,R8
   \   00000354   ........           BL       GUI_ARRAY_GetNumItems
   \   00000358   00A0A0E1           MOV      R10,R0
   \                     ??_OnKey_24:
   \   0000035C   01B04BE2           SUB      R11,R11,#+1
   \   00000360   0A005BE1           CMP      R11,R10
   \   00000364   030000AA           BGE      ??_OnKey_25
   \   00000368   00005BE3           CMP      R11,#+0
   \   0000036C   0300005A           BPL      ??_OnKey_26
   \   00000370   01B04AE2           SUB      R11,R10,#+1
   \   00000374   000000EA           B        ??_OnKey_27
   \                     ??_OnKey_25:
   \   00000378   00B0A0E3           MOV      R11,#+0
   \                     ??_OnKey_27:
   \   0000037C   017087E2           ADD      R7,R7,#+1
   \                     ??_OnKey_26:
   \   00000380   0B10A0E1           MOV      R1,R11
   \   00000384   0800A0E1           MOV      R0,R8
   \   00000388   ........           BL       GUI_ARRAY_GetpItemLocked
   \   0000038C   0600D0E5           LDRB     R0,[R0, #+6]
   \   00000390   020010E3           TST      R0,#0x2
   \   00000394   0B90A001           MOVEQ    R9,R11
   \   00000398   ........           BL       GUI_ALLOC_UnlockH
   \   0000039C   000059E3           CMP      R9,#+0
   \   000003A0   0200005A           BPL      ??_OnKey_22
   \   000003A4   020057E3           CMP      R7,#+2
   \   000003A8   EBFFFFBA           BLT      ??_OnKey_24
   \   000003AC   030000EA           B        ??_OnKey_23
   \                     ??_OnKey_22:
   \   000003B0   0120A0E3           MOV      R2,#+1
   \   000003B4   0B10A0E1           MOV      R1,R11
   \   000003B8   0400A0E1           MOV      R0,R4
   \   000003BC   ........           BL       _SetSelectionEx
   1444                _GetTopLevelMenu(hObj, &hObjTopLevel, &SubSel); /* Pointer recalculation required after sending a notification message */
   \                     ??_OnKey_23:
   \   000003C0   1C208DE2           ADD      R2,SP,#+28
   \   000003C4   04108DE2           ADD      R1,SP,#+4
   \   000003C8   0500A0E1           MOV      R0,R5
   \   000003CC   ........           BL       _GetTopLevelMenu
   1445              }
   1446              /* Open top level menu */
   1447              pObjTopLevel = MENU_LOCK_H(hObjTopLevel);
   1448              TopLevel_Sel   = pObjTopLevel->Sel;
   \   000003D0   04009DE5           LDR      R0,[SP, #+4]
   \   000003D4   ........           BL       GUI_ALLOC_LockH
   \   000003D8   784090E5           LDR      R4,[R0, #+120]
   1449              GUI_UNLOCK_H(pObjTopLevel);
   \   000003DC   ........           BL       GUI_ALLOC_UnlockH
   1450              _OpenMenu(hObjTopLevel, TopLevel_Sel, (Key == KeyBack) ? SubSel : 0);
   \   000003E0   08009DE5           LDR      R0,[SP, #+8]
   \   000003E4   000056E1           CMP      R6,R0
   \   000003E8   04609DE5           LDR      R6,[SP, #+4]
   \   000003EC   1C509D05           LDREQ    R5,[SP, #+28]
   \   000003F0   0050A013           MOVNE    R5,#+0
   \   000003F4   0600A0E1           MOV      R0,R6
   \   000003F8   ........           BL       GUI_ALLOC_LockH
   \   000003FC   BC16D0E1           LDRH     R1,[R0, #+108]
   \   00000400   647090E5           LDR      R7,[R0, #+100]
   \   00000404   401081E3           ORR      R1,R1,#0x40
   \   00000408   BC16C0E1           STRH     R1,[R0, #+108]
   \   0000040C   ........           BL       GUI_ALLOC_UnlockH
   \   00000410   0410A0E1           MOV      R1,R4
   \   00000414   0700A0E1           MOV      R0,R7
   \   00000418   ........           BL       GUI_ARRAY_GetpItemLocked
   \   0000041C   008090E5           LDR      R8,[R0, #+0]
   \   00000420   ........           BL       GUI_ALLOC_UnlockH
   \   00000424   0410A0E1           MOV      R1,R4
   \   00000428   0600A0E1           MOV      R0,R6
   \   0000042C   ........           BL       _OpenSubmenu
   \   00000430   0700A0E1           MOV      R0,R7
   \   00000434   ........           BL       GUI_ARRAY_GetNumItems
   \   00000438   000055E1           CMP      R5,R0
   \   0000043C   015040A2           SUBGE    R5,R0,#+1
   \   00000440   0020A0E3           MOV      R2,#+0
   \   00000444   0510A0E1           MOV      R1,R5
   \   00000448   0800A0E1           MOV      R0,R8
   \   0000044C   ........           BL       _SetSelectionEx
   \   00000450   0800A0E1           MOV      R0,R8
   \   00000454   ........           BL       WM_SetFocus
   \   00000458   0020A0E3           MOV      R2,#+0
   \   0000045C   0410A0E1           MOV      R1,R4
   \   00000460   0600A0E1           MOV      R0,R6
   \   00000464   57FFFFEA           B        ??_OnKey_10
   \                     ??_OnKey_15:
   \   00000468   1B0056E3           CMP      R6,#+27
   \   0000046C   4000000A           BEQ      ??_OnKey_28
   \   00000470   08009DE5           LDR      R0,[SP, #+8]
   \   00000474   000056E1           CMP      R6,R0
   \   00000478   01001803           TSTEQ    R8,#0x1
   \   0000047C   3A00001A           BNE      ??_OnKey_29
   \   00000480   00005BE3           CMP      R11,#+0
   \   00000484   6700001A           BNE      ??_OnKey_30
   \   00000488   04009DE5           LDR      R0,[SP, #+4]
   \   0000048C   040050E1           CMP      R0,R4
   \   00000490   3700001A           BNE      ??_OnKey_28
   1451            } else if ((hObjTopLevel != hObj) && 
   1452                       ((Key == GUI_KEY_ESCAPE) || ((Key == KeyBack) && ((!(TopLevel_Flags & MENU_CF_VERTICAL)) && (!Item_hSubmenu) && (hObjTopLevel != hOwner)) || (TopLevel_Flags & MENU_CF_VERTICAL)))) {
   1453              /*
   1454               *  If the current menu is not the top level menu and the top level menu is vertical and <GUI_KEY_LEFT> has been pressed
   1455               *  or the top level menu is vertical or horizontal and <GUI_KEY_ESCAPE> has been pressed,
   1456               *  close the current submenu
   1457               */
   1458              WM_SetFocus(hOwner);
   1459              if (hOwner) {
   1460                MENU_Obj  * pObjOwner;
   1461                MENU_ITEM * pItemOwner;
   1462                U16         IdOwner;
   1463                U16         FlagsOwner;
   1464                pObjOwner = MENU_LOCK_H(hOwner);
   1465                pItemOwner = (MENU_ITEM *)GUI_ARRAY_GetpItemLocked(pObjOwner->ItemArray, pObjOwner->Sel);
   1466                GUI_UNLOCK_H(pObjOwner);
   1467                IdOwner    = pItemOwner->Id;
   1468                FlagsOwner = pItemOwner->Flags;
   1469                GUI_UNLOCK_H(pItemOwner);
   1470                if ((FlagsOwner & MENU_IF_SEPARATOR) == 0) {
   1471                  MENU__SendMenuMessage(hObj, hOwner, MENU_ON_ITEMACTIVATE, IdOwner);
   1472                }
   1473              }
   1474            } else if ((hObjTopLevel == hObj) && (Key == GUI_KEY_ESCAPE) && (!(Flags & MENU_SF_POPUP))) {
   \                     ??_OnKey_14:
   \   00000494   050050E1           CMP      R0,R5
   \   00000498   1B005603           CMPEQ    R6,#+27
   \   0000049C   6100001A           BNE      ??_OnKey_30
   \   000004A0   24009DE5           LDR      R0,[SP, #+36]
   \   000004A4   800010E3           TST      R0,#0x80
   \   000004A8   0500A0E1           MOV      R0,R5
   \   000004AC   5000001A           BNE      ??_OnKey_31
   1475              /*
   1476               *  If the current menu is the top level menu and <GUI_KEY_ESCAPE> has been pressed,
   1477               *  close submenu, unselect the menu and release capture
   1478               */
   1479              _CloseSubmenu(hObj);
   \   000004B0   ........           BL       _CloseSubmenu
   1480              _SetSelection(hObj, -1);
   \   000004B4   0020A0E3           MOV      R2,#+0
   \   000004B8   0210E0E1           MVN      R1,R2
   \   000004BC   0500A0E1           MOV      R0,R5
   \   000004C0   ........           BL       _SetSelectionEx
   1481              _ReleaseCapture(hObj);
   \   000004C4   0500A0E1           MOV      R0,R5
   \   000004C8   ........           BL       WM_HasCaptured
   \   000004CC   000050E3           CMP      R0,#+0
   \   000004D0   9E00000A           BEQ      ??_OnKey_6
   \   000004D4   0500A0E1           MOV      R0,R5
   \   000004D8   ........           BL       GUI_ALLOC_LockH
   \   000004DC   BC46D0E1           LDRH     R4,[R0, #+108]
   \   000004E0   ........           BL       GUI_ALLOC_UnlockH
   \   000004E4   0500A0E1           MOV      R0,R5
   \   000004E8   ........           BL       GUI_ALLOC_LockH
   \   000004EC   686090E5           LDR      R6,[R0, #+104]
   \   000004F0   ........           BL       GUI_ALLOC_UnlockH
   \   000004F4   0C008DE2           ADD      R0,SP,#+12
   \   000004F8   0010A0E3           MOV      R1,#+0
   \   000004FC   0020A0E3           MOV      R2,#+0
   \   00000500   0030A0E3           MOV      R3,#+0
   \   00000504   00C0A0E3           MOV      R12,#+0
   \   00000508   0E10A0E8           STM      R0!,{R1-R3,R12}
   \   0000050C   0510A0E3           MOV      R1,#+5
   \   00000510   B010CDE1           STRH     R1,[SP, #+0]
   \   00000514   2C10A0E3           MOV      R1,#+44
   \   00000518   B220CDE1           STRH     R2,[SP, #+2]
   \   0000051C   0C108DE5           STR      R1,[SP, #+12]
   \   00000520   18D08DE5           STR      SP,[SP, #+24]
   \   00000524   14508DE5           STR      R5,[SP, #+20]
   \   00000528   000056E3           CMP      R6,#+0
   \   0000052C   0200001A           BNE      ??_OnKey_32
   \   00000530   0500A0E1           MOV      R0,R5
   \   00000534   ........           BL       WM_GetParent
   \   00000538   0060A0E1           MOV      R6,R0
   \                     ??_OnKey_32:
   \   0000053C   000056E3           CMP      R6,#+0
   \   00000540   0500000A           BEQ      ??_OnKey_33
   \   00000544   0C108DE2           ADD      R1,SP,#+12
   \   00000548   0600A0E1           MOV      R0,R6
   \   0000054C   ........           BL       WM__SendMessage
   \   00000550   18009DE5           LDR      R0,[SP, #+24]
   \   00000554   000050E3           CMP      R0,#+0
   \   00000558   EDFEFF1A           BNE      ??_OnKey_5
   \                     ??_OnKey_33:
   \   0000055C   800014E3           TST      R4,#0x80
   \   00000560   EBFEFF1A           BNE      ??_OnKey_5
   \                     ??_OnKey_34:
   \   00000564   ........           BL       WM_ReleaseCapture
   \   00000568   E9FEFFEA           B        ??_OnKey_5
   1482            } else if ((hObjTopLevel == hObj) && (Key == GUI_KEY_ESCAPE) && (Flags & MENU_SF_POPUP)) {
   \                     ??_OnKey_29:
   \   0000056C   010018E3           TST      R8,#0x1
   \   00000570   2C00000A           BEQ      ??_OnKey_30
   \                     ??_OnKey_28:
   \   00000574   0400A0E1           MOV      R0,R4
   \   00000578   ........           BL       WM_SetFocus
   \   0000057C   000054E3           CMP      R4,#+0
   \   00000580   E3FEFF0A           BEQ      ??_OnKey_5
   \   00000584   0400A0E1           MOV      R0,R4
   \   00000588   ........           BL       GUI_ALLOC_LockH
   \   0000058C   781090E5           LDR      R1,[R0, #+120]
   \   00000590   640090E5           LDR      R0,[R0, #+100]
   \   00000594   ........           BL       GUI_ARRAY_GetpItemLocked
   \   00000598   0070A0E1           MOV      R7,R0
   \   0000059C   ........           BL       GUI_ALLOC_UnlockH
   \   000005A0   B460D7E1           LDRH     R6,[R7, #+4]
   \   000005A4   B670D7E1           LDRH     R7,[R7, #+6]
   \   000005A8   ........           BL       GUI_ALLOC_UnlockH
   \   000005AC   020017E3           TST      R7,#0x2
   \   000005B0   D7FEFF1A           BNE      ??_OnKey_5
   \   000005B4   0C008DE2           ADD      R0,SP,#+12
   \   000005B8   0010A0E3           MOV      R1,#+0
   \   000005BC   0020A0E3           MOV      R2,#+0
   \   000005C0   0030A0E3           MOV      R3,#+0
   \   000005C4   00C0A0E3           MOV      R12,#+0
   \   000005C8   0E10A0E8           STM      R0!,{R1-R3,R12}
   \   000005CC   0610A0E3           MOV      R1,#+6
   \   000005D0   B010CDE1           STRH     R1,[SP, #+0]
   \   000005D4   2C10A0E3           MOV      R1,#+44
   \   000005D8   0C108DE5           STR      R1,[SP, #+12]
   \   000005DC   B260CDE1           STRH     R6,[SP, #+2]
   \   000005E0   18D08DE5           STR      SP,[SP, #+24]
   \   000005E4   14508DE5           STR      R5,[SP, #+20]
   \   000005E8   0C108DE2           ADD      R1,SP,#+12
   \   000005EC   0400A0E1           MOV      R0,R4
   \   000005F0   18FFFFEA           B        ??_OnKey_13
   1483              /*
   1484               *  If the current menu is a top level popup menu and <GUI_KEY_ESCAPE> has been pressed,
   1485               *  close the popup menu
   1486               */
   1487              _ClosePopup(hObj);
   \                     ??_OnKey_31:
   \   000005F4   ........           BL       GUI_ALLOC_LockH
   \   000005F8   6C10D0E5           LDRB     R1,[R0, #+108]
   \   000005FC   800011E3           TST      R1,#0x80
   \   00000600   0600000A           BEQ      ??_OnKey_35
   \   00000604   BC16D0E1           LDRH     R1,[R0, #+108]
   \   00000608   8010C1E3           BIC      R1,R1,#0x80
   \   0000060C   BC16C0E1           STRH     R1,[R0, #+108]
   \   00000610   ........           BL       GUI_ALLOC_UnlockH
   \   00000614   0500A0E1           MOV      R0,R5
   \   00000618   ........           BL       WM_DetachWindow
   \   0000061C   D0FFFFEA           B        ??_OnKey_34
   \                     ??_OnKey_35:
   \   00000620   ........           BL       GUI_ALLOC_UnlockH
   \   00000624   BAFEFFEA           B        ??_OnKey_5
   1488            } else if (Key == KeyNext) {
   \                     ??_OnKey_30:
   \   00000628   20009DE5           LDR      R0,[SP, #+32]
   \   0000062C   000056E1           CMP      R6,R0
   \   00000630   2100001A           BNE      ??_OnKey_36
   1489              /*
   1490               *  If KeyNext has been pressed move the selection to the next menu item
   1491               */
   1492              _CloseSubmenu(hObj);
   \   00000634   0500A0E1           MOV      R0,R5
   \   00000638   ........           BL       _CloseSubmenu
   1493              _MoveSel(hObj, +1, 0);
   \   0000063C   0060A0E3           MOV      R6,#+0
   \   00000640   0500A0E1           MOV      R0,R5
   \   00000644   ........           BL       GUI_ALLOC_LockH
   \   00000648   644090E5           LDR      R4,[R0, #+100]
   \   0000064C   787090E5           LDR      R7,[R0, #+120]
   \   00000650   ........           BL       GUI_ALLOC_UnlockH
   \   00000654   0680E0E1           MVN      R8,R6
   \   00000658   0400A0E1           MOV      R0,R4
   \   0000065C   ........           BL       GUI_ARRAY_GetNumItems
   \   00000660   0090A0E1           MOV      R9,R0
   \   00000664   01A049E2           SUB      R10,R9,#+1
   \                     ??_OnKey_37:
   \   00000668   017087E2           ADD      R7,R7,#+1
   \   0000066C   090057E1           CMP      R7,R9
   \   00000670   030000AA           BGE      ??_OnKey_38
   \   00000674   000057E3           CMP      R7,#+0
   \   00000678   0300005A           BPL      ??_OnKey_39
   \   0000067C   0A70A0E1           MOV      R7,R10
   \   00000680   000000EA           B        ??_OnKey_40
   \                     ??_OnKey_38:
   \   00000684   0070A0E3           MOV      R7,#+0
   \                     ??_OnKey_40:
   \   00000688   016086E2           ADD      R6,R6,#+1
   \                     ??_OnKey_39:
   \   0000068C   0710A0E1           MOV      R1,R7
   \   00000690   0400A0E1           MOV      R0,R4
   \   00000694   ........           BL       GUI_ARRAY_GetpItemLocked
   \   00000698   0600D0E5           LDRB     R0,[R0, #+6]
   \   0000069C   020010E3           TST      R0,#0x2
   \   000006A0   0780A001           MOVEQ    R8,R7
   \   000006A4   ........           BL       GUI_ALLOC_UnlockH
   \   000006A8   000058E3           CMP      R8,#+0
   \   000006AC   C2FEFF5A           BPL      ??_OnKey_9
   \   000006B0   020056E3           CMP      R6,#+2
   \   000006B4   EBFFFFBA           BLT      ??_OnKey_37
   \   000006B8   95FEFFEA           B        ??_OnKey_5
   1494            } else if (Key == KeyPrev) {
   \                     ??_OnKey_36:
   \   000006BC   0A0056E1           CMP      R6,R10
   \   000006C0   2100001A           BNE      ??_OnKey_41
   1495              /*
   1496               *  If KeyPrev has been pressed move the selection to the previous menu item
   1497               */
   1498              _CloseSubmenu(hObj);
   \   000006C4   0500A0E1           MOV      R0,R5
   \   000006C8   ........           BL       _CloseSubmenu
   1499              _MoveSel(hObj, -1, 0);
   \   000006CC   0060A0E3           MOV      R6,#+0
   \   000006D0   0500A0E1           MOV      R0,R5
   \   000006D4   ........           BL       GUI_ALLOC_LockH
   \   000006D8   644090E5           LDR      R4,[R0, #+100]
   \   000006DC   787090E5           LDR      R7,[R0, #+120]
   \   000006E0   ........           BL       GUI_ALLOC_UnlockH
   \   000006E4   0680E0E1           MVN      R8,R6
   \   000006E8   0400A0E1           MOV      R0,R4
   \   000006EC   ........           BL       GUI_ARRAY_GetNumItems
   \   000006F0   0090A0E1           MOV      R9,R0
   \   000006F4   01A049E2           SUB      R10,R9,#+1
   \                     ??_OnKey_42:
   \   000006F8   017047E2           SUB      R7,R7,#+1
   \   000006FC   090057E1           CMP      R7,R9
   \   00000700   030000AA           BGE      ??_OnKey_43
   \   00000704   000057E3           CMP      R7,#+0
   \   00000708   0300005A           BPL      ??_OnKey_44
   \   0000070C   0A70A0E1           MOV      R7,R10
   \   00000710   000000EA           B        ??_OnKey_45
   \                     ??_OnKey_43:
   \   00000714   0070A0E3           MOV      R7,#+0
   \                     ??_OnKey_45:
   \   00000718   016086E2           ADD      R6,R6,#+1
   \                     ??_OnKey_44:
   \   0000071C   0710A0E1           MOV      R1,R7
   \   00000720   0400A0E1           MOV      R0,R4
   \   00000724   ........           BL       GUI_ARRAY_GetpItemLocked
   \   00000728   0600D0E5           LDRB     R0,[R0, #+6]
   \   0000072C   020010E3           TST      R0,#0x2
   \   00000730   0780A001           MOVEQ    R8,R7
   \   00000734   ........           BL       GUI_ALLOC_UnlockH
   \   00000738   000058E3           CMP      R8,#+0
   \   0000073C   9EFEFF5A           BPL      ??_OnKey_9
   \   00000740   020056E3           CMP      R6,#+2
   \   00000744   EBFFFFBA           BLT      ??_OnKey_42
   \   00000748   71FEFFEA           B        ??_OnKey_5
   1500            } else {
   1501              return 1;
   \                     ??_OnKey_41:
   \   0000074C   0100A0E3           MOV      R0,#+1
   \                     ??_OnKey_6:
   \   00000750   2CD08DE2           ADD      SP,SP,#+44       ;; stack cleaning
   \   00000754   F08FBDE8           POP      {R4-R11,PC}      ;; return
   1502            }
   1503            return 0;
   1504          }
   1505          
   1506          /*********************************************************************
   1507          *
   1508          *       Private routines
   1509          *
   1510          **********************************************************************
   1511          */
   1512          /*********************************************************************
   1513          *
   1514          *       MENU_LockH
   1515          */
   1516          #if GUI_DEBUG_LEVEL >= GUI_DEBUG_LEVEL_CHECK_ALL
   1517          MENU_Obj * MENU_LockH(MENU_Handle h) {
   1518            MENU_Obj * p = (MENU_Obj *)GUI_LOCK_H(h);
   1519            if (p) {
   1520              if (p->DebugId != MENU_ID) {
   1521                GUI_DEBUG_ERROROUT("MENU.c: Wrong handle type or Object not init'ed");
   1522                return 0;
   1523              }
   1524            }
   1525            return p;
   1526          }
   1527          #endif
   1528          
   1529          /*********************************************************************
   1530          *
   1531          *       Public code, Callback
   1532          *
   1533          **********************************************************************
   1534          */
   1535          /*********************************************************************
   1536          *
   1537          *       MENU_Callback
   1538          */

   \                                 In section .text, align 4, keep-with-next
   1539          void MENU_Callback(WM_MESSAGE * pMsg) {
   \                     MENU_Callback:
   \   00000000   F0472DE9           PUSH     {R4-R10,LR}
   \   00000004   0040A0E1           MOV      R4,R0
   1540            MENU_Handle hObj;
   1541            MENU_Obj * pObj;
   1542            GUI_ARRAY   ItemArray;
   1543            int         Sel;
   1544            int OldWidgetState, Result, HasFocus;
   1545          
   1546            hObj = pMsg->hWin;
   \   00000008   045094E5           LDR      R5,[R4, #+4]
   \   0000000C   18D04DE2           SUB      SP,SP,#+24
   1547            pObj = (MENU_Obj *)GUI_LOCK_H(hObj);
   1548            OldWidgetState = pObj->Widget.State;
   \   00000010   0500A0E1           MOV      R0,R5
   \   00000014   ........           BL       GUI_ALLOC_LockH
   \   00000018   B283D0E1           LDRH     R8,[R0, #+50]
   1549            GUI_UNLOCK_H(pObj);
   \   0000001C   ........           BL       GUI_ALLOC_UnlockH
   1550            Result = 1;
   1551            if (pMsg->MsgId != WM_PID_STATE_CHANGED) {
   \   00000020   000094E5           LDR      R0,[R4, #+0]
   \   00000024   0160A0E3           MOV      R6,#+1
   \   00000028   110050E3           CMP      R0,#+17
   \   0000002C   0300000A           BEQ      ??MENU_Callback_1
   1552              /* Let widget handle the standard messages */
   1553              Result = WIDGET_HandleActive(hObj, pMsg);
   \   00000030   0410A0E1           MOV      R1,R4
   \   00000034   0500A0E1           MOV      R0,R5
   \   00000038   ........           BL       WIDGET_HandleActive
   \   0000003C   0060A0E1           MOV      R6,R0
   1554            }
   1555            pObj = (MENU_Obj *)GUI_LOCK_H(hObj);
   \                     ??MENU_Callback_1:
   \   00000040   0500A0E1           MOV      R0,R5
   \   00000044   ........           BL       GUI_ALLOC_LockH
   1556            ItemArray = pObj->ItemArray;
   \   00000048   647090E5           LDR      R7,[R0, #+100]
   1557            Sel       = pObj->Sel;
   \   0000004C   789090E5           LDR      R9,[R0, #+120]
   1558            HasFocus  = pObj->Widget.State & WIDGET_STATE_FOCUS;
   \   00000050   3200D0E5           LDRB     R0,[R0, #+50]
   \   00000054   01A000E2           AND      R10,R0,#0x1
   1559            GUI_UNLOCK_H(pObj);
   \   00000058   ........           BL       GUI_ALLOC_UnlockH
   1560            /* React on focus change */
   1561            if ((OldWidgetState & WIDGET_STATE_FOCUS) != HasFocus) {
   \   0000005C   010008E2           AND      R0,R8,#0x1
   \   00000060   0A0050E1           CMP      R0,R10
   \   00000064   4500000A           BEQ      ??MENU_Callback_2
   1562              if (HasFocus) {
   \   00000068   00005AE3           CMP      R10,#+0
   \   0000006C   0500A0E1           MOV      R0,R5
   \   00000070   1A00000A           BEQ      ??MENU_Callback_3
   1563                _CloseSubmenu(hObj);
   \   00000074   ........           BL       _CloseSubmenu
   1564                pObj = MENU_LOCK_H(hObj);
   \   00000078   0500A0E1           MOV      R0,R5
   \   0000007C   ........           BL       GUI_ALLOC_LockH
   1565                pObj->Flags &= ~MENU_SF_ACTIVE;
   \   00000080   BC16D0E1           LDRH     R1,[R0, #+108]
   \   00000084   4010C1E3           BIC      R1,R1,#0x40
   \   00000088   BC16C0E1           STRH     R1,[R0, #+108]
   1566                GUI_UNLOCK_H(pObj);
   \   0000008C   ........           BL       GUI_ALLOC_UnlockH
   1567                if (Sel <= 0) {
   \   00000090   010059E3           CMP      R9,#+1
   \   00000094   390000AA           BGE      ??MENU_Callback_2
   1568                  _SetSelection(hObj, 0);
   \   00000098   0020A0E3           MOV      R2,#+0
   \   0000009C   0010A0E3           MOV      R1,#+0
   \   000000A0   0500A0E1           MOV      R0,R5
   \   000000A4   ........           BL       _SetSelectionEx
   1569                  _SetCapture(hObj);
   \   000000A8   0500A0E1           MOV      R0,R5
   \   000000AC   ........           BL       GUI_ALLOC_LockH
   \   000000B0   6E80D0E5           LDRB     R8,[R0, #+110]
   \   000000B4   ........           BL       GUI_ALLOC_UnlockH
   \   000000B8   000058E3           CMP      R8,#+0
   \   000000BC   2F00001A           BNE      ??MENU_Callback_2
   \   000000C0   0500A0E1           MOV      R0,R5
   \   000000C4   ........           BL       WM_HasCaptured
   \   000000C8   000050E3           CMP      R0,#+0
   \   000000CC   2B00001A           BNE      ??MENU_Callback_2
   \   000000D0   0010A0E3           MOV      R1,#+0
   \   000000D4   0500A0E1           MOV      R0,R5
   \   000000D8   ........           BL       WM_SetCapture
   \   000000DC   270000EA           B        ??MENU_Callback_2
   1570                }
   1571              } else {
   1572                _ReleaseCapture(hObj);
   \                     ??MENU_Callback_3:
   \   000000E0   ........           BL       WM_HasCaptured
   \   000000E4   000050E3           CMP      R0,#+0
   \   000000E8   2400000A           BEQ      ??MENU_Callback_2
   \   000000EC   0500A0E1           MOV      R0,R5
   \   000000F0   ........           BL       GUI_ALLOC_LockH
   \   000000F4   BC86D0E1           LDRH     R8,[R0, #+108]
   \   000000F8   ........           BL       GUI_ALLOC_UnlockH
   \   000000FC   0500A0E1           MOV      R0,R5
   \   00000100   ........           BL       GUI_ALLOC_LockH
   \   00000104   689090E5           LDR      R9,[R0, #+104]
   \   00000108   ........           BL       GUI_ALLOC_UnlockH
   \   0000010C   04008DE2           ADD      R0,SP,#+4
   \   00000110   0010A0E3           MOV      R1,#+0
   \   00000114   0020A0E3           MOV      R2,#+0
   \   00000118   0030A0E3           MOV      R3,#+0
   \   0000011C   00C0A0E3           MOV      R12,#+0
   \   00000120   0E10A0E8           STM      R0!,{R1-R3,R12}
   \   00000124   0510A0E3           MOV      R1,#+5
   \   00000128   B010CDE1           STRH     R1,[SP, #+0]
   \   0000012C   2C10A0E3           MOV      R1,#+44
   \   00000130   B220CDE1           STRH     R2,[SP, #+2]
   \   00000134   04108DE5           STR      R1,[SP, #+4]
   \   00000138   10D08DE5           STR      SP,[SP, #+16]
   \   0000013C   0C508DE5           STR      R5,[SP, #+12]
   \   00000140   000059E3           CMP      R9,#+0
   \   00000144   0200001A           BNE      ??MENU_Callback_4
   \   00000148   0500A0E1           MOV      R0,R5
   \   0000014C   ........           BL       WM_GetParent
   \   00000150   0090A0E1           MOV      R9,R0
   \                     ??MENU_Callback_4:
   \   00000154   000059E3           CMP      R9,#+0
   \   00000158   0500000A           BEQ      ??MENU_Callback_5
   \   0000015C   04108DE2           ADD      R1,SP,#+4
   \   00000160   0900A0E1           MOV      R0,R9
   \   00000164   ........           BL       WM__SendMessage
   \   00000168   10009DE5           LDR      R0,[SP, #+16]
   \   0000016C   000050E3           CMP      R0,#+0
   \   00000170   0200001A           BNE      ??MENU_Callback_2
   \                     ??MENU_Callback_5:
   \   00000174   800018E3           TST      R8,#0x80
   \   00000178   0000001A           BNE      ??MENU_Callback_2
   \   0000017C   ........           BL       WM_ReleaseCapture
   1573              }
   1574            }
   1575            /* Return if message already has been processed */
   1576            if (!Result) {
   \                     ??MENU_Callback_2:
   \   00000180   000056E3           CMP      R6,#+0
   \   00000184   6600000A           BEQ      ??MENU_Callback_6
   1577              return;
   1578            }
   1579            switch (pMsg->MsgId) {
   \   00000188   000094E5           LDR      R0,[R4, #+0]
   \   0000018C   0B0040E2           SUB      R0,R0,#+11
   \   00000190   210050E3           CMP      R0,#+33
   \   00000194   00F18F90           ADDLS    PC,PC,R0, LSL #+2
   \                     ??MENU_Callback_0:
   \   00000198   5F00008A           BHI      ??MENU_Callback_7
   \   0000019C   5C0000EA           B        ??MENU_Callback_8
   \   000001A0   270000EA           B        ??MENU_Callback_9
   \   000001A4   5C0000EA           B        ??MENU_Callback_7
   \   000001A8   4C0000EA           B        ??MENU_Callback_10
   \   000001AC   550000EA           B        ??MENU_Callback_11
   \   000001B0   3C0000EA           B        ??MENU_Callback_12
   \   000001B4   1A0000EA           B        ??MENU_Callback_13
   \   000001B8   570000EA           B        ??MENU_Callback_7
   \   000001BC   560000EA           B        ??MENU_Callback_7
   \   000001C0   550000EA           B        ??MENU_Callback_7
   \   000001C4   540000EA           B        ??MENU_Callback_7
   \   000001C8   530000EA           B        ??MENU_Callback_7
   \   000001CC   520000EA           B        ??MENU_Callback_7
   \   000001D0   510000EA           B        ??MENU_Callback_7
   \   000001D4   500000EA           B        ??MENU_Callback_7
   \   000001D8   4F0000EA           B        ??MENU_Callback_7
   \   000001DC   4E0000EA           B        ??MENU_Callback_7
   \   000001E0   4D0000EA           B        ??MENU_Callback_7
   \   000001E4   4C0000EA           B        ??MENU_Callback_7
   \   000001E8   4B0000EA           B        ??MENU_Callback_7
   \   000001EC   4A0000EA           B        ??MENU_Callback_7
   \   000001F0   490000EA           B        ??MENU_Callback_7
   \   000001F4   480000EA           B        ??MENU_Callback_7
   \   000001F8   470000EA           B        ??MENU_Callback_7
   \   000001FC   460000EA           B        ??MENU_Callback_7
   \   00000200   450000EA           B        ??MENU_Callback_7
   \   00000204   440000EA           B        ??MENU_Callback_7
   \   00000208   430000EA           B        ??MENU_Callback_7
   \   0000020C   420000EA           B        ??MENU_Callback_7
   \   00000210   410000EA           B        ??MENU_Callback_7
   \   00000214   400000EA           B        ??MENU_Callback_7
   \   00000218   3F0000EA           B        ??MENU_Callback_7
   \   0000021C   3E0000EA           B        ??MENU_Callback_7
   \   00000220   030000EA           B        ??MENU_Callback_14
   1580            case WM_PID_STATE_CHANGED:
   1581              _ForwardPIDStateChange(hObj, pMsg);
   \                     ??MENU_Callback_13:
   \   00000224   0410A0E1           MOV      R1,R4
   \   00000228   0500A0E1           MOV      R0,R5
   \   0000022C   ........           BL       _ForwardPIDStateChange
   1582              break;
   \   00000230   390000EA           B        ??MENU_Callback_7
   1583            case WM_MENU:
   1584              _OnMenu(hObj, pMsg);
   \                     ??MENU_Callback_14:
   \   00000234   0410A0E1           MOV      R1,R4
   \   00000238   0500A0E1           MOV      R0,R5
   \   0000023C   ........           BL       _OnMenu
   1585              return;     /* Message handled, do not call WM_DefaultProc() here. */
   \   00000240   370000EA           B        ??MENU_Callback_6
   1586            case WM_TOUCH:
   1587              #if GUI_NUM_LAYERS > 1
   1588                WM__SelectTopLevelLayer(hObj);
   \                     ??MENU_Callback_9:
   \   00000244   0500A0E1           MOV      R0,R5
   \   00000248   ........           BL       WM__SelectTopLevelLayer
   1589              #endif
   1590              if (_OnTouch(hObj, pMsg)) {
   \   0000024C   0C0094E5           LDR      R0,[R4, #+12]
   \   00000250   000050E3           CMP      R0,#+0
   \   00000254   0300001A           BNE      ??MENU_Callback_15
   \   00000258   0030E0E3           MVN      R3,#+0
   \   0000025C   0320A0E1           MOV      R2,R3
   \   00000260   0210A0E1           MOV      R1,R2
   \   00000264   020000EA           B        ??MENU_Callback_16
   \                     ??MENU_Callback_15:
   \   00000268   0830D0E5           LDRB     R3,[R0, #+8]
   \   0000026C   042090E5           LDR      R2,[R0, #+4]
   \   00000270   001090E5           LDR      R1,[R0, #+0]
   \                     ??MENU_Callback_16:
   \   00000274   0500A0E1           MOV      R0,R5
   \   00000278   ........           BL       _HandlePID
   \   0000027C   000050E3           CMP      R0,#+0
   \   00000280   2500000A           BEQ      ??MENU_Callback_7
   1591                if (_ForwardPIDMsgToOwner(hObj, pMsg)) {
   \   00000284   0410A0E1           MOV      R1,R4
   \   00000288   0500A0E1           MOV      R0,R5
   \   0000028C   ........           BL       _ForwardPIDMsgToOwner
   \   00000290   000050E3           CMP      R0,#+0
   \   00000294   2000000A           BEQ      ??MENU_Callback_7
   1592                  _ForwardPIDMsg(hObj, pMsg);
   \   00000298   0410A0E1           MOV      R1,R4
   \   0000029C   0500A0E1           MOV      R0,R5
   \   000002A0   ........           BL       _ForwardPIDMsg
   \   000002A4   1C0000EA           B        ??MENU_Callback_7
   1593                }
   1594              }
   1595              break;
   1596          #if (GUI_SUPPORT_MOUSE)
   1597            case WM_MOUSEOVER:
   1598              if (_OnMouseOver(hObj, pMsg)) {
   \                     ??MENU_Callback_12:
   \   000002A8   0C0094E5           LDR      R0,[R4, #+12]
   \   000002AC   000050E3           CMP      R0,#+0
   \   000002B0   1900000A           BEQ      ??MENU_Callback_7
   \   000002B4   042090E5           LDR      R2,[R0, #+4]
   \   000002B8   001090E5           LDR      R1,[R0, #+0]
   \   000002BC   0030E0E3           MVN      R3,#+0
   \   000002C0   0500A0E1           MOV      R0,R5
   \   000002C4   ........           BL       _HandlePID
   \   000002C8   000050E3           CMP      R0,#+0
   \   000002CC   1200000A           BEQ      ??MENU_Callback_7
   1599                _ForwardPIDMsgToOwner(hObj, pMsg);
   \   000002D0   0410A0E1           MOV      R1,R4
   \   000002D4   0500A0E1           MOV      R0,R5
   \   000002D8   ........           BL       _ForwardPIDMsgToOwner
   \   000002DC   0E0000EA           B        ??MENU_Callback_7
   1600              }
   1601              break;
   1602          #endif
   1603            case WM_KEY:
   1604              if (((const WM_KEY_INFO *)(pMsg->Data.p))->PressedCnt > 0) {
   \                     ??MENU_Callback_10:
   \   000002E0   0C0094E5           LDR      R0,[R4, #+12]
   \   000002E4   041090E5           LDR      R1,[R0, #+4]
   \   000002E8   010051E3           CMP      R1,#+1
   \   000002EC   0A0000BA           BLT      ??MENU_Callback_7
   1605                if (!_OnKey(hObj, ((const WM_KEY_INFO *)(pMsg->Data.p))->Key)) {
   \   000002F0   001090E5           LDR      R1,[R0, #+0]
   \   000002F4   0500A0E1           MOV      R0,R5
   \   000002F8   ........           BL       _OnKey
   \   000002FC   000050E3           CMP      R0,#+0
   \   00000300   0500001A           BNE      ??MENU_Callback_7
   \   00000304   060000EA           B        ??MENU_Callback_6
   1606                  return;
   1607                }
   1608              }
   1609              break;
   1610            case WM_PAINT:
   1611              _OnPaint(hObj);
   \                     ??MENU_Callback_11:
   \   00000308   0500A0E1           MOV      R0,R5
   \   0000030C   ........           BL       _OnPaint
   1612              break;
   \   00000310   010000EA           B        ??MENU_Callback_7
   1613            case WM_DELETE:
   1614              GUI_ARRAY_Delete(ItemArray);
   \                     ??MENU_Callback_8:
   \   00000314   0700A0E1           MOV      R0,R7
   \   00000318   ........           BL       GUI_ARRAY_Delete
   1615              break;      /* No return here ... WM_DefaultProc needs to be called */
   1616            }
   1617            WM_DefaultProc(pMsg);
   \                     ??MENU_Callback_7:
   \   0000031C   0400A0E1           MOV      R0,R4
   \   00000320   ........           BL       WM_DefaultProc
   1618          }
   \                     ??MENU_Callback_6:
   \   00000324   18D08DE2           ADD      SP,SP,#+24       ;; stack cleaning
   \   00000328   F087BDE8           POP      {R4-R10,PC}      ;; return
   1619          
   1620          /*********************************************************************
   1621          *
   1622          *       Public code, Create
   1623          *
   1624          **********************************************************************
   1625          */
   1626          /*********************************************************************
   1627          *
   1628          *       MENU_CreateEx
   1629          */

   \                                 In section .text, align 4, keep-with-next
   1630          MENU_Handle MENU_CreateEx(int x0, int y0, int xSize, int ySize, WM_HWIN hParent, int WinFlags, int ExFlags, int Id) {
   \                     MENU_CreateEx:
   \   00000000   F04F2DE9           PUSH     {R4-R11,LR}
   \   00000004   14D04DE2           SUB      SP,SP,#+20
   \   00000008   0060A0E1           MOV      R6,R0
   \   0000000C   0170A0E1           MOV      R7,R1
   \   00000010   0240A0E1           MOV      R4,R2
   \   00000014   0350A0E1           MOV      R5,R3
   \   00000018   38A09DE5           LDR      R10,[SP, #+56]
   \   0000001C   3CB09DE5           LDR      R11,[SP, #+60]
   \   00000020   40809DE5           LDR      R8,[SP, #+64]
   \   00000024   44909DE5           LDR      R9,[SP, #+68]
   1631            MENU_Handle hObj;
   1632            /* Create the window */
   1633            WM_LOCK();
   \   00000028   ........           BL       GUI_Lock
   1634            hObj = WM_CreateWindowAsChild(x0, y0, xSize, ySize, hParent, WM_CF_SHOW | WM_CF_STAYONTOP | WinFlags, &MENU_Callback,
   1635                                          sizeof(MENU_Obj) - sizeof(WM_Obj));
   \   0000002C   5000A0E3           MOV      R0,#+80
   \   00000030   0C008DE5           STR      R0,[SP, #+12]
   \   00000034   ........           LDR      R0,??DataTable6_1
   \   00000038   00A08DE5           STR      R10,[SP, #+0]
   \   0000003C   08008DE5           STR      R0,[SP, #+8]
   \   00000040   0A008BE3           ORR      R0,R11,#0xA
   \   00000044   04008DE5           STR      R0,[SP, #+4]
   \   00000048   0530A0E1           MOV      R3,R5
   \   0000004C   0420A0E1           MOV      R2,R4
   \   00000050   0710A0E1           MOV      R1,R7
   \   00000054   0600A0E1           MOV      R0,R6
   \   00000058   ........           BL       WM_CreateWindowAsChild
   \   0000005C   0060B0E1           MOVS     R6,R0
   1636            if (hObj) {
   \   00000060   2600000A           BEQ      ??MENU_CreateEx_0
   1637              MENU_Obj * pObj;
   1638              GUI_ARRAY ItemArray;
   1639              ItemArray = GUI_ARRAY_Create();
   \   00000064   ........           BL       GUI_ARRAY_Create
   \   00000068   00A0B0E1           MOVS     R10,R0
   1640              if (ItemArray) {
   \   0000006C   0600A0E1           MOV      R0,R6
   \   00000070   2000000A           BEQ      ??MENU_CreateEx_1
   1641                pObj = (MENU_Obj *)GUI_LOCK_H(hObj);
   \   00000074   ........           BL       GUI_ALLOC_LockH
   \   00000078   0070A0E1           MOV      R7,R0
   1642                 /* Init sub-classes */
   1643                pObj->ItemArray = ItemArray;
   \   0000007C   64A087E5           STR      R10,[R7, #+100]
   1644                /* init widget specific variables */
   1645                WIDGET__Init(&pObj->Widget, Id, WIDGET_STATE_FOCUSSABLE);
   \   00000080   1020A0E3           MOV      R2,#+16
   \   00000084   0910A0E1           MOV      R1,R9
   \   00000088   ........           BL       WIDGET__Init
   1646                /* init member variables */
   1647                MENU_INIT_ID(pObj);
   1648                if (ExFlags & MENU_SF_OPEN_ON_POINTEROVER) {
   1649                  ExFlags |= MENU_SF_ACTIVE;
   1650                } else {
   1651                  ExFlags &= ~(MENU_SF_ACTIVE);
   1652                }
   1653                pObj->Props           = MENU__DefaultProps;
   \   0000008C   ........           LDR      R9,??DataTable6_2
   \   00000090   340087E2           ADD      R0,R7,#+52
   \   00000094   0E54B9E8           LDM      R9!,{R1-R3,R10,R12,LR}
   \   00000098   020018E3           TST      R8,#0x2
   \   0000009C   0E54A0E8           STM      R0!,{R1-R3,R10,R12,LR}
   \   000000A0   0E54B9E8           LDM      R9!,{R1-R3,R10,R12,LR}
   \   000000A4   40808813           ORRNE    R8,R8,#0x40
   \   000000A8   0E54A0E8           STM      R0!,{R1-R3,R10,R12,LR}
   \   000000AC   4080C803           BICEQ    R8,R8,#0x40
   1654                pObj->Flags           = ExFlags;
   1655                pObj->Width           = ((xSize > 0) ? xSize : 0);
   \   000000B0   010054E3           CMP      R4,#+1
   \   000000B4   0040A0B3           MOVLT    R4,#+0
   \   000000B8   BC86C7E1           STRH     R8,[R7, #+108]
   1656                pObj->Height          = ((ySize > 0) ? ySize : 0);
   \   000000BC   010055E3           CMP      R5,#+1
   \   000000C0   704087E5           STR      R4,[R7, #+112]
   \   000000C4   0050A0B3           MOVLT    R5,#+0
   \   000000C8   745087E5           STR      R5,[R7, #+116]
   1657                pObj->Sel             = -1;
   \   000000CC   0000E0E3           MVN      R0,#+0
   \   000000D0   780087E5           STR      R0,[R7, #+120]
   1658                pObj->hOwner          = 0;
   \   000000D4   0000A0E3           MOV      R0,#+0
   \   000000D8   680087E5           STR      R0,[R7, #+104]
   \   000000DC   309049E2           SUB      R9,R9,#+48
   1659                pObj->IsSubmenuActive = 0;
   \   000000E0   6E00C7E5           STRB     R0,[R7, #+110]
   1660                GUI_UNLOCK_H(pObj);
   \   000000E4   ........           BL       GUI_ALLOC_UnlockH
   1661                WIDGET_SetEffect(hObj, MENU__pDefaultEffect);
   \   000000E8   301099E5           LDR      R1,[R9, #+48]
   \   000000EC   0600A0E1           MOV      R0,R6
   \   000000F0   ........           BL       WIDGET_SetEffect
   \   000000F4   010000EA           B        ??MENU_CreateEx_0
   1662              } else {
   1663                WM_DeleteWindow(hObj);
   \                     ??MENU_CreateEx_1:
   \   000000F8   ........           BL       WM_DeleteWindow
   1664                hObj = 0;
   \   000000FC   0060A0E3           MOV      R6,#+0
   1665                GUI_DEBUG_ERROROUT_IF(hObj==0, "MENU_CreateEx failed")
   1666              }
   1667            } else {
   1668              GUI_DEBUG_ERROROUT_IF(hObj==0, "MENU_CreateEx failed")
   1669            }
   1670            WM_UNLOCK();
   \                     ??MENU_CreateEx_0:
   \   00000100   ........           BL       GUI_Unlock
   1671            return hObj;
   \   00000104   0600A0E1           MOV      R0,R6
   \   00000108   14D08DE2           ADD      SP,SP,#+20
   \   0000010C   F08FBDE8           POP      {R4-R11,PC}      ;; return
   1672          }
   1673          
   1674          /*********************************************************************
   1675          *
   1676          *       Public code, modul internal functions
   1677          *
   1678          **********************************************************************
   1679          */
   1680          /*********************************************************************
   1681          *
   1682          *       MENU__GetNumItems
   1683          */

   \                                 In section .text, align 4, keep-with-next
   1684          unsigned MENU__GetNumItems(MENU_Obj * pObj) {
   1685            return GUI_ARRAY_GetNumItems(pObj->ItemArray);
   \                     MENU__GetNumItems:
   \   00000000   640090E5           LDR      R0,[R0, #+100]
   \   00000004   ........           B        GUI_ARRAY_GetNumItems  ;; tailcall
   1686          }
   1687          
   1688          /*********************************************************************
   1689          *
   1690          *       MENU__InvalidateItem
   1691          */

   \                                 In section .text, align 4, keep-with-next
   1692          void MENU__InvalidateItem(MENU_Handle hObj, unsigned Index) {
   1693            GUI_USE_PARA(Index);
   1694            WM_InvalidateWindow(hObj);  /* Can be optimized, no need to invalidate all items */
   \                     MENU__InvalidateItem:
   \   00000000   ........           B        WM_InvalidateWindow  ;; tailcall
   1695          }
   1696          
   1697          /*********************************************************************
   1698          *
   1699          *       MENU__RecalcTextWidthOfItems
   1700          */

   \                                 In section .text, align 4, keep-with-next
   1701          void MENU__RecalcTextWidthOfItems(MENU_Obj * pObj) {
   \                     MENU__RecalcTextWidthOfItems:
   \   00000000   F0412DE9           PUSH     {R4-R8,LR}
   \   00000004   0040A0E1           MOV      R4,R0
   1702            const GUI_FONT GUI_UNI_PTR * pOldFont;
   1703            MENU_ITEM * pItem;
   1704            unsigned i, NumItems;
   1705            NumItems = MENU__GetNumItems(pObj);
   \   00000008   640094E5           LDR      R0,[R4, #+100]
   \   0000000C   ........           BL       GUI_ARRAY_GetNumItems
   \   00000010   0050A0E1           MOV      R5,R0
   1706            pOldFont  = GUI_SetFont(pObj->Props.pFont);
   \   00000014   600094E5           LDR      R0,[R4, #+96]
   \   00000018   ........           BL       GUI_SetFont
   \   0000001C   0060A0E1           MOV      R6,R0
   1707            for (i = 0; i < NumItems; i++) {
   \   00000020   0070A0E3           MOV      R7,#+0
   \   00000024   000055E3           CMP      R5,#+0
   \   00000028   0A00000A           BEQ      ??MENU__RecalcTextWidthOfItems_0
   1708              pItem = (MENU_ITEM *)GUI_ARRAY_GetpItemLocked(pObj->ItemArray, i);
   \                     ??MENU__RecalcTextWidthOfItems_1:
   \   0000002C   0710A0E1           MOV      R1,R7
   \   00000030   640094E5           LDR      R0,[R4, #+100]
   \   00000034   ........           BL       GUI_ARRAY_GetpItemLocked
   \   00000038   0080A0E1           MOV      R8,R0
   1709              pItem->TextWidth = GUI_GetStringDistX(pItem->acText);
   \   0000003C   0C0088E2           ADD      R0,R8,#+12
   \   00000040   ........           BL       GUI_GetStringDistX
   \   00000044   080088E5           STR      R0,[R8, #+8]
   1710              GUI_UNLOCK_H(pItem);
   \   00000048   ........           BL       GUI_ALLOC_UnlockH
   1711            }
   \   0000004C   017087E2           ADD      R7,R7,#+1
   \   00000050   050057E1           CMP      R7,R5
   \   00000054   F4FFFF3A           BCC      ??MENU__RecalcTextWidthOfItems_1
   1712            GUI_SetFont(pOldFont);
   \                     ??MENU__RecalcTextWidthOfItems_0:
   \   00000058   0600A0E1           MOV      R0,R6
   \   0000005C   F041BDE8           POP      {R4-R8,LR}
   \   00000060   ........           B        GUI_SetFont      ;; tailcall
   1713          }
   1714          
   1715          /*********************************************************************
   1716          *
   1717          *       MENU__ResizeMenu
   1718          */

   \                                 In section .text, align 4, keep-with-next
   1719          void MENU__ResizeMenu(MENU_Handle hObj) {
   \                     MENU__ResizeMenu:
   \   00000000   70402DE9           PUSH     {R4-R6,LR}
   \   00000004   0040A0E1           MOV      R4,R0
   1720            MENU_Obj * pObj;
   1721            int xSize, ySize;
   1722            pObj = MENU_LOCK_H(hObj);
   \   00000008   ........           BL       GUI_ALLOC_LockH
   \   0000000C   0050A0E1           MOV      R5,R0
   1723            xSize = _CalcWindowSizeX(hObj, pObj);
   \   00000010   706095E5           LDR      R6,[R5, #+112]
   \   00000014   000056E3           CMP      R6,#+0
   \   00000018   0200001A           BNE      ??MENU__ResizeMenu_0
   \   0000001C   0400A0E1           MOV      R0,R4
   \   00000020   ........           BL       _CalcMenuSizeX
   \   00000024   0060A0E1           MOV      R6,R0
   1724            ySize = _CalcWindowSizeY(hObj, pObj);
   \                     ??MENU__ResizeMenu_0:
   \   00000028   745095E5           LDR      R5,[R5, #+116]
   \   0000002C   000055E3           CMP      R5,#+0
   \   00000030   0200001A           BNE      ??MENU__ResizeMenu_1
   \   00000034   0400A0E1           MOV      R0,R4
   \   00000038   ........           BL       _CalcMenuSizeY
   \   0000003C   0050A0E1           MOV      R5,R0
   1725            GUI_UNLOCK_H(pObj);
   \                     ??MENU__ResizeMenu_1:
   \   00000040   ........           BL       GUI_ALLOC_UnlockH
   1726            WM_SetSize(hObj, xSize, ySize);
   \   00000044   0520A0E1           MOV      R2,R5
   \   00000048   0610A0E1           MOV      R1,R6
   \   0000004C   0400A0E1           MOV      R0,R4
   \   00000050   ........           BL       WM_SetSize
   1727            WM_InvalidateWindow(hObj);
   \   00000054   0400A0E1           MOV      R0,R4
   \   00000058   7040BDE8           POP      {R4-R6,LR}
   \   0000005C   ........           B        WM_InvalidateWindow  ;; tailcall
   1728          }
   1729          
   1730          /*********************************************************************
   1731          *
   1732          *       MENU__SetItem
   1733          */

   \                                 In section .text, align 4, keep-with-next
   1734          char MENU__SetItem(MENU_Handle hObj, unsigned Index, const MENU_ITEM_DATA * pItemData) {
   \                     MENU__SetItem:
   \   00000000   F0472DE9           PUSH     {R4-R10,LR}
   \   00000004   10D04DE2           SUB      SP,SP,#+16
   \   00000008   0040A0E1           MOV      R4,R0
   \   0000000C   0160A0E1           MOV      R6,R1
   \   00000010   0280A0E1           MOV      R8,R2
   1735            MENU_Obj * pObj;
   1736            GUI_ARRAY ItemArray;
   1737            MENU_ITEM Item = {0};
   \   00000014   0D00A0E1           MOV      R0,SP
   \   00000018   0010A0E3           MOV      R1,#+0
   \   0000001C   0020A0E3           MOV      R2,#+0
   \   00000020   0030A0E3           MOV      R3,#+0
   \   00000024   00C0A0E3           MOV      R12,#+0
   \   00000028   0E10A0E8           STM      R0!,{R1-R3,R12}
   1738            const char * pText;
   1739            char r = 0;
   1740            pText = pItemData->pText;
   \   0000002C   005098E5           LDR      R5,[R8, #+0]
   \   00000030   0070A0E3           MOV      R7,#+0
   1741            if (!pText) {
   \   00000034   000055E3           CMP      R5,#+0
   1742              pText = "";
   \   00000038   ........           ADREQ    R5,??DataTable6  ;; ""
   1743            }
   1744            pObj = MENU_LOCK_H(hObj);
   \   0000003C   0400A0E1           MOV      R0,R4
   \   00000040   ........           BL       GUI_ALLOC_LockH
   1745            Item.Id        = pItemData->Id;
   \   00000044   B410D8E1           LDRH     R1,[R8, #+4]
   \   00000048   0090A0E1           MOV      R9,R0
   1746            Item.Flags     = pItemData->Flags;
   1747            Item.hSubmenu  = pItemData->hSubmenu;
   1748            Item.TextWidth = _CalcTextWidth(pObj, pText);
   \   0000004C   000055E3           CMP      R5,#+0
   \   00000050   B410CDE1           STRH     R1,[SP, #+4]
   \   00000054   B610D8E1           LDRH     R1,[R8, #+6]
   \   00000058   B610CDE1           STRH     R1,[SP, #+6]
   \   0000005C   080098E5           LDR      R0,[R8, #+8]
   \   00000060   0080A0E3           MOV      R8,#+0
   \   00000064   00008DE5           STR      R0,[SP, #+0]
   \   00000068   0700000A           BEQ      ??MENU__SetItem_0
   \   0000006C   600099E5           LDR      R0,[R9, #+96]
   \   00000070   ........           BL       GUI_SetFont
   \   00000074   00A0A0E1           MOV      R10,R0
   \   00000078   0500A0E1           MOV      R0,R5
   \   0000007C   ........           BL       GUI_GetStringDistX
   \   00000080   0080A0E1           MOV      R8,R0
   \   00000084   0A00A0E1           MOV      R0,R10
   \   00000088   ........           BL       GUI_SetFont
   \                     ??MENU__SetItem_0:
   \   0000008C   08808DE5           STR      R8,[SP, #+8]
   1749            ItemArray      = pObj->ItemArray;
   \   00000090   648099E5           LDR      R8,[R9, #+100]
   1750            GUI_UNLOCK_H(pObj);
   \   00000094   ........           BL       GUI_ALLOC_UnlockH
   1751            if (Item.Flags & MENU_IF_SEPARATOR) {
   \   00000098   0600DDE5           LDRB     R0,[SP, #+6]
   \   0000009C   020010E3           TST      R0,#0x2
   1752              Item.hSubmenu = 0;   /* Ensures that no separator is a submenu */
   \   000000A0   00708D15           STRNE    R7,[SP, #+0]
   1753            }
   1754            if (GUI_ARRAY_SetItem(ItemArray, Index, &Item, sizeof(MENU_ITEM) + strlen(pText)) != 0) {
   \   000000A4   0500A0E1           MOV      R0,R5
   \   000000A8   ........           BL       strlen
   \   000000AC   103080E2           ADD      R3,R0,#+16
   \   000000B0   0D20A0E1           MOV      R2,SP
   \   000000B4   0610A0E1           MOV      R1,R6
   \   000000B8   0800A0E1           MOV      R0,R8
   \   000000BC   ........           BL       GUI_ARRAY_SetItem
   \   000000C0   000050E3           CMP      R0,#+0
   \   000000C4   1300000A           BEQ      ??MENU__SetItem_1
   1755              MENU_ITEM * pItem;
   1756              pItem = (MENU_ITEM *)GUI_ARRAY_GetpItemLocked(ItemArray, Index);
   \   000000C8   0610A0E1           MOV      R1,R6
   \   000000CC   0800A0E1           MOV      R0,R8
   \   000000D0   ........           BL       GUI_ARRAY_GetpItemLocked
   1757              strcpy(pItem->acText, pText);
   \   000000D4   0510A0E1           MOV      R1,R5
   \   000000D8   0C0080E2           ADD      R0,R0,#+12
   \   000000DC   ........           BL       strcpy
   1758              GUI_UNLOCK_H(pItem);
   \   000000E0   ........           BL       GUI_ALLOC_UnlockH
   1759              MENU_SetOwner(Item.hSubmenu, hObj);
   \   000000E4   00509DE5           LDR      R5,[SP, #+0]
   \   000000E8   000055E3           CMP      R5,#+0
   \   000000EC   0600000A           BEQ      ??MENU__SetItem_2
   \   000000F0   ........           BL       GUI_Lock
   \   000000F4   0500A0E1           MOV      R0,R5
   \   000000F8   ........           BL       GUI_ALLOC_LockH
   \   000000FC   000050E3           CMP      R0,#+0
   \   00000100   68408015           STRNE    R4,[R0, #+104]
   \   00000104   ........           BL       GUI_ALLOC_UnlockH
   \   00000108   ........           BL       GUI_Unlock
   1760              WM_DetachWindow(Item.hSubmenu);   /* Ensures all submenus are initially closed */
   \                     ??MENU__SetItem_2:
   \   0000010C   00009DE5           LDR      R0,[SP, #+0]
   \   00000110   ........           BL       WM_DetachWindow
   1761              r = 1;
   \   00000114   0170A0E3           MOV      R7,#+1
   1762            }
   1763            return r;
   \                     ??MENU__SetItem_1:
   \   00000118   0700A0E1           MOV      R0,R7
   \   0000011C   10D08DE2           ADD      SP,SP,#+16
   \   00000120   F087BDE8           POP      {R4-R10,PC}      ;; return
   1764          }
   1765          
   1766          /*********************************************************************
   1767          *
   1768          *       MENU__SetItemFlags
   1769          */

   \                                 In section .text, align 4, keep-with-next
   1770          void MENU__SetItemFlags(MENU_Obj * pObj, unsigned Index, U16 Mask, U16 Flags) {
   \                     MENU__SetItemFlags:
   \   00000000   30402DE9           PUSH     {R4,R5,LR}
   \   00000004   04D04DE2           SUB      SP,SP,#+4
   \   00000008   0240A0E1           MOV      R4,R2
   \   0000000C   0350A0E1           MOV      R5,R3
   1771            MENU_ITEM * pItem = (MENU_ITEM *)GUI_ARRAY_GetpItemLocked(pObj->ItemArray, Index);
   \   00000010   640090E5           LDR      R0,[R0, #+100]
   \   00000014   ........           BL       GUI_ARRAY_GetpItemLocked
   1772            pItem->Flags &= ~(int)Mask;
   1773            pItem->Flags |= Flags;
   \   00000018   B610D0E1           LDRH     R1,[R0, #+6]
   1774            GUI_UNLOCK_H(pItem);
   \   0000001C   04D08DE2           ADD      SP,SP,#+4
   \   00000020   0410C1E1           BIC      R1,R1,R4
   \   00000024   011085E1           ORR      R1,R5,R1
   \   00000028   B610C0E1           STRH     R1,[R0, #+6]
   \   0000002C   3040BDE8           POP      {R4,R5,LR}
   \   00000030   ........           B        GUI_ALLOC_UnlockH  ;; tailcall
   1775          }
   1776          
   1777          /*********************************************************************
   1778          *
   1779          *       MENU__SendMenuMessage
   1780          */

   \                                 In section .text, align 4, keep-with-next
   1781          int MENU__SendMenuMessage(MENU_Handle hObj, WM_HWIN hDestWin, U16 MsgType, U16 ItemId) {
   \                     MENU__SendMenuMessage:
   \   00000000   70402DE9           PUSH     {R4-R6,LR}
   1782            MENU_MSG_DATA MsgData;
   1783            WM_MESSAGE    Msg = {0};
   \   00000004   00E0A0E3           MOV      LR,#+0
   \   00000008   18D04DE2           SUB      SP,SP,#+24
   \   0000000C   01C0B0E1           MOVS     R12,R1
   \   00000010   0E40A0E1           MOV      R4,LR
   \   00000014   04108DE2           ADD      R1,SP,#+4
   \   00000018   0450A0E1           MOV      R5,R4
   \   0000001C   0460A0E1           MOV      R6,R4
   \   00000020   7040A1E8           STM      R1!,{R4-R6,LR}
   1784            MsgData.MsgType   = MsgType;
   \   00000024   B020CDE1           STRH     R2,[SP, #+0]
   1785            MsgData.ItemId    = ItemId;
   1786            Msg.MsgId         = WM_MENU;
   \   00000028   2C20A0E3           MOV      R2,#+44
   \   0000002C   B230CDE1           STRH     R3,[SP, #+2]
   \   00000030   04208DE5           STR      R2,[SP, #+4]
   1787            Msg.Data.p        = &MsgData;
   \   00000034   10D08DE5           STR      SP,[SP, #+16]
   1788            Msg.hWinSrc       = hObj;
   \   00000038   0C008DE5           STR      R0,[SP, #+12]
   1789            if (!hDestWin) {
   \   0000003C   0100001A           BNE      ??MENU__SendMenuMessage_0
   1790              hDestWin = WM_GetParent(hObj);
   \   00000040   ........           BL       WM_GetParent
   \   00000044   00C0A0E1           MOV      R12,R0
   1791            }
   1792            if (hDestWin) {
   \                     ??MENU__SendMenuMessage_0:
   \   00000048   00005CE3           CMP      R12,#+0
   \   0000004C   0400000A           BEQ      ??MENU__SendMenuMessage_1
   1793              WM__SendMessage(hDestWin, &Msg);
   \   00000050   04108DE2           ADD      R1,SP,#+4
   \   00000054   0C00A0E1           MOV      R0,R12
   \   00000058   ........           BL       WM__SendMessage
   1794              return Msg.Data.v;
   \   0000005C   10009DE5           LDR      R0,[SP, #+16]
   \   00000060   000000EA           B        ??MENU__SendMenuMessage_2
   1795            }
   1796            return 0;
   \                     ??MENU__SendMenuMessage_1:
   \   00000064   0000A0E3           MOV      R0,#+0
   \                     ??MENU__SendMenuMessage_2:
   \   00000068   18D08DE2           ADD      SP,SP,#+24       ;; stack cleaning
   \   0000006C   7080BDE8           POP      {R4-R6,PC}       ;; return
   1797          }
   1798          
   1799          /*********************************************************************
   1800          *
   1801          *       Public code, member functions
   1802          *
   1803          **********************************************************************
   1804          */
   1805          /*********************************************************************
   1806          *
   1807          *       MENU_AddItem
   1808          */

   \                                 In section .text, align 4, keep-with-next
   1809          void MENU_AddItem(MENU_Handle hObj, const MENU_ITEM_DATA * pItemData) {
   \                     MENU_AddItem:
   \   00000000   F0402DE9           PUSH     {R4-R7,LR}
   \   00000004   0040A0E1           MOV      R4,R0
   \   00000008   0150A0E1           MOV      R5,R1
   1810            if (hObj && pItemData) {
   \   0000000C   000054E3           CMP      R4,#+0
   \   00000010   04D04DE2           SUB      SP,SP,#+4
   \   00000014   00005513           CMPNE    R5,#+0
   \   00000018   2E00000A           BEQ      ??MENU_AddItem_0
   1811              MENU_Obj * pObj;
   1812              GUI_ARRAY ItemArray;
   1813              WM_LOCK();
   \   0000001C   ........           BL       GUI_Lock
   1814              pObj = MENU_LOCK_H(hObj);
   1815              ItemArray = pObj->ItemArray;
   \   00000020   0400A0E1           MOV      R0,R4
   \   00000024   ........           BL       GUI_ALLOC_LockH
   \   00000028   646090E5           LDR      R6,[R0, #+100]
   1816              GUI_UNLOCK_H(pObj);
   \   0000002C   ........           BL       GUI_ALLOC_UnlockH
   1817              if (GUI_ARRAY_AddItem(ItemArray, NULL, 0) == 0) {
   \   00000030   0020A0E3           MOV      R2,#+0
   \   00000034   0010A0E3           MOV      R1,#+0
   \   00000038   0600A0E1           MOV      R0,R6
   \   0000003C   ........           BL       GUI_ARRAY_AddItem
   \   00000040   000050E3           CMP      R0,#+0
   \   00000044   2200001A           BNE      ??MENU_AddItem_1
   1818                unsigned Index;
   1819                Index = GUI_ARRAY_GetNumItems(ItemArray) - 1;
   \   00000048   0600A0E1           MOV      R0,R6
   \   0000004C   ........           BL       GUI_ARRAY_GetNumItems
   \   00000050   017040E2           SUB      R7,R0,#+1
   1820                if (MENU__SetItem(hObj, Index, pItemData) == 0) {
   \   00000054   0520A0E1           MOV      R2,R5
   \   00000058   0710A0E1           MOV      R1,R7
   \   0000005C   0400A0E1           MOV      R0,R4
   \   00000060   ........           BL       MENU__SetItem
   \   00000064   000050E3           CMP      R0,#+0
   \   00000068   0300001A           BNE      ??MENU_AddItem_2
   1821                  GUI_ARRAY_DeleteItem(ItemArray, Index);
   \   0000006C   0710A0E1           MOV      R1,R7
   \   00000070   0600A0E1           MOV      R0,R6
   \   00000074   ........           BL       GUI_ARRAY_DeleteItem
   \   00000078   150000EA           B        ??MENU_AddItem_1
   1822                } else {
   1823                  MENU__ResizeMenu(hObj);
   \                     ??MENU_AddItem_2:
   \   0000007C   0400A0E1           MOV      R0,R4
   \   00000080   ........           BL       GUI_ALLOC_LockH
   \   00000084   0050A0E1           MOV      R5,R0
   \   00000088   706095E5           LDR      R6,[R5, #+112]
   \   0000008C   000056E3           CMP      R6,#+0
   \   00000090   0200001A           BNE      ??MENU_AddItem_3
   \   00000094   0400A0E1           MOV      R0,R4
   \   00000098   ........           BL       _CalcMenuSizeX
   \   0000009C   0060A0E1           MOV      R6,R0
   \                     ??MENU_AddItem_3:
   \   000000A0   745095E5           LDR      R5,[R5, #+116]
   \   000000A4   000055E3           CMP      R5,#+0
   \   000000A8   0200001A           BNE      ??MENU_AddItem_4
   \   000000AC   0400A0E1           MOV      R0,R4
   \   000000B0   ........           BL       _CalcMenuSizeY
   \   000000B4   0050A0E1           MOV      R5,R0
   \                     ??MENU_AddItem_4:
   \   000000B8   ........           BL       GUI_ALLOC_UnlockH
   \   000000BC   0520A0E1           MOV      R2,R5
   \   000000C0   0610A0E1           MOV      R1,R6
   \   000000C4   0400A0E1           MOV      R0,R4
   \   000000C8   ........           BL       WM_SetSize
   \   000000CC   0400A0E1           MOV      R0,R4
   \   000000D0   ........           BL       WM_InvalidateWindow
   1824                }
   1825              }
   1826              WM_UNLOCK();
   \                     ??MENU_AddItem_1:
   \   000000D4   ........           BL       GUI_Unlock
   1827            }
   1828          }
   \                     ??MENU_AddItem_0:
   \   000000D8   04D08DE2           ADD      SP,SP,#+4        ;; stack cleaning
   \   000000DC   F080BDE8           POP      {R4-R7,PC}       ;; return
   1829          
   1830          /*********************************************************************
   1831          *
   1832          *       MENU_SetOwner
   1833          */

   \                                 In section .text, align 4, keep-with-next
   1834          void MENU_SetOwner(MENU_Handle hObj, WM_HWIN hOwner) {
   \                     MENU_SetOwner:
   \   00000000   30402DE9           PUSH     {R4,R5,LR}
   \   00000004   0040A0E1           MOV      R4,R0
   \   00000008   04D04DE2           SUB      SP,SP,#+4
   \   0000000C   0150A0E1           MOV      R5,R1
   1835            if (hObj) {
   \   00000010   000054E3           CMP      R4,#+0
   \   00000014   0600000A           BEQ      ??MENU_SetOwner_0
   1836              MENU_Obj * pObj;
   1837              WM_LOCK();
   \   00000018   ........           BL       GUI_Lock
   1838              pObj = MENU_LOCK_H(hObj);
   \   0000001C   0400A0E1           MOV      R0,R4
   \   00000020   ........           BL       GUI_ALLOC_LockH
   1839              if (pObj) {
   \   00000024   000050E3           CMP      R0,#+0
   1840                pObj->hOwner = hOwner;
   \   00000028   68508015           STRNE    R5,[R0, #+104]
   1841              }
   1842              GUI_UNLOCK_H(pObj);
   \   0000002C   ........           BL       GUI_ALLOC_UnlockH
   1843              WM_UNLOCK();
   \   00000030   ........           BL       GUI_Unlock
   1844            }
   1845          }
   \                     ??MENU_SetOwner_0:
   \   00000034   04D08DE2           ADD      SP,SP,#+4        ;; stack cleaning
   \   00000038   3080BDE8           POP      {R4,R5,PC}       ;; return
   1846          
   1847          /*********************************************************************
   1848          *
   1849          *       MENU_SetSel
   1850          */

   \                                 In section .text, align 4, keep-with-next
   1851          int MENU_SetSel(MENU_Handle hObj, int Sel) {
   \                     MENU_SetSel:
   \   00000000   F0402DE9           PUSH     {R4-R7,LR}
   \   00000004   0040A0E1           MOV      R4,R0
   \   00000008   04D04DE2           SUB      SP,SP,#+4
   \   0000000C   0150A0E1           MOV      R5,R1
   1852            int OldSel;
   1853            OldSel = 0;
   \   00000010   0060A0E3           MOV      R6,#+0
   1854            if (hObj) {
   \   00000014   000054E3           CMP      R4,#+0
   \   00000018   0E00000A           BEQ      ??MENU_SetSel_0
   1855              MENU_Obj * pObj;
   1856              WM_LOCK();
   \   0000001C   ........           BL       GUI_Lock
   1857              pObj = MENU_LOCK_H(hObj);
   \   00000020   0400A0E1           MOV      R0,R4
   \   00000024   ........           BL       GUI_ALLOC_LockH
   \   00000028   0070B0E1           MOVS     R7,R0
   1858              if (pObj) {
   \   0000002C   0700000A           BEQ      ??MENU_SetSel_1
   1859                int NumItems;
   1860                OldSel = pObj->Sel;
   \   00000030   786097E5           LDR      R6,[R7, #+120]
   1861                NumItems = GUI_ARRAY_GetNumItems(pObj->ItemArray);
   1862                if (Sel < NumItems) {
   \   00000034   640097E5           LDR      R0,[R7, #+100]
   \   00000038   ........           BL       GUI_ARRAY_GetNumItems
   \   0000003C   000055E1           CMP      R5,R0
   \   00000040   020000AA           BGE      ??MENU_SetSel_1
   1863                  pObj->Sel = Sel;
   \   00000044   785087E5           STR      R5,[R7, #+120]
   1864                  WM_InvalidateWindow(hObj);
   \   00000048   0400A0E1           MOV      R0,R4
   \   0000004C   ........           BL       WM_InvalidateWindow
   1865                }
   1866              }
   1867              GUI_UNLOCK_H(pObj);
   \                     ??MENU_SetSel_1:
   \   00000050   ........           BL       GUI_ALLOC_UnlockH
   1868              WM_UNLOCK();
   \   00000054   ........           BL       GUI_Unlock
   1869            }
   1870            return OldSel;
   \                     ??MENU_SetSel_0:
   \   00000058   0600A0E1           MOV      R0,R6
   \   0000005C   04D08DE2           ADD      SP,SP,#+4
   \   00000060   F080BDE8           POP      {R4-R7,PC}       ;; return
   1871          }
   1872          
   1873          /*********************************************************************
   1874          *
   1875          *       MENU_GetOwner
   1876          */

   \                                 In section .text, align 4, keep-with-next
   1877          WM_HWIN MENU_GetOwner(MENU_Handle hObj) {
   \                     MENU_GetOwner:
   \   00000000   30402DE9           PUSH     {R4,R5,LR}
   \   00000004   04D04DE2           SUB      SP,SP,#+4
   \   00000008   0040B0E1           MOVS     R4,R0
   1878            WM_HWIN hOwner = 0;
   \   0000000C   0050A0E3           MOV      R5,#+0
   1879            if (hObj) {
   \   00000010   0C00000A           BEQ      ??MENU_GetOwner_0
   1880              MENU_Obj * pObj;
   1881              WM_LOCK();
   \   00000014   ........           BL       GUI_Lock
   1882              pObj = MENU_LOCK_H(hObj);
   \   00000018   0400A0E1           MOV      R0,R4
   \   0000001C   ........           BL       GUI_ALLOC_LockH
   1883              if (pObj) {
   \   00000020   000050E3           CMP      R0,#+0
   \   00000024   0500000A           BEQ      ??MENU_GetOwner_1
   1884                hOwner = pObj->hOwner ? pObj->hOwner : WM_GetParent(hObj);
   \   00000028   685090E5           LDR      R5,[R0, #+104]
   \   0000002C   000055E3           CMP      R5,#+0
   \   00000030   0200001A           BNE      ??MENU_GetOwner_1
   \   00000034   0400A0E1           MOV      R0,R4
   \   00000038   ........           BL       WM_GetParent
   \   0000003C   0050A0E1           MOV      R5,R0
   1885              }
   1886              GUI_UNLOCK_H(pObj);
   \                     ??MENU_GetOwner_1:
   \   00000040   ........           BL       GUI_ALLOC_UnlockH
   1887              WM_UNLOCK();
   \   00000044   ........           BL       GUI_Unlock
   1888            }
   1889            return hOwner;
   \                     ??MENU_GetOwner_0:
   \   00000048   0500A0E1           MOV      R0,R5
   \   0000004C   04D08DE2           ADD      SP,SP,#+4
   \   00000050   3080BDE8           POP      {R4,R5,PC}       ;; return
   1890          }

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4:
   \   00000000   ........           DC32     WM__TouchedLayer

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable5:
   \   00000000   7C7C7C00           DC32     0x7c7c7c

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable6:
   \   00000000   00000000           DC8      "",0x0,0x0,0x0

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable6_1:
   \   00000000   ........           DC32     MENU_Callback

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable6_2:
   \   00000000   ........           DC32     MENU__DefaultProps

   \                                 In section .rodata, align 4, keep-with-next
   \                     `?<Constant {0L}>`:
   \   00000000                      ; Initializer data, 16 bytes
   \   00000000   00000000           DC32 0
   \   00000004   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              00000000    
   \   0000000E   0000               DC8 0, 0

   \                                 In section .rodata, align 1, keep-with-next
   \                     `?<Constant "">`:
   \   00000000                      ; Initializer data, 1 bytes
   \   00000000   00                 DC8 0

   \                                 In section .text, align 4, keep-with-next
   \                     `?<Constant {0}>`:
   \   00000000                      ; Initializer data, 16 bytes
   \   00000000   00000000           DC32 0
   \   00000004   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              00000000    
   \   0000000E   0000               DC8 0, 0
   1891          
   1892          #else  /* avoid empty object files */
   1893            void Menu_C(void);
   1894            void Menu_C(void) {}
   1895          #endif
   1896          
   1897          /*************************** End of file ****************************/

   Maximum stack usage in bytes:

     Function                     .cstack
     --------                     -------
     MENU_AddItem                     24
     MENU_Callback                    56
     MENU_CreateEx                    56
     MENU_GetOwner                    16
     MENU_SetOwner                    16
     MENU_SetSel                      24
     MENU__GetNumItems                 8
     MENU__InvalidateItem              8
     MENU__RecalcTextWidthOfItems     24
     MENU__ResizeMenu                 16
     MENU__SendMenuMessage            40
     MENU__SetItem                    48
     MENU__SetItemFlags               16
     _ActivateItem                    48
     _ActivateMenu                    32
     _CalcMenuSizeX                   56
     _CalcMenuSizeY                   56
     _CloseSubmenu                    48
     _DeselectItem                    40
     _ForwardMouseOverMsg             56
     _ForwardPIDMsg                   40
     _ForwardPIDMsgToOwner            48
     _ForwardPIDStateChange           64
     _GetItemFromPos                  64
     _GetItemHeight                   48
     _GetItemPos                      64
     _GetItemWidth                    48
     _GetTopLevelMenu                 56
     _HandlePID                       80
     _OnKey                           80
     _OnMenu                          24
     _OnPaint                         96
     _OpenSubmenu                     80
     _SetSelectionEx                  56


   Section sizes:

     Function/Label               Bytes
     --------------               -----
     MENU__DefaultProps             52
     MENU__pDefaultEffect
     _GetTopLevelMenu              316
     _GetItemWidth                 284
     _GetItemHeight                292
     _CalcMenuSizeX                460
     _CalcMenuSizeY                460
     _GetItemFromPos               616
     _GetItemPos                   464
     _CloseSubmenu                 264
     _OpenSubmenu                 1240
     _SetSelectionEx               240
     _DeselectItem                 220
     _ActivateItem                 224
     _ActivateMenu                 192
     _ForwardMouseOverMsg          320
     _HandlePID                   1244
     _ForwardPIDMsgToOwner         292
     _ForwardPIDStateChange        388
     _ForwardPIDMsg                208
     _OnMenu                       444
     _OnPaint                     1308
     _OnKey                       1880
     MENU_Callback                 812
     MENU_CreateEx                 272
     MENU__GetNumItems               8
     MENU__InvalidateItem            4
     MENU__RecalcTextWidthOfItems  100
     MENU__ResizeMenu               96
     MENU__SetItem                 292
     MENU__SetItemFlags             52
     MENU__SendMenuMessage         112
     MENU_AddItem                  224
     MENU_SetOwner                  60
     MENU_SetSel                   100
     MENU_GetOwner                  84
     ??DataTable4                    4
     ??DataTable5                    4
     ??DataTable6                    4
     ??DataTable6_1                  4
     ??DataTable6_2                  4
     ?<Constant {0L}>               16
     ?<Constant "">                  1
     ?<Constant {0}>                16

 
     52 bytes in section .data
     17 bytes in section .rodata
 13 608 bytes in section .text
 
 13 608 bytes of CODE  memory
     17 bytes of CONST memory
     52 bytes of DATA  memory

Errors: none
Warnings: none
