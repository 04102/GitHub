###############################################################################
#                                                                             #
# IAR ANSI C/C++ Compiler V6.10.2.52244/W32 for ARM     02/Feb/2016  18:29:19 #
# Copyright 1999-2010 IAR Systems AB.                                         #
#                                                                             #
#    Cpu mode     =  arm                                                      #
#    Endian       =  little                                                   #
#    Source file  =  C:\DUII\TargetHW\Setup\WiFiFunctions.c                   #
#    Command line =  C:\DUII\TargetHW\Setup\WiFiFunctions.c -D DEBUG=1 -D     #
#                    SDRAM_TARGET=1 -D USB_IS_HIGH_SPEED -D NOPROFILER -D     #
#                    OS_TRACE=0 -D OS_VIEW_ENABLE=0 -lCN                      #
#                    C:\DUII\TargetHW\Release\List\ -o                        #
#                    C:\DUII\TargetHW\Release\Obj\ --endian=little            #
#                    --cpu=ARM926EJ-S -e --fpu=None --dlib_config             #
#                    "C:\Program Files (x86)\IAR Systems\Embedded Workbench   #
#                    6.0\arm\INC\c\DLib_Config_Normal.h" -I                   #
#                    C:\DUII\TargetHW\Application\SEGGERDEMO\ -I              #
#                    C:\DUII\TargetHW\Application\SEGGERDEMO\Src\ -I          #
#                    C:\DUII\TargetHW\Config\ -I C:\DUII\TargetHW\FS\ -I      #
#                    C:\DUII\TargetHW\GUI\ -I C:\DUII\TargetHW\Inc\ -I        #
#                    C:\DUII\TargetHW\OS\ -I C:\DUII\TargetHW\Setup\ -I       #
#                    \DUII\DUII\ -I \DUII\DUII\Graphics\ --cpu_mode arm -Ohs  #
#                    --use_c++_inline --require_prototypes                    #
#    List file    =  C:\DUII\TargetHW\Release\List\WiFiFunctions.lst          #
#    Object file  =  C:\DUII\TargetHW\Release\Obj\WiFiFunctions.o             #
#                                                                             #
#                                                                             #
###############################################################################

C:\DUII\TargetHW\Setup\WiFiFunctions.c
      1          // these functions are used with the Toshiba FlashAir WiFi SD card
      2          //
      3          
      4          #include "DUII.h"
      5          #include "commondefs.h"
      6          #include "GeneralConfig.h"
      7          #if	_WINDOWS
      8          #include "windows.h"
      9          #else
     10          #include "RTOS.H"
     11          #include "FS.h"
     12          #include "dataflash.h"
     13          #include "FlashReadWrite.h"
     14          #include "WiFiFunctions.h"
     15          #endif
     16          #include <stdio.h>
     17          #include <string.h>
     18          
     19          #define LINELEN	80
     20          

   \                                 In section .text, align 4, keep-with-next
     21          const char WIFI_PATH[] = { LEADING_PATH WLAN_PATH };
   \                     WIFI_PATH:
   \   00000000                      ; Initializer data, 12 bytes
   \   00000000   5C53445F574C       DC8 92, 83, 68, 95, 87, 76, 65, 78, 0, 0
   \              414E0000    
   \   0000000A   0000               DC8 0, 0

   \                                 In section .text, align 4, keep-with-next
     22          const char WIFI_FILE[] = { LEADING_PATH WLAN_PATH "\\" WIFI_CFG_FILE };
   \                     WIFI_FILE:
   \   00000000                      ; Initializer data, 16 bytes
   \   00000000   5C53445F574C       DC8 92, 83, 68, 95, 87, 76, 65, 78, 92, 67
   \              414E5C43    
   \   0000000A   4F4E46494700       DC8 79, 78, 70, 73, 71, 0

   \                                 In section .text, align 4, keep-with-next
     23          const char WIFI_OLD[] = { LEADING_PATH WLAN_PATH "\\CFG_OLD" };
   \                     WIFI_OLD:
   \   00000000                      ; Initializer data, 20 bytes
   \   00000000   5C53445F574C       DC8 92, 83, 68, 95, 87, 76, 65, 78, 92, 67
   \              414E5C43    
   \   0000000A   46475F4F4C44       DC8 70, 71, 95, 79, 76, 68, 0, 0, 0, 0
   \              00000000    

   \                                 In section .text, align 4, keep-with-next
     24          const char JUNK_PATH[] = { LEADING_PATH FLASHAIR_PATH };
   \                     JUNK_PATH:
   \   00000000                      ; Initializer data, 12 bytes
   \   00000000   5C4755504958       DC8 92, 71, 85, 80, 73, 88, 73, 78, 70, 0
   \              494E4600    
   \   0000000A   0000               DC8 0, 0

   \                                 In section .text, align 4, keep-with-next
     25          const char PHOTO_PATH[] = { LEADING_PATH PIC_PATH };
   \                     PHOTO_PATH:
   \   00000000                      ; Initializer data, 8 bytes
   \   00000000   5C4443494D00       DC8 92, 68, 67, 73, 77, 0, 0, 0
   \              0000        

   \                                 In section .rodata, align 4, keep-with-next
     26          const char WIFI_TEMP[] = { LEADING_PATH WIFI_CFG_FILE };
   \                     WIFI_TEMP:
   \   00000000                      ; Initializer data, 8 bytes
   \   00000000   5C434F4E4649       DC8 92, 67, 79, 78, 70, 73, 71, 0
   \              4700        
     27          
     28          /* function spec
     29          on sd card
     30          
     31          change folder GUPININF to read/write
     32          remove folder GUPIXINF and contents / subfolders
     33          change folder DCIM to read/write
     34          remove folder DCIM and contents / subfolders
     35          change folder SD_WLAN to read/write
     36          
     37          in folder SD_WLAN
     38          delete *.jpg
     39          delete *.htm
     40          
     41          // determine if config file is original
     42          open \\SD_WLAN\CONFIG for read
     43          read first line
     44          read second line
     45          if second line is 'VENDOR=Traqmate' process complete
     46          close \\SD_WLAN\CONFIG
     47          
     48          rename file \\SD_WLAN\CONFIG to \\SD_WLAN\CFG_OLD
     49          open file \\SD_WLAN\CFG_OLD for read
     50          open file \\SD_WLAN\CONFIG for write
     51          
     52          write line in CONFIG
     53          [Vendor]
     54          VENDOR=Traqmate
     55          PRODUCT=TraqDashWiFi
     56          LOCK=1
     57          APPMODE=4
     58          APPAUTOTIME=0
     59          APPNAME=traqdash
     60          
     61          if (unsavedSysData.wifiname[0] == '\0' || unsavedSysData.wifiname[0] == 0xFF)
     62          	APPSSID=TraqDashWiFiXXXX where XXXX is last 4 digits of TraqDash serial number
     63          	unsavedSysData.wifiname = TraqDashWiFiXXXX where XXXX is last 4 digits of TraqDash serial number
     64          else
     65          	APPSID= unsavedSysData.wifiname
     66          
     67          		
     68          if (unsavedSysData.wifipass[0] == '\0' || unsavedSysData.wifiname[0] == 0xFF)
     69          	APPNETWORKKEY="traqmate"
     70          	unsavedSysData.wifiname = "traqmate"
     71          else
     72          	APPNETWORKKEY= unsavedSysData.wifipass
     73          		
     74          read CFG_OLD line by line
     75          if line starts with 'VERSION=' or 'CID='
     76          copy line to \\SD_WLAN\CONFIG
     77          */
     78          
     79          //
     80          // this function will "terraform" a fresh Toshiba FlashAir WiFi SD card to make it into a TraqDash WiFi network
     81          //

   \                                 In section .text, align 4, keep-with-next
     82          void WiFiSetup(int rewrite) {
   \                     WiFiSetup:
   \   00000000   F04F2DE9           PUSH     {R4-R11,LR}
     83          	FS_FILE *pConfig;
     84          	FS_FILE *pOldConfig;
     85          	char line[LINELEN];				// max 80 characters
     86          	
     87          	// check for GUPIXINF folder
     88          	if (0xFF != FS_GetFileAttributes(JUNK_PATH)) {
   \   00000004   ............       ADRL     R5,JUNK_PATH
   \              ....        
   \   0000000C   0040A0E1           MOV      R4,R0
   \   00000010   FCD04DE2           SUB      SP,SP,#+252
   \   00000014   0500A0E1           MOV      R0,R5
   \   00000018   ........           BL       FS_GetFileAttributes
   \   0000001C   FF0050E3           CMP      R0,#+255
   \   00000020   0200000A           BEQ      ??WiFiSetup_0
     89          		rewrite = true;
   \   00000024   0140A0E3           MOV      R4,#+1
     90          		// delete folder GUPININF and everything in it
     91          		WipeFiles((char *) JUNK_PATH);
   \   00000028   0500A0E1           MOV      R0,R5
   \   0000002C   ........           BL       WipeFiles
     92          	} // if
     93          
     94          	// check for DCIM folder
     95          	if (0xFF != FS_GetFileAttributes(PHOTO_PATH)) {
   \                     ??WiFiSetup_0:
   \   00000030   ............       ADRL     R5,PHOTO_PATH
   \              ....        
   \   00000038   0500A0E1           MOV      R0,R5
   \   0000003C   ........           BL       FS_GetFileAttributes
   \   00000040   FF0050E3           CMP      R0,#+255
   \   00000044   8800000A           BEQ      ??WiFiSetup_1
     96          		rewrite = true;
     97          		// delete folder DCIM and everything in it
     98          		WipeFiles((char *) PHOTO_PATH);
   \   00000048   0500A0E1           MOV      R0,R5
   \   0000004C   ........           BL       WipeFiles
     99          	} // if
    100          
    101          	if (false == rewrite) {		// check to see if it is an updated file
    102          		// open file \\SD_WLAN\CONFIG for write
    103          		pConfig = FS_FOpen(WIFI_FILE, "r");
    104          
    105          		while (0 != (ReadLine(pConfig, line, LINELEN))) {
    106          			if (0 == strncmp(line, "VENDOR=Traqmate", 15)) {
    107          				rewrite = false;
    108          				break;
    109          			} // if
    110          		} // while
    111          
    112          		// close the file
    113          		FS_FClose(pConfig);
    114          	} // if
    115          	
    116          	if (rewrite) { // clean SD_WLAN folder
    117          		// move CONFIG file from SD_WLAN to root directory
    118          		FS_Move(WIFI_FILE, "\\");
   \                     ??WiFiSetup_2:
   \   00000050   ............       ADRL     R4,WIFI_FILE
   \              ....        
   \   00000058   A91F8FE2           ADR      R1,??WiFiSetup_3  ;; "\\"
   \   0000005C   0400A0E1           MOV      R0,R4
   \   00000060   ........           BL       FS_Move
   \   00000064   ............       ADRL     R0,WIFI_PATH
   \              ....        
    119          		
    120          		// remove SD_WLAN directory (in order to purge all files except CONFIG)
    121          		WipeFiles((char *) WIFI_PATH);
   \   0000006C   ........           BL       WipeFiles
    122          		
    123          		// create SD_WLAN directory
    124          		FS_MkDir(WIFI_PATH);
   \   00000070   ............       ADRL     R0,WIFI_PATH
   \              ....        
   \   00000078   ........           BL       FS_MkDir
    125          		
    126          		// move CONFIG file back to SD_WLAN directory
    127          		FS_Move("\\CONFIG", "\\SD_WLAN\\");
   \   0000007C   ............       ADRL     R1,`?<Constant "\\\\SD_WLAN\\\\">`
   \              ....        
   \   00000084   ............       ADRL     R0,`?<Constant "\\\\CONFIG">`
   \              ....        
   \   0000008C   ........           BL       FS_Move
    128          		
    129          		// rename file \\SD_WLAN\CONFIG to \\SD_WLAN\CFG_OLD
    130          		FS_Rename("\\SD_WLAN\\CONFIG", "CFG_OLD");
   \   00000090   ............       ADRL     R1,`?<Constant "CFG_OLD">`
   \              ....        
   \   00000098   ............       ADRL     R0,`?<Constant "\\\\SD_WLAN\\\\CONFIG">`
   \              ....        
   \   000000A0   ........           BL       FS_Rename
    131          		
    132          		// flush out the cache
    133          		FS_Sync("");
   \   000000A4   970F8FE2           ADR      R0,??WiFiSetup_3+0x4  ;; ""
   \   000000A8   ........           BL       FS_Sync
    134          	  
    135          		// open file \\SD_WLAN\CFG_OLD for read
    136          		pOldConfig = FS_FOpen(WIFI_OLD, "r");
   \   000000AC   961F8FE2           ADR      R1,??WiFiSetup_3+0x8  ;; "r"
   \   000000B0   ............       ADRL     R0,WIFI_OLD
   \              ....        
   \   000000B8   ........           BL       FS_FOpen
   \   000000BC   0060A0E1           MOV      R6,R0
    137          
    138          		// open file \\SD_WLAN\CONFIG for write
    139          		pConfig = FS_FOpen(WIFI_FILE, "w");
   \   000000C0   921F8FE2           ADR      R1,??WiFiSetup_3+0xC  ;; "w"
   \   000000C4   0400A0E1           MOV      R0,R4
   \   000000C8   ........           BL       FS_FOpen
   \   000000CC   0040A0E1           MOV      R4,R0
    140          			
    141          		// put stuff in new config file - note that order is important
    142          		WriteLine(pConfig, "[Vendor]");
   \   000000D0   58108DE2           ADD      R1,SP,#+88
   \   000000D4   0000E0E3           MVN      R0,#+0
   \   000000D8   011041E2           SUB      R1,R1,#+1
   \   000000DC   ............       ADRL     R2,`?<Constant "[Vendor]">`
   \              ....        
   \                     ??WiFiSetup_4:
   \   000000E4   010080E2           ADD      R0,R0,#+1
   \   000000E8   0230D0E7           LDRB     R3,[R0, +R2]
   \   000000EC   0130C1E5           STRB     R3,[R1, #+1]
   \   000000F0   0130F1E5           LDRB     R3,[R1, #+1]!
   \   000000F4   000053E3           CMP      R3,#+0
   \   000000F8   F9FFFF1A           BNE      ??WiFiSetup_4
   \   000000FC   0D70A0E3           MOV      R7,#+13
   \   00000100   58108DE2           ADD      R1,SP,#+88
   \   00000104   0170C0E7           STRB     R7,[R0, +R1]
   \   00000108   010080E2           ADD      R0,R0,#+1
   \   0000010C   0A80A0E3           MOV      R8,#+10
   \   00000110   0180C0E7           STRB     R8,[R0, +R1]
   \   00000114   012080E2           ADD      R2,R0,#+1
   \   00000118   0400A0E1           MOV      R0,R4
   \   0000011C   ........           BL       FS_Write
    143          		WriteLine(pConfig, "APPMODE=4");
   \   00000120   04108DE2           ADD      R1,SP,#+4
   \   00000124   0000E0E3           MVN      R0,#+0
   \   00000128   011041E2           SUB      R1,R1,#+1
   \   0000012C   ............       ADRL     R2,`?<Constant "APPMODE=4">`
   \              ....        
   \                     ??WiFiSetup_5:
   \   00000134   010080E2           ADD      R0,R0,#+1
   \   00000138   0230D0E7           LDRB     R3,[R0, +R2]
   \   0000013C   0130C1E5           STRB     R3,[R1, #+1]
   \   00000140   0130F1E5           LDRB     R3,[R1, #+1]!
   \   00000144   000053E3           CMP      R3,#+0
   \   00000148   F9FFFF1A           BNE      ??WiFiSetup_5
   \   0000014C   04108DE2           ADD      R1,SP,#+4
   \   00000150   0170C0E7           STRB     R7,[R0, +R1]
   \   00000154   010080E2           ADD      R0,R0,#+1
   \   00000158   0180C0E7           STRB     R8,[R0, +R1]
   \   0000015C   012080E2           ADD      R2,R0,#+1
   \   00000160   0400A0E1           MOV      R0,R4
   \   00000164   ........           BL       FS_Write
    144          		WriteLine(pConfig, "APPAUTOTIME=0");
   \   00000168   58108DE2           ADD      R1,SP,#+88
   \   0000016C   0000E0E3           MVN      R0,#+0
   \   00000170   011041E2           SUB      R1,R1,#+1
   \   00000174   ............       ADRL     R2,`?<Constant "APPAUTOTIME=0">`
   \              ....        
   \                     ??WiFiSetup_6:
   \   0000017C   010080E2           ADD      R0,R0,#+1
   \   00000180   0230D0E7           LDRB     R3,[R0, +R2]
   \   00000184   0130C1E5           STRB     R3,[R1, #+1]
   \   00000188   0130F1E5           LDRB     R3,[R1, #+1]!
   \   0000018C   000053E3           CMP      R3,#+0
   \   00000190   F9FFFF1A           BNE      ??WiFiSetup_6
   \   00000194   58108DE2           ADD      R1,SP,#+88
   \   00000198   0170C0E7           STRB     R7,[R0, +R1]
   \   0000019C   010080E2           ADD      R0,R0,#+1
   \   000001A0   0180C0E7           STRB     R8,[R0, +R1]
   \   000001A4   012080E2           ADD      R2,R0,#+1
   \   000001A8   0400A0E1           MOV      R0,R4
   \   000001AC   ........           BL       FS_Write
    145          		WriteLine(pConfig, "APPNAME=traqdash");
   \   000001B0   04108DE2           ADD      R1,SP,#+4
   \   000001B4   0000E0E3           MVN      R0,#+0
   \   000001B8   011041E2           SUB      R1,R1,#+1
   \   000001BC   ............       ADRL     R2,`?<Constant "APPNAME=traqdash">`
   \              ....        
   \                     ??WiFiSetup_7:
   \   000001C4   010080E2           ADD      R0,R0,#+1
   \   000001C8   0230D0E7           LDRB     R3,[R0, +R2]
   \   000001CC   0130C1E5           STRB     R3,[R1, #+1]
   \   000001D0   0130F1E5           LDRB     R3,[R1, #+1]!
   \   000001D4   000053E3           CMP      R3,#+0
   \   000001D8   F9FFFF1A           BNE      ??WiFiSetup_7
   \   000001DC   04108DE2           ADD      R1,SP,#+4
   \   000001E0   0170C0E7           STRB     R7,[R0, +R1]
   \   000001E4   010080E2           ADD      R0,R0,#+1
   \   000001E8   0180C0E7           STRB     R8,[R0, +R1]
   \   000001EC   012080E2           ADD      R2,R0,#+1
   \   000001F0   0400A0E1           MOV      R0,R4
   \   000001F4   ........           BL       FS_Write
    146          		strcpy (line, "APPNETWORKKEY=");
   \   000001F8   0F20A0E3           MOV      R2,#+15
   \   000001FC   ............       ADRL     R1,`?<Constant "APPNETWORKKEY=">`
   \              ....        
   \   00000204   AC008DE2           ADD      R0,SP,#+172
   \   00000208   ........           BL       __aeabi_memcpy4
   \   0000020C   ........           LDR      R1,??DataTable25
   \   00000210   AC008DE2           ADD      R0,SP,#+172
    147          		strcat (line, unsavedSysData.unitInfo.wifiPass);
   \   00000214   ........           BL       strcat
    148          		WriteLine(pConfig, line);
   \   00000218   58108DE2           ADD      R1,SP,#+88
   \   0000021C   0000E0E3           MVN      R0,#+0
   \   00000220   011041E2           SUB      R1,R1,#+1
   \   00000224   AC208DE2           ADD      R2,SP,#+172
   \                     ??WiFiSetup_8:
   \   00000228   0130D2E4           LDRB     R3,[R2], #+1
   \   0000022C   010080E2           ADD      R0,R0,#+1
   \   00000230   0130C1E5           STRB     R3,[R1, #+1]
   \   00000234   0130F1E5           LDRB     R3,[R1, #+1]!
   \   00000238   000053E3           CMP      R3,#+0
   \   0000023C   F9FFFF1A           BNE      ??WiFiSetup_8
   \   00000240   58108DE2           ADD      R1,SP,#+88
   \   00000244   0170C0E7           STRB     R7,[R0, +R1]
   \   00000248   010080E2           ADD      R0,R0,#+1
   \   0000024C   0180C0E7           STRB     R8,[R0, +R1]
   \   00000250   012080E2           ADD      R2,R0,#+1
   \   00000254   0400A0E1           MOV      R0,R4
   \   00000258   ........           BL       FS_Write
   \   0000025C   ............       ADRL     R9,`?<Constant "VERSION=">`
   \              ....        
   \   00000264   AC508DE2           ADD      R5,SP,#+172
   \   00000268   3B0000EA           B        ??WiFiSetup_9
   \                     ??WiFiSetup_1:
   \   0000026C   000054E3           CMP      R4,#+0
   \   00000270   76FFFF1A           BNE      ??WiFiSetup_2
   \   00000274   90108FE2           ADR      R1,??WiFiSetup_3+0x8  ;; "r"
   \   00000278   ............       ADRL     R0,WIFI_FILE
   \              ....        
   \   00000280   ........           BL       FS_FOpen
   \   00000284   0040A0E1           MOV      R4,R0
   \   00000288   ........           ADR      R9,`?<Constant "VENDOR=Traqmate">`
   \   0000028C   AC508DE2           ADD      R5,SP,#+172
   \                     ??WiFiSetup_10:
   \   00000290   0070A0E3           MOV      R7,#+0
   \   00000294   AC608DE2           ADD      R6,SP,#+172
   \                     ??WiFiSetup_11:
   \   00000298   0120A0E3           MOV      R2,#+1
   \   0000029C   0D10A0E1           MOV      R1,SP
   \   000002A0   0400A0E1           MOV      R0,R4
   \   000002A4   ........           BL       FS_Read
   \   000002A8   000050E3           CMP      R0,#+0
   \   000002AC   1100000A           BEQ      ??WiFiSetup_12
   \   000002B0   0000DDE5           LDRB     R0,[SP, #+0]
   \   000002B4   017087E2           ADD      R7,R7,#+1
   \   000002B8   4F0057E3           CMP      R7,#+79
   \   000002BC   0100C6E4           STRB     R0,[R6], #+1
   \   000002C0   020000AA           BGE      ??WiFiSetup_13
   \   000002C4   0000DDE5           LDRB     R0,[SP, #+0]
   \   000002C8   0A0050E3           CMP      R0,#+10
   \   000002CC   F1FFFF1A           BNE      ??WiFiSetup_11
   \                     ??WiFiSetup_13:
   \   000002D0   0000A0E3           MOV      R0,#+0
   \   000002D4   0500C7E7           STRB     R0,[R7, +R5]
   \   000002D8   010097E2           ADDS     R0,R7,#+1
   \   000002DC   0500000A           BEQ      ??WiFiSetup_12
   \   000002E0   0F20A0E3           MOV      R2,#+15
   \   000002E4   0910A0E1           MOV      R1,R9
   \   000002E8   AC008DE2           ADD      R0,SP,#+172
   \   000002EC   ........           BL       strncmp
   \   000002F0   000050E3           CMP      R0,#+0
   \   000002F4   E5FFFF1A           BNE      ??WiFiSetup_10
   \                     ??WiFiSetup_12:
   \   000002F8   0400A0E1           MOV      R0,R4
   \   000002FC   ........           BL       FS_FClose
   \   00000300   7B0000EA           B        ??WiFiSetup_14
   \                     ??WiFiSetup_3:
   \   00000304   5C000000           DC8      "\\",0x0,0x0
   \   00000308   00000000           DC8      "",0x0,0x0,0x0
   \   0000030C   72000000           DC8      "r",0x0,0x0
   \   00000310   77000000           DC8      "w",0x0,0x0
    149          		
    150          		// read old config file line by line and copy 2 important ones over
    151          		while (0 != (ReadLine(pOldConfig, line, LINELEN))) {
    152          			if ((0 == strncmp(line, "VERSION=", 8)) || (0 == strncmp(line, "CID=", 4)))
   \                     ??WiFiSetup_15:
   \   00000314   0820A0E3           MOV      R2,#+8
   \   00000318   0910A0E1           MOV      R1,R9
   \   0000031C   AC008DE2           ADD      R0,SP,#+172
   \   00000320   ........           BL       strncmp
   \   00000324   000050E3           CMP      R0,#+0
   \   00000328   0500000A           BEQ      ??WiFiSetup_16
   \   0000032C   0420A0E3           MOV      R2,#+4
   \   00000330   ........           ADR      R1,`?<Constant "CID=">`
   \   00000334   AC008DE2           ADD      R0,SP,#+172
   \   00000338   ........           BL       strncmp
   \   0000033C   000050E3           CMP      R0,#+0
   \   00000340   0500001A           BNE      ??WiFiSetup_9
    153          				FS_Write(pConfig, line, strlen(line));		// use FS_Write because already contains newline
   \                     ??WiFiSetup_16:
   \   00000344   AC008DE2           ADD      R0,SP,#+172
   \   00000348   ........           BL       strlen
   \   0000034C   0020A0E1           MOV      R2,R0
   \   00000350   AC108DE2           ADD      R1,SP,#+172
   \   00000354   0400A0E1           MOV      R0,R4
   \   00000358   ........           BL       FS_Write
    154          		} // while
   \                     ??WiFiSetup_9:
   \   0000035C   00A0A0E3           MOV      R10,#+0
   \   00000360   ACB08DE2           ADD      R11,SP,#+172
   \                     ??WiFiSetup_17:
   \   00000364   0120A0E3           MOV      R2,#+1
   \   00000368   0D10A0E1           MOV      R1,SP
   \   0000036C   0600A0E1           MOV      R0,R6
   \   00000370   ........           BL       FS_Read
   \   00000374   000050E3           CMP      R0,#+0
   \   00000378   0B00000A           BEQ      ??WiFiSetup_18
   \   0000037C   0000DDE5           LDRB     R0,[SP, #+0]
   \   00000380   01A08AE2           ADD      R10,R10,#+1
   \   00000384   4F005AE3           CMP      R10,#+79
   \   00000388   0100CBE4           STRB     R0,[R11], #+1
   \   0000038C   020000AA           BGE      ??WiFiSetup_19
   \   00000390   0000DDE5           LDRB     R0,[SP, #+0]
   \   00000394   0A0050E3           CMP      R0,#+10
   \   00000398   F1FFFF1A           BNE      ??WiFiSetup_17
   \                     ??WiFiSetup_19:
   \   0000039C   0000A0E3           MOV      R0,#+0
   \   000003A0   0500CAE7           STRB     R0,[R10, +R5]
   \   000003A4   01009AE2           ADDS     R0,R10,#+1
   \   000003A8   D9FFFF1A           BNE      ??WiFiSetup_15
    155          
    156          		WriteLine(pConfig, "PRODUCT=TraqDashWiFi");
   \                     ??WiFiSetup_18:
   \   000003AC   58108DE2           ADD      R1,SP,#+88
   \   000003B0   0000E0E3           MVN      R0,#+0
   \   000003B4   011041E2           SUB      R1,R1,#+1
   \   000003B8   ........           ADR      R2,`?<Constant "PRODUCT=TraqDashWiFi">`
   \                     ??WiFiSetup_20:
   \   000003BC   010080E2           ADD      R0,R0,#+1
   \   000003C0   0230D0E7           LDRB     R3,[R0, +R2]
   \   000003C4   0130C1E5           STRB     R3,[R1, #+1]
   \   000003C8   0130F1E5           LDRB     R3,[R1, #+1]!
   \   000003CC   000053E3           CMP      R3,#+0
   \   000003D0   F9FFFF1A           BNE      ??WiFiSetup_20
   \   000003D4   58108DE2           ADD      R1,SP,#+88
   \   000003D8   0170C0E7           STRB     R7,[R0, +R1]
   \   000003DC   010080E2           ADD      R0,R0,#+1
   \   000003E0   0180C0E7           STRB     R8,[R0, +R1]
   \   000003E4   012080E2           ADD      R2,R0,#+1
   \   000003E8   0400A0E1           MOV      R0,R4
   \   000003EC   ........           BL       FS_Write
    157          		WriteLine(pConfig, "VENDOR=Traqmate");
   \   000003F0   04108DE2           ADD      R1,SP,#+4
   \   000003F4   0000E0E3           MVN      R0,#+0
   \   000003F8   011041E2           SUB      R1,R1,#+1
   \   000003FC   ........           ADR      R9,`?<Constant "VENDOR=Traqmate">`
   \                     ??WiFiSetup_21:
   \   00000400   010080E2           ADD      R0,R0,#+1
   \   00000404   0920D0E7           LDRB     R2,[R0, +R9]
   \   00000408   0120C1E5           STRB     R2,[R1, #+1]
   \   0000040C   0120F1E5           LDRB     R2,[R1, #+1]!
   \   00000410   000052E3           CMP      R2,#+0
   \   00000414   F9FFFF1A           BNE      ??WiFiSetup_21
   \   00000418   04108DE2           ADD      R1,SP,#+4
   \   0000041C   0170C0E7           STRB     R7,[R0, +R1]
   \   00000420   010080E2           ADD      R0,R0,#+1
   \   00000424   0180C0E7           STRB     R8,[R0, +R1]
   \   00000428   012080E2           ADD      R2,R0,#+1
   \   0000042C   0400A0E1           MOV      R0,R4
   \   00000430   ........           BL       FS_Write
    158          		strcpy (line, "APPSSID=");
   \   00000434   0920A0E3           MOV      R2,#+9
   \   00000438   ........           ADR      R1,`?<Constant "APPSSID=">`
   \   0000043C   AC008DE2           ADD      R0,SP,#+172
   \   00000440   ........           BL       __aeabi_memcpy4
    159          		strcat (line, unsavedSysData.unitInfo.wifiName);
   \   00000444   ........           LDR      R1,??DataTable25_1
   \   00000448   AC008DE2           ADD      R0,SP,#+172
   \   0000044C   ........           BL       strcat
    160          		WriteLine(pConfig, line);
   \   00000450   58108DE2           ADD      R1,SP,#+88
   \   00000454   0000E0E3           MVN      R0,#+0
   \   00000458   011041E2           SUB      R1,R1,#+1
   \   0000045C   AC208DE2           ADD      R2,SP,#+172
   \                     ??WiFiSetup_22:
   \   00000460   0130D2E4           LDRB     R3,[R2], #+1
   \   00000464   010080E2           ADD      R0,R0,#+1
   \   00000468   0130C1E5           STRB     R3,[R1, #+1]
   \   0000046C   0130F1E5           LDRB     R3,[R1, #+1]!
   \   00000470   000053E3           CMP      R3,#+0
   \   00000474   F9FFFF1A           BNE      ??WiFiSetup_22
   \   00000478   58108DE2           ADD      R1,SP,#+88
   \   0000047C   0170C0E7           STRB     R7,[R0, +R1]
   \   00000480   010080E2           ADD      R0,R0,#+1
   \   00000484   0180C0E7           STRB     R8,[R0, +R1]
   \   00000488   012080E2           ADD      R2,R0,#+1
   \   0000048C   0400A0E1           MOV      R0,R4
   \   00000490   ........           BL       FS_Write
    161          		WriteLine(pConfig, "LOCK=1");
   \   00000494   04108DE2           ADD      R1,SP,#+4
   \   00000498   0000E0E3           MVN      R0,#+0
   \   0000049C   011041E2           SUB      R1,R1,#+1
   \   000004A0   ........           ADR      R2,`?<Constant "LOCK=1">`
   \                     ??WiFiSetup_23:
   \   000004A4   010080E2           ADD      R0,R0,#+1
   \   000004A8   0230D0E7           LDRB     R3,[R0, +R2]
   \   000004AC   0130C1E5           STRB     R3,[R1, #+1]
   \   000004B0   0130F1E5           LDRB     R3,[R1, #+1]!
   \   000004B4   000053E3           CMP      R3,#+0
   \   000004B8   F9FFFF1A           BNE      ??WiFiSetup_23
   \   000004BC   04108DE2           ADD      R1,SP,#+4
   \   000004C0   0170C0E7           STRB     R7,[R0, +R1]
   \   000004C4   010080E2           ADD      R0,R0,#+1
   \   000004C8   0180C0E7           STRB     R8,[R0, +R1]
   \   000004CC   012080E2           ADD      R2,R0,#+1
   \   000004D0   0400A0E1           MOV      R0,R4
   \   000004D4   ........           BL       FS_Write
    162          
    163          		// close the files
    164          		FS_FClose(pOldConfig);
   \   000004D8   0600A0E1           MOV      R0,R6
   \   000004DC   ........           BL       FS_FClose
    165          		FS_FClose(pConfig);
   \   000004E0   0400A0E1           MOV      R0,R4
   \   000004E4   ........           BL       FS_FClose
    166          	
    167          		// change path back to hidden and read only
    168          		FS_SetFileAttributes(WIFI_PATH, FS_ATTR_HIDDEN | FS_ATTR_READ_ONLY);
   \   000004E8   0310A0E3           MOV      R1,#+3
   \   000004EC   ........           ADR      R0,WIFI_PATH
   \   000004F0   ........           BL       FS_SetFileAttributes
    169          
    170          	} // if
    171          } // WiFiSetup()
   \                     ??WiFiSetup_14:
   \   000004F4   FCD08DE2           ADD      SP,SP,#+252      ;; stack cleaning
   \   000004F8   F08FBDE8           POP      {R4-R11,PC}      ;; return
    172          
    173          // writes a text line to designated file and appends a newline

   \                                 In section .text, align 4, keep-with-next
    174          void WriteLine(FS_FILE *pFile, char *line) {
   \                     WriteLine:
   \   00000000   00402DE9           PUSH     {LR}
   \   00000004   54D04DE2           SUB      SP,SP,#+84
    175          	char outline[LINELEN+2];
    176          	int len = -1;
   \   00000008   0020E0E3           MVN      R2,#+0
   \   0000000C   01304DE2           SUB      R3,SP,#+1
    177          	
    178          	do {
    179          		len++;
    180          	} while ('\0' != (outline[len] = line[len]));
   \                     ??WriteLine_0:
   \   00000010   01C0D1E4           LDRB     R12,[R1], #+1
   \   00000014   012082E2           ADD      R2,R2,#+1
   \   00000018   01C0C3E5           STRB     R12,[R3, #+1]
   \   0000001C   01C0F3E5           LDRB     R12,[R3, #+1]!
   \   00000020   00005CE3           CMP      R12,#+0
   \   00000024   F9FFFF1A           BNE      ??WriteLine_0
    181          	
    182          	outline[len++] = '\r';
   \   00000028   0D10A0E1           MOV      R1,SP
   \   0000002C   0D30A0E3           MOV      R3,#+13
   \   00000030   0130C2E7           STRB     R3,[R2, +R1]
   \   00000034   012082E2           ADD      R2,R2,#+1
    183          	outline[len++] = '\n';
   \   00000038   0A30A0E3           MOV      R3,#+10
   \   0000003C   0130C2E7           STRB     R3,[R2, +R1]
    184          	FS_Write(pFile, outline, len);
   \   00000040   012082E2           ADD      R2,R2,#+1
   \   00000044   ........           BL       FS_Write
    185          
    186          } // WriteLine
   \   00000048   54D08DE2           ADD      SP,SP,#+84       ;; stack cleaning
   \   0000004C   0080BDE8           POP      {PC}             ;; return
    187          
    188          // gets a string up to and including a carriage return / newline from the designated file

   \                                 In section .text, align 4, keep-with-next
    189          int ReadLine(FS_FILE *pFile, char *line, int len) {
   \                     ReadLine:
   \   00000000   F0412DE9           PUSH     {R4-R8,LR}
   \   00000004   0150A0E1           MOV      R5,R1
   \   00000008   08D04DE2           SUB      SP,SP,#+8
   \   0000000C   0040A0E1           MOV      R4,R0
    190          	char ch;
    191          	int cnt = 0;
   \   00000010   0080A0E3           MOV      R8,#+0
   \   00000014   0560A0E1           MOV      R6,R5
   \   00000018   017042E2           SUB      R7,R2,#+1
    192          	int numread;
    193          	
    194          	while (0 != (numread = FS_Read(pFile, &ch, 1))) {
   \                     ??ReadLine_0:
   \   0000001C   0120A0E3           MOV      R2,#+1
   \   00000020   0D10A0E1           MOV      R1,SP
   \   00000024   0400A0E1           MOV      R0,R4
   \   00000028   ........           BL       FS_Read
   \   0000002C   000050E3           CMP      R0,#+0
   \   00000030   0A00000A           BEQ      ??ReadLine_1
    195          		line[cnt++] = ch;
   \   00000034   0000DDE5           LDRB     R0,[SP, #+0]
   \   00000038   018088E2           ADD      R8,R8,#+1
    196          		if (cnt >= (len-1)) break;
   \   0000003C   070058E1           CMP      R8,R7
   \   00000040   0100C6E4           STRB     R0,[R6], #+1
   \   00000044   020000AA           BGE      ??ReadLine_2
    197          		if ('\n' == ch) break;
   \   00000048   0000DDE5           LDRB     R0,[SP, #+0]
   \   0000004C   0A0050E3           CMP      R0,#+10
   \   00000050   F1FFFF1A           BNE      ??ReadLine_0
    198          	} // while
    199          
    200          	if (0 == numread)
    201          		return 0;
    202          
    203          	line[cnt++] = '\0';
   \                     ??ReadLine_2:
   \   00000054   0000A0E3           MOV      R0,#+0
   \   00000058   0500C8E7           STRB     R0,[R8, +R5]
    204          	return cnt;
   \   0000005C   010088E2           ADD      R0,R8,#+1
   \                     ??ReadLine_1:
   \   00000060   08D08DE2           ADD      SP,SP,#+8        ;; stack cleaning
   \   00000064   F081BDE8           POP      {R4-R8,PC}       ;; return
    205          } // ReadLine

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable25:
   \   00000000   ........           DC32     unsavedSysData+0x44

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable25_1:
   \   00000000   ........           DC32     unsavedSysData+0x30

   \                                 In section .text, align 4, keep-with-next
   \                     `?<Constant "VENDOR=Traqmate">`:
   \   00000000                      ; Initializer data, 16 bytes
   \   00000000   56454E444F52       DC8 86, 69, 78, 68, 79, 82, 61, 84, 114, 97
   \              3D547261    
   \   0000000A   716D61746500       DC8 113, 109, 97, 116, 101, 0

   \                                 In section .text, align 4, keep-with-next
   \                     `?<Constant "\\\\CONFIG">`:
   \   00000000                      ; Initializer data, 8 bytes
   \   00000000   5C434F4E4649       DC8 92, 67, 79, 78, 70, 73, 71, 0
   \              4700        

   \                                 In section .text, align 4, keep-with-next
   \                     `?<Constant "\\\\SD_WLAN\\\\">`:
   \   00000000                      ; Initializer data, 12 bytes
   \   00000000   5C53445F574C       DC8 92, 83, 68, 95, 87, 76, 65, 78, 92, 0
   \              414E5C00    
   \   0000000A   0000               DC8 0, 0

   \                                 In section .text, align 4, keep-with-next
   \                     `?<Constant "\\\\SD_WLAN\\\\CONFIG">`:
   \   00000000                      ; Initializer data, 16 bytes
   \   00000000   5C53445F574C       DC8 92, 83, 68, 95, 87, 76, 65, 78, 92, 67
   \              414E5C43    
   \   0000000A   4F4E46494700       DC8 79, 78, 70, 73, 71, 0

   \                                 In section .text, align 4, keep-with-next
   \                     `?<Constant "CFG_OLD">`:
   \   00000000                      ; Initializer data, 8 bytes
   \   00000000   4346475F4F4C       DC8 67, 70, 71, 95, 79, 76, 68, 0
   \              4400        

   \                                 In section .text, align 4, keep-with-next
   \                     `?<Constant "[Vendor]">`:
   \   00000000                      ; Initializer data, 12 bytes
   \   00000000   5B56656E646F       DC8 91, 86, 101, 110, 100, 111, 114, 93, 0, 0
   \              725D0000    
   \   0000000A   0000               DC8 0, 0

   \                                 In section .text, align 4, keep-with-next
   \                     `?<Constant "APPMODE=4">`:
   \   00000000                      ; Initializer data, 12 bytes
   \   00000000   4150504D4F44       DC8 65, 80, 80, 77, 79, 68, 69, 61, 52, 0
   \              453D3400    
   \   0000000A   0000               DC8 0, 0

   \                                 In section .text, align 4, keep-with-next
   \                     `?<Constant "APPAUTOTIME=0">`:
   \   00000000                      ; Initializer data, 16 bytes
   \   00000000   415050415554       DC8 65, 80, 80, 65, 85, 84, 79, 84, 73, 77
   \              4F54494D    
   \   0000000A   453D30000000       DC8 69, 61, 48, 0, 0, 0

   \                                 In section .text, align 4, keep-with-next
   \                     `?<Constant "APPNAME=traqdash">`:
   \   00000000                      ; Initializer data, 20 bytes
   \   00000000   4150504E414D       DC8 65, 80, 80, 78, 65, 77, 69, 61, 116, 114
   \              453D7472    
   \   0000000A   617164617368       DC8 97, 113, 100, 97, 115, 104, 0, 0, 0, 0
   \              00000000    

   \                                 In section .text, align 4, keep-with-next
   \                     `?<Constant "APPNETWORKKEY=">`:
   \   00000000                      ; Initializer data, 16 bytes
   \   00000000   4150504E4554       DC8 65, 80, 80, 78, 69, 84, 87, 79, 82, 75
   \              574F524B    
   \   0000000A   4B45593D0000       DC8 75, 69, 89, 61, 0, 0

   \                                 In section .text, align 4, keep-with-next
   \                     `?<Constant "VERSION=">`:
   \   00000000                      ; Initializer data, 12 bytes
   \   00000000   56455253494F       DC8 86, 69, 82, 83, 73, 79, 78, 61, 0, 0
   \              4E3D0000    
   \   0000000A   0000               DC8 0, 0

   \                                 In section .text, align 4, keep-with-next
   \                     `?<Constant "CID=">`:
   \   00000000                      ; Initializer data, 8 bytes
   \   00000000   4349443D0000       DC8 67, 73, 68, 61, 0, 0, 0, 0
   \              0000        

   \                                 In section .text, align 4, keep-with-next
   \                     `?<Constant "PRODUCT=TraqDashWiFi">`:
   \   00000000                      ; Initializer data, 24 bytes
   \   00000000   50524F445543       DC8 80, 82, 79, 68, 85, 67, 84, 61, 84, 114
   \              543D5472    
   \   0000000A   617144617368       DC8 97, 113, 68, 97, 115, 104, 87, 105, 70, 105
   \              57694669    
   \   00000014   00000000           DC8 0, 0, 0, 0

   \                                 In section .text, align 4, keep-with-next
   \                     `?<Constant "APPSSID=">`:
   \   00000000                      ; Initializer data, 12 bytes
   \   00000000   415050535349       DC8 65, 80, 80, 83, 83, 73, 68, 61, 0, 0
   \              443D0000    
   \   0000000A   0000               DC8 0, 0

   \                                 In section .text, align 4, keep-with-next
   \                     `?<Constant "LOCK=1">`:
   \   00000000                      ; Initializer data, 8 bytes
   \   00000000   4C4F434B3D31       DC8 76, 79, 67, 75, 61, 49, 0, 0
   \              0000        

   \                                 In section .rodata, align 2, keep-with-next
   \                     `?<Constant "r">`:
   \   00000000                      ; Initializer data, 2 bytes
   \   00000000   7200               DC8 114, 0

   \                                 In section .rodata, align 2, keep-with-next
   \                     `?<Constant "\\\\">`:
   \   00000000                      ; Initializer data, 2 bytes
   \   00000000   5C00               DC8 92, 0

   \                                 In section .rodata, align 1, keep-with-next
   \                     `?<Constant "">`:
   \   00000000                      ; Initializer data, 1 bytes
   \   00000000   00                 DC8 0

   \                                 In section .rodata, align 2, keep-with-next
   \                     `?<Constant "w">`:
   \   00000000                      ; Initializer data, 2 bytes
   \   00000000   7700               DC8 119, 0

   Maximum stack usage in bytes:

     Function  .cstack
     --------  -------
     ReadLine      32
     WiFiSetup    288
     WriteLine     88


   Section sizes:

     Function/Label                     Bytes
     --------------                     -----
     WIFI_PATH                            12
     WIFI_FILE                            16
     WIFI_OLD                             20
     JUNK_PATH                            12
     PHOTO_PATH                            8
     WIFI_TEMP                             8
     WiFiSetup                          1276
     WriteLine                            80
     ReadLine                            104
     ??DataTable25                         4
     ??DataTable25_1                       4
     ?<Constant "VENDOR=Traqmate">        16
     ?<Constant "\\CONFIG">                8
     ?<Constant "\\SD_WLAN\\">            12
     ?<Constant "\\SD_WLAN\\CONFIG">      16
     ?<Constant "CFG_OLD">                 8
     ?<Constant "[Vendor]">               12
     ?<Constant "APPMODE=4">              12
     ?<Constant "APPAUTOTIME=0">          16
     ?<Constant "APPNAME=traqdash">       20
     ?<Constant "APPNETWORKKEY=">         16
     ?<Constant "VERSION=">               12
     ?<Constant "CID=">                    8
     ?<Constant "PRODUCT=TraqDashWiFi">   24
     ?<Constant "APPSSID=">               12
     ?<Constant "LOCK=1">                  8
     ?<Constant "r">                       2
     ?<Constant "\\">                      2
     ?<Constant "">                        1
     ?<Constant "w">                       2

 
    15 bytes in section .rodata
 1 736 bytes in section .text
 
 1 736 bytes of CODE  memory
    15 bytes of CONST memory

Errors: none
Warnings: none
